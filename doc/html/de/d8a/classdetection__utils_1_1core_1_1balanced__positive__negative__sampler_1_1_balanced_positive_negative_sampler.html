<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RESIIST: detection_utils.core.balanced_positive_negative_sampler.BalancedPositiveNegativeSampler Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">RESIIST
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d8/d97/namespacedetection__utils.html">detection_utils</a></li><li class="navelem"><a class="el" href="../../de/d5d/namespacedetection__utils_1_1core.html">core</a></li><li class="navelem"><a class="el" href="../../d3/d58/namespacedetection__utils_1_1core_1_1balanced__positive__negative__sampler.html">balanced_positive_negative_sampler</a></li><li class="navelem"><a class="el" href="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler.html">BalancedPositiveNegativeSampler</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="../../dc/dbd/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">detection_utils.core.balanced_positive_negative_sampler.BalancedPositiveNegativeSampler Class Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for detection_utils.core.balanced_positive_negative_sampler.BalancedPositiveNegativeSampler:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d8c/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler__inherit__graph.png" border="0" usemap="#adetection__utils_8core_8balanced__positive__negative__sampler_8_balanced_positive_negative_sampler_inherit__map" alt="Inheritance graph"/></div>
<map name="adetection__utils_8core_8balanced__positive__negative__sampler_8_balanced_positive_negative_sampler_inherit__map" id="adetection__utils_8core_8balanced__positive__negative__sampler_8_balanced_positive_negative_sampler_inherit__map">
<area shape="rect" title=" " alt="" coords="76,287,305,496"/>
<area shape="rect" href="../../dd/dc4/classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler.html" title=" " alt="" coords="97,119,284,239"/>
<area shape="poly" title=" " alt="" coords="193,253,193,286,188,286,188,253"/>
<area shape="rect" title=" " alt="" coords="5,5,131,71"/>
<area shape="poly" title=" " alt="" coords="107,80,140,116,136,120,103,83"/>
<area shape="rect" title=" " alt="" coords="155,5,226,71"/>
<area shape="poly" title=" " alt="" coords="193,85,193,118,188,118,188,85"/>
<area shape="rect" title=" " alt="" coords="250,5,299,71"/>
<area shape="poly" title=" " alt="" coords="251,84,229,120,224,117,246,81"/>
</map>
</div>
<div class="dynheader">
Collaboration diagram for detection_utils.core.balanced_positive_negative_sampler.BalancedPositiveNegativeSampler:</div>
<div class="dyncontent">
<div class="center"><img src="../../d8/dba/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler__coll__graph.png" border="0" usemap="#adetection__utils_8core_8balanced__positive__negative__sampler_8_balanced_positive_negative_sampler_coll__map" alt="Collaboration graph"/></div>
<map name="adetection__utils_8core_8balanced__positive__negative__sampler_8_balanced_positive_negative_sampler_coll__map" id="adetection__utils_8core_8balanced__positive__negative__sampler_8_balanced_positive_negative_sampler_coll__map">
<area shape="rect" title=" " alt="" coords="76,287,305,496"/>
<area shape="rect" href="../../dd/dc4/classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler.html" title=" " alt="" coords="97,119,284,239"/>
<area shape="poly" title=" " alt="" coords="193,253,193,286,188,286,188,253"/>
<area shape="rect" title=" " alt="" coords="5,5,131,71"/>
<area shape="poly" title=" " alt="" coords="107,80,140,116,136,120,103,83"/>
<area shape="rect" title=" " alt="" coords="155,5,226,71"/>
<area shape="poly" title=" " alt="" coords="193,85,193,118,188,118,188,85"/>
<area shape="rect" title=" " alt="" coords="250,5,299,71"/>
<area shape="poly" title=" " alt="" coords="251,84,229,120,224,117,246,81"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a4bb04705236af59e8b4938304074f35c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler.html#a4bb04705236af59e8b4938304074f35c">__init__</a> (self, positive_fraction=0.5, is_static=False)</td></tr>
<tr class="separator:a4bb04705236af59e8b4938304074f35c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47ecd1ba4a6e9f0be57ff1b85f7a6c56"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler.html#a47ecd1ba4a6e9f0be57ff1b85f7a6c56">subsample</a> (self, indicator, batch_size, labels, scope=None)</td></tr>
<tr class="separator:a47ecd1ba4a6e9f0be57ff1b85f7a6c56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e60af5bd531feb28ad2c179b8e745a4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/dc4/classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler.html#a0e60af5bd531feb28ad2c179b8e745a4">__init__</a> (self)</td></tr>
<tr class="separator:a0e60af5bd531feb28ad2c179b8e745a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af62418aa0c50303f6b5f4e8f5130651f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/dc4/classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler.html#af62418aa0c50303f6b5f4e8f5130651f">subsample</a> (self, indicator, batch_size, **params)</td></tr>
<tr class="separator:af62418aa0c50303f6b5f4e8f5130651f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-methods" name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a114dc7eba49d5c24ca4a9645e6557aca"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler.html#a114dc7eba49d5c24ca4a9645e6557aca">_get_num_pos_neg_samples</a> (self, sorted_indices_tensor, sample_size)</td></tr>
<tr class="separator:a114dc7eba49d5c24ca4a9645e6557aca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbe6d71b81e8ef0007043b6a7ae23692"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler.html#adbe6d71b81e8ef0007043b6a7ae23692">_get_values_from_start_and_end</a> (self, input_tensor, num_start_samples, num_end_samples, total_num_samples)</td></tr>
<tr class="separator:adbe6d71b81e8ef0007043b6a7ae23692"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa87afbab24c4a5d1214eb918bf534436"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler.html#aa87afbab24c4a5d1214eb918bf534436">_static_subsample</a> (self, indicator, batch_size, labels)</td></tr>
<tr class="separator:aa87afbab24c4a5d1214eb918bf534436"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-attribs" name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:a52824e1d5b1e9c3a085f9bd1e733f008"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler.html#a52824e1d5b1e9c3a085f9bd1e733f008">_positive_fraction</a></td></tr>
<tr class="separator:a52824e1d5b1e9c3a085f9bd1e733f008"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cf7a20373c2870b4ea3b316403adb8c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler.html#a0cf7a20373c2870b4ea3b316403adb8c">_is_static</a></td></tr>
<tr class="separator:a0cf7a20373c2870b4ea3b316403adb8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="inherited" name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pub_static_methods_classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler"><td colspan="2" onclick="javascript:toggleInherit('pub_static_methods_classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler')"><img src="../../closed.png" alt="-"/>&#160;Static Public Member Functions inherited from <a class="el" href="../../dd/dc4/classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler.html">detection_utils.core.minibatch_sampler.MinibatchSampler</a></td></tr>
<tr class="memitem:a2c2eda2a51cf3969cfe0211ac6658ba6 inherit pub_static_methods_classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/dc4/classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler.html#a2c2eda2a51cf3969cfe0211ac6658ba6">subsample_indicator</a> (indicator, num_samples)</td></tr>
<tr class="separator:a2c2eda2a51cf3969cfe0211ac6658ba6 inherit pub_static_methods_classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Subsamples minibatches to a desired balance of positives and negatives.</pre> 
<p class="definition">Definition at line <a class="el" href="../../d2/d4c/balanced__positive__negative__sampler_8py_source.html#l00039">39</a> of file <a class="el" href="../../d2/d4c/balanced__positive__negative__sampler_8py_source.html">balanced_positive_negative_sampler.py</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a4bb04705236af59e8b4938304074f35c" name="a4bb04705236af59e8b4938304074f35c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4bb04705236af59e8b4938304074f35c">&#9670;&#160;</a></span>__init__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.balanced_positive_negative_sampler.BalancedPositiveNegativeSampler.__init__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>positive_fraction</em> = <code>0.5</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>is_static</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Constructs a minibatch sampler.

Args:
  positive_fraction: desired fraction of positive examples (scalar in [0,1])
    in the batch.
  is_static: If True, uses an implementation with static shape guarantees.

Raises:
  ValueError: if positive_fraction &lt; 0, or positive_fraction &gt; 1
</pre> 
<p>Reimplemented from <a class="el" href="../../dd/dc4/classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler.html#a0e60af5bd531feb28ad2c179b8e745a4">detection_utils.core.minibatch_sampler.MinibatchSampler</a>.</p>

<p class="definition">Definition at line <a class="el" href="../../d2/d4c/balanced__positive__negative__sampler_8py_source.html#l00042">42</a> of file <a class="el" href="../../d2/d4c/balanced__positive__negative__sampler_8py_source.html">balanced_positive_negative_sampler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   42</span>  <span class="keyword">def </span>__init__(self, positive_fraction=0.5, is_static=False):</div>
<div class="line"><span class="lineno">   43</span>    <span class="stringliteral">&quot;&quot;&quot;Constructs a minibatch sampler.</span></div>
<div class="line"><span class="lineno">   44</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   45</span><span class="stringliteral">    Args:</span></div>
<div class="line"><span class="lineno">   46</span><span class="stringliteral">      positive_fraction: desired fraction of positive examples (scalar </span><span class="keywordflow">in</span> [0,1])</div>
<div class="line"><span class="lineno">   47</span>        <span class="keywordflow">in</span> the batch.</div>
<div class="line"><span class="lineno">   48</span>      is_static: If <span class="keyword">True</span>, uses an implementation <span class="keyword">with</span> static shape guarantees.</div>
<div class="line"><span class="lineno">   49</span> </div>
<div class="line"><span class="lineno">   50</span>    Raises:</div>
<div class="line"><span class="lineno">   51</span>      ValueError: <span class="keywordflow">if</span> positive_fraction &lt; 0, <span class="keywordflow">or</span> positive_fraction &gt; 1</div>
<div class="line"><span class="lineno">   52</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   53</span><span class="stringliteral">    </span><span class="keywordflow">if</span> positive_fraction &lt; 0 <span class="keywordflow">or</span> positive_fraction &gt; 1:</div>
<div class="line"><span class="lineno">   54</span>      <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;positive_fraction should be in range [0,1]. &#39;</span></div>
<div class="line"><span class="lineno">   55</span>                       <span class="stringliteral">&#39;Received: %s.&#39;</span> % positive_fraction)</div>
<div class="line"><span class="lineno">   56</span>    self._positive_fraction = positive_fraction</div>
<div class="line"><span class="lineno">   57</span>    self._is_static = is_static</div>
<div class="line"><span class="lineno">   58</span> </div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a114dc7eba49d5c24ca4a9645e6557aca" name="a114dc7eba49d5c24ca4a9645e6557aca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a114dc7eba49d5c24ca4a9645e6557aca">&#9670;&#160;</a></span>_get_num_pos_neg_samples()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.balanced_positive_negative_sampler.BalancedPositiveNegativeSampler._get_num_pos_neg_samples </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>sorted_indices_tensor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>sample_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Counts the number of positives and negatives numbers to be sampled.

Args:
  sorted_indices_tensor: A sorted int32 tensor of shape [N] which contains
    the signed indices of the examples where the sign is based on the label
    value. The examples that cannot be sampled are set to 0. It samples
    atmost sample_size*positive_fraction positive examples and remaining
    from negative examples.
  sample_size: Size of subsamples.

Returns:
  A tuple containing the number of positive and negative labels in the
  subsample.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d2/d4c/balanced__positive__negative__sampler_8py_source.html#l00059">59</a> of file <a class="el" href="../../d2/d4c/balanced__positive__negative__sampler_8py_source.html">balanced_positive_negative_sampler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   59</span>  <span class="keyword">def </span>_get_num_pos_neg_samples(self, sorted_indices_tensor, sample_size):</div>
<div class="line"><span class="lineno">   60</span>    <span class="stringliteral">&quot;&quot;&quot;Counts the number of positives and negatives numbers to be sampled.</span></div>
<div class="line"><span class="lineno">   61</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   62</span><span class="stringliteral">    Args:</span></div>
<div class="line"><span class="lineno">   63</span><span class="stringliteral">      sorted_indices_tensor: A sorted int32 tensor of shape [N] which contains</span></div>
<div class="line"><span class="lineno">   64</span><span class="stringliteral">        the signed indices of the examples where the sign </span><span class="keywordflow">is</span> based on the label</div>
<div class="line"><span class="lineno">   65</span>        value. The examples that cannot be sampled are set to 0. It samples</div>
<div class="line"><span class="lineno">   66</span>        atmost sample_size*positive_fraction positive examples <span class="keywordflow">and</span> remaining</div>
<div class="line"><span class="lineno">   67</span>        <span class="keyword">from</span> negative examples.</div>
<div class="line"><span class="lineno">   68</span>      sample_size: Size of subsamples.</div>
<div class="line"><span class="lineno">   69</span> </div>
<div class="line"><span class="lineno">   70</span>    Returns:</div>
<div class="line"><span class="lineno">   71</span>      A tuple containing the number of positive <span class="keywordflow">and</span> negative labels <span class="keywordflow">in</span> the</div>
<div class="line"><span class="lineno">   72</span>      subsample.</div>
<div class="line"><span class="lineno">   73</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   74</span><span class="stringliteral">    input_length = tf.shape(sorted_indices_tensor)[0]</span></div>
<div class="line"><span class="lineno">   75</span><span class="stringliteral">    valid_positive_index = tf.greater(sorted_indices_tensor,</span></div>
<div class="line"><span class="lineno">   76</span><span class="stringliteral">                                      tf.zeros(input_length, tf.int32))</span></div>
<div class="line"><span class="lineno">   77</span><span class="stringliteral">    num_sampled_pos = tf.reduce_sum(tf.cast(valid_positive_index, tf.int32))</span></div>
<div class="line"><span class="lineno">   78</span><span class="stringliteral">    max_num_positive_samples = tf.constant(</span></div>
<div class="line"><span class="lineno">   79</span><span class="stringliteral">        int(sample_size * self._positive_fraction), tf.int32)</span></div>
<div class="line"><span class="lineno">   80</span><span class="stringliteral">    num_positive_samples = tf.minimum(max_num_positive_samples, num_sampled_pos)</span></div>
<div class="line"><span class="lineno">   81</span><span class="stringliteral">    num_negative_samples = tf.constant(sample_size,</span></div>
<div class="line"><span class="lineno">   82</span><span class="stringliteral">                                       tf.int32) - num_positive_samples</span></div>
<div class="line"><span class="lineno">   83</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   84</span><span class="stringliteral">    </span><span class="keywordflow">return</span> num_positive_samples, num_negative_samples</div>
<div class="line"><span class="lineno">   85</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a114dc7eba49d5c24ca4a9645e6557aca_icgraph.png" border="0" usemap="#ade/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a114dc7eba49d5c24ca4a9645e6557aca_icgraph" alt=""/></div>
<map name="ade/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a114dc7eba49d5c24ca4a9645e6557aca_icgraph" id="ade/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a114dc7eba49d5c24ca4a9645e6557aca_icgraph">
<area shape="rect" title=" " alt="" coords="576,5,813,75"/>
<area shape="rect" href="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler.html#aa87afbab24c4a5d1214eb918bf534436" title=" " alt="" coords="291,5,528,75"/>
<area shape="poly" title=" " alt="" coords="563,43,528,43,528,37,563,37"/>
<area shape="rect" href="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler.html#a47ecd1ba4a6e9f0be57ff1b85f7a6c56" title=" " alt="" coords="5,13,243,67"/>
<area shape="poly" title=" " alt="" coords="277,43,243,43,243,37,277,37"/>
</map>
</div>

</div>
</div>
<a id="adbe6d71b81e8ef0007043b6a7ae23692" name="adbe6d71b81e8ef0007043b6a7ae23692"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbe6d71b81e8ef0007043b6a7ae23692">&#9670;&#160;</a></span>_get_values_from_start_and_end()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.balanced_positive_negative_sampler.BalancedPositiveNegativeSampler._get_values_from_start_and_end </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>input_tensor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>num_start_samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>num_end_samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>total_num_samples</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">slices num_start_samples and last num_end_samples from input_tensor.

Args:
  input_tensor: An int32 tensor of shape [N] to be sliced.
  num_start_samples: Number of examples to be sliced from the beginning
    of the input tensor.
  num_end_samples: Number of examples to be sliced from the end of the
    input tensor.
  total_num_samples: Sum of is num_start_samples and num_end_samples. This
    should be a scalar.

Returns:
  A tensor containing the first num_start_samples and last num_end_samples
  from input_tensor.</pre> 
<p class="definition">Definition at line <a class="el" href="../../d2/d4c/balanced__positive__negative__sampler_8py_source.html#l00086">86</a> of file <a class="el" href="../../d2/d4c/balanced__positive__negative__sampler_8py_source.html">balanced_positive_negative_sampler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   87</span>                                     num_end_samples, total_num_samples):</div>
<div class="line"><span class="lineno">   88</span>    <span class="stringliteral">&quot;&quot;&quot;slices num_start_samples and last num_end_samples from input_tensor.</span></div>
<div class="line"><span class="lineno">   89</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   90</span><span class="stringliteral">    Args:</span></div>
<div class="line"><span class="lineno">   91</span><span class="stringliteral">      input_tensor: An int32 tensor of shape [N] to be sliced.</span></div>
<div class="line"><span class="lineno">   92</span><span class="stringliteral">      num_start_samples: Number of examples to be sliced </span><span class="keyword">from</span> the beginning</div>
<div class="line"><span class="lineno">   93</span>        of the input tensor.</div>
<div class="line"><span class="lineno">   94</span>      num_end_samples: Number of examples to be sliced <span class="keyword">from</span> the end of the</div>
<div class="line"><span class="lineno">   95</span>        input tensor.</div>
<div class="line"><span class="lineno">   96</span>      total_num_samples: Sum of <span class="keywordflow">is</span> num_start_samples <span class="keywordflow">and</span> num_end_samples. This</div>
<div class="line"><span class="lineno">   97</span>        should be a scalar.</div>
<div class="line"><span class="lineno">   98</span> </div>
<div class="line"><span class="lineno">   99</span>    Returns:</div>
<div class="line"><span class="lineno">  100</span>      A tensor containing the first num_start_samples <span class="keywordflow">and</span> last num_end_samples</div>
<div class="line"><span class="lineno">  101</span>      <span class="keyword">from</span> input_tensor.</div>
<div class="line"><span class="lineno">  102</span> </div>
<div class="line"><span class="lineno">  103</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  104</span><span class="stringliteral">    input_length = tf.shape(input_tensor)[0]</span></div>
<div class="line"><span class="lineno">  105</span><span class="stringliteral">    start_positions = tf.less(tf.range(input_length), num_start_samples)</span></div>
<div class="line"><span class="lineno">  106</span><span class="stringliteral">    end_positions = tf.greater_equal(</span></div>
<div class="line"><span class="lineno">  107</span><span class="stringliteral">        tf.range(input_length), input_length - num_end_samples)</span></div>
<div class="line"><span class="lineno">  108</span><span class="stringliteral">    selected_positions = tf.logical_or(start_positions, end_positions)</span></div>
<div class="line"><span class="lineno">  109</span><span class="stringliteral">    selected_positions = tf.cast(selected_positions, tf.float32)</span></div>
<div class="line"><span class="lineno">  110</span><span class="stringliteral">    indexed_positions = tf.multiply(tf.cumsum(selected_positions),</span></div>
<div class="line"><span class="lineno">  111</span><span class="stringliteral">                                    selected_positions)</span></div>
<div class="line"><span class="lineno">  112</span><span class="stringliteral">    one_hot_selector = tf.one_hot(tf.cast(indexed_positions, tf.int32) - 1,</span></div>
<div class="line"><span class="lineno">  113</span><span class="stringliteral">                                  total_num_samples,</span></div>
<div class="line"><span class="lineno">  114</span><span class="stringliteral">                                  dtype=tf.float32)</span></div>
<div class="line"><span class="lineno">  115</span><span class="stringliteral">    </span><span class="keywordflow">return</span> tf.cast(tf.tensordot(tf.cast(input_tensor, tf.float32),</div>
<div class="line"><span class="lineno">  116</span>                                one_hot_selector, axes=[0, 0]), tf.int32)</div>
<div class="line"><span class="lineno">  117</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_adbe6d71b81e8ef0007043b6a7ae23692_icgraph.png" border="0" usemap="#ade/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_adbe6d71b81e8ef0007043b6a7ae23692_icgraph" alt=""/></div>
<map name="ade/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_adbe6d71b81e8ef0007043b6a7ae23692_icgraph" id="ade/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_adbe6d71b81e8ef0007043b6a7ae23692_icgraph">
<area shape="rect" title=" " alt="" coords="576,5,813,75"/>
<area shape="rect" href="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler.html#aa87afbab24c4a5d1214eb918bf534436" title=" " alt="" coords="291,5,528,75"/>
<area shape="poly" title=" " alt="" coords="563,43,528,43,528,37,563,37"/>
<area shape="rect" href="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler.html#a47ecd1ba4a6e9f0be57ff1b85f7a6c56" title=" " alt="" coords="5,13,243,67"/>
<area shape="poly" title=" " alt="" coords="277,43,243,43,243,37,277,37"/>
</map>
</div>

</div>
</div>
<a id="aa87afbab24c4a5d1214eb918bf534436" name="aa87afbab24c4a5d1214eb918bf534436"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa87afbab24c4a5d1214eb918bf534436">&#9670;&#160;</a></span>_static_subsample()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.balanced_positive_negative_sampler.BalancedPositiveNegativeSampler._static_subsample </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>indicator</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>batch_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>labels</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Returns subsampled minibatch.

Args:
  indicator: boolean tensor of shape [N] whose True entries can be sampled.
    N should be a complie time constant.
  batch_size: desired batch size. This scalar cannot be None.
  labels: boolean tensor of shape [N] denoting positive(=True) and negative
    (=False) examples. N should be a complie time constant.

Returns:
  sampled_idx_indicator: boolean tensor of shape [N], True for entries which
    are sampled. It ensures the length of output of the subsample is always
    batch_size, even when number of examples set to True in indicator is
    less than batch_size.

Raises:
  ValueError: if labels and indicator are not 1D boolean tensors.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d2/d4c/balanced__positive__negative__sampler_8py_source.html#l00118">118</a> of file <a class="el" href="../../d2/d4c/balanced__positive__negative__sampler_8py_source.html">balanced_positive_negative_sampler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  118</span>  <span class="keyword">def </span>_static_subsample(self, indicator, batch_size, labels):</div>
<div class="line"><span class="lineno">  119</span>    <span class="stringliteral">&quot;&quot;&quot;Returns subsampled minibatch.</span></div>
<div class="line"><span class="lineno">  120</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  121</span><span class="stringliteral">    Args:</span></div>
<div class="line"><span class="lineno">  122</span><span class="stringliteral">      indicator: boolean tensor of shape [N] whose </span><span class="keyword">True</span> entries can be sampled.</div>
<div class="line"><span class="lineno">  123</span>        N should be a complie time constant.</div>
<div class="line"><span class="lineno">  124</span>      batch_size: desired batch size. This scalar cannot be <span class="keywordtype">None</span>.</div>
<div class="line"><span class="lineno">  125</span>      labels: boolean tensor of shape [N] denoting positive(=<span class="keyword">True</span>) <span class="keywordflow">and</span> negative</div>
<div class="line"><span class="lineno">  126</span>        (=<span class="keyword">False</span>) examples. N should be a complie time constant.</div>
<div class="line"><span class="lineno">  127</span> </div>
<div class="line"><span class="lineno">  128</span>    Returns:</div>
<div class="line"><span class="lineno">  129</span>      sampled_idx_indicator: boolean tensor of shape [N], <span class="keyword">True</span> <span class="keywordflow">for</span> entries which</div>
<div class="line"><span class="lineno">  130</span>        are sampled. It ensures the length of output of the subsample <span class="keywordflow">is</span> always</div>
<div class="line"><span class="lineno">  131</span>        batch_size, even when number of examples set to <span class="keyword">True</span> <span class="keywordflow">in</span> indicator <span class="keywordflow">is</span></div>
<div class="line"><span class="lineno">  132</span>        less than batch_size.</div>
<div class="line"><span class="lineno">  133</span> </div>
<div class="line"><span class="lineno">  134</span>    Raises:</div>
<div class="line"><span class="lineno">  135</span>      ValueError: <span class="keywordflow">if</span> labels <span class="keywordflow">and</span> indicator are <span class="keywordflow">not</span> 1D boolean tensors.</div>
<div class="line"><span class="lineno">  136</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  137</span><span class="stringliteral">    </span><span class="comment"># Check if indicator and labels have a static size.</span></div>
<div class="line"><span class="lineno">  138</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> indicator.shape.is_fully_defined():</div>
<div class="line"><span class="lineno">  139</span>      <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;indicator must be static in shape when is_static is&#39;</span></div>
<div class="line"><span class="lineno">  140</span>                       <span class="stringliteral">&#39;True&#39;</span>)</div>
<div class="line"><span class="lineno">  141</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> labels.shape.is_fully_defined():</div>
<div class="line"><span class="lineno">  142</span>      <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;labels must be static in shape when is_static is&#39;</span></div>
<div class="line"><span class="lineno">  143</span>                       <span class="stringliteral">&#39;True&#39;</span>)</div>
<div class="line"><span class="lineno">  144</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(batch_size, int):</div>
<div class="line"><span class="lineno">  145</span>      <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;batch_size has to be an integer when is_static is&#39;</span></div>
<div class="line"><span class="lineno">  146</span>                       <span class="stringliteral">&#39;True.&#39;</span>)</div>
<div class="line"><span class="lineno">  147</span> </div>
<div class="line"><span class="lineno">  148</span>    input_length = tf.shape(indicator)[0]</div>
<div class="line"><span class="lineno">  149</span> </div>
<div class="line"><span class="lineno">  150</span>    <span class="comment"># Set the number of examples set True in indicator to be at least</span></div>
<div class="line"><span class="lineno">  151</span>    <span class="comment"># batch_size.</span></div>
<div class="line"><span class="lineno">  152</span>    num_true_sampled = tf.reduce_sum(tf.cast(indicator, tf.float32))</div>
<div class="line"><span class="lineno">  153</span>    additional_false_sample = tf.less_equal(</div>
<div class="line"><span class="lineno">  154</span>        tf.cumsum(tf.cast(tf.logical_not(indicator), tf.float32)),</div>
<div class="line"><span class="lineno">  155</span>        batch_size - num_true_sampled)</div>
<div class="line"><span class="lineno">  156</span>    indicator = tf.logical_or(indicator, additional_false_sample)</div>
<div class="line"><span class="lineno">  157</span> </div>
<div class="line"><span class="lineno">  158</span>    <span class="comment"># Shuffle indicator and label. Need to store the permutation to restore the</span></div>
<div class="line"><span class="lineno">  159</span>    <span class="comment"># order post sampling.</span></div>
<div class="line"><span class="lineno">  160</span>    permutation = tf.random_shuffle(tf.range(input_length))</div>
<div class="line"><span class="lineno">  161</span>    indicator = ops.matmul_gather_on_zeroth_axis(</div>
<div class="line"><span class="lineno">  162</span>        tf.cast(indicator, tf.float32), permutation)</div>
<div class="line"><span class="lineno">  163</span>    labels = ops.matmul_gather_on_zeroth_axis(</div>
<div class="line"><span class="lineno">  164</span>        tf.cast(labels, tf.float32), permutation)</div>
<div class="line"><span class="lineno">  165</span> </div>
<div class="line"><span class="lineno">  166</span>    <span class="comment"># index (starting from 1) when indicator is True, 0 when False</span></div>
<div class="line"><span class="lineno">  167</span>    indicator_idx = tf.where(</div>
<div class="line"><span class="lineno">  168</span>        tf.cast(indicator, tf.bool), tf.range(1, input_length + 1),</div>
<div class="line"><span class="lineno">  169</span>        tf.zeros(input_length, tf.int32))</div>
<div class="line"><span class="lineno">  170</span> </div>
<div class="line"><span class="lineno">  171</span>    <span class="comment"># Replace -1 for negative, +1 for positive labels</span></div>
<div class="line"><span class="lineno">  172</span>    signed_label = tf.where(</div>
<div class="line"><span class="lineno">  173</span>        tf.cast(labels, tf.bool), tf.ones(input_length, tf.int32),</div>
<div class="line"><span class="lineno">  174</span>        tf.scalar_mul(-1, tf.ones(input_length, tf.int32)))</div>
<div class="line"><span class="lineno">  175</span>    <span class="comment"># negative of index for negative label, positive index for positive label,</span></div>
<div class="line"><span class="lineno">  176</span>    <span class="comment"># 0 when indicator is False.</span></div>
<div class="line"><span class="lineno">  177</span>    signed_indicator_idx = tf.multiply(indicator_idx, signed_label)</div>
<div class="line"><span class="lineno">  178</span>    sorted_signed_indicator_idx = tf.nn.top_k(</div>
<div class="line"><span class="lineno">  179</span>        signed_indicator_idx, input_length, sorted=<span class="keyword">True</span>).values</div>
<div class="line"><span class="lineno">  180</span> </div>
<div class="line"><span class="lineno">  181</span>    [num_positive_samples,</div>
<div class="line"><span class="lineno">  182</span>     num_negative_samples] = self._get_num_pos_neg_samples(</div>
<div class="line"><span class="lineno">  183</span>         sorted_signed_indicator_idx, batch_size)</div>
<div class="line"><span class="lineno">  184</span> </div>
<div class="line"><span class="lineno">  185</span>    sampled_idx = self._get_values_from_start_and_end(</div>
<div class="line"><span class="lineno">  186</span>        sorted_signed_indicator_idx, num_positive_samples,</div>
<div class="line"><span class="lineno">  187</span>        num_negative_samples, batch_size)</div>
<div class="line"><span class="lineno">  188</span> </div>
<div class="line"><span class="lineno">  189</span>    <span class="comment"># Shift the indices to start from 0 and remove any samples that are set as</span></div>
<div class="line"><span class="lineno">  190</span>    <span class="comment"># False.</span></div>
<div class="line"><span class="lineno">  191</span>    sampled_idx = tf.abs(sampled_idx) - tf.ones(batch_size, tf.int32)</div>
<div class="line"><span class="lineno">  192</span>    sampled_idx = tf.multiply(</div>
<div class="line"><span class="lineno">  193</span>        tf.cast(tf.greater_equal(sampled_idx, tf.constant(0)), tf.int32),</div>
<div class="line"><span class="lineno">  194</span>        sampled_idx)</div>
<div class="line"><span class="lineno">  195</span> </div>
<div class="line"><span class="lineno">  196</span>    sampled_idx_indicator = tf.cast(tf.reduce_sum(</div>
<div class="line"><span class="lineno">  197</span>        tf.one_hot(sampled_idx, depth=input_length),</div>
<div class="line"><span class="lineno">  198</span>        axis=0), tf.bool)</div>
<div class="line"><span class="lineno">  199</span> </div>
<div class="line"><span class="lineno">  200</span>    <span class="comment"># project back the order based on stored permutations</span></div>
<div class="line"><span class="lineno">  201</span>    reprojections = tf.one_hot(permutation, depth=input_length,</div>
<div class="line"><span class="lineno">  202</span>                               dtype=tf.float32)</div>
<div class="line"><span class="lineno">  203</span>    <span class="keywordflow">return</span> tf.cast(tf.tensordot(</div>
<div class="line"><span class="lineno">  204</span>        tf.cast(sampled_idx_indicator, tf.float32),</div>
<div class="line"><span class="lineno">  205</span>        reprojections, axes=[0, 0]), tf.bool)</div>
<div class="line"><span class="lineno">  206</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_aa87afbab24c4a5d1214eb918bf534436_cgraph.png" border="0" usemap="#ade/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_aa87afbab24c4a5d1214eb918bf534436_cgraph" alt=""/></div>
<map name="ade/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_aa87afbab24c4a5d1214eb918bf534436_cgraph" id="ade/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_aa87afbab24c4a5d1214eb918bf534436_cgraph">
<area shape="rect" title=" " alt="" coords="5,52,243,121"/>
<area shape="rect" href="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler.html#a114dc7eba49d5c24ca4a9645e6557aca" title=" " alt="" coords="291,5,528,75"/>
<area shape="poly" title=" " alt="" coords="242,65,277,59,278,64,243,70"/>
<area shape="rect" href="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler.html#adbe6d71b81e8ef0007043b6a7ae23692" title=" " alt="" coords="291,99,528,168"/>
<area shape="poly" title=" " alt="" coords="243,103,278,109,277,114,242,109"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_aa87afbab24c4a5d1214eb918bf534436_icgraph.png" border="0" usemap="#ade/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_aa87afbab24c4a5d1214eb918bf534436_icgraph" alt=""/></div>
<map name="ade/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_aa87afbab24c4a5d1214eb918bf534436_icgraph" id="ade/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_aa87afbab24c4a5d1214eb918bf534436_icgraph">
<area shape="rect" title=" " alt="" coords="291,5,528,75"/>
<area shape="rect" href="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler.html#a47ecd1ba4a6e9f0be57ff1b85f7a6c56" title=" " alt="" coords="5,13,243,67"/>
<area shape="poly" title=" " alt="" coords="277,43,243,43,243,37,277,37"/>
</map>
</div>

</div>
</div>
<a id="a47ecd1ba4a6e9f0be57ff1b85f7a6c56" name="a47ecd1ba4a6e9f0be57ff1b85f7a6c56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a47ecd1ba4a6e9f0be57ff1b85f7a6c56">&#9670;&#160;</a></span>subsample()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.balanced_positive_negative_sampler.BalancedPositiveNegativeSampler.subsample </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>indicator</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>batch_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>labels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>scope</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Returns subsampled minibatch.

Args:
  indicator: boolean tensor of shape [N] whose True entries can be sampled.
  batch_size: desired batch size. If None, keeps all positive samples and
    randomly selects negative samples so that the positive sample fraction
    matches self._positive_fraction. It cannot be None is is_static is True.
  labels: boolean tensor of shape [N] denoting positive(=True) and negative
      (=False) examples.
  scope: name scope.

Returns:
  sampled_idx_indicator: boolean tensor of shape [N], True for entries which
    are sampled.

Raises:
  ValueError: if labels and indicator are not 1D boolean tensors.
</pre> 
<p>Reimplemented from <a class="el" href="../../dd/dc4/classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler.html#af62418aa0c50303f6b5f4e8f5130651f">detection_utils.core.minibatch_sampler.MinibatchSampler</a>.</p>

<p class="definition">Definition at line <a class="el" href="../../d2/d4c/balanced__positive__negative__sampler_8py_source.html#l00207">207</a> of file <a class="el" href="../../d2/d4c/balanced__positive__negative__sampler_8py_source.html">balanced_positive_negative_sampler.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  207</span>  <span class="keyword">def </span>subsample(self, indicator, batch_size, labels, scope=None):</div>
<div class="line"><span class="lineno">  208</span>    <span class="stringliteral">&quot;&quot;&quot;Returns subsampled minibatch.</span></div>
<div class="line"><span class="lineno">  209</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  210</span><span class="stringliteral">    Args:</span></div>
<div class="line"><span class="lineno">  211</span><span class="stringliteral">      indicator: boolean tensor of shape [N] whose </span><span class="keyword">True</span> entries can be sampled.</div>
<div class="line"><span class="lineno">  212</span>      batch_size: desired batch size. If <span class="keywordtype">None</span>, keeps all positive samples <span class="keywordflow">and</span></div>
<div class="line"><span class="lineno">  213</span>        randomly selects negative samples so that the positive sample fraction</div>
<div class="line"><span class="lineno">  214</span>        matches self._positive_fraction. It cannot be <span class="keywordtype">None</span> <span class="keywordflow">is</span> is_static <span class="keywordflow">is</span> <span class="keyword">True</span>.</div>
<div class="line"><span class="lineno">  215</span>      labels: boolean tensor of shape [N] denoting positive(=<span class="keyword">True</span>) <span class="keywordflow">and</span> negative</div>
<div class="line"><span class="lineno">  216</span>          (=<span class="keyword">False</span>) examples.</div>
<div class="line"><span class="lineno">  217</span>      scope: name scope.</div>
<div class="line"><span class="lineno">  218</span> </div>
<div class="line"><span class="lineno">  219</span>    Returns:</div>
<div class="line"><span class="lineno">  220</span>      sampled_idx_indicator: boolean tensor of shape [N], <span class="keyword">True</span> <span class="keywordflow">for</span> entries which</div>
<div class="line"><span class="lineno">  221</span>        are sampled.</div>
<div class="line"><span class="lineno">  222</span> </div>
<div class="line"><span class="lineno">  223</span>    Raises:</div>
<div class="line"><span class="lineno">  224</span>      ValueError: <span class="keywordflow">if</span> labels <span class="keywordflow">and</span> indicator are <span class="keywordflow">not</span> 1D boolean tensors.</div>
<div class="line"><span class="lineno">  225</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  226</span><span class="stringliteral">    </span><span class="keywordflow">if</span> len(indicator.get_shape().as_list()) != 1:</div>
<div class="line"><span class="lineno">  227</span>      <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;indicator must be 1 dimensional, got a tensor of &#39;</span></div>
<div class="line"><span class="lineno">  228</span>                       <span class="stringliteral">&#39;shape %s&#39;</span> % indicator.get_shape())</div>
<div class="line"><span class="lineno">  229</span>    <span class="keywordflow">if</span> len(labels.get_shape().as_list()) != 1:</div>
<div class="line"><span class="lineno">  230</span>      <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;labels must be 1 dimensional, got a tensor of &#39;</span></div>
<div class="line"><span class="lineno">  231</span>                       <span class="stringliteral">&#39;shape %s&#39;</span> % labels.get_shape())</div>
<div class="line"><span class="lineno">  232</span>    <span class="keywordflow">if</span> labels.dtype != tf.bool:</div>
<div class="line"><span class="lineno">  233</span>      <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;labels should be of type bool. Received: %s&#39;</span> %</div>
<div class="line"><span class="lineno">  234</span>                       labels.dtype)</div>
<div class="line"><span class="lineno">  235</span>    <span class="keywordflow">if</span> indicator.dtype != tf.bool:</div>
<div class="line"><span class="lineno">  236</span>      <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;indicator should be of type bool. Received: %s&#39;</span> %</div>
<div class="line"><span class="lineno">  237</span>                       indicator.dtype)</div>
<div class="line"><span class="lineno">  238</span>    <span class="keyword">with</span> tf.name_scope(scope, <span class="stringliteral">&#39;BalancedPositiveNegativeSampler&#39;</span>):</div>
<div class="line"><span class="lineno">  239</span>      <span class="keywordflow">if</span> self._is_static:</div>
<div class="line"><span class="lineno">  240</span>        <span class="keywordflow">return</span> self._static_subsample(indicator, batch_size, labels)</div>
<div class="line"><span class="lineno">  241</span> </div>
<div class="line"><span class="lineno">  242</span>      <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  243</span>        <span class="comment"># Only sample from indicated samples</span></div>
<div class="line"><span class="lineno">  244</span>        negative_idx = tf.logical_not(labels)</div>
<div class="line"><span class="lineno">  245</span>        positive_idx = tf.logical_and(labels, indicator)</div>
<div class="line"><span class="lineno">  246</span>        negative_idx = tf.logical_and(negative_idx, indicator)</div>
<div class="line"><span class="lineno">  247</span> </div>
<div class="line"><span class="lineno">  248</span>        <span class="comment"># Sample positive and negative samples separately</span></div>
<div class="line"><span class="lineno">  249</span>        <span class="keywordflow">if</span> batch_size <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  250</span>          max_num_pos = tf.reduce_sum(tf.cast(positive_idx, dtype=tf.int32))</div>
<div class="line"><span class="lineno">  251</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  252</span>          max_num_pos = int(self._positive_fraction * batch_size)</div>
<div class="line"><span class="lineno">  253</span>        sampled_pos_idx = self.subsample_indicator(positive_idx, max_num_pos)</div>
<div class="line"><span class="lineno">  254</span>        num_sampled_pos = tf.reduce_sum(tf.cast(sampled_pos_idx, tf.int32))</div>
<div class="line"><span class="lineno">  255</span>        <span class="keywordflow">if</span> batch_size <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  256</span>          negative_positive_ratio = (</div>
<div class="line"><span class="lineno">  257</span>              1 - self._positive_fraction) / self._positive_fraction</div>
<div class="line"><span class="lineno">  258</span>          max_num_neg = tf.cast(</div>
<div class="line"><span class="lineno">  259</span>              negative_positive_ratio *</div>
<div class="line"><span class="lineno">  260</span>              tf.cast(num_sampled_pos, dtype=tf.float32),</div>
<div class="line"><span class="lineno">  261</span>              dtype=tf.int32)</div>
<div class="line"><span class="lineno">  262</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  263</span>          max_num_neg = batch_size - num_sampled_pos</div>
<div class="line"><span class="lineno">  264</span>        sampled_neg_idx = self.subsample_indicator(negative_idx, max_num_neg)</div>
<div class="line"><span class="lineno">  265</span> </div>
<div class="line"><span class="lineno">  266</span>        <span class="keywordflow">return</span> tf.logical_or(sampled_pos_idx, sampled_neg_idx)</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a47ecd1ba4a6e9f0be57ff1b85f7a6c56_cgraph.png" border="0" usemap="#ade/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a47ecd1ba4a6e9f0be57ff1b85f7a6c56_cgraph" alt=""/></div>
<map name="ade/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a47ecd1ba4a6e9f0be57ff1b85f7a6c56_cgraph" id="ade/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a47ecd1ba4a6e9f0be57ff1b85f7a6c56_cgraph">
<area shape="rect" title=" " alt="" coords="5,103,243,158"/>
<area shape="rect" href="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler.html#aa87afbab24c4a5d1214eb918bf534436" title=" " alt="" coords="297,52,535,121"/>
<area shape="poly" title=" " alt="" coords="243,110,283,104,284,109,243,115"/>
<area shape="rect" href="../../dd/dc4/classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler.html#a2c2eda2a51cf3969cfe0211ac6658ba6" title=" " alt="" coords="291,146,541,201"/>
<area shape="poly" title=" " alt="" coords="243,145,278,150,277,156,243,151"/>
<area shape="rect" href="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler.html#a114dc7eba49d5c24ca4a9645e6557aca" title=" " alt="" coords="589,5,827,75"/>
<area shape="poly" title=" " alt="" coords="535,65,575,59,576,64,535,70"/>
<area shape="rect" href="../../de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler.html#adbe6d71b81e8ef0007043b6a7ae23692" title=" " alt="" coords="589,99,827,168"/>
<area shape="poly" title=" " alt="" coords="535,103,576,110,575,115,535,108"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a0cf7a20373c2870b4ea3b316403adb8c" name="a0cf7a20373c2870b4ea3b316403adb8c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0cf7a20373c2870b4ea3b316403adb8c">&#9670;&#160;</a></span>_is_static</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.balanced_positive_negative_sampler.BalancedPositiveNegativeSampler._is_static</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d2/d4c/balanced__positive__negative__sampler_8py_source.html#l00057">57</a> of file <a class="el" href="../../d2/d4c/balanced__positive__negative__sampler_8py_source.html">balanced_positive_negative_sampler.py</a>.</p>

</div>
</div>
<a id="a52824e1d5b1e9c3a085f9bd1e733f008" name="a52824e1d5b1e9c3a085f9bd1e733f008"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a52824e1d5b1e9c3a085f9bd1e733f008">&#9670;&#160;</a></span>_positive_fraction</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.balanced_positive_negative_sampler.BalancedPositiveNegativeSampler._positive_fraction</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d2/d4c/balanced__positive__negative__sampler_8py_source.html#l00056">56</a> of file <a class="el" href="../../d2/d4c/balanced__positive__negative__sampler_8py_source.html">balanced_positive_negative_sampler.py</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>src/main/resources/processing/video/detections/detection_utils/core/<a class="el" href="../../d2/d4c/balanced__positive__negative__sampler_8py_source.html">balanced_positive_negative_sampler.py</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
