<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RESIIST: detection_utils.core.target_assigner Namespace Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">RESIIST
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d8/d97/namespacedetection__utils.html">detection_utils</a></li><li class="navelem"><a class="el" href="../../de/d5d/namespacedetection__utils_1_1core.html">core</a></li><li class="navelem"><a class="el" href="../../d2/de4/namespacedetection__utils_1_1core_1_1target__assigner.html">target_assigner</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">detection_utils.core.target_assigner Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d89/classdetection__utils_1_1core_1_1target__assigner_1_1_target_assigner.html">TargetAssigner</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad5169f5aa5c502e10c38cc5663dbafd4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/de4/namespacedetection__utils_1_1core_1_1target__assigner.html#ad5169f5aa5c502e10c38cc5663dbafd4">create_target_assigner</a> (reference, stage=None, negative_class_weight=1.0, use_matmul_gather=False)</td></tr>
<tr class="separator:ad5169f5aa5c502e10c38cc5663dbafd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d3571d24057b74962a5e08c912d8145"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/de4/namespacedetection__utils_1_1core_1_1target__assigner.html#a8d3571d24057b74962a5e08c912d8145">batch_assign</a> (target_assigner, anchors_batch, gt_box_batch, gt_class_targets_batch, unmatched_class_label=None, gt_weights_batch=None)</td></tr>
<tr class="separator:a8d3571d24057b74962a5e08c912d8145"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c9aabceffa66cd1fe527afe829b768b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/de4/namespacedetection__utils_1_1core_1_1target__assigner.html#a4c9aabceffa66cd1fe527afe829b768b">batch_get_targets</a> (batch_match, groundtruth_tensor_list, groundtruth_weights_list, unmatched_value, unmatched_weight)</td></tr>
<tr class="separator:a4c9aabceffa66cd1fe527afe829b768b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38051cc741fa2198a014d46f8c5d7e87"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/de4/namespacedetection__utils_1_1core_1_1target__assigner.html#a38051cc741fa2198a014d46f8c5d7e87">batch_assign_confidences</a> (target_assigner, anchors_batch, gt_box_batch, gt_class_confidences_batch, gt_weights_batch=None, unmatched_class_label=None, include_background_class=True, implicit_class_weight=1.0)</td></tr>
<tr class="separator:a38051cc741fa2198a014d46f8c5d7e87"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a5c6f3a5416c9c7d7eee481724034c9be"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/de4/namespacedetection__utils_1_1core_1_1target__assigner.html#a5c6f3a5416c9c7d7eee481724034c9be">batch_assign_targets</a> = <a class="el" href="../../d2/de4/namespacedetection__utils_1_1core_1_1target__assigner.html#a8d3571d24057b74962a5e08c912d8145">batch_assign</a></td></tr>
<tr class="separator:a5c6f3a5416c9c7d7eee481724034c9be"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Base target assigner module.

The job of a TargetAssigner is, for a given set of anchors (bounding boxes) and
groundtruth detections (bounding boxes), to assign classification and regression
targets to each anchor as well as weights to each anchor (specifying, e.g.,
which anchors should not contribute to training loss).

It assigns classification/regression targets by performing the following steps:
1) Computing pairwise similarity between anchors and groundtruth boxes using a
  provided RegionSimilarity Calculator
2) Computing a matching based on the similarity matrix using a provided Matcher
3) Assigning regression targets based on the matching and a provided BoxCoder
4) Assigning classification targets based on the matching and groundtruth labels

Note that TargetAssigners only operate on detections from a single
image at a time, so any logic for applying a TargetAssigner to multiple
images must be handled externally.
</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="a8d3571d24057b74962a5e08c912d8145" name="a8d3571d24057b74962a5e08c912d8145"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d3571d24057b74962a5e08c912d8145">&#9670;&#160;</a></span>batch_assign()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.target_assigner.batch_assign </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>target_assigner</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>anchors_batch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>gt_box_batch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>gt_class_targets_batch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>unmatched_class_label</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>gt_weights_batch</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Batched assignment of classification and regression targets.

Args:
  target_assigner: a target assigner.
  anchors_batch: BoxList representing N box anchors or list of BoxList objects
    with length batch_size representing anchor sets.
  gt_box_batch: a list of BoxList objects with length batch_size
    representing groundtruth boxes for each image in the batch
  gt_class_targets_batch: a list of tensors with length batch_size, where
    each tensor has shape [num_gt_boxes_i, classification_target_size] and
    num_gt_boxes_i is the number of boxes in the ith boxlist of
    gt_box_batch.
  unmatched_class_label: a float32 tensor with shape [d_1, d_2, ..., d_k]
    which is consistent with the classification target for each
    anchor (and can be empty for scalar targets).  This shape must thus be
    compatible with the groundtruth labels that are passed to the "assign"
    function (which have shape [num_gt_boxes, d_1, d_2, ..., d_k]).
  gt_weights_batch: A list of 1-D tf.float32 tensors of shape
    [num_boxes] containing weights for groundtruth boxes.

Returns:
  batch_cls_targets: a tensor with shape [batch_size, num_anchors,
    num_classes],
  batch_cls_weights: a tensor with shape [batch_size, num_anchors,
    num_classes],
  batch_reg_targets: a tensor with shape [batch_size, num_anchors,
    box_code_dimension]
  batch_reg_weights: a tensor with shape [batch_size, num_anchors],
  match: an int32 tensor of shape [batch_size, num_anchors] containing result
    of anchor groundtruth matching. Each position in the tensor indicates an
    anchor and holds the following meaning:
    (1) if match[x, i] &gt;= 0, anchor i is matched with groundtruth match[x, i].
    (2) if match[x, i]=-1, anchor i is marked to be background .
    (3) if match[x, i]=-2, anchor i is ignored since it is not background and
        does not have sufficient overlap to call it a foreground.

Raises:
  ValueError: if input list lengths are inconsistent, i.e.,
    batch_size == len(gt_box_batch) == len(gt_class_targets_batch)
      and batch_size == len(anchors_batch) unless anchors_batch is a single
      BoxList.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d4/d4b/target__assigner_8py_source.html#l00430">430</a> of file <a class="el" href="../../d4/d4b/target__assigner_8py_source.html">target_assigner.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  435</span>                 gt_weights_batch=<span class="keywordtype">None</span>):</div>
<div class="line"><span class="lineno">  436</span>  <span class="stringliteral">&quot;&quot;&quot;Batched assignment of classification and regression targets.</span></div>
<div class="line"><span class="lineno">  437</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  438</span><span class="stringliteral">  Args:</span></div>
<div class="line"><span class="lineno">  439</span><span class="stringliteral">    target_assigner: a target assigner.</span></div>
<div class="line"><span class="lineno">  440</span><span class="stringliteral">    anchors_batch: BoxList representing N box anchors </span><span class="keywordflow">or</span> list of BoxList objects</div>
<div class="line"><span class="lineno">  441</span>      <span class="keyword">with</span> length batch_size representing anchor sets.</div>
<div class="line"><span class="lineno">  442</span>    gt_box_batch: a list of BoxList objects <span class="keyword">with</span> length batch_size</div>
<div class="line"><span class="lineno">  443</span>      representing groundtruth boxes <span class="keywordflow">for</span> each image <span class="keywordflow">in</span> the batch</div>
<div class="line"><span class="lineno">  444</span>    gt_class_targets_batch: a list of tensors <span class="keyword">with</span> length batch_size, where</div>
<div class="line"><span class="lineno">  445</span>      each tensor has shape [num_gt_boxes_i, classification_target_size] <span class="keywordflow">and</span></div>
<div class="line"><span class="lineno">  446</span>      num_gt_boxes_i <span class="keywordflow">is</span> the number of boxes <span class="keywordflow">in</span> the ith boxlist of</div>
<div class="line"><span class="lineno">  447</span>      gt_box_batch.</div>
<div class="line"><span class="lineno">  448</span>    unmatched_class_label: a float32 tensor <span class="keyword">with</span> shape [d_1, d_2, ..., d_k]</div>
<div class="line"><span class="lineno">  449</span>      which <span class="keywordflow">is</span> consistent <span class="keyword">with</span> the classification target <span class="keywordflow">for</span> each</div>
<div class="line"><span class="lineno">  450</span>      anchor (<span class="keywordflow">and</span> can be empty <span class="keywordflow">for</span> scalar targets).  This shape must thus be</div>
<div class="line"><span class="lineno">  451</span>      compatible <span class="keyword">with</span> the groundtruth labels that are passed to the <span class="stringliteral">&quot;assign&quot;</span></div>
<div class="line"><span class="lineno">  452</span>      function (which have shape [num_gt_boxes, d_1, d_2, ..., d_k]).</div>
<div class="line"><span class="lineno">  453</span>    gt_weights_batch: A list of 1-D tf.float32 tensors of shape</div>
<div class="line"><span class="lineno">  454</span>      [num_boxes] containing weights <span class="keywordflow">for</span> groundtruth boxes.</div>
<div class="line"><span class="lineno">  455</span> </div>
<div class="line"><span class="lineno">  456</span>  Returns:</div>
<div class="line"><span class="lineno">  457</span>    batch_cls_targets: a tensor <span class="keyword">with</span> shape [batch_size, num_anchors,</div>
<div class="line"><span class="lineno">  458</span>      num_classes],</div>
<div class="line"><span class="lineno">  459</span>    batch_cls_weights: a tensor <span class="keyword">with</span> shape [batch_size, num_anchors,</div>
<div class="line"><span class="lineno">  460</span>      num_classes],</div>
<div class="line"><span class="lineno">  461</span>    batch_reg_targets: a tensor <span class="keyword">with</span> shape [batch_size, num_anchors,</div>
<div class="line"><span class="lineno">  462</span>      box_code_dimension]</div>
<div class="line"><span class="lineno">  463</span>    batch_reg_weights: a tensor <span class="keyword">with</span> shape [batch_size, num_anchors],</div>
<div class="line"><span class="lineno">  464</span>    match: an int32 tensor of shape [batch_size, num_anchors] containing result</div>
<div class="line"><span class="lineno">  465</span>      of anchor groundtruth matching. Each position <span class="keywordflow">in</span> the tensor indicates an</div>
<div class="line"><span class="lineno">  466</span>      anchor <span class="keywordflow">and</span> holds the following meaning:</div>
<div class="line"><span class="lineno">  467</span>      (1) <span class="keywordflow">if</span> match[x, i] &gt;= 0, anchor i <span class="keywordflow">is</span> matched <span class="keyword">with</span> groundtruth match[x, i].</div>
<div class="line"><span class="lineno">  468</span>      (2) <span class="keywordflow">if</span> match[x, i]=-1, anchor i <span class="keywordflow">is</span> marked to be background .</div>
<div class="line"><span class="lineno">  469</span>      (3) <span class="keywordflow">if</span> match[x, i]=-2, anchor i <span class="keywordflow">is</span> ignored since it <span class="keywordflow">is</span> <span class="keywordflow">not</span> background <span class="keywordflow">and</span></div>
<div class="line"><span class="lineno">  470</span>          does <span class="keywordflow">not</span> have sufficient overlap to call it a foreground.</div>
<div class="line"><span class="lineno">  471</span> </div>
<div class="line"><span class="lineno">  472</span>  Raises:</div>
<div class="line"><span class="lineno">  473</span>    ValueError: <span class="keywordflow">if</span> input list lengths are inconsistent, i.e.,</div>
<div class="line"><span class="lineno">  474</span>      batch_size == len(gt_box_batch) == len(gt_class_targets_batch)</div>
<div class="line"><span class="lineno">  475</span>        <span class="keywordflow">and</span> batch_size == len(anchors_batch) unless anchors_batch <span class="keywordflow">is</span> a single</div>
<div class="line"><span class="lineno">  476</span>        BoxList.</div>
<div class="line"><span class="lineno">  477</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  478</span><span class="stringliteral">  </span><span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(anchors_batch, list):</div>
<div class="line"><span class="lineno">  479</span>    anchors_batch = len(gt_box_batch) * [anchors_batch]</div>
<div class="line"><span class="lineno">  480</span>  <span class="keywordflow">if</span> <span class="keywordflow">not</span> all(</div>
<div class="line"><span class="lineno">  481</span>      isinstance(anchors, box_list.BoxList) <span class="keywordflow">for</span> anchors <span class="keywordflow">in</span> anchors_batch):</div>
<div class="line"><span class="lineno">  482</span>    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;anchors_batch must be a BoxList or list of BoxLists.&#39;</span>)</div>
<div class="line"><span class="lineno">  483</span>  <span class="keywordflow">if</span> <span class="keywordflow">not</span> (len(anchors_batch)</div>
<div class="line"><span class="lineno">  484</span>          == len(gt_box_batch)</div>
<div class="line"><span class="lineno">  485</span>          == len(gt_class_targets_batch)):</div>
<div class="line"><span class="lineno">  486</span>    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;batch size incompatible with lengths of anchors_batch, &#39;</span></div>
<div class="line"><span class="lineno">  487</span>                     <span class="stringliteral">&#39;gt_box_batch and gt_class_targets_batch.&#39;</span>)</div>
<div class="line"><span class="lineno">  488</span>  cls_targets_list = []</div>
<div class="line"><span class="lineno">  489</span>  cls_weights_list = []</div>
<div class="line"><span class="lineno">  490</span>  reg_targets_list = []</div>
<div class="line"><span class="lineno">  491</span>  reg_weights_list = []</div>
<div class="line"><span class="lineno">  492</span>  match_list = []</div>
<div class="line"><span class="lineno">  493</span>  <span class="keywordflow">if</span> gt_weights_batch <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  494</span>    gt_weights_batch = [<span class="keywordtype">None</span>] * len(gt_class_targets_batch)</div>
<div class="line"><span class="lineno">  495</span>  <span class="keywordflow">for</span> anchors, gt_boxes, gt_class_targets, gt_weights <span class="keywordflow">in</span> zip(</div>
<div class="line"><span class="lineno">  496</span>      anchors_batch, gt_box_batch, gt_class_targets_batch, gt_weights_batch):</div>
<div class="line"><span class="lineno">  497</span>    (cls_targets, cls_weights,</div>
<div class="line"><span class="lineno">  498</span>     reg_targets, reg_weights, match) = target_assigner.assign(</div>
<div class="line"><span class="lineno">  499</span>         anchors, gt_boxes, gt_class_targets, unmatched_class_label, gt_weights)</div>
<div class="line"><span class="lineno">  500</span>    cls_targets_list.append(cls_targets)</div>
<div class="line"><span class="lineno">  501</span>    cls_weights_list.append(cls_weights)</div>
<div class="line"><span class="lineno">  502</span>    reg_targets_list.append(reg_targets)</div>
<div class="line"><span class="lineno">  503</span>    reg_weights_list.append(reg_weights)</div>
<div class="line"><span class="lineno">  504</span>    match_list.append(match)</div>
<div class="line"><span class="lineno">  505</span>  batch_cls_targets = tf.stack(cls_targets_list)</div>
<div class="line"><span class="lineno">  506</span>  batch_cls_weights = tf.stack(cls_weights_list)</div>
<div class="line"><span class="lineno">  507</span>  batch_reg_targets = tf.stack(reg_targets_list)</div>
<div class="line"><span class="lineno">  508</span>  batch_reg_weights = tf.stack(reg_weights_list)</div>
<div class="line"><span class="lineno">  509</span>  batch_match = tf.stack(match_list)</div>
<div class="line"><span class="lineno">  510</span>  <span class="keywordflow">return</span> (batch_cls_targets, batch_cls_weights, batch_reg_targets,</div>
<div class="line"><span class="lineno">  511</span>          batch_reg_weights, batch_match)</div>
<div class="line"><span class="lineno">  512</span> </div>
<div class="line"><span class="lineno">  513</span> </div>
<div class="line"><span class="lineno">  514</span><span class="comment"># Assign an alias to avoid large refactor of existing users.</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a38051cc741fa2198a014d46f8c5d7e87" name="a38051cc741fa2198a014d46f8c5d7e87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38051cc741fa2198a014d46f8c5d7e87">&#9670;&#160;</a></span>batch_assign_confidences()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.target_assigner.batch_assign_confidences </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>target_assigner</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>anchors_batch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>gt_box_batch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>gt_class_confidences_batch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>gt_weights_batch</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>unmatched_class_label</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>include_background_class</em> = <code>True</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>implicit_class_weight</em> = <code>1.0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Batched assignment of classification and regression targets.

This differences between batch_assign_confidences and batch_assign_targets:
 - 'batch_assign_targets' supports scalar (agnostic), vector (multiclass) and
   tensor (high-dimensional) targets. 'batch_assign_confidences' only support
   scalar (agnostic) and vector (multiclass) targets.
 - 'batch_assign_targets' assumes the input class tensor using the binary
   one/K-hot encoding. 'batch_assign_confidences' takes the class confidence
   scores as the input, where 1 means positive classes, 0 means implicit
   negative classes, and -1 means explicit negative classes.
 - 'batch_assign_confidences' assigns the targets in the similar way as
   'batch_assign_targets' except that it gives different weights for implicit
   and explicit classes. This allows user to control the negative gradients
   pushed differently for implicit and explicit examples during the training.

Args:
  target_assigner: a target assigner.
  anchors_batch: BoxList representing N box anchors or list of BoxList objects
    with length batch_size representing anchor sets.
  gt_box_batch: a list of BoxList objects with length batch_size
    representing groundtruth boxes for each image in the batch
  gt_class_confidences_batch: a list of tensors with length batch_size, where
    each tensor has shape [num_gt_boxes_i, classification_target_size] and
    num_gt_boxes_i is the number of boxes in the ith boxlist of
    gt_box_batch. Note that in this tensor, 1 means explicit positive class,
    -1 means explicit negative class, and 0 means implicit negative class.
  gt_weights_batch: A list of 1-D tf.float32 tensors of shape
    [num_gt_boxes_i] containing weights for groundtruth boxes.
  unmatched_class_label: a float32 tensor with shape [d_1, d_2, ..., d_k]
    which is consistent with the classification target for each
    anchor (and can be empty for scalar targets).  This shape must thus be
    compatible with the groundtruth labels that are passed to the "assign"
    function (which have shape [num_gt_boxes, d_1, d_2, ..., d_k]).
  include_background_class: whether or not gt_class_confidences_batch includes
    the background class.
  implicit_class_weight: the weight assigned to implicit examples.

Returns:
  batch_cls_targets: a tensor with shape [batch_size, num_anchors,
    num_classes],
  batch_cls_weights: a tensor with shape [batch_size, num_anchors,
    num_classes],
  batch_reg_targets: a tensor with shape [batch_size, num_anchors,
    box_code_dimension]
  batch_reg_weights: a tensor with shape [batch_size, num_anchors],
  match: an int32 tensor of shape [batch_size, num_anchors] containing result
    of anchor groundtruth matching. Each position in the tensor indicates an
    anchor and holds the following meaning:
    (1) if match[x, i] &gt;= 0, anchor i is matched with groundtruth match[x, i].
    (2) if match[x, i]=-1, anchor i is marked to be background .
    (3) if match[x, i]=-2, anchor i is ignored since it is not background and
        does not have sufficient overlap to call it a foreground.

Raises:
  ValueError: if input list lengths are inconsistent, i.e.,
    batch_size == len(gt_box_batch) == len(gt_class_targets_batch)
    and batch_size == len(anchors_batch) unless anchors_batch is a single
    BoxList, or if any element in gt_class_confidences_batch has rank &gt; 2.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d4/d4b/target__assigner_8py_source.html#l00560">560</a> of file <a class="el" href="../../d4/d4b/target__assigner_8py_source.html">target_assigner.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  567</span>                             implicit_class_weight=1.0):</div>
<div class="line"><span class="lineno">  568</span>  <span class="stringliteral">&quot;&quot;&quot;Batched assignment of classification and regression targets.</span></div>
<div class="line"><span class="lineno">  569</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  570</span><span class="stringliteral">  This differences between batch_assign_confidences </span><span class="keywordflow">and</span> batch_assign_targets:</div>
<div class="line"><span class="lineno">  571</span>   - <span class="stringliteral">&#39;batch_assign_targets&#39;</span> supports scalar (agnostic), vector (multiclass) <span class="keywordflow">and</span></div>
<div class="line"><span class="lineno">  572</span>     tensor (high-dimensional) targets. <span class="stringliteral">&#39;batch_assign_confidences&#39;</span> only support</div>
<div class="line"><span class="lineno">  573</span>     scalar (agnostic) <span class="keywordflow">and</span> vector (multiclass) targets.</div>
<div class="line"><span class="lineno">  574</span>   - <span class="stringliteral">&#39;batch_assign_targets&#39;</span> assumes the input <span class="keyword">class </span>tensor using the binary</div>
<div class="line"><span class="lineno">  575</span>     one/K-hot encoding. <span class="stringliteral">&#39;batch_assign_confidences&#39;</span> takes the <span class="keyword">class </span>confidence</div>
<div class="line"><span class="lineno">  576</span>     scores <span class="keyword">as</span> the input, where 1 means positive classes, 0 means implicit</div>
<div class="line"><span class="lineno">  577</span>     negative classes, <span class="keywordflow">and</span> -1 means explicit negative classes.</div>
<div class="line"><span class="lineno">  578</span>   - <span class="stringliteral">&#39;batch_assign_confidences&#39;</span> assigns the targets <span class="keywordflow">in</span> the similar way <span class="keyword">as</span></div>
<div class="line"><span class="lineno">  579</span>     <span class="stringliteral">&#39;batch_assign_targets&#39;</span> <span class="keywordflow">except</span> that it gives different weights <span class="keywordflow">for</span> implicit</div>
<div class="line"><span class="lineno">  580</span>     <span class="keywordflow">and</span> explicit classes. This allows user to control the negative gradients</div>
<div class="line"><span class="lineno">  581</span>     pushed differently <span class="keywordflow">for</span> implicit <span class="keywordflow">and</span> explicit examples during the training.</div>
<div class="line"><span class="lineno">  582</span> </div>
<div class="line"><span class="lineno">  583</span>  Args:</div>
<div class="line"><span class="lineno">  584</span>    target_assigner: a target assigner.</div>
<div class="line"><span class="lineno">  585</span>    anchors_batch: BoxList representing N box anchors <span class="keywordflow">or</span> list of BoxList objects</div>
<div class="line"><span class="lineno">  586</span>      <span class="keyword">with</span> length batch_size representing anchor sets.</div>
<div class="line"><span class="lineno">  587</span>    gt_box_batch: a list of BoxList objects <span class="keyword">with</span> length batch_size</div>
<div class="line"><span class="lineno">  588</span>      representing groundtruth boxes <span class="keywordflow">for</span> each image <span class="keywordflow">in</span> the batch</div>
<div class="line"><span class="lineno">  589</span>    gt_class_confidences_batch: a list of tensors <span class="keyword">with</span> length batch_size, where</div>
<div class="line"><span class="lineno">  590</span>      each tensor has shape [num_gt_boxes_i, classification_target_size] <span class="keywordflow">and</span></div>
<div class="line"><span class="lineno">  591</span>      num_gt_boxes_i <span class="keywordflow">is</span> the number of boxes <span class="keywordflow">in</span> the ith boxlist of</div>
<div class="line"><span class="lineno">  592</span>      gt_box_batch. Note that <span class="keywordflow">in</span> this tensor, 1 means explicit positive <span class="keyword">class</span>,</div>
<div class="line"><span class="lineno">  593</span>      -1 means explicit negative <span class="keyword">class</span>, <span class="keywordflow">and</span> 0 means implicit negative <span class="keyword">class</span>.</div>
<div class="line"><span class="lineno">  594</span>    gt_weights_batch: A list of 1-D tf.float32 tensors of shape</div>
<div class="line"><span class="lineno">  595</span>      [num_gt_boxes_i] containing weights <span class="keywordflow">for</span> groundtruth boxes.</div>
<div class="line"><span class="lineno">  596</span>    unmatched_class_label: a float32 tensor <span class="keyword">with</span> shape [d_1, d_2, ..., d_k]</div>
<div class="line"><span class="lineno">  597</span>      which <span class="keywordflow">is</span> consistent <span class="keyword">with</span> the classification target <span class="keywordflow">for</span> each</div>
<div class="line"><span class="lineno">  598</span>      anchor (<span class="keywordflow">and</span> can be empty <span class="keywordflow">for</span> scalar targets).  This shape must thus be</div>
<div class="line"><span class="lineno">  599</span>      compatible <span class="keyword">with</span> the groundtruth labels that are passed to the <span class="stringliteral">&quot;assign&quot;</span></div>
<div class="line"><span class="lineno">  600</span>      function (which have shape [num_gt_boxes, d_1, d_2, ..., d_k]).</div>
<div class="line"><span class="lineno">  601</span>    include_background_class: whether <span class="keywordflow">or</span> <span class="keywordflow">not</span> gt_class_confidences_batch includes</div>
<div class="line"><span class="lineno">  602</span>      the background <span class="keyword">class</span>.</div>
<div class="line"><span class="lineno">  603</span>    implicit_class_weight: the weight assigned to implicit examples.</div>
<div class="line"><span class="lineno">  604</span> </div>
<div class="line"><span class="lineno">  605</span>  Returns:</div>
<div class="line"><span class="lineno">  606</span>    batch_cls_targets: a tensor <span class="keyword">with</span> shape [batch_size, num_anchors,</div>
<div class="line"><span class="lineno">  607</span>      num_classes],</div>
<div class="line"><span class="lineno">  608</span>    batch_cls_weights: a tensor <span class="keyword">with</span> shape [batch_size, num_anchors,</div>
<div class="line"><span class="lineno">  609</span>      num_classes],</div>
<div class="line"><span class="lineno">  610</span>    batch_reg_targets: a tensor <span class="keyword">with</span> shape [batch_size, num_anchors,</div>
<div class="line"><span class="lineno">  611</span>      box_code_dimension]</div>
<div class="line"><span class="lineno">  612</span>    batch_reg_weights: a tensor <span class="keyword">with</span> shape [batch_size, num_anchors],</div>
<div class="line"><span class="lineno">  613</span>    match: an int32 tensor of shape [batch_size, num_anchors] containing result</div>
<div class="line"><span class="lineno">  614</span>      of anchor groundtruth matching. Each position <span class="keywordflow">in</span> the tensor indicates an</div>
<div class="line"><span class="lineno">  615</span>      anchor <span class="keywordflow">and</span> holds the following meaning:</div>
<div class="line"><span class="lineno">  616</span>      (1) <span class="keywordflow">if</span> match[x, i] &gt;= 0, anchor i <span class="keywordflow">is</span> matched <span class="keyword">with</span> groundtruth match[x, i].</div>
<div class="line"><span class="lineno">  617</span>      (2) <span class="keywordflow">if</span> match[x, i]=-1, anchor i <span class="keywordflow">is</span> marked to be background .</div>
<div class="line"><span class="lineno">  618</span>      (3) <span class="keywordflow">if</span> match[x, i]=-2, anchor i <span class="keywordflow">is</span> ignored since it <span class="keywordflow">is</span> <span class="keywordflow">not</span> background <span class="keywordflow">and</span></div>
<div class="line"><span class="lineno">  619</span>          does <span class="keywordflow">not</span> have sufficient overlap to call it a foreground.</div>
<div class="line"><span class="lineno">  620</span> </div>
<div class="line"><span class="lineno">  621</span>  Raises:</div>
<div class="line"><span class="lineno">  622</span>    ValueError: <span class="keywordflow">if</span> input list lengths are inconsistent, i.e.,</div>
<div class="line"><span class="lineno">  623</span>      batch_size == len(gt_box_batch) == len(gt_class_targets_batch)</div>
<div class="line"><span class="lineno">  624</span>      <span class="keywordflow">and</span> batch_size == len(anchors_batch) unless anchors_batch <span class="keywordflow">is</span> a single</div>
<div class="line"><span class="lineno">  625</span>      BoxList, <span class="keywordflow">or</span> <span class="keywordflow">if</span> any element <span class="keywordflow">in</span> gt_class_confidences_batch has rank &gt; 2.</div>
<div class="line"><span class="lineno">  626</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  627</span><span class="stringliteral">  </span><span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(anchors_batch, list):</div>
<div class="line"><span class="lineno">  628</span>    anchors_batch = len(gt_box_batch) * [anchors_batch]</div>
<div class="line"><span class="lineno">  629</span>  <span class="keywordflow">if</span> <span class="keywordflow">not</span> all(</div>
<div class="line"><span class="lineno">  630</span>      isinstance(anchors, box_list.BoxList) <span class="keywordflow">for</span> anchors <span class="keywordflow">in</span> anchors_batch):</div>
<div class="line"><span class="lineno">  631</span>    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;anchors_batch must be a BoxList or list of BoxLists.&#39;</span>)</div>
<div class="line"><span class="lineno">  632</span>  <span class="keywordflow">if</span> <span class="keywordflow">not</span> (len(anchors_batch)</div>
<div class="line"><span class="lineno">  633</span>          == len(gt_box_batch)</div>
<div class="line"><span class="lineno">  634</span>          == len(gt_class_confidences_batch)):</div>
<div class="line"><span class="lineno">  635</span>    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;batch size incompatible with lengths of anchors_batch, &#39;</span></div>
<div class="line"><span class="lineno">  636</span>                     <span class="stringliteral">&#39;gt_box_batch and gt_class_confidences_batch.&#39;</span>)</div>
<div class="line"><span class="lineno">  637</span> </div>
<div class="line"><span class="lineno">  638</span>  cls_targets_list = []</div>
<div class="line"><span class="lineno">  639</span>  cls_weights_list = []</div>
<div class="line"><span class="lineno">  640</span>  reg_targets_list = []</div>
<div class="line"><span class="lineno">  641</span>  reg_weights_list = []</div>
<div class="line"><span class="lineno">  642</span>  match_list = []</div>
<div class="line"><span class="lineno">  643</span>  <span class="keywordflow">if</span> gt_weights_batch <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  644</span>    gt_weights_batch = [<span class="keywordtype">None</span>] * len(gt_class_confidences_batch)</div>
<div class="line"><span class="lineno">  645</span>  <span class="keywordflow">for</span> anchors, gt_boxes, gt_class_confidences, gt_weights <span class="keywordflow">in</span> zip(</div>
<div class="line"><span class="lineno">  646</span>      anchors_batch, gt_box_batch, gt_class_confidences_batch,</div>
<div class="line"><span class="lineno">  647</span>      gt_weights_batch):</div>
<div class="line"><span class="lineno">  648</span> </div>
<div class="line"><span class="lineno">  649</span>    <span class="keywordflow">if</span> (gt_class_confidences <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span></div>
<div class="line"><span class="lineno">  650</span>        len(gt_class_confidences.get_shape().as_list()) &gt; 2):</div>
<div class="line"><span class="lineno">  651</span>      <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;The shape of the class target is not supported. &#39;</span>,</div>
<div class="line"><span class="lineno">  652</span>                       gt_class_confidences.get_shape())</div>
<div class="line"><span class="lineno">  653</span> </div>
<div class="line"><span class="lineno">  654</span>    cls_targets, _, reg_targets, _, match = target_assigner.assign(</div>
<div class="line"><span class="lineno">  655</span>        anchors, gt_boxes, gt_class_confidences, unmatched_class_label,</div>
<div class="line"><span class="lineno">  656</span>        groundtruth_weights=gt_weights)</div>
<div class="line"><span class="lineno">  657</span> </div>
<div class="line"><span class="lineno">  658</span>    <span class="keywordflow">if</span> include_background_class:</div>
<div class="line"><span class="lineno">  659</span>      cls_targets_without_background = tf.slice(</div>
<div class="line"><span class="lineno">  660</span>          cls_targets, [0, 1], [-1, -1])</div>
<div class="line"><span class="lineno">  661</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  662</span>      cls_targets_without_background = cls_targets</div>
<div class="line"><span class="lineno">  663</span> </div>
<div class="line"><span class="lineno">  664</span>    positive_mask = tf.greater(cls_targets_without_background, 0.0)</div>
<div class="line"><span class="lineno">  665</span>    negative_mask = tf.less(cls_targets_without_background, 0.0)</div>
<div class="line"><span class="lineno">  666</span>    explicit_example_mask = tf.logical_or(positive_mask, negative_mask)</div>
<div class="line"><span class="lineno">  667</span>    positive_anchors = tf.reduce_any(positive_mask, axis=-1)</div>
<div class="line"><span class="lineno">  668</span> </div>
<div class="line"><span class="lineno">  669</span>    regression_weights = tf.cast(positive_anchors, dtype=tf.float32)</div>
<div class="line"><span class="lineno">  670</span>    regression_targets = (</div>
<div class="line"><span class="lineno">  671</span>        reg_targets * tf.expand_dims(regression_weights, axis=-1))</div>
<div class="line"><span class="lineno">  672</span>    regression_weights_expanded = tf.expand_dims(regression_weights, axis=-1)</div>
<div class="line"><span class="lineno">  673</span> </div>
<div class="line"><span class="lineno">  674</span>    cls_targets_without_background = (</div>
<div class="line"><span class="lineno">  675</span>        cls_targets_without_background *</div>
<div class="line"><span class="lineno">  676</span>        (1 - tf.cast(negative_mask, dtype=tf.float32)))</div>
<div class="line"><span class="lineno">  677</span>    cls_weights_without_background = ((1 - implicit_class_weight) * tf.cast(</div>
<div class="line"><span class="lineno">  678</span>        explicit_example_mask, dtype=tf.float32) + implicit_class_weight)</div>
<div class="line"><span class="lineno">  679</span> </div>
<div class="line"><span class="lineno">  680</span>    <span class="keywordflow">if</span> include_background_class:</div>
<div class="line"><span class="lineno">  681</span>      cls_weights_background = (</div>
<div class="line"><span class="lineno">  682</span>          (1 - implicit_class_weight) * regression_weights_expanded</div>
<div class="line"><span class="lineno">  683</span>          + implicit_class_weight)</div>
<div class="line"><span class="lineno">  684</span>      classification_weights = tf.concat(</div>
<div class="line"><span class="lineno">  685</span>          [cls_weights_background, cls_weights_without_background], axis=-1)</div>
<div class="line"><span class="lineno">  686</span>      cls_targets_background = 1 - regression_weights_expanded</div>
<div class="line"><span class="lineno">  687</span>      classification_targets = tf.concat(</div>
<div class="line"><span class="lineno">  688</span>          [cls_targets_background, cls_targets_without_background], axis=-1)</div>
<div class="line"><span class="lineno">  689</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  690</span>      classification_targets = cls_targets_without_background</div>
<div class="line"><span class="lineno">  691</span>      classification_weights = cls_weights_without_background</div>
<div class="line"><span class="lineno">  692</span> </div>
<div class="line"><span class="lineno">  693</span>    cls_targets_list.append(classification_targets)</div>
<div class="line"><span class="lineno">  694</span>    cls_weights_list.append(classification_weights)</div>
<div class="line"><span class="lineno">  695</span>    reg_targets_list.append(regression_targets)</div>
<div class="line"><span class="lineno">  696</span>    reg_weights_list.append(regression_weights)</div>
<div class="line"><span class="lineno">  697</span>    match_list.append(match)</div>
<div class="line"><span class="lineno">  698</span>  batch_cls_targets = tf.stack(cls_targets_list)</div>
<div class="line"><span class="lineno">  699</span>  batch_cls_weights = tf.stack(cls_weights_list)</div>
<div class="line"><span class="lineno">  700</span>  batch_reg_targets = tf.stack(reg_targets_list)</div>
<div class="line"><span class="lineno">  701</span>  batch_reg_weights = tf.stack(reg_weights_list)</div>
<div class="line"><span class="lineno">  702</span>  batch_match = tf.stack(match_list)</div>
<div class="line"><span class="lineno">  703</span>  <span class="keywordflow">return</span> (batch_cls_targets, batch_cls_weights, batch_reg_targets,</div>
<div class="line"><span class="lineno">  704</span>          batch_reg_weights, batch_match)</div>
</div><!-- fragment -->
</div>
</div>
<a id="a4c9aabceffa66cd1fe527afe829b768b" name="a4c9aabceffa66cd1fe527afe829b768b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c9aabceffa66cd1fe527afe829b768b">&#9670;&#160;</a></span>batch_get_targets()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.target_assigner.batch_get_targets </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>batch_match</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>groundtruth_tensor_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>groundtruth_weights_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>unmatched_value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>unmatched_weight</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Returns targets based on anchor-groundtruth box matching results.

Args:
  batch_match: An int32 tensor of shape [batch, num_anchors] containing the
    result of target assignment returned by TargetAssigner.assign(..).
  groundtruth_tensor_list: A list of groundtruth tensors of shape
    [num_groundtruth, d_1, d_2, ..., d_k]. The tensors can be of any type.
  groundtruth_weights_list: A list of weights, one per groundtruth tensor, of
    shape [num_groundtruth].
  unmatched_value: A tensor of shape [d_1, d_2, ..., d_k] of the same type as
    groundtruth tensor containing target value for anchors that remain
    unmatched.
  unmatched_weight: Scalar weight to assign to anchors that remain unmatched.

Returns:
  targets: A tensor of shape [batch, num_anchors, d_1, d_2, ..., d_k]
    containing targets for anchors.
  weights: A float tensor of shape [batch, num_anchors] containing the weights
    to assign to each target.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d4/d4b/target__assigner_8py_source.html#l00518">518</a> of file <a class="el" href="../../d4/d4b/target__assigner_8py_source.html">target_assigner.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  520</span>                      unmatched_weight):</div>
<div class="line"><span class="lineno">  521</span>  <span class="stringliteral">&quot;&quot;&quot;Returns targets based on anchor-groundtruth box matching results.</span></div>
<div class="line"><span class="lineno">  522</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  523</span><span class="stringliteral">  Args:</span></div>
<div class="line"><span class="lineno">  524</span><span class="stringliteral">    batch_match: An int32 tensor of shape [batch, num_anchors] containing the</span></div>
<div class="line"><span class="lineno">  525</span><span class="stringliteral">      result of target assignment returned by TargetAssigner.assign(..).</span></div>
<div class="line"><span class="lineno">  526</span><span class="stringliteral">    groundtruth_tensor_list: A list of groundtruth tensors of shape</span></div>
<div class="line"><span class="lineno">  527</span><span class="stringliteral">      [num_groundtruth, d_1, d_2, ..., d_k]. The tensors can be of any type.</span></div>
<div class="line"><span class="lineno">  528</span><span class="stringliteral">    groundtruth_weights_list: A list of weights, one per groundtruth tensor, of</span></div>
<div class="line"><span class="lineno">  529</span><span class="stringliteral">      shape [num_groundtruth].</span></div>
<div class="line"><span class="lineno">  530</span><span class="stringliteral">    unmatched_value: A tensor of shape [d_1, d_2, ..., d_k] of the same type </span><span class="keyword">as</span></div>
<div class="line"><span class="lineno">  531</span>      groundtruth tensor containing target value <span class="keywordflow">for</span> anchors that remain</div>
<div class="line"><span class="lineno">  532</span>      unmatched.</div>
<div class="line"><span class="lineno">  533</span>    unmatched_weight: Scalar weight to assign to anchors that remain unmatched.</div>
<div class="line"><span class="lineno">  534</span> </div>
<div class="line"><span class="lineno">  535</span>  Returns:</div>
<div class="line"><span class="lineno">  536</span>    targets: A tensor of shape [batch, num_anchors, d_1, d_2, ..., d_k]</div>
<div class="line"><span class="lineno">  537</span>      containing targets <span class="keywordflow">for</span> anchors.</div>
<div class="line"><span class="lineno">  538</span>    weights: A float tensor of shape [batch, num_anchors] containing the weights</div>
<div class="line"><span class="lineno">  539</span>      to assign to each target.</div>
<div class="line"><span class="lineno">  540</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  541</span><span class="stringliteral">  match_list = tf.unstack(batch_match)</span></div>
<div class="line"><span class="lineno">  542</span><span class="stringliteral">  targets_list = []</span></div>
<div class="line"><span class="lineno">  543</span><span class="stringliteral">  weights_list = []</span></div>
<div class="line"><span class="lineno">  544</span><span class="stringliteral">  </span><span class="keywordflow">for</span> match_tensor, groundtruth_tensor, groundtruth_weight <span class="keywordflow">in</span> zip(</div>
<div class="line"><span class="lineno">  545</span>      match_list, groundtruth_tensor_list, groundtruth_weights_list):</div>
<div class="line"><span class="lineno">  546</span>    match_object = mat.Match(match_tensor)</div>
<div class="line"><span class="lineno">  547</span>    targets = match_object.gather_based_on_match(</div>
<div class="line"><span class="lineno">  548</span>        groundtruth_tensor,</div>
<div class="line"><span class="lineno">  549</span>        unmatched_value=unmatched_value,</div>
<div class="line"><span class="lineno">  550</span>        ignored_value=unmatched_value)</div>
<div class="line"><span class="lineno">  551</span>    targets_list.append(targets)</div>
<div class="line"><span class="lineno">  552</span>    weights = match_object.gather_based_on_match(</div>
<div class="line"><span class="lineno">  553</span>        groundtruth_weight,</div>
<div class="line"><span class="lineno">  554</span>        unmatched_value=unmatched_weight,</div>
<div class="line"><span class="lineno">  555</span>        ignored_value=tf.zeros_like(unmatched_weight))</div>
<div class="line"><span class="lineno">  556</span>    weights_list.append(weights)</div>
<div class="line"><span class="lineno">  557</span>  <span class="keywordflow">return</span> tf.stack(targets_list), tf.stack(weights_list)</div>
<div class="line"><span class="lineno">  558</span> </div>
<div class="line"><span class="lineno">  559</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ad5169f5aa5c502e10c38cc5663dbafd4" name="ad5169f5aa5c502e10c38cc5663dbafd4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5169f5aa5c502e10c38cc5663dbafd4">&#9670;&#160;</a></span>create_target_assigner()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.target_assigner.create_target_assigner </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>reference</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>stage</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>negative_class_weight</em> = <code>1.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>use_matmul_gather</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Factory function for creating standard target assigners.

Args:
  reference: string referencing the type of TargetAssigner.
  stage: string denoting stage: {proposal, detection}.
  negative_class_weight: classification weight to be associated to negative
    anchors (default: 1.0)
  use_matmul_gather: whether to use matrix multiplication based gather which
    are better suited for TPUs.

Returns:
  TargetAssigner: desired target assigner.

Raises:
  ValueError: if combination reference+stage is invalid.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d4/d4b/target__assigner_8py_source.html#l00373">373</a> of file <a class="el" href="../../d4/d4b/target__assigner_8py_source.html">target_assigner.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  374</span>                           negative_class_weight=1.0, use_matmul_gather=<span class="keyword">False</span>):</div>
<div class="line"><span class="lineno">  375</span>  <span class="stringliteral">&quot;&quot;&quot;Factory function for creating standard target assigners.</span></div>
<div class="line"><span class="lineno">  376</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  377</span><span class="stringliteral">  Args:</span></div>
<div class="line"><span class="lineno">  378</span><span class="stringliteral">    reference: string referencing the type of TargetAssigner.</span></div>
<div class="line"><span class="lineno">  379</span><span class="stringliteral">    stage: string denoting stage: {proposal, detection}.</span></div>
<div class="line"><span class="lineno">  380</span><span class="stringliteral">    negative_class_weight: classification weight to be associated to negative</span></div>
<div class="line"><span class="lineno">  381</span><span class="stringliteral">      anchors (default: 1.0)</span></div>
<div class="line"><span class="lineno">  382</span><span class="stringliteral">    use_matmul_gather: whether to use matrix multiplication based gather which</span></div>
<div class="line"><span class="lineno">  383</span><span class="stringliteral">      are better suited </span><span class="keywordflow">for</span> TPUs.</div>
<div class="line"><span class="lineno">  384</span> </div>
<div class="line"><span class="lineno">  385</span>  Returns:</div>
<div class="line"><span class="lineno">  386</span>    TargetAssigner: desired target assigner.</div>
<div class="line"><span class="lineno">  387</span> </div>
<div class="line"><span class="lineno">  388</span>  Raises:</div>
<div class="line"><span class="lineno">  389</span>    ValueError: <span class="keywordflow">if</span> combination reference+stage <span class="keywordflow">is</span> invalid.</div>
<div class="line"><span class="lineno">  390</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  391</span><span class="stringliteral">  </span><span class="keywordflow">if</span> reference == <span class="stringliteral">&#39;Multibox&#39;</span> <span class="keywordflow">and</span> stage == <span class="stringliteral">&#39;proposal&#39;</span>:</div>
<div class="line"><span class="lineno">  392</span>    similarity_calc = sim_calc.NegSqDistSimilarity()</div>
<div class="line"><span class="lineno">  393</span>    matcher = bipartite_matcher.GreedyBipartiteMatcher()</div>
<div class="line"><span class="lineno">  394</span>    box_coder = mean_stddev_box_coder.MeanStddevBoxCoder()</div>
<div class="line"><span class="lineno">  395</span> </div>
<div class="line"><span class="lineno">  396</span>  <span class="keywordflow">elif</span> reference == <span class="stringliteral">&#39;FasterRCNN&#39;</span> <span class="keywordflow">and</span> stage == <span class="stringliteral">&#39;proposal&#39;</span>:</div>
<div class="line"><span class="lineno">  397</span>    similarity_calc = sim_calc.IouSimilarity()</div>
<div class="line"><span class="lineno">  398</span>    matcher = argmax_matcher.ArgMaxMatcher(matched_threshold=0.7,</div>
<div class="line"><span class="lineno">  399</span>                                           unmatched_threshold=0.3,</div>
<div class="line"><span class="lineno">  400</span>                                           force_match_for_each_row=<span class="keyword">True</span>,</div>
<div class="line"><span class="lineno">  401</span>                                           use_matmul_gather=use_matmul_gather)</div>
<div class="line"><span class="lineno">  402</span>    box_coder = faster_rcnn_box_coder.FasterRcnnBoxCoder(</div>
<div class="line"><span class="lineno">  403</span>        scale_factors=[10.0, 10.0, 5.0, 5.0])</div>
<div class="line"><span class="lineno">  404</span> </div>
<div class="line"><span class="lineno">  405</span>  <span class="keywordflow">elif</span> reference == <span class="stringliteral">&#39;FasterRCNN&#39;</span> <span class="keywordflow">and</span> stage == <span class="stringliteral">&#39;detection&#39;</span>:</div>
<div class="line"><span class="lineno">  406</span>    similarity_calc = sim_calc.IouSimilarity()</div>
<div class="line"><span class="lineno">  407</span>    <span class="comment"># Uses all proposals with IOU &lt; 0.5 as candidate negatives.</span></div>
<div class="line"><span class="lineno">  408</span>    matcher = argmax_matcher.ArgMaxMatcher(matched_threshold=0.5,</div>
<div class="line"><span class="lineno">  409</span>                                           negatives_lower_than_unmatched=<span class="keyword">True</span>,</div>
<div class="line"><span class="lineno">  410</span>                                           use_matmul_gather=use_matmul_gather)</div>
<div class="line"><span class="lineno">  411</span>    box_coder = faster_rcnn_box_coder.FasterRcnnBoxCoder(</div>
<div class="line"><span class="lineno">  412</span>        scale_factors=[10.0, 10.0, 5.0, 5.0])</div>
<div class="line"><span class="lineno">  413</span> </div>
<div class="line"><span class="lineno">  414</span>  <span class="keywordflow">elif</span> reference == <span class="stringliteral">&#39;FastRCNN&#39;</span>:</div>
<div class="line"><span class="lineno">  415</span>    similarity_calc = sim_calc.IouSimilarity()</div>
<div class="line"><span class="lineno">  416</span>    matcher = argmax_matcher.ArgMaxMatcher(matched_threshold=0.5,</div>
<div class="line"><span class="lineno">  417</span>                                           unmatched_threshold=0.1,</div>
<div class="line"><span class="lineno">  418</span>                                           force_match_for_each_row=<span class="keyword">False</span>,</div>
<div class="line"><span class="lineno">  419</span>                                           negatives_lower_than_unmatched=<span class="keyword">False</span>,</div>
<div class="line"><span class="lineno">  420</span>                                           use_matmul_gather=use_matmul_gather)</div>
<div class="line"><span class="lineno">  421</span>    box_coder = faster_rcnn_box_coder.FasterRcnnBoxCoder()</div>
<div class="line"><span class="lineno">  422</span> </div>
<div class="line"><span class="lineno">  423</span>  <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  424</span>    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;No valid combination of reference and stage.&#39;</span>)</div>
<div class="line"><span class="lineno">  425</span> </div>
<div class="line"><span class="lineno">  426</span>  <span class="keywordflow">return</span> TargetAssigner(similarity_calc, matcher, box_coder,</div>
<div class="line"><span class="lineno">  427</span>                        negative_class_weight=negative_class_weight)</div>
<div class="line"><span class="lineno">  428</span> </div>
<div class="line"><span class="lineno">  429</span> </div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a5c6f3a5416c9c7d7eee481724034c9be" name="a5c6f3a5416c9c7d7eee481724034c9be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c6f3a5416c9c7d7eee481724034c9be">&#9670;&#160;</a></span>batch_assign_targets</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.target_assigner.batch_assign_targets = <a class="el" href="../../d2/de4/namespacedetection__utils_1_1core_1_1target__assigner.html#a8d3571d24057b74962a5e08c912d8145">batch_assign</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d4b/target__assigner_8py_source.html#l00515">515</a> of file <a class="el" href="../../d4/d4b/target__assigner_8py_source.html">target_assigner.py</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
