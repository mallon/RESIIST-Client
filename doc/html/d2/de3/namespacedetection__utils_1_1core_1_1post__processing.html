<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RESIIST: detection_utils.core.post_processing Namespace Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">RESIIST
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d8/d97/namespacedetection__utils.html">detection_utils</a></li><li class="navelem"><a class="el" href="../../de/d5d/namespacedetection__utils_1_1core.html">core</a></li><li class="navelem"><a class="el" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html">post_processing</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">detection_utils.core.post_processing Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a612ecf46d8c84ee42d5fb8cce480d2c5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a612ecf46d8c84ee42d5fb8cce480d2c5">batch_iou</a> (boxes1, boxes2)</td></tr>
<tr class="separator:a612ecf46d8c84ee42d5fb8cce480d2c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a259919b31e1b3880168781f2907ecf75"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a259919b31e1b3880168781f2907ecf75">_self_suppression</a> (iou, iou_threshold, loop_condition, iou_sum)</td></tr>
<tr class="separator:a259919b31e1b3880168781f2907ecf75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a9bf16a47c1a7fa60bd230b8936bfa6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a7a9bf16a47c1a7fa60bd230b8936bfa6">_cross_suppression</a> (boxes, box_slice, iou_threshold, inner_idx)</td></tr>
<tr class="separator:a7a9bf16a47c1a7fa60bd230b8936bfa6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36bbe3e1836346ce651409440b335386"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a36bbe3e1836346ce651409440b335386">_suppression_loop_body</a> (boxes, iou_threshold, output_size, idx)</td></tr>
<tr class="separator:a36bbe3e1836346ce651409440b335386"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdb21198d6a9443ec277742c9938612b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#afdb21198d6a9443ec277742c9938612b">partitioned_non_max_suppression_padded</a> (boxes, scores, max_output_size, iou_threshold=0.5, score_threshold=float('-inf'))</td></tr>
<tr class="separator:afdb21198d6a9443ec277742c9938612b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1def87e6a8b8fad1ca56f6b3985f69d1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a1def87e6a8b8fad1ca56f6b3985f69d1">_validate_boxes_scores_iou_thresh</a> (boxes, scores, iou_thresh, change_coordinate_frame, clip_window)</td></tr>
<tr class="separator:a1def87e6a8b8fad1ca56f6b3985f69d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa52731af79c1f94bed50a291b05060ce"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#aa52731af79c1f94bed50a291b05060ce">_clip_window_prune_boxes</a> (sorted_boxes, clip_window, pad_to_max_output_size, change_coordinate_frame)</td></tr>
<tr class="separator:aa52731af79c1f94bed50a291b05060ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58b5edbb0a9b33010aae722c82050006"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a58b5edbb0a9b33010aae722c82050006">multiclass_non_max_suppression</a> (boxes, scores, score_thresh, iou_thresh, max_size_per_class, max_total_size=0, clip_window=None, change_coordinate_frame=False, masks=None, boundaries=None, pad_to_max_output_size=False, additional_fields=None, soft_nms_sigma=0.0, scope=None)</td></tr>
<tr class="separator:a58b5edbb0a9b33010aae722c82050006"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d33e143f24dc55fe43809b17882217d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a0d33e143f24dc55fe43809b17882217d">class_agnostic_non_max_suppression</a> (boxes, scores, score_thresh, iou_thresh, max_classes_per_detection=1, max_total_size=0, clip_window=None, change_coordinate_frame=False, masks=None, boundaries=None, pad_to_max_output_size=False, additional_fields=None, soft_nms_sigma=0.0, scope=None)</td></tr>
<tr class="separator:a0d33e143f24dc55fe43809b17882217d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a766a437a0d89839c4e6828b54205d000"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a766a437a0d89839c4e6828b54205d000">batch_multiclass_non_max_suppression</a> (boxes, scores, score_thresh, iou_thresh, max_size_per_class, max_total_size=0, clip_window=None, change_coordinate_frame=False, num_valid_boxes=None, masks=None, additional_fields=None, soft_nms_sigma=0.0, scope=None, use_static_shapes=False, parallel_iterations=32, use_class_agnostic_nms=False, max_classes_per_detection=1)</td></tr>
<tr class="separator:a766a437a0d89839c4e6828b54205d000"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aaa179acbbda14bd507b72a2fb36b0fef"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#aaa179acbbda14bd507b72a2fb36b0fef">_NMS_TILE_SIZE</a> = 512</td></tr>
<tr class="separator:aaa179acbbda14bd507b72a2fb36b0fef"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Post-processing operations on detected boxes.</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="aa52731af79c1f94bed50a291b05060ce" name="aa52731af79c1f94bed50a291b05060ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa52731af79c1f94bed50a291b05060ce">&#9670;&#160;</a></span>_clip_window_prune_boxes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.post_processing._clip_window_prune_boxes </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>sorted_boxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>clip_window</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>pad_to_max_output_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>change_coordinate_frame</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Prune boxes with zero area.

Args:
  sorted_boxes: A BoxList containing k detections.
  clip_window: A float32 tensor of the form [y_min, x_min, y_max, x_max]
    representing the window to clip and normalize boxes to before performing
    non-max suppression.
  pad_to_max_output_size: flag indicating whether to pad to max output size or
    not.
  change_coordinate_frame: Whether to normalize coordinates after clipping
    relative to clip_window (this can only be set to True if a clip_window is
    provided).

Returns:
  sorted_boxes: A BoxList containing k detections after pruning.
  num_valid_nms_boxes_cumulative: Number of valid NMS boxes
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d1/d53/post__processing_8py_source.html#l00344">344</a> of file <a class="el" href="../../d1/d53/post__processing_8py_source.html">post_processing.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  345</span>                             change_coordinate_frame):</div>
<div class="line"><span class="lineno">  346</span>  <span class="stringliteral">&quot;&quot;&quot;Prune boxes with zero area.</span></div>
<div class="line"><span class="lineno">  347</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  348</span><span class="stringliteral">  Args:</span></div>
<div class="line"><span class="lineno">  349</span><span class="stringliteral">    sorted_boxes: A BoxList containing k detections.</span></div>
<div class="line"><span class="lineno">  350</span><span class="stringliteral">    clip_window: A float32 tensor of the form [y_min, x_min, y_max, x_max]</span></div>
<div class="line"><span class="lineno">  351</span><span class="stringliteral">      representing the window to clip </span><span class="keywordflow">and</span> normalize boxes to before performing</div>
<div class="line"><span class="lineno">  352</span>      non-max suppression.</div>
<div class="line"><span class="lineno">  353</span>    pad_to_max_output_size: flag indicating whether to pad to max output size <span class="keywordflow">or</span></div>
<div class="line"><span class="lineno">  354</span>      <span class="keywordflow">not</span>.</div>
<div class="line"><span class="lineno">  355</span>    change_coordinate_frame: Whether to normalize coordinates after clipping</div>
<div class="line"><span class="lineno">  356</span>      relative to clip_window (this can only be set to <span class="keyword">True</span> <span class="keywordflow">if</span> a clip_window <span class="keywordflow">is</span></div>
<div class="line"><span class="lineno">  357</span>      provided).</div>
<div class="line"><span class="lineno">  358</span> </div>
<div class="line"><span class="lineno">  359</span>  Returns:</div>
<div class="line"><span class="lineno">  360</span>    sorted_boxes: A BoxList containing k detections after pruning.</div>
<div class="line"><span class="lineno">  361</span>    num_valid_nms_boxes_cumulative: Number of valid NMS boxes</div>
<div class="line"><span class="lineno">  362</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  363</span><span class="stringliteral">  sorted_boxes = box_list_ops.clip_to_window(</span></div>
<div class="line"><span class="lineno">  364</span><span class="stringliteral">      sorted_boxes,</span></div>
<div class="line"><span class="lineno">  365</span><span class="stringliteral">      clip_window,</span></div>
<div class="line"><span class="lineno">  366</span><span class="stringliteral">      filter_nonoverlapping=</span><span class="keywordflow">not</span> pad_to_max_output_size)</div>
<div class="line"><span class="lineno">  367</span>  <span class="comment"># Set the scores of boxes with zero area to -1 to keep the default</span></div>
<div class="line"><span class="lineno">  368</span>  <span class="comment"># behaviour of pruning out zero area boxes.</span></div>
<div class="line"><span class="lineno">  369</span>  sorted_boxes_size = tf.shape(sorted_boxes.get())[0]</div>
<div class="line"><span class="lineno">  370</span>  non_zero_box_area = tf.cast(box_list_ops.area(sorted_boxes), tf.bool)</div>
<div class="line"><span class="lineno">  371</span>  sorted_boxes_scores = tf.where(</div>
<div class="line"><span class="lineno">  372</span>      non_zero_box_area, sorted_boxes.get_field(fields.BoxListFields.scores),</div>
<div class="line"><span class="lineno">  373</span>      -1 * tf.ones(sorted_boxes_size))</div>
<div class="line"><span class="lineno">  374</span>  sorted_boxes.add_field(fields.BoxListFields.scores, sorted_boxes_scores)</div>
<div class="line"><span class="lineno">  375</span>  num_valid_nms_boxes_cumulative = tf.reduce_sum(</div>
<div class="line"><span class="lineno">  376</span>      tf.cast(tf.greater_equal(sorted_boxes_scores, 0), tf.int32))</div>
<div class="line"><span class="lineno">  377</span>  sorted_boxes = box_list_ops.sort_by_field(sorted_boxes,</div>
<div class="line"><span class="lineno">  378</span>                                            fields.BoxListFields.scores)</div>
<div class="line"><span class="lineno">  379</span>  <span class="keywordflow">if</span> change_coordinate_frame:</div>
<div class="line"><span class="lineno">  380</span>    sorted_boxes = box_list_ops.change_coordinate_frame(sorted_boxes,</div>
<div class="line"><span class="lineno">  381</span>                                                        clip_window)</div>
<div class="line"><span class="lineno">  382</span>  <span class="keywordflow">return</span> sorted_boxes, num_valid_nms_boxes_cumulative</div>
<div class="line"><span class="lineno">  383</span> </div>
<div class="line"><span class="lineno">  384</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing_aa52731af79c1f94bed50a291b05060ce_icgraph.png" border="0" usemap="#ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_aa52731af79c1f94bed50a291b05060ce_icgraph" alt=""/></div>
<map name="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_aa52731af79c1f94bed50a291b05060ce_icgraph" id="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_aa52731af79c1f94bed50a291b05060ce_icgraph">
<area shape="rect" title=" " alt="" coords="479,45,651,100"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a0d33e143f24dc55fe43809b17882217d" title=" " alt="" coords="248,5,431,60"/>
<area shape="poly" title=" " alt="" coords="465,58,430,51,431,46,466,52"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a58b5edbb0a9b33010aae722c82050006" title=" " alt="" coords="257,84,421,139"/>
<area shape="poly" title=" " alt="" coords="466,92,422,100,421,95,465,87"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a766a437a0d89839c4e6828b54205d000" title=" " alt="" coords="5,45,200,100"/>
<area shape="poly" title=" " alt="" coords="235,53,201,59,200,54,234,48"/>
<area shape="poly" title=" " alt="" coords="243,98,200,91,201,86,244,93"/>
</map>
</div>

</div>
</div>
<a id="a7a9bf16a47c1a7fa60bd230b8936bfa6" name="a7a9bf16a47c1a7fa60bd230b8936bfa6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a9bf16a47c1a7fa60bd230b8936bfa6">&#9670;&#160;</a></span>_cross_suppression()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.post_processing._cross_suppression </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>boxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>box_slice</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iou_threshold</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>inner_idx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Bounding-boxes cross-suppression loop body.

Args:
  boxes: A float Tensor of shape [1, anchors, 4], representing boxes.
  box_slice: A float Tensor of shape [1, _NMS_TILE_SIZE, 4], the box tile
    returned from last iteration
  iou_threshold: A scalar, representing IOU threshold.
  inner_idx: A scalar, representing inner index.

Returns:
  boxes: A float Tensor of shape [1, anchors, 4], representing boxes.
  ret_slice: A float Tensor of shape [1, _NMS_TILE_SIZE, 4], the box tile
             after suppression
  iou_threshold: A scalar, representing IOU threshold.
  inner_idx: A scalar, inner index incremented.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d1/d53/post__processing_8py_source.html#l00114">114</a> of file <a class="el" href="../../d1/d53/post__processing_8py_source.html">post_processing.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  114</span><span class="keyword">def </span>_cross_suppression(boxes, box_slice, iou_threshold, inner_idx):</div>
<div class="line"><span class="lineno">  115</span>  <span class="stringliteral">&quot;&quot;&quot;Bounding-boxes cross-suppression loop body.</span></div>
<div class="line"><span class="lineno">  116</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  117</span><span class="stringliteral">  Args:</span></div>
<div class="line"><span class="lineno">  118</span><span class="stringliteral">    boxes: A float Tensor of shape [1, anchors, 4], representing boxes.</span></div>
<div class="line"><span class="lineno">  119</span><span class="stringliteral">    box_slice: A float Tensor of shape [1, _NMS_TILE_SIZE, 4], the box tile</span></div>
<div class="line"><span class="lineno">  120</span><span class="stringliteral">      returned </span><span class="keyword">from</span> last iteration</div>
<div class="line"><span class="lineno">  121</span>    iou_threshold: A scalar, representing IOU threshold.</div>
<div class="line"><span class="lineno">  122</span>    inner_idx: A scalar, representing inner index.</div>
<div class="line"><span class="lineno">  123</span> </div>
<div class="line"><span class="lineno">  124</span>  Returns:</div>
<div class="line"><span class="lineno">  125</span>    boxes: A float Tensor of shape [1, anchors, 4], representing boxes.</div>
<div class="line"><span class="lineno">  126</span>    ret_slice: A float Tensor of shape [1, _NMS_TILE_SIZE, 4], the box tile</div>
<div class="line"><span class="lineno">  127</span>               after suppression</div>
<div class="line"><span class="lineno">  128</span>    iou_threshold: A scalar, representing IOU threshold.</div>
<div class="line"><span class="lineno">  129</span>    inner_idx: A scalar, inner index incremented.</div>
<div class="line"><span class="lineno">  130</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  131</span><span class="stringliteral">  new_slice = tf.slice(boxes, [0, inner_idx * _NMS_TILE_SIZE, 0],</span></div>
<div class="line"><span class="lineno">  132</span><span class="stringliteral">                       [1, _NMS_TILE_SIZE, 4])</span></div>
<div class="line"><span class="lineno">  133</span><span class="stringliteral">  iou = batch_iou(new_slice, box_slice)</span></div>
<div class="line"><span class="lineno">  134</span><span class="stringliteral">  ret_slice = tf.expand_dims(</span></div>
<div class="line"><span class="lineno">  135</span><span class="stringliteral">      tf.cast(tf.reduce_all(iou &lt; iou_threshold, [1]), box_slice.dtype),</span></div>
<div class="line"><span class="lineno">  136</span><span class="stringliteral">      2) * box_slice</span></div>
<div class="line"><span class="lineno">  137</span><span class="stringliteral">  </span><span class="keywordflow">return</span> boxes, ret_slice, iou_threshold, inner_idx + 1</div>
<div class="line"><span class="lineno">  138</span> </div>
<div class="line"><span class="lineno">  139</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing_a7a9bf16a47c1a7fa60bd230b8936bfa6_cgraph.png" border="0" usemap="#ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a7a9bf16a47c1a7fa60bd230b8936bfa6_cgraph" alt=""/></div>
<map name="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a7a9bf16a47c1a7fa60bd230b8936bfa6_cgraph" id="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a7a9bf16a47c1a7fa60bd230b8936bfa6_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,217,45"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a612ecf46d8c84ee42d5fb8cce480d2c5" title=" " alt="" coords="265,5,429,45"/>
<area shape="poly" title=" " alt="" coords="217,23,252,23,252,28,217,28"/>
</map>
</div>

</div>
</div>
<a id="a259919b31e1b3880168781f2907ecf75" name="a259919b31e1b3880168781f2907ecf75"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a259919b31e1b3880168781f2907ecf75">&#9670;&#160;</a></span>_self_suppression()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.post_processing._self_suppression </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iou</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iou_threshold</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>loop_condition</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iou_sum</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Bounding-boxes self-suppression loop body.

Args:
  iou: A float Tensor with shape [1, num_boxes, max_num_instance]: IOUs.
  iou_threshold: A scalar, representing IOU threshold.
  loop_condition: The loop condition returned from last iteration.
  iou_sum: iou_sum_new returned from last iteration.

Returns:
  iou_suppressed: A float Tensor with shape [1, num_boxes, max_num_instance],
                  IOU after suppression.
  iou_threshold: A scalar, representing IOU threshold.
  loop_condition: Bool Tensor of shape [], the loop condition.
  iou_sum_new: The new IOU sum.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d1/d53/post__processing_8py_source.html#l00084">84</a> of file <a class="el" href="../../d1/d53/post__processing_8py_source.html">post_processing.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   84</span><span class="keyword">def </span>_self_suppression(iou, iou_threshold, loop_condition, iou_sum):</div>
<div class="line"><span class="lineno">   85</span>  <span class="stringliteral">&quot;&quot;&quot;Bounding-boxes self-suppression loop body.</span></div>
<div class="line"><span class="lineno">   86</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   87</span><span class="stringliteral">  Args:</span></div>
<div class="line"><span class="lineno">   88</span><span class="stringliteral">    iou: A float Tensor </span><span class="keyword">with</span> shape [1, num_boxes, max_num_instance]: IOUs.</div>
<div class="line"><span class="lineno">   89</span>    iou_threshold: A scalar, representing IOU threshold.</div>
<div class="line"><span class="lineno">   90</span>    loop_condition: The loop condition returned <span class="keyword">from</span> last iteration.</div>
<div class="line"><span class="lineno">   91</span>    iou_sum: iou_sum_new returned <span class="keyword">from</span> last iteration.</div>
<div class="line"><span class="lineno">   92</span> </div>
<div class="line"><span class="lineno">   93</span>  Returns:</div>
<div class="line"><span class="lineno">   94</span>    iou_suppressed: A float Tensor <span class="keyword">with</span> shape [1, num_boxes, max_num_instance],</div>
<div class="line"><span class="lineno">   95</span>                    IOU after suppression.</div>
<div class="line"><span class="lineno">   96</span>    iou_threshold: A scalar, representing IOU threshold.</div>
<div class="line"><span class="lineno">   97</span>    loop_condition: Bool Tensor of shape [], the loop condition.</div>
<div class="line"><span class="lineno">   98</span>    iou_sum_new: The new IOU sum.</div>
<div class="line"><span class="lineno">   99</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  100</span><span class="stringliteral">  del loop_condition</span></div>
<div class="line"><span class="lineno">  101</span><span class="stringliteral">  can_suppress_others = tf.cast(</span></div>
<div class="line"><span class="lineno">  102</span><span class="stringliteral">      tf.reshape(tf.reduce_max(iou, 1) &lt;= iou_threshold, [1, -1, 1]), iou.dtype)</span></div>
<div class="line"><span class="lineno">  103</span><span class="stringliteral">  iou_suppressed = tf.reshape(</span></div>
<div class="line"><span class="lineno">  104</span><span class="stringliteral">      tf.cast(</span></div>
<div class="line"><span class="lineno">  105</span><span class="stringliteral">          tf.reduce_max(can_suppress_others * iou, 1) &lt;= iou_threshold,</span></div>
<div class="line"><span class="lineno">  106</span><span class="stringliteral">          iou.dtype), [1, -1, 1]) * iou</span></div>
<div class="line"><span class="lineno">  107</span><span class="stringliteral">  iou_sum_new = tf.reduce_sum(iou_suppressed, [1, 2])</span></div>
<div class="line"><span class="lineno">  108</span><span class="stringliteral">  </span><span class="keywordflow">return</span> [</div>
<div class="line"><span class="lineno">  109</span>      iou_suppressed, iou_threshold,</div>
<div class="line"><span class="lineno">  110</span>      tf.reduce_any(iou_sum - iou_sum_new &gt; iou_threshold), iou_sum_new</div>
<div class="line"><span class="lineno">  111</span>  ]</div>
<div class="line"><span class="lineno">  112</span> </div>
<div class="line"><span class="lineno">  113</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a36bbe3e1836346ce651409440b335386" name="a36bbe3e1836346ce651409440b335386"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36bbe3e1836346ce651409440b335386">&#9670;&#160;</a></span>_suppression_loop_body()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.post_processing._suppression_loop_body </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>boxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iou_threshold</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>output_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>idx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Process boxes in the range [idx*_NMS_TILE_SIZE, (idx+1)*_NMS_TILE_SIZE).

Args:
  boxes: a tensor with a shape of [1, anchors, 4].
  iou_threshold: a float representing the threshold for deciding whether boxes
    overlap too much with respect to IOU.
  output_size: an int32 tensor of size [1]. Representing the number of
    selected boxes.
  idx: an integer scalar representing induction variable.

Returns:
  boxes: updated boxes.
  iou_threshold: pass down iou_threshold to the next iteration.
  output_size: the updated output_size.
  idx: the updated induction variable.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d1/d53/post__processing_8py_source.html#l00140">140</a> of file <a class="el" href="../../d1/d53/post__processing_8py_source.html">post_processing.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  140</span><span class="keyword">def </span>_suppression_loop_body(boxes, iou_threshold, output_size, idx):</div>
<div class="line"><span class="lineno">  141</span>  <span class="stringliteral">&quot;&quot;&quot;Process boxes in the range [idx*_NMS_TILE_SIZE, (idx+1)*_NMS_TILE_SIZE).</span></div>
<div class="line"><span class="lineno">  142</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  143</span><span class="stringliteral">  Args:</span></div>
<div class="line"><span class="lineno">  144</span><span class="stringliteral">    boxes: a tensor </span><span class="keyword">with</span> a shape of [1, anchors, 4].</div>
<div class="line"><span class="lineno">  145</span>    iou_threshold: a float representing the threshold <span class="keywordflow">for</span> deciding whether boxes</div>
<div class="line"><span class="lineno">  146</span>      overlap too much <span class="keyword">with</span> respect to IOU.</div>
<div class="line"><span class="lineno">  147</span>    output_size: an int32 tensor of size [1]. Representing the number of</div>
<div class="line"><span class="lineno">  148</span>      selected boxes.</div>
<div class="line"><span class="lineno">  149</span>    idx: an integer scalar representing induction variable.</div>
<div class="line"><span class="lineno">  150</span> </div>
<div class="line"><span class="lineno">  151</span>  Returns:</div>
<div class="line"><span class="lineno">  152</span>    boxes: updated boxes.</div>
<div class="line"><span class="lineno">  153</span>    iou_threshold: <span class="keywordflow">pass</span> down iou_threshold to the next iteration.</div>
<div class="line"><span class="lineno">  154</span>    output_size: the updated output_size.</div>
<div class="line"><span class="lineno">  155</span>    idx: the updated induction variable.</div>
<div class="line"><span class="lineno">  156</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  157</span><span class="stringliteral">  num_tiles = tf.shape(boxes)[1] // _NMS_TILE_SIZE</span></div>
<div class="line"><span class="lineno">  158</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  159</span><span class="stringliteral">  </span><span class="comment"># Iterates over tiles that can possibly suppress the current tile.</span></div>
<div class="line"><span class="lineno">  160</span>  box_slice = tf.slice(boxes, [0, idx * _NMS_TILE_SIZE, 0],</div>
<div class="line"><span class="lineno">  161</span>                       [1, _NMS_TILE_SIZE, 4])</div>
<div class="line"><span class="lineno">  162</span>  _, box_slice, _, _ = tf.while_loop(</div>
<div class="line"><span class="lineno">  163</span>      <span class="keyword">lambda</span> _boxes, _box_slice, _threshold, inner_idx: inner_idx &lt; idx,</div>
<div class="line"><span class="lineno">  164</span>      _cross_suppression, [boxes, box_slice, iou_threshold,</div>
<div class="line"><span class="lineno">  165</span>                           tf.constant(0)])</div>
<div class="line"><span class="lineno">  166</span> </div>
<div class="line"><span class="lineno">  167</span>  <span class="comment"># Iterates over the current tile to compute self-suppression.</span></div>
<div class="line"><span class="lineno">  168</span>  iou = batch_iou(box_slice, box_slice)</div>
<div class="line"><span class="lineno">  169</span>  mask = tf.expand_dims(</div>
<div class="line"><span class="lineno">  170</span>      tf.reshape(tf.range(_NMS_TILE_SIZE), [1, -1]) &gt; tf.reshape(</div>
<div class="line"><span class="lineno">  171</span>          tf.range(_NMS_TILE_SIZE), [-1, 1]), 0)</div>
<div class="line"><span class="lineno">  172</span>  iou *= tf.cast(tf.logical_and(mask, iou &gt;= iou_threshold), iou.dtype)</div>
<div class="line"><span class="lineno">  173</span>  suppressed_iou, _, _, _ = tf.while_loop(</div>
<div class="line"><span class="lineno">  174</span>      <span class="keyword">lambda</span> _iou, _threshold, loop_condition, _iou_sum: loop_condition,</div>
<div class="line"><span class="lineno">  175</span>      _self_suppression,</div>
<div class="line"><span class="lineno">  176</span>      [iou, iou_threshold,</div>
<div class="line"><span class="lineno">  177</span>       tf.constant(<span class="keyword">True</span>),</div>
<div class="line"><span class="lineno">  178</span>       tf.reduce_sum(iou, [1, 2])])</div>
<div class="line"><span class="lineno">  179</span>  suppressed_box = tf.reduce_sum(suppressed_iou, 1) &gt; 0</div>
<div class="line"><span class="lineno">  180</span>  box_slice *= tf.expand_dims(1.0 - tf.cast(suppressed_box, box_slice.dtype), 2)</div>
<div class="line"><span class="lineno">  181</span> </div>
<div class="line"><span class="lineno">  182</span>  <span class="comment"># Uses box_slice to update the input boxes.</span></div>
<div class="line"><span class="lineno">  183</span>  mask = tf.reshape(</div>
<div class="line"><span class="lineno">  184</span>      tf.cast(tf.equal(tf.range(num_tiles), idx), boxes.dtype), [1, -1, 1, 1])</div>
<div class="line"><span class="lineno">  185</span>  boxes = tf.tile(tf.expand_dims(box_slice, [1]),</div>
<div class="line"><span class="lineno">  186</span>                  [1, num_tiles, 1, 1]) * mask + tf.reshape(</div>
<div class="line"><span class="lineno">  187</span>                      boxes, [1, num_tiles, _NMS_TILE_SIZE, 4]) * (1 - mask)</div>
<div class="line"><span class="lineno">  188</span>  boxes = tf.reshape(boxes, [1, -1, 4])</div>
<div class="line"><span class="lineno">  189</span> </div>
<div class="line"><span class="lineno">  190</span>  <span class="comment"># Updates output_size.</span></div>
<div class="line"><span class="lineno">  191</span>  output_size += tf.reduce_sum(</div>
<div class="line"><span class="lineno">  192</span>      tf.cast(tf.reduce_any(box_slice &gt; 0, [2]), tf.int32), [1])</div>
<div class="line"><span class="lineno">  193</span>  <span class="keywordflow">return</span> boxes, iou_threshold, output_size, idx + 1</div>
<div class="line"><span class="lineno">  194</span> </div>
<div class="line"><span class="lineno">  195</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing_a36bbe3e1836346ce651409440b335386_cgraph.png" border="0" usemap="#ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a36bbe3e1836346ce651409440b335386_cgraph" alt=""/></div>
<map name="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a36bbe3e1836346ce651409440b335386_cgraph" id="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a36bbe3e1836346ce651409440b335386_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,179,60"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a612ecf46d8c84ee42d5fb8cce480d2c5" title=" " alt="" coords="227,13,391,53"/>
<area shape="poly" title=" " alt="" coords="179,30,213,30,213,35,179,35"/>
</map>
</div>

</div>
</div>
<a id="a1def87e6a8b8fad1ca56f6b3985f69d1" name="a1def87e6a8b8fad1ca56f6b3985f69d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1def87e6a8b8fad1ca56f6b3985f69d1">&#9670;&#160;</a></span>_validate_boxes_scores_iou_thresh()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.post_processing._validate_boxes_scores_iou_thresh </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>boxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>scores</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iou_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>change_coordinate_frame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>clip_window</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Validates boxes, scores and iou_thresh.

This function validates the boxes, scores, iou_thresh
   and if change_coordinate_frame is True, clip_window must be specified.

Args:
  boxes: A [k, q, 4] float32 tensor containing k detections. `q` can be either
    number of classes or 1 depending on whether a separate box is predicted
    per class.
  scores: A [k, num_classes] float32 tensor containing the scores for each of
    the k detections. The scores have to be non-negative when
    pad_to_max_output_size is True.
  iou_thresh: scalar threshold for IOU (new boxes that have high IOU overlap
    with previously selected boxes are removed).
  change_coordinate_frame: Whether to normalize coordinates after clipping
    relative to clip_window (this can only be set to True if a clip_window is
    provided)
  clip_window: A float32 tensor of the form [y_min, x_min, y_max, x_max]
    representing the window to clip and normalize boxes to before performing
    non-max suppression.

Raises:
  ValueError: if iou_thresh is not in [0, 1] or if input boxlist does not
  have a valid scores field.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d1/d53/post__processing_8py_source.html#l00297">297</a> of file <a class="el" href="../../d1/d53/post__processing_8py_source.html">post_processing.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  298</span>                                      change_coordinate_frame, clip_window):</div>
<div class="line"><span class="lineno">  299</span>  <span class="stringliteral">&quot;&quot;&quot;Validates boxes, scores and iou_thresh.</span></div>
<div class="line"><span class="lineno">  300</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  301</span><span class="stringliteral">  This function validates the boxes, scores, iou_thresh</span></div>
<div class="line"><span class="lineno">  302</span><span class="stringliteral">     </span><span class="keywordflow">and</span> <span class="keywordflow">if</span> change_coordinate_frame <span class="keywordflow">is</span> <span class="keyword">True</span>, clip_window must be specified.</div>
<div class="line"><span class="lineno">  303</span> </div>
<div class="line"><span class="lineno">  304</span>  Args:</div>
<div class="line"><span class="lineno">  305</span>    boxes: A [k, q, 4] float32 tensor containing k detections. `q` can be either</div>
<div class="line"><span class="lineno">  306</span>      number of classes <span class="keywordflow">or</span> 1 depending on whether a separate box <span class="keywordflow">is</span> predicted</div>
<div class="line"><span class="lineno">  307</span>      per <span class="keyword">class</span>.</div>
<div class="line"><span class="lineno">  308</span>    scores: A [k, num_classes] float32 tensor containing the scores <span class="keywordflow">for</span> each of</div>
<div class="line"><span class="lineno">  309</span>      the k detections. The scores have to be non-negative when</div>
<div class="line"><span class="lineno">  310</span>      pad_to_max_output_size <span class="keywordflow">is</span> <span class="keyword">True</span>.</div>
<div class="line"><span class="lineno">  311</span>    iou_thresh: scalar threshold <span class="keywordflow">for</span> IOU (new boxes that have high IOU overlap</div>
<div class="line"><span class="lineno">  312</span>      <span class="keyword">with</span> previously selected boxes are removed).</div>
<div class="line"><span class="lineno">  313</span>    change_coordinate_frame: Whether to normalize coordinates after clipping</div>
<div class="line"><span class="lineno">  314</span>      relative to clip_window (this can only be set to <span class="keyword">True</span> <span class="keywordflow">if</span> a clip_window <span class="keywordflow">is</span></div>
<div class="line"><span class="lineno">  315</span>      provided)</div>
<div class="line"><span class="lineno">  316</span>    clip_window: A float32 tensor of the form [y_min, x_min, y_max, x_max]</div>
<div class="line"><span class="lineno">  317</span>      representing the window to clip <span class="keywordflow">and</span> normalize boxes to before performing</div>
<div class="line"><span class="lineno">  318</span>      non-max suppression.</div>
<div class="line"><span class="lineno">  319</span> </div>
<div class="line"><span class="lineno">  320</span>  Raises:</div>
<div class="line"><span class="lineno">  321</span>    ValueError: <span class="keywordflow">if</span> iou_thresh <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> [0, 1] <span class="keywordflow">or</span> <span class="keywordflow">if</span> input boxlist does <span class="keywordflow">not</span></div>
<div class="line"><span class="lineno">  322</span>    have a valid scores field.</div>
<div class="line"><span class="lineno">  323</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  324</span><span class="stringliteral">  </span><span class="keywordflow">if</span> <span class="keywordflow">not</span> 0 &lt;= iou_thresh &lt;= 1.0:</div>
<div class="line"><span class="lineno">  325</span>    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;iou_thresh must be between 0 and 1&#39;</span>)</div>
<div class="line"><span class="lineno">  326</span>  <span class="keywordflow">if</span> scores.shape.ndims != 2:</div>
<div class="line"><span class="lineno">  327</span>    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;scores field must be of rank 2&#39;</span>)</div>
<div class="line"><span class="lineno">  328</span>  <span class="keywordflow">if</span> shape_utils.get_dim_as_int(scores.shape[1]) <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  329</span>    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;scores must have statically defined second &#39;</span> <span class="stringliteral">&#39;dimension&#39;</span>)</div>
<div class="line"><span class="lineno">  330</span>  <span class="keywordflow">if</span> boxes.shape.ndims != 3:</div>
<div class="line"><span class="lineno">  331</span>    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;boxes must be of rank 3.&#39;</span>)</div>
<div class="line"><span class="lineno">  332</span>  <span class="keywordflow">if</span> <span class="keywordflow">not</span> (shape_utils.get_dim_as_int(</div>
<div class="line"><span class="lineno">  333</span>      boxes.shape[1]) == shape_utils.get_dim_as_int(scores.shape[1]) <span class="keywordflow">or</span></div>
<div class="line"><span class="lineno">  334</span>          shape_utils.get_dim_as_int(boxes.shape[1]) == 1):</div>
<div class="line"><span class="lineno">  335</span>    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;second dimension of boxes must be either 1 or equal &#39;</span></div>
<div class="line"><span class="lineno">  336</span>                     <span class="stringliteral">&#39;to the second dimension of scores&#39;</span>)</div>
<div class="line"><span class="lineno">  337</span>  <span class="keywordflow">if</span> shape_utils.get_dim_as_int(boxes.shape[2]) != 4:</div>
<div class="line"><span class="lineno">  338</span>    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;last dimension of boxes must be of size 4.&#39;</span>)</div>
<div class="line"><span class="lineno">  339</span>  <span class="keywordflow">if</span> change_coordinate_frame <span class="keywordflow">and</span> clip_window <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  340</span>    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;if change_coordinate_frame is True, then a clip_window&#39;</span></div>
<div class="line"><span class="lineno">  341</span>                     <span class="stringliteral">&#39;must be specified.&#39;</span>)</div>
<div class="line"><span class="lineno">  342</span> </div>
<div class="line"><span class="lineno">  343</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing_a1def87e6a8b8fad1ca56f6b3985f69d1_icgraph.png" border="0" usemap="#ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a1def87e6a8b8fad1ca56f6b3985f69d1_icgraph" alt=""/></div>
<map name="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a1def87e6a8b8fad1ca56f6b3985f69d1_icgraph" id="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a1def87e6a8b8fad1ca56f6b3985f69d1_icgraph">
<area shape="rect" title=" " alt="" coords="479,45,667,100"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a0d33e143f24dc55fe43809b17882217d" title=" " alt="" coords="248,5,431,60"/>
<area shape="poly" title=" " alt="" coords="464,57,430,51,431,46,465,52"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a58b5edbb0a9b33010aae722c82050006" title=" " alt="" coords="257,84,421,139"/>
<area shape="poly" title=" " alt="" coords="465,93,422,100,421,95,464,88"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a766a437a0d89839c4e6828b54205d000" title=" " alt="" coords="5,45,200,100"/>
<area shape="poly" title=" " alt="" coords="235,53,201,59,200,54,234,48"/>
<area shape="poly" title=" " alt="" coords="243,98,200,91,201,86,244,93"/>
</map>
</div>

</div>
</div>
<a id="a612ecf46d8c84ee42d5fb8cce480d2c5" name="a612ecf46d8c84ee42d5fb8cce480d2c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a612ecf46d8c84ee42d5fb8cce480d2c5">&#9670;&#160;</a></span>batch_iou()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.post_processing.batch_iou </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>boxes1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>boxes2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Calculates the overlap between proposal and ground truth boxes.

Some `boxes2` may have been padded.  The returned `iou` tensor for these
boxes will be -1.

Args:
  boxes1: a tensor with a shape of [batch_size, N, 4]. N is the number of
    proposals before groundtruth assignment. The last dimension is the pixel
    coordinates in [ymin, xmin, ymax, xmax] form.
  boxes2: a tensor with a shape of [batch_size, MAX_NUM_INSTANCES, 4]. This
    tensor might have paddings with a negative value.

Returns:
  iou: a tensor with as a shape of [batch_size, N, MAX_NUM_INSTANCES].
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d1/d53/post__processing_8py_source.html#l00035">35</a> of file <a class="el" href="../../d1/d53/post__processing_8py_source.html">post_processing.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   35</span><span class="keyword">def </span>batch_iou(boxes1, boxes2):</div>
<div class="line"><span class="lineno">   36</span>  <span class="stringliteral">&quot;&quot;&quot;Calculates the overlap between proposal and ground truth boxes.</span></div>
<div class="line"><span class="lineno">   37</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   38</span><span class="stringliteral">  Some `boxes2` may have been padded.  The returned `iou` tensor </span><span class="keywordflow">for</span> these</div>
<div class="line"><span class="lineno">   39</span>  boxes will be -1.</div>
<div class="line"><span class="lineno">   40</span> </div>
<div class="line"><span class="lineno">   41</span>  Args:</div>
<div class="line"><span class="lineno">   42</span>    boxes1: a tensor <span class="keyword">with</span> a shape of [batch_size, N, 4]. N <span class="keywordflow">is</span> the number of</div>
<div class="line"><span class="lineno">   43</span>      proposals before groundtruth assignment. The last dimension <span class="keywordflow">is</span> the pixel</div>
<div class="line"><span class="lineno">   44</span>      coordinates <span class="keywordflow">in</span> [ymin, xmin, ymax, xmax] form.</div>
<div class="line"><span class="lineno">   45</span>    boxes2: a tensor <span class="keyword">with</span> a shape of [batch_size, MAX_NUM_INSTANCES, 4]. This</div>
<div class="line"><span class="lineno">   46</span>      tensor might have paddings <span class="keyword">with</span> a negative value.</div>
<div class="line"><span class="lineno">   47</span> </div>
<div class="line"><span class="lineno">   48</span>  Returns:</div>
<div class="line"><span class="lineno">   49</span>    iou: a tensor <span class="keyword">with</span> <span class="keyword">as</span> a shape of [batch_size, N, MAX_NUM_INSTANCES].</div>
<div class="line"><span class="lineno">   50</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   51</span><span class="stringliteral">  </span><span class="keyword">with</span> tf.name_scope(<span class="stringliteral">&#39;BatchIOU&#39;</span>):</div>
<div class="line"><span class="lineno">   52</span>    y1_min, x1_min, y1_max, x1_max = tf.split(</div>
<div class="line"><span class="lineno">   53</span>        value=boxes1, num_or_size_splits=4, axis=2)</div>
<div class="line"><span class="lineno">   54</span>    y2_min, x2_min, y2_max, x2_max = tf.split(</div>
<div class="line"><span class="lineno">   55</span>        value=boxes2, num_or_size_splits=4, axis=2)</div>
<div class="line"><span class="lineno">   56</span> </div>
<div class="line"><span class="lineno">   57</span>    <span class="comment"># Calculates the intersection area.</span></div>
<div class="line"><span class="lineno">   58</span>    intersection_xmin = tf.maximum(x1_min, tf.transpose(x2_min, [0, 2, 1]))</div>
<div class="line"><span class="lineno">   59</span>    intersection_xmax = tf.minimum(x1_max, tf.transpose(x2_max, [0, 2, 1]))</div>
<div class="line"><span class="lineno">   60</span>    intersection_ymin = tf.maximum(y1_min, tf.transpose(y2_min, [0, 2, 1]))</div>
<div class="line"><span class="lineno">   61</span>    intersection_ymax = tf.minimum(y1_max, tf.transpose(y2_max, [0, 2, 1]))</div>
<div class="line"><span class="lineno">   62</span>    intersection_area = tf.maximum(</div>
<div class="line"><span class="lineno">   63</span>        (intersection_xmax - intersection_xmin), 0) * tf.maximum(</div>
<div class="line"><span class="lineno">   64</span>            (intersection_ymax - intersection_ymin), 0)</div>
<div class="line"><span class="lineno">   65</span> </div>
<div class="line"><span class="lineno">   66</span>    <span class="comment"># Calculates the union area.</span></div>
<div class="line"><span class="lineno">   67</span>    area1 = (y1_max - y1_min) * (x1_max - x1_min)</div>
<div class="line"><span class="lineno">   68</span>    area2 = (y2_max - y2_min) * (x2_max - x2_min)</div>
<div class="line"><span class="lineno">   69</span>    <span class="comment"># Adds a small epsilon to avoid divide-by-zero.</span></div>
<div class="line"><span class="lineno">   70</span>    union_area = area1 + tf.transpose(area2,</div>
<div class="line"><span class="lineno">   71</span>                                      [0, 2, 1]) - intersection_area + 1e-8</div>
<div class="line"><span class="lineno">   72</span> </div>
<div class="line"><span class="lineno">   73</span>    <span class="comment"># Calculates IoU.</span></div>
<div class="line"><span class="lineno">   74</span>    iou = intersection_area / union_area</div>
<div class="line"><span class="lineno">   75</span> </div>
<div class="line"><span class="lineno">   76</span>    <span class="comment"># Fills -1 for padded ground truth boxes.</span></div>
<div class="line"><span class="lineno">   77</span>    padding_mask = tf.logical_and(</div>
<div class="line"><span class="lineno">   78</span>        tf.less(intersection_xmax, 0), tf.less(intersection_ymax, 0))</div>
<div class="line"><span class="lineno">   79</span>    iou = tf.where(padding_mask, -tf.ones_like(iou), iou)</div>
<div class="line"><span class="lineno">   80</span> </div>
<div class="line"><span class="lineno">   81</span>    <span class="keywordflow">return</span> iou</div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing_a612ecf46d8c84ee42d5fb8cce480d2c5_icgraph.png" border="0" usemap="#ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a612ecf46d8c84ee42d5fb8cce480d2c5_icgraph" alt=""/></div>
<map name="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a612ecf46d8c84ee42d5fb8cce480d2c5_icgraph" id="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a612ecf46d8c84ee42d5fb8cce480d2c5_icgraph">
<area shape="rect" title=" " alt="" coords="739,77,903,117"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a7a9bf16a47c1a7fa60bd230b8936bfa6" title=" " alt="" coords="479,5,691,45"/>
<area shape="poly" title=" " alt="" coords="741,76,690,60,651,48,653,43,691,55,742,70"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a36bbe3e1836346ce651409440b335386" title=" " alt="" coords="498,70,671,125"/>
<area shape="poly" title=" " alt="" coords="725,100,672,100,672,95,725,95"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#afdb21198d6a9443ec277742c9938612b" title=" " alt="" coords="481,149,689,203"/>
<area shape="poly" title=" " alt="" coords="748,124,668,151,667,146,746,119"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a0d33e143f24dc55fe43809b17882217d" title=" " alt="" coords="248,109,431,163"/>
<area shape="poly" title=" " alt="" coords="467,159,430,153,431,148,468,154"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a58b5edbb0a9b33010aae722c82050006" title=" " alt="" coords="257,187,421,242"/>
<area shape="poly" title=" " alt="" coords="467,197,422,204,421,199,467,192"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a766a437a0d89839c4e6828b54205d000" title=" " alt="" coords="5,149,200,203"/>
<area shape="poly" title=" " alt="" coords="235,156,201,162,200,157,234,151"/>
<area shape="poly" title=" " alt="" coords="243,202,200,195,201,189,244,196"/>
</map>
</div>

</div>
</div>
<a id="a766a437a0d89839c4e6828b54205d000" name="a766a437a0d89839c4e6828b54205d000"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a766a437a0d89839c4e6828b54205d000">&#9670;&#160;</a></span>batch_multiclass_non_max_suppression()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.post_processing.batch_multiclass_non_max_suppression </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>boxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>scores</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>score_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iou_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_size_per_class</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_total_size</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>clip_window</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>change_coordinate_frame</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>num_valid_boxes</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>masks</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>additional_fields</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>soft_nms_sigma</em> = <code>0.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>scope</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>use_static_shapes</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>parallel_iterations</em> = <code>32</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>use_class_agnostic_nms</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_classes_per_detection</em> = <code>1</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Multi-class version of non maximum suppression that operates on a batch.

This op is similar to `multiclass_non_max_suppression` but operates on a batch
of boxes and scores. See documentation for `multiclass_non_max_suppression`
for details.

Args:
  boxes: A [batch_size, num_anchors, q, 4] float32 tensor containing
    detections. If `q` is 1 then same boxes are used for all classes
    otherwise, if `q` is equal to number of classes, class-specific boxes are
    used.
  scores: A [batch_size, num_anchors, num_classes] float32 tensor containing
    the scores for each of the `num_anchors` detections. The scores have to be
    non-negative when use_static_shapes is set True.
  score_thresh: scalar threshold for score (low scoring boxes are removed).
  iou_thresh: scalar threshold for IOU (new boxes that have high IOU overlap
    with previously selected boxes are removed).
  max_size_per_class: maximum number of retained boxes per class.
  max_total_size: maximum number of boxes retained over all classes. By
    default returns all boxes retained after capping boxes per class.
  clip_window: A float32 tensor of shape [batch_size, 4]  where each entry is
    of the form [y_min, x_min, y_max, x_max] representing the window to clip
    boxes to before performing non-max suppression. This argument can also be
    a tensor of shape [4] in which case, the same clip window is applied to
    all images in the batch. If clip_widow is None, all boxes are used to
    perform non-max suppression.
  change_coordinate_frame: Whether to normalize coordinates after clipping
    relative to clip_window (this can only be set to True if a clip_window is
    provided)
  num_valid_boxes: (optional) a Tensor of type `int32`. A 1-D tensor of shape
    [batch_size] representing the number of valid boxes to be considered for
    each image in the batch.  This parameter allows for ignoring zero
    paddings.
  masks: (optional) a [batch_size, num_anchors, q, mask_height, mask_width]
    float32 tensor containing box masks. `q` can be either number of classes
    or 1 depending on whether a separate mask is predicted per class.
  additional_fields: (optional) If not None, a dictionary that maps keys to
    tensors whose dimensions are [batch_size, num_anchors, ...].
  soft_nms_sigma: A scalar float representing the Soft NMS sigma parameter;
    See Bodla et al, https://arxiv.org/abs/1704.04503).  When
    `soft_nms_sigma=0.0` (which is default), we fall back to standard (hard)
    NMS.  Soft NMS is currently only supported when pad_to_max_output_size is
    False.
  scope: tf scope name.
  use_static_shapes: If true, the output nmsed boxes are padded to be of
    length `max_size_per_class` and it doesn't clip boxes to max_total_size.
    Defaults to false.
  parallel_iterations: (optional) number of batch items to process in
    parallel.
  use_class_agnostic_nms: If true, this uses class-agnostic non max
    suppression
  max_classes_per_detection: Maximum number of retained classes per detection
    box in class-agnostic NMS.

Returns:
  'nmsed_boxes': A [batch_size, max_detections, 4] float32 tensor
    containing the non-max suppressed boxes.
  'nmsed_scores': A [batch_size, max_detections] float32 tensor containing
    the scores for the boxes.
  'nmsed_classes': A [batch_size, max_detections] float32 tensor
    containing the class for boxes.
  'nmsed_masks': (optional) a
    [batch_size, max_detections, mask_height, mask_width] float32 tensor
    containing masks for each selected box. This is set to None if input
    `masks` is None.
  'nmsed_additional_fields': (optional) a dictionary of
    [batch_size, max_detections, ...] float32 tensors corresponding to the
    tensors specified in the input `additional_fields`. This is not returned
    if input `additional_fields` is None.
  'num_detections': A [batch_size] int32 tensor indicating the number of
    valid detections per batch item. Only the top num_detections[i] entries in
    nms_boxes[i], nms_scores[i] and nms_class[i] are valid. The rest of the
    entries are zero paddings.

Raises:
  ValueError: if `q` in boxes.shape is not 1 or not equal to number of
    classes as inferred from scores.shape.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d1/d53/post__processing_8py_source.html#l00807">807</a> of file <a class="el" href="../../d1/d53/post__processing_8py_source.html">post_processing.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  823</span>                                         max_classes_per_detection=1):</div>
<div class="line"><span class="lineno">  824</span>  <span class="stringliteral">&quot;&quot;&quot;Multi-class version of non maximum suppression that operates on a batch.</span></div>
<div class="line"><span class="lineno">  825</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  826</span><span class="stringliteral">  This op </span><span class="keywordflow">is</span> similar to `multiclass_non_max_suppression` but operates on a batch</div>
<div class="line"><span class="lineno">  827</span>  of boxes <span class="keywordflow">and</span> scores. See documentation <span class="keywordflow">for</span> `multiclass_non_max_suppression`</div>
<div class="line"><span class="lineno">  828</span>  <span class="keywordflow">for</span> details.</div>
<div class="line"><span class="lineno">  829</span> </div>
<div class="line"><span class="lineno">  830</span>  Args:</div>
<div class="line"><span class="lineno">  831</span>    boxes: A [batch_size, num_anchors, q, 4] float32 tensor containing</div>
<div class="line"><span class="lineno">  832</span>      detections. If `q` <span class="keywordflow">is</span> 1 then same boxes are used <span class="keywordflow">for</span> all classes</div>
<div class="line"><span class="lineno">  833</span>      otherwise, <span class="keywordflow">if</span> `q` <span class="keywordflow">is</span> equal to number of classes, <span class="keyword">class</span>-specific boxes are</div>
<div class="line"><span class="lineno">  834</span>      used.</div>
<div class="line"><span class="lineno">  835</span>    scores: A [batch_size, num_anchors, num_classes] float32 tensor containing</div>
<div class="line"><span class="lineno">  836</span>      the scores <span class="keywordflow">for</span> each of the `num_anchors` detections. The scores have to be</div>
<div class="line"><span class="lineno">  837</span>      non-negative when use_static_shapes <span class="keywordflow">is</span> set <span class="keyword">True</span>.</div>
<div class="line"><span class="lineno">  838</span>    score_thresh: scalar threshold <span class="keywordflow">for</span> score (low scoring boxes are removed).</div>
<div class="line"><span class="lineno">  839</span>    iou_thresh: scalar threshold <span class="keywordflow">for</span> IOU (new boxes that have high IOU overlap</div>
<div class="line"><span class="lineno">  840</span>      <span class="keyword">with</span> previously selected boxes are removed).</div>
<div class="line"><span class="lineno">  841</span>    max_size_per_class: maximum number of retained boxes per <span class="keyword">class</span>.</div>
<div class="line"><span class="lineno">  842</span>    max_total_size: maximum number of boxes retained over all classes. By</div>
<div class="line"><span class="lineno">  843</span>      default returns all boxes retained after capping boxes per <span class="keyword">class</span>.</div>
<div class="line"><span class="lineno">  844</span>    clip_window: A float32 tensor of shape [batch_size, 4]  where each entry <span class="keywordflow">is</span></div>
<div class="line"><span class="lineno">  845</span>      of the form [y_min, x_min, y_max, x_max] representing the window to clip</div>
<div class="line"><span class="lineno">  846</span>      boxes to before performing non-max suppression. This argument can also be</div>
<div class="line"><span class="lineno">  847</span>      a tensor of shape [4] <span class="keywordflow">in</span> which case, the same clip window <span class="keywordflow">is</span> applied to</div>
<div class="line"><span class="lineno">  848</span>      all images <span class="keywordflow">in</span> the batch. If clip_widow <span class="keywordflow">is</span> <span class="keywordtype">None</span>, all boxes are used to</div>
<div class="line"><span class="lineno">  849</span>      perform non-max suppression.</div>
<div class="line"><span class="lineno">  850</span>    change_coordinate_frame: Whether to normalize coordinates after clipping</div>
<div class="line"><span class="lineno">  851</span>      relative to clip_window (this can only be set to <span class="keyword">True</span> <span class="keywordflow">if</span> a clip_window <span class="keywordflow">is</span></div>
<div class="line"><span class="lineno">  852</span>      provided)</div>
<div class="line"><span class="lineno">  853</span>    num_valid_boxes: (optional) a Tensor of type `int32`. A 1-D tensor of shape</div>
<div class="line"><span class="lineno">  854</span>      [batch_size] representing the number of valid boxes to be considered <span class="keywordflow">for</span></div>
<div class="line"><span class="lineno">  855</span>      each image <span class="keywordflow">in</span> the batch.  This parameter allows <span class="keywordflow">for</span> ignoring zero</div>
<div class="line"><span class="lineno">  856</span>      paddings.</div>
<div class="line"><span class="lineno">  857</span>    masks: (optional) a [batch_size, num_anchors, q, mask_height, mask_width]</div>
<div class="line"><span class="lineno">  858</span>      float32 tensor containing box masks. `q` can be either number of classes</div>
<div class="line"><span class="lineno">  859</span>      <span class="keywordflow">or</span> 1 depending on whether a separate mask <span class="keywordflow">is</span> predicted per <span class="keyword">class</span>.</div>
<div class="line"><span class="lineno">  860</span>    additional_fields: (optional) If <span class="keywordflow">not</span> <span class="keywordtype">None</span>, a dictionary that maps keys to</div>
<div class="line"><span class="lineno">  861</span>      tensors whose dimensions are [batch_size, num_anchors, ...].</div>
<div class="line"><span class="lineno">  862</span>    soft_nms_sigma: A scalar float representing the Soft NMS sigma parameter;</div>
<div class="line"><span class="lineno">  863</span>      See Bodla et al, https://arxiv.org/abs/1704.04503).  When</div>
<div class="line"><span class="lineno">  864</span>      `soft_nms_sigma=0.0` (which <span class="keywordflow">is</span> default), we fall back to standard (hard)</div>
<div class="line"><span class="lineno">  865</span>      NMS.  Soft NMS <span class="keywordflow">is</span> currently only supported when pad_to_max_output_size <span class="keywordflow">is</span></div>
<div class="line"><span class="lineno">  866</span>      <span class="keyword">False</span>.</div>
<div class="line"><span class="lineno">  867</span>    scope: tf scope name.</div>
<div class="line"><span class="lineno">  868</span>    use_static_shapes: If true, the output nmsed boxes are padded to be of</div>
<div class="line"><span class="lineno">  869</span>      length `max_size_per_class` <span class="keywordflow">and</span> it doesn<span class="stringliteral">&#39;t clip boxes to max_total_size.</span></div>
<div class="line"><span class="lineno">  870</span><span class="stringliteral">      Defaults to false.</span></div>
<div class="line"><span class="lineno">  871</span><span class="stringliteral">    parallel_iterations: (optional) number of batch items to process </span><span class="keywordflow">in</span></div>
<div class="line"><span class="lineno">  872</span>      parallel.</div>
<div class="line"><span class="lineno">  873</span>    use_class_agnostic_nms: If true, this uses <span class="keyword">class</span>-agnostic non max</div>
<div class="line"><span class="lineno">  874</span>      suppression</div>
<div class="line"><span class="lineno">  875</span>    max_classes_per_detection: Maximum number of retained classes per detection</div>
<div class="line"><span class="lineno">  876</span>      box <span class="keywordflow">in</span> <span class="keyword">class</span>-agnostic NMS.</div>
<div class="line"><span class="lineno">  877</span> </div>
<div class="line"><span class="lineno">  878</span>  Returns:</div>
<div class="line"><span class="lineno">  879</span>    <span class="stringliteral">&#39;nmsed_boxes&#39;</span>: A [batch_size, max_detections, 4] float32 tensor</div>
<div class="line"><span class="lineno">  880</span>      containing the non-max suppressed boxes.</div>
<div class="line"><span class="lineno">  881</span>    <span class="stringliteral">&#39;nmsed_scores&#39;</span>: A [batch_size, max_detections] float32 tensor containing</div>
<div class="line"><span class="lineno">  882</span>      the scores <span class="keywordflow">for</span> the boxes.</div>
<div class="line"><span class="lineno">  883</span>    <span class="stringliteral">&#39;nmsed_classes&#39;</span>: A [batch_size, max_detections] float32 tensor</div>
<div class="line"><span class="lineno">  884</span>      containing the <span class="keyword">class </span>for boxes.</div>
<div class="line"><span class="lineno">  885</span>    <span class="stringliteral">&#39;nmsed_masks&#39;</span>: (optional) a</div>
<div class="line"><span class="lineno">  886</span>      [batch_size, max_detections, mask_height, mask_width] float32 tensor</div>
<div class="line"><span class="lineno">  887</span>      containing masks <span class="keywordflow">for</span> each selected box. This <span class="keywordflow">is</span> set to <span class="keywordtype">None</span> <span class="keywordflow">if</span> input</div>
<div class="line"><span class="lineno">  888</span>      `masks` <span class="keywordflow">is</span> <span class="keywordtype">None</span>.</div>
<div class="line"><span class="lineno">  889</span>    <span class="stringliteral">&#39;nmsed_additional_fields&#39;</span>: (optional) a dictionary of</div>
<div class="line"><span class="lineno">  890</span>      [batch_size, max_detections, ...] float32 tensors corresponding to the</div>
<div class="line"><span class="lineno">  891</span>      tensors specified <span class="keywordflow">in</span> the input `additional_fields`. This <span class="keywordflow">is</span> <span class="keywordflow">not</span> returned</div>
<div class="line"><span class="lineno">  892</span>      <span class="keywordflow">if</span> input `additional_fields` <span class="keywordflow">is</span> <span class="keywordtype">None</span>.</div>
<div class="line"><span class="lineno">  893</span>    <span class="stringliteral">&#39;num_detections&#39;</span>: A [batch_size] int32 tensor indicating the number of</div>
<div class="line"><span class="lineno">  894</span>      valid detections per batch item. Only the top num_detections[i] entries <span class="keywordflow">in</span></div>
<div class="line"><span class="lineno">  895</span>      nms_boxes[i], nms_scores[i] <span class="keywordflow">and</span> nms_class[i] are valid. The rest of the</div>
<div class="line"><span class="lineno">  896</span>      entries are zero paddings.</div>
<div class="line"><span class="lineno">  897</span> </div>
<div class="line"><span class="lineno">  898</span>  Raises:</div>
<div class="line"><span class="lineno">  899</span>    ValueError: <span class="keywordflow">if</span> `q` <span class="keywordflow">in</span> boxes.shape <span class="keywordflow">is</span> <span class="keywordflow">not</span> 1 <span class="keywordflow">or</span> <span class="keywordflow">not</span> equal to number of</div>
<div class="line"><span class="lineno">  900</span>      classes <span class="keyword">as</span> inferred <span class="keyword">from</span> scores.shape.</div>
<div class="line"><span class="lineno">  901</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  902</span><span class="stringliteral">  q = shape_utils.get_dim_as_int(boxes.shape[2])</span></div>
<div class="line"><span class="lineno">  903</span><span class="stringliteral">  num_classes = shape_utils.get_dim_as_int(scores.shape[2])</span></div>
<div class="line"><span class="lineno">  904</span><span class="stringliteral">  </span><span class="keywordflow">if</span> q != 1 <span class="keywordflow">and</span> q != num_classes:</div>
<div class="line"><span class="lineno">  905</span>    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;third dimension of boxes must be either 1 or equal &#39;</span></div>
<div class="line"><span class="lineno">  906</span>                     <span class="stringliteral">&#39;to the third dimension of scores&#39;</span>)</div>
<div class="line"><span class="lineno">  907</span>  <span class="keywordflow">if</span> change_coordinate_frame <span class="keywordflow">and</span> clip_window <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  908</span>    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;if change_coordinate_frame is True, then a clip_window&#39;</span></div>
<div class="line"><span class="lineno">  909</span>                     <span class="stringliteral">&#39;must be specified.&#39;</span>)</div>
<div class="line"><span class="lineno">  910</span>  original_masks = masks</div>
<div class="line"><span class="lineno">  911</span> </div>
<div class="line"><span class="lineno">  912</span>  <span class="comment"># Create ordered dictionary using the sorted keys from</span></div>
<div class="line"><span class="lineno">  913</span>  <span class="comment"># additional fields to ensure getting the same key value assignment</span></div>
<div class="line"><span class="lineno">  914</span>  <span class="comment"># in _single_image_nms_fn(). The dictionary is thus a sorted version of</span></div>
<div class="line"><span class="lineno">  915</span>  <span class="comment"># additional_fields.</span></div>
<div class="line"><span class="lineno">  916</span>  <span class="keywordflow">if</span> additional_fields <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  917</span>    ordered_additional_fields = {}</div>
<div class="line"><span class="lineno">  918</span>  <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  919</span>    ordered_additional_fields = collections.OrderedDict(</div>
<div class="line"><span class="lineno">  920</span>        sorted(additional_fields.items(), key=<span class="keyword">lambda</span> item: item[0]))</div>
<div class="line"><span class="lineno">  921</span>  del additional_fields</div>
<div class="line"><span class="lineno">  922</span>  <span class="keyword">with</span> tf.name_scope(scope, <span class="stringliteral">&#39;BatchMultiClassNonMaxSuppression&#39;</span>):</div>
<div class="line"><span class="lineno">  923</span>    boxes_shape = boxes.shape</div>
<div class="line"><span class="lineno">  924</span>    batch_size = shape_utils.get_dim_as_int(boxes_shape[0])</div>
<div class="line"><span class="lineno">  925</span>    num_anchors = shape_utils.get_dim_as_int(boxes_shape[1])</div>
<div class="line"><span class="lineno">  926</span> </div>
<div class="line"><span class="lineno">  927</span>    <span class="keywordflow">if</span> batch_size <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  928</span>      batch_size = tf.shape(boxes)[0]</div>
<div class="line"><span class="lineno">  929</span>    <span class="keywordflow">if</span> num_anchors <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  930</span>      num_anchors = tf.shape(boxes)[1]</div>
<div class="line"><span class="lineno">  931</span> </div>
<div class="line"><span class="lineno">  932</span>    <span class="comment"># If num valid boxes aren&#39;t provided, create one and mark all boxes as</span></div>
<div class="line"><span class="lineno">  933</span>    <span class="comment"># valid.</span></div>
<div class="line"><span class="lineno">  934</span>    <span class="keywordflow">if</span> num_valid_boxes <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  935</span>      num_valid_boxes = tf.ones([batch_size], dtype=tf.int32) * num_anchors</div>
<div class="line"><span class="lineno">  936</span> </div>
<div class="line"><span class="lineno">  937</span>    <span class="comment"># If masks aren&#39;t provided, create dummy masks so we can only have one copy</span></div>
<div class="line"><span class="lineno">  938</span>    <span class="comment"># of _single_image_nms_fn and discard the dummy masks after map_fn.</span></div>
<div class="line"><span class="lineno">  939</span>    <span class="keywordflow">if</span> masks <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  940</span>      masks_shape = tf.stack([batch_size, num_anchors, q, 1, 1])</div>
<div class="line"><span class="lineno">  941</span>      masks = tf.zeros(masks_shape)</div>
<div class="line"><span class="lineno">  942</span> </div>
<div class="line"><span class="lineno">  943</span>    <span class="keywordflow">if</span> clip_window <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  944</span>      clip_window = tf.stack([</div>
<div class="line"><span class="lineno">  945</span>          tf.reduce_min(boxes[:, :, :, 0]),</div>
<div class="line"><span class="lineno">  946</span>          tf.reduce_min(boxes[:, :, :, 1]),</div>
<div class="line"><span class="lineno">  947</span>          tf.reduce_max(boxes[:, :, :, 2]),</div>
<div class="line"><span class="lineno">  948</span>          tf.reduce_max(boxes[:, :, :, 3])</div>
<div class="line"><span class="lineno">  949</span>      ])</div>
<div class="line"><span class="lineno">  950</span>    <span class="keywordflow">if</span> clip_window.shape.ndims == 1:</div>
<div class="line"><span class="lineno">  951</span>      clip_window = tf.tile(tf.expand_dims(clip_window, 0), [batch_size, 1])</div>
<div class="line"><span class="lineno">  952</span> </div>
<div class="line"><span class="lineno">  953</span>    <span class="keyword">def </span>_single_image_nms_fn(args):</div>
<div class="line"><span class="lineno">  954</span>      <span class="stringliteral">&quot;&quot;&quot;Runs NMS on a single image and returns padded output.</span></div>
<div class="line"><span class="lineno">  955</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  956</span><span class="stringliteral">      Args:</span></div>
<div class="line"><span class="lineno">  957</span><span class="stringliteral">        args: A list of tensors consisting of the following:</span></div>
<div class="line"><span class="lineno">  958</span><span class="stringliteral">          per_image_boxes - A [num_anchors, q, 4] float32 tensor containing</span></div>
<div class="line"><span class="lineno">  959</span><span class="stringliteral">            detections. If `q` </span><span class="keywordflow">is</span> 1 then same boxes are used <span class="keywordflow">for</span> all classes</div>
<div class="line"><span class="lineno">  960</span>            otherwise, <span class="keywordflow">if</span> `q` <span class="keywordflow">is</span> equal to number of classes, <span class="keyword">class</span>-specific</div>
<div class="line"><span class="lineno">  961</span>            boxes are used.</div>
<div class="line"><span class="lineno">  962</span>          per_image_scores - A [num_anchors, num_classes] float32 tensor</div>
<div class="line"><span class="lineno">  963</span>            containing the scores <span class="keywordflow">for</span> each of the `num_anchors` detections.</div>
<div class="line"><span class="lineno">  964</span>          per_image_masks - A [num_anchors, q, mask_height, mask_width] float32</div>
<div class="line"><span class="lineno">  965</span>            tensor containing box masks. `q` can be either number of classes</div>
<div class="line"><span class="lineno">  966</span>            <span class="keywordflow">or</span> 1 depending on whether a separate mask <span class="keywordflow">is</span> predicted per <span class="keyword">class</span>.</div>
<div class="line"><span class="lineno">  967</span>          per_image_clip_window - A 1D float32 tensor of the form</div>
<div class="line"><span class="lineno">  968</span>            [ymin, xmin, ymax, xmax] representing the window to clip the boxes</div>
<div class="line"><span class="lineno">  969</span>            to.</div>
<div class="line"><span class="lineno">  970</span>          per_image_additional_fields - (optional) A variable number of float32</div>
<div class="line"><span class="lineno">  971</span>            tensors each <span class="keyword">with</span> size [num_anchors, ...].</div>
<div class="line"><span class="lineno">  972</span>          per_image_num_valid_boxes - A tensor of type `int32`. A 1-D tensor of</div>
<div class="line"><span class="lineno">  973</span>            shape [batch_size] representing the number of valid boxes to be</div>
<div class="line"><span class="lineno">  974</span>            considered <span class="keywordflow">for</span> each image <span class="keywordflow">in</span> the batch.  This parameter allows <span class="keywordflow">for</span></div>
<div class="line"><span class="lineno">  975</span>            ignoring zero paddings.</div>
<div class="line"><span class="lineno">  976</span> </div>
<div class="line"><span class="lineno">  977</span>      Returns:</div>
<div class="line"><span class="lineno">  978</span>        <span class="stringliteral">&#39;nmsed_boxes&#39;</span>: A [max_detections, 4] float32 tensor containing the</div>
<div class="line"><span class="lineno">  979</span>          non-max suppressed boxes.</div>
<div class="line"><span class="lineno">  980</span>        <span class="stringliteral">&#39;nmsed_scores&#39;</span>: A [max_detections] float32 tensor containing the scores</div>
<div class="line"><span class="lineno">  981</span>          <span class="keywordflow">for</span> the boxes.</div>
<div class="line"><span class="lineno">  982</span>        <span class="stringliteral">&#39;nmsed_classes&#39;</span>: A [max_detections] float32 tensor containing the <span class="keyword">class</span></div>
<div class="line"><span class="lineno">  983</span>          <span class="keywordflow">for</span> boxes.</div>
<div class="line"><span class="lineno">  984</span>        <span class="stringliteral">&#39;nmsed_masks&#39;</span>: (optional) a [max_detections, mask_height, mask_width]</div>
<div class="line"><span class="lineno">  985</span>          float32 tensor containing masks <span class="keywordflow">for</span> each selected box. This <span class="keywordflow">is</span> set to</div>
<div class="line"><span class="lineno">  986</span>          <span class="keywordtype">None</span> <span class="keywordflow">if</span> input `masks` <span class="keywordflow">is</span> <span class="keywordtype">None</span>.</div>
<div class="line"><span class="lineno">  987</span>        <span class="stringliteral">&#39;nmsed_additional_fields&#39;</span>:  (optional) A variable number of float32</div>
<div class="line"><span class="lineno">  988</span>          tensors each <span class="keyword">with</span> size [max_detections, ...] corresponding to the</div>
<div class="line"><span class="lineno">  989</span>          input `per_image_additional_fields`.</div>
<div class="line"><span class="lineno">  990</span>        <span class="stringliteral">&#39;num_detections&#39;</span>: A [batch_size] int32 tensor indicating the number of</div>
<div class="line"><span class="lineno">  991</span>          valid detections per batch item. Only the top num_detections[i]</div>
<div class="line"><span class="lineno">  992</span>          entries <span class="keywordflow">in</span> nms_boxes[i], nms_scores[i] <span class="keywordflow">and</span> nms_class[i] are valid. The</div>
<div class="line"><span class="lineno">  993</span>          rest of the entries are zero paddings.</div>
<div class="line"><span class="lineno">  994</span>      <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  995</span><span class="stringliteral">      per_image_boxes = args[0]</span></div>
<div class="line"><span class="lineno">  996</span><span class="stringliteral">      per_image_scores = args[1]</span></div>
<div class="line"><span class="lineno">  997</span><span class="stringliteral">      per_image_masks = args[2]</span></div>
<div class="line"><span class="lineno">  998</span><span class="stringliteral">      per_image_clip_window = args[3]</span></div>
<div class="line"><span class="lineno">  999</span><span class="stringliteral">      </span><span class="comment"># Make sure that the order of elements passed in args is aligned with</span></div>
<div class="line"><span class="lineno"> 1000</span>      <span class="comment"># the iteration order of ordered_additional_fields</span></div>
<div class="line"><span class="lineno"> 1001</span>      per_image_additional_fields = {</div>
<div class="line"><span class="lineno"> 1002</span>          key: value</div>
<div class="line"><span class="lineno"> 1003</span>          <span class="keywordflow">for</span> key, value <span class="keywordflow">in</span> zip(ordered_additional_fields, args[4:-1])</div>
<div class="line"><span class="lineno"> 1004</span>      }</div>
<div class="line"><span class="lineno"> 1005</span>      per_image_num_valid_boxes = args[-1]</div>
<div class="line"><span class="lineno"> 1006</span>      <span class="keywordflow">if</span> use_static_shapes:</div>
<div class="line"><span class="lineno"> 1007</span>        total_proposals = tf.shape(per_image_scores)</div>
<div class="line"><span class="lineno"> 1008</span>        per_image_scores = tf.where(</div>
<div class="line"><span class="lineno"> 1009</span>            tf.less(tf.range(total_proposals[0]), per_image_num_valid_boxes),</div>
<div class="line"><span class="lineno"> 1010</span>            per_image_scores,</div>
<div class="line"><span class="lineno"> 1011</span>            tf.fill(total_proposals, np.finfo(<span class="stringliteral">&#39;float32&#39;</span>).min))</div>
<div class="line"><span class="lineno"> 1012</span>      <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 1013</span>        per_image_boxes = tf.reshape(</div>
<div class="line"><span class="lineno"> 1014</span>            tf.slice(per_image_boxes, 3 * [0],</div>
<div class="line"><span class="lineno"> 1015</span>                     tf.stack([per_image_num_valid_boxes, -1, -1])), [-1, q, 4])</div>
<div class="line"><span class="lineno"> 1016</span>        per_image_scores = tf.reshape(</div>
<div class="line"><span class="lineno"> 1017</span>            tf.slice(per_image_scores, [0, 0],</div>
<div class="line"><span class="lineno"> 1018</span>                     tf.stack([per_image_num_valid_boxes, -1])),</div>
<div class="line"><span class="lineno"> 1019</span>            [-1, num_classes])</div>
<div class="line"><span class="lineno"> 1020</span>        per_image_masks = tf.reshape(</div>
<div class="line"><span class="lineno"> 1021</span>            tf.slice(per_image_masks, 4 * [0],</div>
<div class="line"><span class="lineno"> 1022</span>                     tf.stack([per_image_num_valid_boxes, -1, -1, -1])),</div>
<div class="line"><span class="lineno"> 1023</span>            [-1, q, shape_utils.get_dim_as_int(per_image_masks.shape[2]),</div>
<div class="line"><span class="lineno"> 1024</span>             shape_utils.get_dim_as_int(per_image_masks.shape[3])])</div>
<div class="line"><span class="lineno"> 1025</span>        <span class="keywordflow">if</span> per_image_additional_fields <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno"> 1026</span>          <span class="keywordflow">for</span> key, tensor <span class="keywordflow">in</span> per_image_additional_fields.items():</div>
<div class="line"><span class="lineno"> 1027</span>            additional_field_shape = tensor.get_shape()</div>
<div class="line"><span class="lineno"> 1028</span>            additional_field_dim = len(additional_field_shape)</div>
<div class="line"><span class="lineno"> 1029</span>            per_image_additional_fields[key] = tf.reshape(</div>
<div class="line"><span class="lineno"> 1030</span>                tf.slice(</div>
<div class="line"><span class="lineno"> 1031</span>                    per_image_additional_fields[key],</div>
<div class="line"><span class="lineno"> 1032</span>                    additional_field_dim * [0],</div>
<div class="line"><span class="lineno"> 1033</span>                    tf.stack([per_image_num_valid_boxes] +</div>
<div class="line"><span class="lineno"> 1034</span>                             (additional_field_dim - 1) * [-1])), [-1] + [</div>
<div class="line"><span class="lineno"> 1035</span>                                 shape_utils.get_dim_as_int(dim)</div>
<div class="line"><span class="lineno"> 1036</span>                                 <span class="keywordflow">for</span> dim <span class="keywordflow">in</span> additional_field_shape[1:]</div>
<div class="line"><span class="lineno"> 1037</span>                             ])</div>
<div class="line"><span class="lineno"> 1038</span>      <span class="keywordflow">if</span> use_class_agnostic_nms:</div>
<div class="line"><span class="lineno"> 1039</span>        nmsed_boxlist, num_valid_nms_boxes = class_agnostic_non_max_suppression(</div>
<div class="line"><span class="lineno"> 1040</span>            per_image_boxes,</div>
<div class="line"><span class="lineno"> 1041</span>            per_image_scores,</div>
<div class="line"><span class="lineno"> 1042</span>            score_thresh,</div>
<div class="line"><span class="lineno"> 1043</span>            iou_thresh,</div>
<div class="line"><span class="lineno"> 1044</span>            max_classes_per_detection,</div>
<div class="line"><span class="lineno"> 1045</span>            max_total_size,</div>
<div class="line"><span class="lineno"> 1046</span>            clip_window=per_image_clip_window,</div>
<div class="line"><span class="lineno"> 1047</span>            change_coordinate_frame=change_coordinate_frame,</div>
<div class="line"><span class="lineno"> 1048</span>            masks=per_image_masks,</div>
<div class="line"><span class="lineno"> 1049</span>            pad_to_max_output_size=use_static_shapes,</div>
<div class="line"><span class="lineno"> 1050</span>            additional_fields=per_image_additional_fields,</div>
<div class="line"><span class="lineno"> 1051</span>            soft_nms_sigma=soft_nms_sigma)</div>
<div class="line"><span class="lineno"> 1052</span>      <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno"> 1053</span>        nmsed_boxlist, num_valid_nms_boxes = multiclass_non_max_suppression(</div>
<div class="line"><span class="lineno"> 1054</span>            per_image_boxes,</div>
<div class="line"><span class="lineno"> 1055</span>            per_image_scores,</div>
<div class="line"><span class="lineno"> 1056</span>            score_thresh,</div>
<div class="line"><span class="lineno"> 1057</span>            iou_thresh,</div>
<div class="line"><span class="lineno"> 1058</span>            max_size_per_class,</div>
<div class="line"><span class="lineno"> 1059</span>            max_total_size,</div>
<div class="line"><span class="lineno"> 1060</span>            clip_window=per_image_clip_window,</div>
<div class="line"><span class="lineno"> 1061</span>            change_coordinate_frame=change_coordinate_frame,</div>
<div class="line"><span class="lineno"> 1062</span>            masks=per_image_masks,</div>
<div class="line"><span class="lineno"> 1063</span>            pad_to_max_output_size=use_static_shapes,</div>
<div class="line"><span class="lineno"> 1064</span>            additional_fields=per_image_additional_fields,</div>
<div class="line"><span class="lineno"> 1065</span>            soft_nms_sigma=soft_nms_sigma)</div>
<div class="line"><span class="lineno"> 1066</span> </div>
<div class="line"><span class="lineno"> 1067</span>      <span class="keywordflow">if</span> <span class="keywordflow">not</span> use_static_shapes:</div>
<div class="line"><span class="lineno"> 1068</span>        nmsed_boxlist = box_list_ops.pad_or_clip_box_list(</div>
<div class="line"><span class="lineno"> 1069</span>            nmsed_boxlist, max_total_size)</div>
<div class="line"><span class="lineno"> 1070</span>      num_detections = num_valid_nms_boxes</div>
<div class="line"><span class="lineno"> 1071</span>      nmsed_boxes = nmsed_boxlist.get()</div>
<div class="line"><span class="lineno"> 1072</span>      nmsed_scores = nmsed_boxlist.get_field(fields.BoxListFields.scores)</div>
<div class="line"><span class="lineno"> 1073</span>      nmsed_classes = nmsed_boxlist.get_field(fields.BoxListFields.classes)</div>
<div class="line"><span class="lineno"> 1074</span>      nmsed_masks = nmsed_boxlist.get_field(fields.BoxListFields.masks)</div>
<div class="line"><span class="lineno"> 1075</span>      nmsed_additional_fields = []</div>
<div class="line"><span class="lineno"> 1076</span>      <span class="comment"># Sorting is needed here to ensure that the values stored in</span></div>
<div class="line"><span class="lineno"> 1077</span>      <span class="comment"># nmsed_additional_fields are always kept in the same order</span></div>
<div class="line"><span class="lineno"> 1078</span>      <span class="comment"># across different execution runs.</span></div>
<div class="line"><span class="lineno"> 1079</span>      <span class="keywordflow">for</span> key <span class="keywordflow">in</span> sorted(per_image_additional_fields.keys()):</div>
<div class="line"><span class="lineno"> 1080</span>        nmsed_additional_fields.append(nmsed_boxlist.get_field(key))</div>
<div class="line"><span class="lineno"> 1081</span>      <span class="keywordflow">return</span> ([nmsed_boxes, nmsed_scores, nmsed_classes, nmsed_masks] +</div>
<div class="line"><span class="lineno"> 1082</span>              nmsed_additional_fields + [num_detections])</div>
<div class="line"><span class="lineno"> 1083</span> </div>
<div class="line"><span class="lineno"> 1084</span>    num_additional_fields = 0</div>
<div class="line"><span class="lineno"> 1085</span>    <span class="keywordflow">if</span> ordered_additional_fields:</div>
<div class="line"><span class="lineno"> 1086</span>      num_additional_fields = len(ordered_additional_fields)</div>
<div class="line"><span class="lineno"> 1087</span>    num_nmsed_outputs = 4 + num_additional_fields</div>
<div class="line"><span class="lineno"> 1088</span> </div>
<div class="line"><span class="lineno"> 1089</span>    batch_outputs = shape_utils.static_or_dynamic_map_fn(</div>
<div class="line"><span class="lineno"> 1090</span>        _single_image_nms_fn,</div>
<div class="line"><span class="lineno"> 1091</span>        elems=([boxes, scores, masks, clip_window] +</div>
<div class="line"><span class="lineno"> 1092</span>               list(ordered_additional_fields.values()) + [num_valid_boxes]),</div>
<div class="line"><span class="lineno"> 1093</span>        dtype=(num_nmsed_outputs * [tf.float32] + [tf.int32]),</div>
<div class="line"><span class="lineno"> 1094</span>        parallel_iterations=parallel_iterations)</div>
<div class="line"><span class="lineno"> 1095</span> </div>
<div class="line"><span class="lineno"> 1096</span>    batch_nmsed_boxes = batch_outputs[0]</div>
<div class="line"><span class="lineno"> 1097</span>    batch_nmsed_scores = batch_outputs[1]</div>
<div class="line"><span class="lineno"> 1098</span>    batch_nmsed_classes = batch_outputs[2]</div>
<div class="line"><span class="lineno"> 1099</span>    batch_nmsed_masks = batch_outputs[3]</div>
<div class="line"><span class="lineno"> 1100</span>    batch_nmsed_values = batch_outputs[4:-1]</div>
<div class="line"><span class="lineno"> 1101</span> </div>
<div class="line"><span class="lineno"> 1102</span>    batch_nmsed_additional_fields = {}</div>
<div class="line"><span class="lineno"> 1103</span>    <span class="keywordflow">if</span> num_additional_fields &gt; 0:</div>
<div class="line"><span class="lineno"> 1104</span>      <span class="comment"># Sort the keys to ensure arranging elements in same order as</span></div>
<div class="line"><span class="lineno"> 1105</span>      <span class="comment"># in _single_image_nms_fn.</span></div>
<div class="line"><span class="lineno"> 1106</span>      batch_nmsed_keys = list(ordered_additional_fields.keys())</div>
<div class="line"><span class="lineno"> 1107</span>      <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(batch_nmsed_keys)):</div>
<div class="line"><span class="lineno"> 1108</span>        batch_nmsed_additional_fields[</div>
<div class="line"><span class="lineno"> 1109</span>            batch_nmsed_keys[i]] = batch_nmsed_values[i]</div>
<div class="line"><span class="lineno"> 1110</span> </div>
<div class="line"><span class="lineno"> 1111</span>    batch_num_detections = batch_outputs[-1]</div>
<div class="line"><span class="lineno"> 1112</span> </div>
<div class="line"><span class="lineno"> 1113</span>    <span class="keywordflow">if</span> original_masks <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno"> 1114</span>      batch_nmsed_masks = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno"> 1115</span> </div>
<div class="line"><span class="lineno"> 1116</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> ordered_additional_fields:</div>
<div class="line"><span class="lineno"> 1117</span>      batch_nmsed_additional_fields = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno"> 1118</span> </div>
<div class="line"><span class="lineno"> 1119</span>    <span class="keywordflow">return</span> (batch_nmsed_boxes, batch_nmsed_scores, batch_nmsed_classes,</div>
<div class="line"><span class="lineno"> 1120</span>            batch_nmsed_masks, batch_nmsed_additional_fields,</div>
<div class="line"><span class="lineno"> 1121</span>            batch_num_detections)</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing_a766a437a0d89839c4e6828b54205d000_cgraph.png" border="0" usemap="#ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a766a437a0d89839c4e6828b54205d000_cgraph" alt=""/></div>
<map name="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a766a437a0d89839c4e6828b54205d000_cgraph" id="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a766a437a0d89839c4e6828b54205d000_cgraph">
<area shape="rect" title=" " alt="" coords="5,85,200,140"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a0d33e143f24dc55fe43809b17882217d" title=" " alt="" coords="248,45,431,100"/>
<area shape="poly" title=" " alt="" coords="200,94,234,88,235,93,201,99"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a58b5edbb0a9b33010aae722c82050006" title=" " alt="" coords="257,124,421,179"/>
<area shape="poly" title=" " alt="" coords="201,126,244,133,243,138,200,131"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#aa52731af79c1f94bed50a291b05060ce" title=" " alt="" coords="497,5,669,60"/>
<area shape="poly" title=" " alt="" coords="431,55,482,46,483,52,431,60"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a1def87e6a8b8fad1ca56f6b3985f69d1" title=" " alt="" coords="489,84,677,139"/>
<area shape="poly" title=" " alt="" coords="431,85,476,92,475,97,431,90"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#afdb21198d6a9443ec277742c9938612b" title=" " alt="" coords="479,163,687,217"/>
<area shape="poly" title=" " alt="" coords="411,98,432,109,456,129,480,148,492,154,490,159,477,152,453,133,429,114,409,102"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a612ecf46d8c84ee42d5fb8cce480d2c5" title=" " alt="" coords="735,170,899,210"/>
<area shape="poly" title=" " alt="" coords="687,187,721,187,721,193,687,193"/>
<area shape="poly" title=" " alt="" coords="407,122,429,109,453,89,477,69,487,64,490,68,480,74,456,93,432,114,409,126"/>
<area shape="poly" title=" " alt="" coords="421,135,474,126,475,132,422,141"/>
<area shape="poly" title=" " alt="" coords="422,162,465,169,465,174,421,167"/>
</map>
</div>

</div>
</div>
<a id="a0d33e143f24dc55fe43809b17882217d" name="a0d33e143f24dc55fe43809b17882217d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d33e143f24dc55fe43809b17882217d">&#9670;&#160;</a></span>class_agnostic_non_max_suppression()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.post_processing.class_agnostic_non_max_suppression </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>boxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>scores</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>score_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iou_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_classes_per_detection</em> = <code>1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_total_size</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>clip_window</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>change_coordinate_frame</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>masks</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>boundaries</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>pad_to_max_output_size</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>additional_fields</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>soft_nms_sigma</em> = <code>0.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>scope</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Class-agnostic version of non maximum suppression.

This op greedily selects a subset of detection bounding boxes, pruning
away boxes that have high IOU (intersection over union) overlap (&gt; thresh)
with already selected boxes.  It operates on all the boxes using
max scores across all classes for which scores are provided (via the scores
field of the input box_list), pruning boxes with score less than a provided
threshold prior to applying NMS.

Please note that this operation is performed in a class-agnostic way,
therefore any background classes should be removed prior to calling this
function.

Selected boxes are guaranteed to be sorted in decreasing order by score (but
the sort is not guaranteed to be stable).

Args:
  boxes: A [k, q, 4] float32 tensor containing k detections. `q` can be either
    number of classes or 1 depending on whether a separate box is predicted
    per class.
  scores: A [k, num_classes] float32 tensor containing the scores for each of
    the k detections. The scores have to be non-negative when
    pad_to_max_output_size is True.
  score_thresh: scalar threshold for score (low scoring boxes are removed).
  iou_thresh: scalar threshold for IOU (new boxes that have high IOU overlap
    with previously selected boxes are removed).
  max_classes_per_detection: maximum number of retained classes per detection
    box in class-agnostic NMS.
  max_total_size: maximum number of boxes retained over all classes. By
    default returns all boxes retained after capping boxes per class.
  clip_window: A float32 tensor of the form [y_min, x_min, y_max, x_max]
    representing the window to clip and normalize boxes to before performing
    non-max suppression.
  change_coordinate_frame: Whether to normalize coordinates after clipping
    relative to clip_window (this can only be set to True if a clip_window is
    provided)
  masks: (optional) a [k, q, mask_height, mask_width] float32 tensor
    containing box masks. `q` can be either number of classes or 1 depending
    on whether a separate mask is predicted per class.
  boundaries: (optional) a [k, q, boundary_height, boundary_width] float32
    tensor containing box boundaries. `q` can be either number of classes or 1
    depending on whether a separate boundary is predicted per class.
  pad_to_max_output_size: If true, the output nmsed boxes are padded to be of
    length `max_size_per_class`. Defaults to false.
  additional_fields: (optional) If not None, a dictionary that maps keys to
    tensors whose first dimensions are all of size `k`. After non-maximum
    suppression, all tensors corresponding to the selected boxes will be added
    to resulting BoxList.
  soft_nms_sigma: A scalar float representing the Soft NMS sigma parameter;
    See Bodla et al, https://arxiv.org/abs/1704.04503).  When
    `soft_nms_sigma=0.0` (which is default), we fall back to standard (hard)
    NMS.  Soft NMS is currently only supported when pad_to_max_output_size is
    False.
  scope: name scope.

Returns:
  A tuple of sorted_boxes and num_valid_nms_boxes. The sorted_boxes is a
    BoxList holds M boxes with a rank-1 scores field representing
    corresponding scores for each box with scores sorted in decreasing order
    and a rank-1 classes field representing a class label for each box. The
    num_valid_nms_boxes is a 0-D integer tensor representing the number of
    valid elements in `BoxList`, with the valid elements appearing first.

Raises:
  ValueError: if iou_thresh is not in [0, 1] or if input boxlist does not have
    a valid scores field or if non-zero soft_nms_sigma is provided when
    pad_to_max_output_size is True.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d1/d53/post__processing_8py_source.html#l00598">598</a> of file <a class="el" href="../../d1/d53/post__processing_8py_source.html">post_processing.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  611</span>                                       scope=<span class="keywordtype">None</span>):</div>
<div class="line"><span class="lineno">  612</span>  <span class="stringliteral">&quot;&quot;&quot;Class-agnostic version of non maximum suppression.</span></div>
<div class="line"><span class="lineno">  613</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  614</span><span class="stringliteral">  This op greedily selects a subset of detection bounding boxes, pruning</span></div>
<div class="line"><span class="lineno">  615</span><span class="stringliteral">  away boxes that have high IOU (intersection over union) overlap (&gt; thresh)</span></div>
<div class="line"><span class="lineno">  616</span><span class="stringliteral">  </span><span class="keyword">with</span> already selected boxes.  It operates on all the boxes using</div>
<div class="line"><span class="lineno">  617</span>  max scores across all classes <span class="keywordflow">for</span> which scores are provided (via the scores</div>
<div class="line"><span class="lineno">  618</span>  field of the input box_list), pruning boxes <span class="keyword">with</span> score less than a provided</div>
<div class="line"><span class="lineno">  619</span>  threshold prior to applying NMS.</div>
<div class="line"><span class="lineno">  620</span> </div>
<div class="line"><span class="lineno">  621</span>  Please note that this operation <span class="keywordflow">is</span> performed <span class="keywordflow">in</span> a <span class="keyword">class</span>-agnostic way,</div>
<div class="line"><span class="lineno">  622</span>  therefore any background classes should be removed prior to calling this</div>
<div class="line"><span class="lineno">  623</span>  function.</div>
<div class="line"><span class="lineno">  624</span> </div>
<div class="line"><span class="lineno">  625</span>  Selected boxes are guaranteed to be sorted <span class="keywordflow">in</span> decreasing order by score (but</div>
<div class="line"><span class="lineno">  626</span>  the sort <span class="keywordflow">is</span> <span class="keywordflow">not</span> guaranteed to be stable).</div>
<div class="line"><span class="lineno">  627</span> </div>
<div class="line"><span class="lineno">  628</span>  Args:</div>
<div class="line"><span class="lineno">  629</span>    boxes: A [k, q, 4] float32 tensor containing k detections. `q` can be either</div>
<div class="line"><span class="lineno">  630</span>      number of classes <span class="keywordflow">or</span> 1 depending on whether a separate box <span class="keywordflow">is</span> predicted</div>
<div class="line"><span class="lineno">  631</span>      per <span class="keyword">class</span>.</div>
<div class="line"><span class="lineno">  632</span>    scores: A [k, num_classes] float32 tensor containing the scores <span class="keywordflow">for</span> each of</div>
<div class="line"><span class="lineno">  633</span>      the k detections. The scores have to be non-negative when</div>
<div class="line"><span class="lineno">  634</span>      pad_to_max_output_size <span class="keywordflow">is</span> <span class="keyword">True</span>.</div>
<div class="line"><span class="lineno">  635</span>    score_thresh: scalar threshold <span class="keywordflow">for</span> score (low scoring boxes are removed).</div>
<div class="line"><span class="lineno">  636</span>    iou_thresh: scalar threshold <span class="keywordflow">for</span> IOU (new boxes that have high IOU overlap</div>
<div class="line"><span class="lineno">  637</span>      <span class="keyword">with</span> previously selected boxes are removed).</div>
<div class="line"><span class="lineno">  638</span>    max_classes_per_detection: maximum number of retained classes per detection</div>
<div class="line"><span class="lineno">  639</span>      box <span class="keywordflow">in</span> <span class="keyword">class</span>-agnostic NMS.</div>
<div class="line"><span class="lineno">  640</span>    max_total_size: maximum number of boxes retained over all classes. By</div>
<div class="line"><span class="lineno">  641</span>      default returns all boxes retained after capping boxes per <span class="keyword">class</span>.</div>
<div class="line"><span class="lineno">  642</span>    clip_window: A float32 tensor of the form [y_min, x_min, y_max, x_max]</div>
<div class="line"><span class="lineno">  643</span>      representing the window to clip <span class="keywordflow">and</span> normalize boxes to before performing</div>
<div class="line"><span class="lineno">  644</span>      non-max suppression.</div>
<div class="line"><span class="lineno">  645</span>    change_coordinate_frame: Whether to normalize coordinates after clipping</div>
<div class="line"><span class="lineno">  646</span>      relative to clip_window (this can only be set to <span class="keyword">True</span> <span class="keywordflow">if</span> a clip_window <span class="keywordflow">is</span></div>
<div class="line"><span class="lineno">  647</span>      provided)</div>
<div class="line"><span class="lineno">  648</span>    masks: (optional) a [k, q, mask_height, mask_width] float32 tensor</div>
<div class="line"><span class="lineno">  649</span>      containing box masks. `q` can be either number of classes <span class="keywordflow">or</span> 1 depending</div>
<div class="line"><span class="lineno">  650</span>      on whether a separate mask <span class="keywordflow">is</span> predicted per <span class="keyword">class</span>.</div>
<div class="line"><span class="lineno">  651</span>    boundaries: (optional) a [k, q, boundary_height, boundary_width] float32</div>
<div class="line"><span class="lineno">  652</span>      tensor containing box boundaries. `q` can be either number of classes <span class="keywordflow">or</span> 1</div>
<div class="line"><span class="lineno">  653</span>      depending on whether a separate boundary <span class="keywordflow">is</span> predicted per <span class="keyword">class</span>.</div>
<div class="line"><span class="lineno">  654</span>    pad_to_max_output_size: If true, the output nmsed boxes are padded to be of</div>
<div class="line"><span class="lineno">  655</span>      length `max_size_per_class`. Defaults to false.</div>
<div class="line"><span class="lineno">  656</span>    additional_fields: (optional) If <span class="keywordflow">not</span> <span class="keywordtype">None</span>, a dictionary that maps keys to</div>
<div class="line"><span class="lineno">  657</span>      tensors whose first dimensions are all of size `k`. After non-maximum</div>
<div class="line"><span class="lineno">  658</span>      suppression, all tensors corresponding to the selected boxes will be added</div>
<div class="line"><span class="lineno">  659</span>      to resulting BoxList.</div>
<div class="line"><span class="lineno">  660</span>    soft_nms_sigma: A scalar float representing the Soft NMS sigma parameter;</div>
<div class="line"><span class="lineno">  661</span>      See Bodla et al, https://arxiv.org/abs/1704.04503).  When</div>
<div class="line"><span class="lineno">  662</span>      `soft_nms_sigma=0.0` (which <span class="keywordflow">is</span> default), we fall back to standard (hard)</div>
<div class="line"><span class="lineno">  663</span>      NMS.  Soft NMS <span class="keywordflow">is</span> currently only supported when pad_to_max_output_size <span class="keywordflow">is</span></div>
<div class="line"><span class="lineno">  664</span>      <span class="keyword">False</span>.</div>
<div class="line"><span class="lineno">  665</span>    scope: name scope.</div>
<div class="line"><span class="lineno">  666</span> </div>
<div class="line"><span class="lineno">  667</span>  Returns:</div>
<div class="line"><span class="lineno">  668</span>    A tuple of sorted_boxes <span class="keywordflow">and</span> num_valid_nms_boxes. The sorted_boxes <span class="keywordflow">is</span> a</div>
<div class="line"><span class="lineno">  669</span>      BoxList holds M boxes <span class="keyword">with</span> a rank-1 scores field representing</div>
<div class="line"><span class="lineno">  670</span>      corresponding scores <span class="keywordflow">for</span> each box <span class="keyword">with</span> scores sorted <span class="keywordflow">in</span> decreasing order</div>
<div class="line"><span class="lineno">  671</span>      <span class="keywordflow">and</span> a rank-1 classes field representing a <span class="keyword">class </span>label for each box. The</div>
<div class="line"><span class="lineno">  672</span>      num_valid_nms_boxes <span class="keywordflow">is</span> a 0-D integer tensor representing the number of</div>
<div class="line"><span class="lineno">  673</span>      valid elements <span class="keywordflow">in</span> `BoxList`, <span class="keyword">with</span> the valid elements appearing first.</div>
<div class="line"><span class="lineno">  674</span> </div>
<div class="line"><span class="lineno">  675</span>  Raises:</div>
<div class="line"><span class="lineno">  676</span>    ValueError: <span class="keywordflow">if</span> iou_thresh <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> [0, 1] <span class="keywordflow">or</span> <span class="keywordflow">if</span> input boxlist does <span class="keywordflow">not</span> have</div>
<div class="line"><span class="lineno">  677</span>      a valid scores field <span class="keywordflow">or</span> <span class="keywordflow">if</span> non-zero soft_nms_sigma <span class="keywordflow">is</span> provided when</div>
<div class="line"><span class="lineno">  678</span>      pad_to_max_output_size <span class="keywordflow">is</span> <span class="keyword">True</span>.</div>
<div class="line"><span class="lineno">  679</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  680</span><span class="stringliteral">  _validate_boxes_scores_iou_thresh(boxes, scores, iou_thresh,</span></div>
<div class="line"><span class="lineno">  681</span><span class="stringliteral">                                    change_coordinate_frame, clip_window)</span></div>
<div class="line"><span class="lineno">  682</span><span class="stringliteral">  </span><span class="keywordflow">if</span> pad_to_max_output_size <span class="keywordflow">and</span> soft_nms_sigma != 0.0:</div>
<div class="line"><span class="lineno">  683</span>    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Soft NMS (soft_nms_sigma != 0.0) is currently not &#39;</span></div>
<div class="line"><span class="lineno">  684</span>                     <span class="stringliteral">&#39;supported when pad_to_max_output_size is True.&#39;</span>)</div>
<div class="line"><span class="lineno">  685</span> </div>
<div class="line"><span class="lineno">  686</span>  <span class="keywordflow">if</span> max_classes_per_detection &gt; 1:</div>
<div class="line"><span class="lineno">  687</span>    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Max classes per detection box &gt;1 not supported.&#39;</span>)</div>
<div class="line"><span class="lineno">  688</span>  q = shape_utils.get_dim_as_int(boxes.shape[1])</div>
<div class="line"><span class="lineno">  689</span>  <span class="keywordflow">if</span> q &gt; 1:</div>
<div class="line"><span class="lineno">  690</span>    class_ids = tf.expand_dims(</div>
<div class="line"><span class="lineno">  691</span>        tf.argmax(scores, axis=1, output_type=tf.int32), axis=1)</div>
<div class="line"><span class="lineno">  692</span>    boxes = tf.batch_gather(boxes, class_ids)</div>
<div class="line"><span class="lineno">  693</span>    <span class="keywordflow">if</span> masks <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  694</span>      masks = tf.batch_gather(masks, class_ids)</div>
<div class="line"><span class="lineno">  695</span>    <span class="keywordflow">if</span> boundaries <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  696</span>      boundaries = tf.batch_gather(boundaries, class_ids)</div>
<div class="line"><span class="lineno">  697</span>  boxes = tf.squeeze(boxes, axis=[1])</div>
<div class="line"><span class="lineno">  698</span>  <span class="keywordflow">if</span> masks <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  699</span>    masks = tf.squeeze(masks, axis=[1])</div>
<div class="line"><span class="lineno">  700</span>  <span class="keywordflow">if</span> boundaries <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  701</span>    boundaries = tf.squeeze(boundaries, axis=[1])</div>
<div class="line"><span class="lineno">  702</span> </div>
<div class="line"><span class="lineno">  703</span>  <span class="keyword">with</span> tf.name_scope(scope, <span class="stringliteral">&#39;ClassAgnosticNonMaxSuppression&#39;</span>):</div>
<div class="line"><span class="lineno">  704</span>    boxlist_and_class_scores = box_list.BoxList(boxes)</div>
<div class="line"><span class="lineno">  705</span>    max_scores = tf.reduce_max(scores, axis=-1)</div>
<div class="line"><span class="lineno">  706</span>    classes_with_max_scores = tf.argmax(scores, axis=-1)</div>
<div class="line"><span class="lineno">  707</span>    boxlist_and_class_scores.add_field(fields.BoxListFields.scores, max_scores)</div>
<div class="line"><span class="lineno">  708</span>    <span class="keywordflow">if</span> masks <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  709</span>      boxlist_and_class_scores.add_field(fields.BoxListFields.masks, masks)</div>
<div class="line"><span class="lineno">  710</span>    <span class="keywordflow">if</span> boundaries <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  711</span>      boxlist_and_class_scores.add_field(fields.BoxListFields.boundaries,</div>
<div class="line"><span class="lineno">  712</span>                                         boundaries)</div>
<div class="line"><span class="lineno">  713</span> </div>
<div class="line"><span class="lineno">  714</span>    <span class="keywordflow">if</span> additional_fields <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  715</span>      <span class="keywordflow">for</span> key, tensor <span class="keywordflow">in</span> additional_fields.items():</div>
<div class="line"><span class="lineno">  716</span>        boxlist_and_class_scores.add_field(key, tensor)</div>
<div class="line"><span class="lineno">  717</span> </div>
<div class="line"><span class="lineno">  718</span>    nms_result = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  719</span>    selected_scores = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  720</span>    <span class="keywordflow">if</span> pad_to_max_output_size:</div>
<div class="line"><span class="lineno">  721</span>      max_selection_size = max_total_size</div>
<div class="line"><span class="lineno">  722</span>      (selected_indices, num_valid_nms_boxes,</div>
<div class="line"><span class="lineno">  723</span>       boxlist_and_class_scores.data[<span class="stringliteral">&#39;boxes&#39;</span>],</div>
<div class="line"><span class="lineno">  724</span>       boxlist_and_class_scores.data[<span class="stringliteral">&#39;scores&#39;</span>],</div>
<div class="line"><span class="lineno">  725</span>       argsort_ids) = partitioned_non_max_suppression_padded(</div>
<div class="line"><span class="lineno">  726</span>           boxlist_and_class_scores.get(),</div>
<div class="line"><span class="lineno">  727</span>           boxlist_and_class_scores.get_field(fields.BoxListFields.scores),</div>
<div class="line"><span class="lineno">  728</span>           max_selection_size,</div>
<div class="line"><span class="lineno">  729</span>           iou_threshold=iou_thresh,</div>
<div class="line"><span class="lineno">  730</span>           score_threshold=score_thresh)</div>
<div class="line"><span class="lineno">  731</span>      nms_result = box_list_ops.gather(boxlist_and_class_scores,</div>
<div class="line"><span class="lineno">  732</span>                                       selected_indices)</div>
<div class="line"><span class="lineno">  733</span>      selected_scores = nms_result.get_field(fields.BoxListFields.scores)</div>
<div class="line"><span class="lineno">  734</span>      classes_with_max_scores = tf.gather(classes_with_max_scores, argsort_ids)</div>
<div class="line"><span class="lineno">  735</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  736</span>      max_selection_size = tf.minimum(max_total_size,</div>
<div class="line"><span class="lineno">  737</span>                                      boxlist_and_class_scores.num_boxes())</div>
<div class="line"><span class="lineno">  738</span>      <span class="keywordflow">if</span> (hasattr(tf.image, <span class="stringliteral">&#39;non_max_suppression_with_scores&#39;</span>) <span class="keywordflow">and</span></div>
<div class="line"><span class="lineno">  739</span>          tf.compat.forward_compatible(2019, 6, 6)):</div>
<div class="line"><span class="lineno">  740</span>        (selected_indices, selected_scores</div>
<div class="line"><span class="lineno">  741</span>        ) = tf.image.non_max_suppression_with_scores(</div>
<div class="line"><span class="lineno">  742</span>            boxlist_and_class_scores.get(),</div>
<div class="line"><span class="lineno">  743</span>            boxlist_and_class_scores.get_field(fields.BoxListFields.scores),</div>
<div class="line"><span class="lineno">  744</span>            max_selection_size,</div>
<div class="line"><span class="lineno">  745</span>            iou_threshold=iou_thresh,</div>
<div class="line"><span class="lineno">  746</span>            score_threshold=score_thresh,</div>
<div class="line"><span class="lineno">  747</span>            soft_nms_sigma=soft_nms_sigma)</div>
<div class="line"><span class="lineno">  748</span>        num_valid_nms_boxes = tf.shape(selected_indices)[0]</div>
<div class="line"><span class="lineno">  749</span>        selected_indices = tf.concat([</div>
<div class="line"><span class="lineno">  750</span>            selected_indices,</div>
<div class="line"><span class="lineno">  751</span>            tf.zeros(max_selection_size - num_valid_nms_boxes, tf.int32)</div>
<div class="line"><span class="lineno">  752</span>        ], 0)</div>
<div class="line"><span class="lineno">  753</span>        selected_scores = tf.concat(</div>
<div class="line"><span class="lineno">  754</span>            [selected_scores,</div>
<div class="line"><span class="lineno">  755</span>             tf.zeros(max_selection_size-num_valid_nms_boxes, tf.float32)], -1)</div>
<div class="line"><span class="lineno">  756</span>        nms_result = box_list_ops.gather(boxlist_and_class_scores,</div>
<div class="line"><span class="lineno">  757</span>                                         selected_indices)</div>
<div class="line"><span class="lineno">  758</span>      <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  759</span>        <span class="keywordflow">if</span> soft_nms_sigma != 0:</div>
<div class="line"><span class="lineno">  760</span>          <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Soft NMS not supported in current TF version!&#39;</span>)</div>
<div class="line"><span class="lineno">  761</span>        selected_indices = tf.image.non_max_suppression(</div>
<div class="line"><span class="lineno">  762</span>            boxlist_and_class_scores.get(),</div>
<div class="line"><span class="lineno">  763</span>            boxlist_and_class_scores.get_field(fields.BoxListFields.scores),</div>
<div class="line"><span class="lineno">  764</span>            max_selection_size,</div>
<div class="line"><span class="lineno">  765</span>            iou_threshold=iou_thresh,</div>
<div class="line"><span class="lineno">  766</span>            score_threshold=score_thresh)</div>
<div class="line"><span class="lineno">  767</span>        num_valid_nms_boxes = tf.shape(selected_indices)[0]</div>
<div class="line"><span class="lineno">  768</span>        selected_indices = tf.concat(</div>
<div class="line"><span class="lineno">  769</span>            [selected_indices,</div>
<div class="line"><span class="lineno">  770</span>             tf.zeros(max_selection_size-num_valid_nms_boxes, tf.int32)], 0)</div>
<div class="line"><span class="lineno">  771</span>        nms_result = box_list_ops.gather(boxlist_and_class_scores,</div>
<div class="line"><span class="lineno">  772</span>                                         selected_indices)</div>
<div class="line"><span class="lineno">  773</span>        selected_scores = nms_result.get_field(fields.BoxListFields.scores)</div>
<div class="line"><span class="lineno">  774</span>    valid_nms_boxes_indices = tf.less(</div>
<div class="line"><span class="lineno">  775</span>        tf.range(max_selection_size), num_valid_nms_boxes)</div>
<div class="line"><span class="lineno">  776</span>    nms_result.add_field(</div>
<div class="line"><span class="lineno">  777</span>        fields.BoxListFields.scores,</div>
<div class="line"><span class="lineno">  778</span>        tf.where(valid_nms_boxes_indices,</div>
<div class="line"><span class="lineno">  779</span>                 selected_scores, -1*tf.ones(max_selection_size)))</div>
<div class="line"><span class="lineno">  780</span> </div>
<div class="line"><span class="lineno">  781</span>    selected_classes = tf.gather(classes_with_max_scores, selected_indices)</div>
<div class="line"><span class="lineno">  782</span>    nms_result.add_field(fields.BoxListFields.classes, selected_classes)</div>
<div class="line"><span class="lineno">  783</span>    selected_boxes = nms_result</div>
<div class="line"><span class="lineno">  784</span>    sorted_boxes = box_list_ops.sort_by_field(selected_boxes,</div>
<div class="line"><span class="lineno">  785</span>                                              fields.BoxListFields.scores)</div>
<div class="line"><span class="lineno">  786</span> </div>
<div class="line"><span class="lineno">  787</span>    <span class="keywordflow">if</span> clip_window <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  788</span>      <span class="comment"># When pad_to_max_output_size is False, it prunes the boxes with zero</span></div>
<div class="line"><span class="lineno">  789</span>      <span class="comment"># area.</span></div>
<div class="line"><span class="lineno">  790</span>      sorted_boxes, num_valid_nms_boxes = _clip_window_prune_boxes(</div>
<div class="line"><span class="lineno">  791</span>          sorted_boxes, clip_window, pad_to_max_output_size,</div>
<div class="line"><span class="lineno">  792</span>          change_coordinate_frame)</div>
<div class="line"><span class="lineno">  793</span> </div>
<div class="line"><span class="lineno">  794</span>    <span class="keywordflow">if</span> max_total_size:</div>
<div class="line"><span class="lineno">  795</span>      max_total_size = tf.minimum(max_total_size, sorted_boxes.num_boxes())</div>
<div class="line"><span class="lineno">  796</span>      sorted_boxes = box_list_ops.gather(sorted_boxes, tf.range(max_total_size))</div>
<div class="line"><span class="lineno">  797</span>      num_valid_nms_boxes = tf.where(max_total_size &gt; num_valid_nms_boxes,</div>
<div class="line"><span class="lineno">  798</span>                                     num_valid_nms_boxes, max_total_size)</div>
<div class="line"><span class="lineno">  799</span>    <span class="comment"># Select only the valid boxes if pad_to_max_output_size is False.</span></div>
<div class="line"><span class="lineno">  800</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> pad_to_max_output_size:</div>
<div class="line"><span class="lineno">  801</span>      sorted_boxes = box_list_ops.gather(sorted_boxes,</div>
<div class="line"><span class="lineno">  802</span>                                         tf.range(num_valid_nms_boxes))</div>
<div class="line"><span class="lineno">  803</span> </div>
<div class="line"><span class="lineno">  804</span>    <span class="keywordflow">return</span> sorted_boxes, num_valid_nms_boxes</div>
<div class="line"><span class="lineno">  805</span> </div>
<div class="line"><span class="lineno">  806</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing_a0d33e143f24dc55fe43809b17882217d_cgraph.png" border="0" usemap="#ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a0d33e143f24dc55fe43809b17882217d_cgraph" alt=""/></div>
<map name="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a0d33e143f24dc55fe43809b17882217d_cgraph" id="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a0d33e143f24dc55fe43809b17882217d_cgraph">
<area shape="rect" title=" " alt="" coords="5,84,188,139"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#aa52731af79c1f94bed50a291b05060ce" title=" " alt="" coords="254,5,426,60"/>
<area shape="poly" title=" " alt="" coords="181,81,241,62,243,67,183,86"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a1def87e6a8b8fad1ca56f6b3985f69d1" title=" " alt="" coords="246,84,434,139"/>
<area shape="poly" title=" " alt="" coords="188,109,232,109,232,114,188,114"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#afdb21198d6a9443ec277742c9938612b" title=" " alt="" coords="236,163,444,217"/>
<area shape="poly" title=" " alt="" coords="183,136,243,156,241,161,181,141"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a612ecf46d8c84ee42d5fb8cce480d2c5" title=" " alt="" coords="492,170,656,210"/>
<area shape="poly" title=" " alt="" coords="444,187,478,187,478,193,444,193"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing_a0d33e143f24dc55fe43809b17882217d_icgraph.png" border="0" usemap="#ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a0d33e143f24dc55fe43809b17882217d_icgraph" alt=""/></div>
<map name="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a0d33e143f24dc55fe43809b17882217d_icgraph" id="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a0d33e143f24dc55fe43809b17882217d_icgraph">
<area shape="rect" title=" " alt="" coords="248,5,431,60"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a766a437a0d89839c4e6828b54205d000" title=" " alt="" coords="5,5,200,60"/>
<area shape="poly" title=" " alt="" coords="234,35,200,35,200,30,234,30"/>
</map>
</div>

</div>
</div>
<a id="a58b5edbb0a9b33010aae722c82050006" name="a58b5edbb0a9b33010aae722c82050006"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58b5edbb0a9b33010aae722c82050006">&#9670;&#160;</a></span>multiclass_non_max_suppression()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.post_processing.multiclass_non_max_suppression </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>boxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>scores</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>score_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iou_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_size_per_class</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_total_size</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>clip_window</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>change_coordinate_frame</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>masks</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>boundaries</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>pad_to_max_output_size</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>additional_fields</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>soft_nms_sigma</em> = <code>0.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>scope</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Multi-class version of non maximum suppression.

This op greedily selects a subset of detection bounding boxes, pruning
away boxes that have high IOU (intersection over union) overlap (&gt; thresh)
with already selected boxes.  It operates independently for each class for
which scores are provided (via the scores field of the input box_list),
pruning boxes with score less than a provided threshold prior to
applying NMS.

Please note that this operation is performed on *all* classes, therefore any
background classes should be removed prior to calling this function.

Selected boxes are guaranteed to be sorted in decreasing order by score (but
the sort is not guaranteed to be stable).

Args:
  boxes: A [k, q, 4] float32 tensor containing k detections. `q` can be either
    number of classes or 1 depending on whether a separate box is predicted
    per class.
  scores: A [k, num_classes] float32 tensor containing the scores for each of
    the k detections. The scores have to be non-negative when
    pad_to_max_output_size is True.
  score_thresh: scalar threshold for score (low scoring boxes are removed).
  iou_thresh: scalar threshold for IOU (new boxes that have high IOU overlap
    with previously selected boxes are removed).
  max_size_per_class: maximum number of retained boxes per class.
  max_total_size: maximum number of boxes retained over all classes. By
    default returns all boxes retained after capping boxes per class.
  clip_window: A float32 tensor of the form [y_min, x_min, y_max, x_max]
    representing the window to clip and normalize boxes to before performing
    non-max suppression.
  change_coordinate_frame: Whether to normalize coordinates after clipping
    relative to clip_window (this can only be set to True if a clip_window
    is provided)
  masks: (optional) a [k, q, mask_height, mask_width] float32 tensor
    containing box masks. `q` can be either number of classes or 1 depending
    on whether a separate mask is predicted per class.
  boundaries: (optional) a [k, q, boundary_height, boundary_width] float32
    tensor containing box boundaries. `q` can be either number of classes or 1
    depending on whether a separate boundary is predicted per class.
  pad_to_max_output_size: If true, the output nmsed boxes are padded to be of
    length `max_size_per_class`. Defaults to false.
  additional_fields: (optional) If not None, a dictionary that maps keys to
    tensors whose first dimensions are all of size `k`. After non-maximum
    suppression, all tensors corresponding to the selected boxes will be
    added to resulting BoxList.
  soft_nms_sigma: A scalar float representing the Soft NMS sigma parameter;
    See Bodla et al, https://arxiv.org/abs/1704.04503).  When
    `soft_nms_sigma=0.0` (which is default), we fall back to standard (hard)
    NMS.  Soft NMS is currently only supported when pad_to_max_output_size is
    False.
  scope: name scope.

Returns:
  A tuple of sorted_boxes and num_valid_nms_boxes. The sorted_boxes is a
    BoxList holds M boxes with a rank-1 scores field representing
    corresponding scores for each box with scores sorted in decreasing order
    and a rank-1 classes field representing a class label for each box. The
    num_valid_nms_boxes is a 0-D integer tensor representing the number of
    valid elements in `BoxList`, with the valid elements appearing first.

Raises:
  ValueError: if iou_thresh is not in [0, 1] or if input boxlist does not have
    a valid scores field.
  ValueError: if Soft NMS (tf.image.non_max_suppression_with_scores) is not
    supported in the current TF version and `soft_nms_sigma` is nonzero.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d1/d53/post__processing_8py_source.html#l00385">385</a> of file <a class="el" href="../../d1/d53/post__processing_8py_source.html">post_processing.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  398</span>                                   scope=<span class="keywordtype">None</span>):</div>
<div class="line"><span class="lineno">  399</span>  <span class="stringliteral">&quot;&quot;&quot;Multi-class version of non maximum suppression.</span></div>
<div class="line"><span class="lineno">  400</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  401</span><span class="stringliteral">  This op greedily selects a subset of detection bounding boxes, pruning</span></div>
<div class="line"><span class="lineno">  402</span><span class="stringliteral">  away boxes that have high IOU (intersection over union) overlap (&gt; thresh)</span></div>
<div class="line"><span class="lineno">  403</span><span class="stringliteral">  </span><span class="keyword">with</span> already selected boxes.  It operates independently <span class="keywordflow">for</span> each <span class="keyword">class </span>for</div>
<div class="line"><span class="lineno">  404</span>  which scores are provided (via the scores field of the input box_list),</div>
<div class="line"><span class="lineno">  405</span>  pruning boxes <span class="keyword">with</span> score less than a provided threshold prior to</div>
<div class="line"><span class="lineno">  406</span>  applying NMS.</div>
<div class="line"><span class="lineno">  407</span> </div>
<div class="line"><span class="lineno">  408</span>  Please note that this operation <span class="keywordflow">is</span> performed on *all* classes, therefore any</div>
<div class="line"><span class="lineno">  409</span>  background classes should be removed prior to calling this function.</div>
<div class="line"><span class="lineno">  410</span> </div>
<div class="line"><span class="lineno">  411</span>  Selected boxes are guaranteed to be sorted <span class="keywordflow">in</span> decreasing order by score (but</div>
<div class="line"><span class="lineno">  412</span>  the sort <span class="keywordflow">is</span> <span class="keywordflow">not</span> guaranteed to be stable).</div>
<div class="line"><span class="lineno">  413</span> </div>
<div class="line"><span class="lineno">  414</span>  Args:</div>
<div class="line"><span class="lineno">  415</span>    boxes: A [k, q, 4] float32 tensor containing k detections. `q` can be either</div>
<div class="line"><span class="lineno">  416</span>      number of classes <span class="keywordflow">or</span> 1 depending on whether a separate box <span class="keywordflow">is</span> predicted</div>
<div class="line"><span class="lineno">  417</span>      per <span class="keyword">class</span>.</div>
<div class="line"><span class="lineno">  418</span>    scores: A [k, num_classes] float32 tensor containing the scores <span class="keywordflow">for</span> each of</div>
<div class="line"><span class="lineno">  419</span>      the k detections. The scores have to be non-negative when</div>
<div class="line"><span class="lineno">  420</span>      pad_to_max_output_size <span class="keywordflow">is</span> <span class="keyword">True</span>.</div>
<div class="line"><span class="lineno">  421</span>    score_thresh: scalar threshold <span class="keywordflow">for</span> score (low scoring boxes are removed).</div>
<div class="line"><span class="lineno">  422</span>    iou_thresh: scalar threshold <span class="keywordflow">for</span> IOU (new boxes that have high IOU overlap</div>
<div class="line"><span class="lineno">  423</span>      <span class="keyword">with</span> previously selected boxes are removed).</div>
<div class="line"><span class="lineno">  424</span>    max_size_per_class: maximum number of retained boxes per <span class="keyword">class</span>.</div>
<div class="line"><span class="lineno">  425</span>    max_total_size: maximum number of boxes retained over all classes. By</div>
<div class="line"><span class="lineno">  426</span>      default returns all boxes retained after capping boxes per <span class="keyword">class</span>.</div>
<div class="line"><span class="lineno">  427</span>    clip_window: A float32 tensor of the form [y_min, x_min, y_max, x_max]</div>
<div class="line"><span class="lineno">  428</span>      representing the window to clip <span class="keywordflow">and</span> normalize boxes to before performing</div>
<div class="line"><span class="lineno">  429</span>      non-max suppression.</div>
<div class="line"><span class="lineno">  430</span>    change_coordinate_frame: Whether to normalize coordinates after clipping</div>
<div class="line"><span class="lineno">  431</span>      relative to clip_window (this can only be set to <span class="keyword">True</span> <span class="keywordflow">if</span> a clip_window</div>
<div class="line"><span class="lineno">  432</span>      <span class="keywordflow">is</span> provided)</div>
<div class="line"><span class="lineno">  433</span>    masks: (optional) a [k, q, mask_height, mask_width] float32 tensor</div>
<div class="line"><span class="lineno">  434</span>      containing box masks. `q` can be either number of classes <span class="keywordflow">or</span> 1 depending</div>
<div class="line"><span class="lineno">  435</span>      on whether a separate mask <span class="keywordflow">is</span> predicted per <span class="keyword">class</span>.</div>
<div class="line"><span class="lineno">  436</span>    boundaries: (optional) a [k, q, boundary_height, boundary_width] float32</div>
<div class="line"><span class="lineno">  437</span>      tensor containing box boundaries. `q` can be either number of classes <span class="keywordflow">or</span> 1</div>
<div class="line"><span class="lineno">  438</span>      depending on whether a separate boundary <span class="keywordflow">is</span> predicted per <span class="keyword">class</span>.</div>
<div class="line"><span class="lineno">  439</span>    pad_to_max_output_size: If true, the output nmsed boxes are padded to be of</div>
<div class="line"><span class="lineno">  440</span>      length `max_size_per_class`. Defaults to false.</div>
<div class="line"><span class="lineno">  441</span>    additional_fields: (optional) If <span class="keywordflow">not</span> <span class="keywordtype">None</span>, a dictionary that maps keys to</div>
<div class="line"><span class="lineno">  442</span>      tensors whose first dimensions are all of size `k`. After non-maximum</div>
<div class="line"><span class="lineno">  443</span>      suppression, all tensors corresponding to the selected boxes will be</div>
<div class="line"><span class="lineno">  444</span>      added to resulting BoxList.</div>
<div class="line"><span class="lineno">  445</span>    soft_nms_sigma: A scalar float representing the Soft NMS sigma parameter;</div>
<div class="line"><span class="lineno">  446</span>      See Bodla et al, https://arxiv.org/abs/1704.04503).  When</div>
<div class="line"><span class="lineno">  447</span>      `soft_nms_sigma=0.0` (which <span class="keywordflow">is</span> default), we fall back to standard (hard)</div>
<div class="line"><span class="lineno">  448</span>      NMS.  Soft NMS <span class="keywordflow">is</span> currently only supported when pad_to_max_output_size <span class="keywordflow">is</span></div>
<div class="line"><span class="lineno">  449</span>      <span class="keyword">False</span>.</div>
<div class="line"><span class="lineno">  450</span>    scope: name scope.</div>
<div class="line"><span class="lineno">  451</span> </div>
<div class="line"><span class="lineno">  452</span>  Returns:</div>
<div class="line"><span class="lineno">  453</span>    A tuple of sorted_boxes <span class="keywordflow">and</span> num_valid_nms_boxes. The sorted_boxes <span class="keywordflow">is</span> a</div>
<div class="line"><span class="lineno">  454</span>      BoxList holds M boxes <span class="keyword">with</span> a rank-1 scores field representing</div>
<div class="line"><span class="lineno">  455</span>      corresponding scores <span class="keywordflow">for</span> each box <span class="keyword">with</span> scores sorted <span class="keywordflow">in</span> decreasing order</div>
<div class="line"><span class="lineno">  456</span>      <span class="keywordflow">and</span> a rank-1 classes field representing a <span class="keyword">class </span>label for each box. The</div>
<div class="line"><span class="lineno">  457</span>      num_valid_nms_boxes <span class="keywordflow">is</span> a 0-D integer tensor representing the number of</div>
<div class="line"><span class="lineno">  458</span>      valid elements <span class="keywordflow">in</span> `BoxList`, <span class="keyword">with</span> the valid elements appearing first.</div>
<div class="line"><span class="lineno">  459</span> </div>
<div class="line"><span class="lineno">  460</span>  Raises:</div>
<div class="line"><span class="lineno">  461</span>    ValueError: <span class="keywordflow">if</span> iou_thresh <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> [0, 1] <span class="keywordflow">or</span> <span class="keywordflow">if</span> input boxlist does <span class="keywordflow">not</span> have</div>
<div class="line"><span class="lineno">  462</span>      a valid scores field.</div>
<div class="line"><span class="lineno">  463</span>    ValueError: <span class="keywordflow">if</span> Soft NMS (tf.image.non_max_suppression_with_scores) <span class="keywordflow">is</span> <span class="keywordflow">not</span></div>
<div class="line"><span class="lineno">  464</span>      supported <span class="keywordflow">in</span> the current TF version <span class="keywordflow">and</span> `soft_nms_sigma` <span class="keywordflow">is</span> nonzero.</div>
<div class="line"><span class="lineno">  465</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  466</span><span class="stringliteral">  _validate_boxes_scores_iou_thresh(boxes, scores, iou_thresh,</span></div>
<div class="line"><span class="lineno">  467</span><span class="stringliteral">                                    change_coordinate_frame, clip_window)</span></div>
<div class="line"><span class="lineno">  468</span><span class="stringliteral">  </span><span class="keywordflow">if</span> pad_to_max_output_size <span class="keywordflow">and</span> soft_nms_sigma != 0.0:</div>
<div class="line"><span class="lineno">  469</span>    <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Soft NMS (soft_nms_sigma != 0.0) is currently not &#39;</span></div>
<div class="line"><span class="lineno">  470</span>                     <span class="stringliteral">&#39;supported when pad_to_max_output_size is True.&#39;</span>)</div>
<div class="line"><span class="lineno">  471</span> </div>
<div class="line"><span class="lineno">  472</span>  <span class="keyword">with</span> tf.name_scope(scope, <span class="stringliteral">&#39;MultiClassNonMaxSuppression&#39;</span>):</div>
<div class="line"><span class="lineno">  473</span>    num_scores = tf.shape(scores)[0]</div>
<div class="line"><span class="lineno">  474</span>    num_classes = shape_utils.get_dim_as_int(scores.get_shape()[1])</div>
<div class="line"><span class="lineno">  475</span> </div>
<div class="line"><span class="lineno">  476</span>    selected_boxes_list = []</div>
<div class="line"><span class="lineno">  477</span>    num_valid_nms_boxes_cumulative = tf.constant(0)</div>
<div class="line"><span class="lineno">  478</span>    per_class_boxes_list = tf.unstack(boxes, axis=1)</div>
<div class="line"><span class="lineno">  479</span>    <span class="keywordflow">if</span> masks <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  480</span>      per_class_masks_list = tf.unstack(masks, axis=1)</div>
<div class="line"><span class="lineno">  481</span>    <span class="keywordflow">if</span> boundaries <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  482</span>      per_class_boundaries_list = tf.unstack(boundaries, axis=1)</div>
<div class="line"><span class="lineno">  483</span>    boxes_ids = (range(num_classes) <span class="keywordflow">if</span> len(per_class_boxes_list) &gt; 1</div>
<div class="line"><span class="lineno">  484</span>                 <span class="keywordflow">else</span> [0] * num_classes)</div>
<div class="line"><span class="lineno">  485</span>    <span class="keywordflow">for</span> class_idx, boxes_idx <span class="keywordflow">in</span> zip(range(num_classes), boxes_ids):</div>
<div class="line"><span class="lineno">  486</span>      per_class_boxes = per_class_boxes_list[boxes_idx]</div>
<div class="line"><span class="lineno">  487</span>      boxlist_and_class_scores = box_list.BoxList(per_class_boxes)</div>
<div class="line"><span class="lineno">  488</span>      class_scores = tf.reshape(</div>
<div class="line"><span class="lineno">  489</span>          tf.slice(scores, [0, class_idx], tf.stack([num_scores, 1])), [-1])</div>
<div class="line"><span class="lineno">  490</span> </div>
<div class="line"><span class="lineno">  491</span>      boxlist_and_class_scores.add_field(fields.BoxListFields.scores,</div>
<div class="line"><span class="lineno">  492</span>                                         class_scores)</div>
<div class="line"><span class="lineno">  493</span>      <span class="keywordflow">if</span> masks <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  494</span>        per_class_masks = per_class_masks_list[boxes_idx]</div>
<div class="line"><span class="lineno">  495</span>        boxlist_and_class_scores.add_field(fields.BoxListFields.masks,</div>
<div class="line"><span class="lineno">  496</span>                                           per_class_masks)</div>
<div class="line"><span class="lineno">  497</span>      <span class="keywordflow">if</span> boundaries <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  498</span>        per_class_boundaries = per_class_boundaries_list[boxes_idx]</div>
<div class="line"><span class="lineno">  499</span>        boxlist_and_class_scores.add_field(fields.BoxListFields.boundaries,</div>
<div class="line"><span class="lineno">  500</span>                                           per_class_boundaries)</div>
<div class="line"><span class="lineno">  501</span>      <span class="keywordflow">if</span> additional_fields <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  502</span>        <span class="keywordflow">for</span> key, tensor <span class="keywordflow">in</span> additional_fields.items():</div>
<div class="line"><span class="lineno">  503</span>          boxlist_and_class_scores.add_field(key, tensor)</div>
<div class="line"><span class="lineno">  504</span> </div>
<div class="line"><span class="lineno">  505</span>      nms_result = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  506</span>      selected_scores = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  507</span>      <span class="keywordflow">if</span> pad_to_max_output_size:</div>
<div class="line"><span class="lineno">  508</span>        max_selection_size = max_size_per_class</div>
<div class="line"><span class="lineno">  509</span>        (selected_indices, num_valid_nms_boxes,</div>
<div class="line"><span class="lineno">  510</span>         boxlist_and_class_scores.data[<span class="stringliteral">&#39;boxes&#39;</span>],</div>
<div class="line"><span class="lineno">  511</span>         boxlist_and_class_scores.data[<span class="stringliteral">&#39;scores&#39;</span>],</div>
<div class="line"><span class="lineno">  512</span>         _) = partitioned_non_max_suppression_padded(</div>
<div class="line"><span class="lineno">  513</span>             boxlist_and_class_scores.get(),</div>
<div class="line"><span class="lineno">  514</span>             boxlist_and_class_scores.get_field(fields.BoxListFields.scores),</div>
<div class="line"><span class="lineno">  515</span>             max_selection_size,</div>
<div class="line"><span class="lineno">  516</span>             iou_threshold=iou_thresh,</div>
<div class="line"><span class="lineno">  517</span>             score_threshold=score_thresh)</div>
<div class="line"><span class="lineno">  518</span>        nms_result = box_list_ops.gather(boxlist_and_class_scores,</div>
<div class="line"><span class="lineno">  519</span>                                         selected_indices)</div>
<div class="line"><span class="lineno">  520</span>        selected_scores = nms_result.get_field(fields.BoxListFields.scores)</div>
<div class="line"><span class="lineno">  521</span>      <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  522</span>        max_selection_size = tf.minimum(max_size_per_class,</div>
<div class="line"><span class="lineno">  523</span>                                        boxlist_and_class_scores.num_boxes())</div>
<div class="line"><span class="lineno">  524</span>        <span class="keywordflow">if</span> (hasattr(tf.image, <span class="stringliteral">&#39;non_max_suppression_with_scores&#39;</span>) <span class="keywordflow">and</span></div>
<div class="line"><span class="lineno">  525</span>            tf.compat.forward_compatible(2019, 6, 6)):</div>
<div class="line"><span class="lineno">  526</span>          (selected_indices, selected_scores</div>
<div class="line"><span class="lineno">  527</span>          ) = tf.image.non_max_suppression_with_scores(</div>
<div class="line"><span class="lineno">  528</span>              boxlist_and_class_scores.get(),</div>
<div class="line"><span class="lineno">  529</span>              boxlist_and_class_scores.get_field(fields.BoxListFields.scores),</div>
<div class="line"><span class="lineno">  530</span>              max_selection_size,</div>
<div class="line"><span class="lineno">  531</span>              iou_threshold=iou_thresh,</div>
<div class="line"><span class="lineno">  532</span>              score_threshold=score_thresh,</div>
<div class="line"><span class="lineno">  533</span>              soft_nms_sigma=soft_nms_sigma)</div>
<div class="line"><span class="lineno">  534</span>          num_valid_nms_boxes = tf.shape(selected_indices)[0]</div>
<div class="line"><span class="lineno">  535</span>          selected_indices = tf.concat(</div>
<div class="line"><span class="lineno">  536</span>              [selected_indices,</div>
<div class="line"><span class="lineno">  537</span>               tf.zeros(max_selection_size-num_valid_nms_boxes, tf.int32)], 0)</div>
<div class="line"><span class="lineno">  538</span>          selected_scores = tf.concat(</div>
<div class="line"><span class="lineno">  539</span>              [selected_scores,</div>
<div class="line"><span class="lineno">  540</span>               tf.zeros(max_selection_size-num_valid_nms_boxes,</div>
<div class="line"><span class="lineno">  541</span>                        tf.float32)], -1)</div>
<div class="line"><span class="lineno">  542</span>          nms_result = box_list_ops.gather(boxlist_and_class_scores,</div>
<div class="line"><span class="lineno">  543</span>                                           selected_indices)</div>
<div class="line"><span class="lineno">  544</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  545</span>          <span class="keywordflow">if</span> soft_nms_sigma != 0:</div>
<div class="line"><span class="lineno">  546</span>            <span class="keywordflow">raise</span> ValueError(<span class="stringliteral">&#39;Soft NMS not supported in current TF version!&#39;</span>)</div>
<div class="line"><span class="lineno">  547</span>          selected_indices = tf.image.non_max_suppression(</div>
<div class="line"><span class="lineno">  548</span>              boxlist_and_class_scores.get(),</div>
<div class="line"><span class="lineno">  549</span>              boxlist_and_class_scores.get_field(fields.BoxListFields.scores),</div>
<div class="line"><span class="lineno">  550</span>              max_selection_size,</div>
<div class="line"><span class="lineno">  551</span>              iou_threshold=iou_thresh,</div>
<div class="line"><span class="lineno">  552</span>              score_threshold=score_thresh)</div>
<div class="line"><span class="lineno">  553</span>          num_valid_nms_boxes = tf.shape(selected_indices)[0]</div>
<div class="line"><span class="lineno">  554</span>          selected_indices = tf.concat(</div>
<div class="line"><span class="lineno">  555</span>              [selected_indices,</div>
<div class="line"><span class="lineno">  556</span>               tf.zeros(max_selection_size-num_valid_nms_boxes, tf.int32)], 0)</div>
<div class="line"><span class="lineno">  557</span>          nms_result = box_list_ops.gather(boxlist_and_class_scores,</div>
<div class="line"><span class="lineno">  558</span>                                           selected_indices)</div>
<div class="line"><span class="lineno">  559</span>          selected_scores = nms_result.get_field(fields.BoxListFields.scores)</div>
<div class="line"><span class="lineno">  560</span>      <span class="comment"># Make the scores -1 for invalid boxes.</span></div>
<div class="line"><span class="lineno">  561</span>      valid_nms_boxes_indices = tf.less(</div>
<div class="line"><span class="lineno">  562</span>          tf.range(max_selection_size), num_valid_nms_boxes)</div>
<div class="line"><span class="lineno">  563</span> </div>
<div class="line"><span class="lineno">  564</span>      nms_result.add_field(</div>
<div class="line"><span class="lineno">  565</span>          fields.BoxListFields.scores,</div>
<div class="line"><span class="lineno">  566</span>          tf.where(valid_nms_boxes_indices,</div>
<div class="line"><span class="lineno">  567</span>                   selected_scores, -1*tf.ones(max_selection_size)))</div>
<div class="line"><span class="lineno">  568</span>      num_valid_nms_boxes_cumulative += num_valid_nms_boxes</div>
<div class="line"><span class="lineno">  569</span> </div>
<div class="line"><span class="lineno">  570</span>      nms_result.add_field(</div>
<div class="line"><span class="lineno">  571</span>          fields.BoxListFields.classes, (tf.zeros_like(</div>
<div class="line"><span class="lineno">  572</span>              nms_result.get_field(fields.BoxListFields.scores)) + class_idx))</div>
<div class="line"><span class="lineno">  573</span>      selected_boxes_list.append(nms_result)</div>
<div class="line"><span class="lineno">  574</span>    selected_boxes = box_list_ops.concatenate(selected_boxes_list)</div>
<div class="line"><span class="lineno">  575</span>    sorted_boxes = box_list_ops.sort_by_field(selected_boxes,</div>
<div class="line"><span class="lineno">  576</span>                                              fields.BoxListFields.scores)</div>
<div class="line"><span class="lineno">  577</span>    <span class="keywordflow">if</span> clip_window <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  578</span>      <span class="comment"># When pad_to_max_output_size is False, it prunes the boxes with zero</span></div>
<div class="line"><span class="lineno">  579</span>      <span class="comment"># area.</span></div>
<div class="line"><span class="lineno">  580</span>      sorted_boxes, num_valid_nms_boxes_cumulative = _clip_window_prune_boxes(</div>
<div class="line"><span class="lineno">  581</span>          sorted_boxes, clip_window, pad_to_max_output_size,</div>
<div class="line"><span class="lineno">  582</span>          change_coordinate_frame)</div>
<div class="line"><span class="lineno">  583</span> </div>
<div class="line"><span class="lineno">  584</span>    <span class="keywordflow">if</span> max_total_size:</div>
<div class="line"><span class="lineno">  585</span>      max_total_size = tf.minimum(max_total_size, sorted_boxes.num_boxes())</div>
<div class="line"><span class="lineno">  586</span>      sorted_boxes = box_list_ops.gather(sorted_boxes, tf.range(max_total_size))</div>
<div class="line"><span class="lineno">  587</span>      num_valid_nms_boxes_cumulative = tf.where(</div>
<div class="line"><span class="lineno">  588</span>          max_total_size &gt; num_valid_nms_boxes_cumulative,</div>
<div class="line"><span class="lineno">  589</span>          num_valid_nms_boxes_cumulative, max_total_size)</div>
<div class="line"><span class="lineno">  590</span>    <span class="comment"># Select only the valid boxes if pad_to_max_output_size is False.</span></div>
<div class="line"><span class="lineno">  591</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> pad_to_max_output_size:</div>
<div class="line"><span class="lineno">  592</span>      sorted_boxes = box_list_ops.gather(</div>
<div class="line"><span class="lineno">  593</span>          sorted_boxes, tf.range(num_valid_nms_boxes_cumulative))</div>
<div class="line"><span class="lineno">  594</span> </div>
<div class="line"><span class="lineno">  595</span>    <span class="keywordflow">return</span> sorted_boxes, num_valid_nms_boxes_cumulative</div>
<div class="line"><span class="lineno">  596</span> </div>
<div class="line"><span class="lineno">  597</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing_a58b5edbb0a9b33010aae722c82050006_cgraph.png" border="0" usemap="#ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a58b5edbb0a9b33010aae722c82050006_cgraph" alt=""/></div>
<map name="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a58b5edbb0a9b33010aae722c82050006_cgraph" id="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a58b5edbb0a9b33010aae722c82050006_cgraph">
<area shape="rect" title=" " alt="" coords="5,84,169,139"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#aa52731af79c1f94bed50a291b05060ce" title=" " alt="" coords="235,5,407,60"/>
<area shape="poly" title=" " alt="" coords="169,81,226,62,227,67,170,86"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a1def87e6a8b8fad1ca56f6b3985f69d1" title=" " alt="" coords="227,84,415,139"/>
<area shape="poly" title=" " alt="" coords="170,109,214,109,214,114,170,114"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#afdb21198d6a9443ec277742c9938612b" title=" " alt="" coords="217,163,425,217"/>
<area shape="poly" title=" " alt="" coords="170,136,227,156,226,161,169,141"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a612ecf46d8c84ee42d5fb8cce480d2c5" title=" " alt="" coords="473,170,637,210"/>
<area shape="poly" title=" " alt="" coords="425,187,460,187,460,193,425,193"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing_a58b5edbb0a9b33010aae722c82050006_icgraph.png" border="0" usemap="#ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a58b5edbb0a9b33010aae722c82050006_icgraph" alt=""/></div>
<map name="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a58b5edbb0a9b33010aae722c82050006_icgraph" id="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_a58b5edbb0a9b33010aae722c82050006_icgraph">
<area shape="rect" title=" " alt="" coords="248,5,412,60"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a766a437a0d89839c4e6828b54205d000" title=" " alt="" coords="5,5,200,60"/>
<area shape="poly" title=" " alt="" coords="234,35,200,35,200,30,234,30"/>
</map>
</div>

</div>
</div>
<a id="afdb21198d6a9443ec277742c9938612b" name="afdb21198d6a9443ec277742c9938612b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdb21198d6a9443ec277742c9938612b">&#9670;&#160;</a></span>partitioned_non_max_suppression_padded()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.core.post_processing.partitioned_non_max_suppression_padded </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>boxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>scores</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>max_output_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iou_threshold</em> = <code>0.5</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>score_threshold</em> = <code>float('-inf')</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">A tiled version of [`tf.image.non_max_suppression_padded`](https://www.tensorflow.org/api_docs/python/tf/image/non_max_suppression_padded).

The overall design of the algorithm is to handle boxes tile-by-tile:

boxes = boxes.pad_to_multiple_of(tile_size)
num_tiles = len(boxes) // tile_size
output_boxes = []
for i in range(num_tiles):
  box_tile = boxes[i*tile_size : (i+1)*tile_size]
  for j in range(i - 1):
    suppressing_tile = boxes[j*tile_size : (j+1)*tile_size]
    iou = batch_iou(box_tile, suppressing_tile)
    # if the box is suppressed in iou, clear it to a dot
    box_tile *= _update_boxes(iou)
  # Iteratively handle the diagonal tile.
  iou = _box_overlap(box_tile, box_tile)
  iou_changed = True
  while iou_changed:
    # boxes that are not suppressed by anything else
    suppressing_boxes = _get_suppressing_boxes(iou)
    # boxes that are suppressed by suppressing_boxes
    suppressed_boxes = _get_suppressed_boxes(iou, suppressing_boxes)
    # clear iou to 0 for boxes that are suppressed, as they cannot be used
    # to suppress other boxes any more
    new_iou = _clear_iou(iou, suppressed_boxes)
    iou_changed = (new_iou != iou)
    iou = new_iou
  # remaining boxes that can still suppress others, are selected boxes.
  output_boxes.append(_get_suppressing_boxes(iou))
  if len(output_boxes) &gt;= max_output_size:
    break

Args:
  boxes: A 2-D float `Tensor` of shape `[num_boxes, 4]`.
  scores: A 1-D float `Tensor` of shape `[num_boxes]` representing a single
    score corresponding to each box (each row of boxes).
  max_output_size: a scalar integer `Tensor` representing the maximum number
    of boxes to be selected by non max suppression.
  iou_threshold: a float representing the threshold for deciding whether boxes
    overlap too much with respect to IOU.
  score_threshold: A float representing the threshold for deciding when to
    remove boxes based on score.

Returns:
  selected_indices: a tensor of shape [anchors].
  num_valid_boxes: a scalar int tensor.
  nms_proposals: a tensor with a shape of [anchors, 4]. It has
    same dtype as input boxes.
  nms_scores: a tensor with a shape of [anchors]. It has same
    dtype as input scores.
  argsort_ids: a tensor of shape [anchors], mapping from input order of boxes
    to output order of boxes.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d1/d53/post__processing_8py_source.html#l00196">196</a> of file <a class="el" href="../../d1/d53/post__processing_8py_source.html">post_processing.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  200</span>                                           score_threshold=float(<span class="stringliteral">&#39;-inf&#39;</span>)):</div>
<div class="line"><span class="lineno">  201</span>  <span class="stringliteral">&quot;&quot;&quot;A tiled version of [`tf.image.non_max_suppression_padded`](https://www.tensorflow.org/api_docs/python/tf/image/non_max_suppression_padded).</span></div>
<div class="line"><span class="lineno">  202</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  203</span><span class="stringliteral">  The overall design of the algorithm </span><span class="keywordflow">is</span> to handle boxes tile-by-tile:</div>
<div class="line"><span class="lineno">  204</span> </div>
<div class="line"><span class="lineno">  205</span>  boxes = boxes.pad_to_multiple_of(tile_size)</div>
<div class="line"><span class="lineno">  206</span>  num_tiles = len(boxes) // tile_size</div>
<div class="line"><span class="lineno">  207</span>  output_boxes = []</div>
<div class="line"><span class="lineno">  208</span>  <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(num_tiles):</div>
<div class="line"><span class="lineno">  209</span>    box_tile = boxes[i*tile_size : (i+1)*tile_size]</div>
<div class="line"><span class="lineno">  210</span>    <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(i - 1):</div>
<div class="line"><span class="lineno">  211</span>      suppressing_tile = boxes[j*tile_size : (j+1)*tile_size]</div>
<div class="line"><span class="lineno">  212</span>      iou = batch_iou(box_tile, suppressing_tile)</div>
<div class="line"><span class="lineno">  213</span>      <span class="comment"># if the box is suppressed in iou, clear it to a dot</span></div>
<div class="line"><span class="lineno">  214</span>      box_tile *= _update_boxes(iou)</div>
<div class="line"><span class="lineno">  215</span>    <span class="comment"># Iteratively handle the diagonal tile.</span></div>
<div class="line"><span class="lineno">  216</span>    iou = _box_overlap(box_tile, box_tile)</div>
<div class="line"><span class="lineno">  217</span>    iou_changed = <span class="keyword">True</span></div>
<div class="line"><span class="lineno">  218</span>    <span class="keywordflow">while</span> iou_changed:</div>
<div class="line"><span class="lineno">  219</span>      <span class="comment"># boxes that are not suppressed by anything else</span></div>
<div class="line"><span class="lineno">  220</span>      suppressing_boxes = _get_suppressing_boxes(iou)</div>
<div class="line"><span class="lineno">  221</span>      <span class="comment"># boxes that are suppressed by suppressing_boxes</span></div>
<div class="line"><span class="lineno">  222</span>      suppressed_boxes = _get_suppressed_boxes(iou, suppressing_boxes)</div>
<div class="line"><span class="lineno">  223</span>      <span class="comment"># clear iou to 0 for boxes that are suppressed, as they cannot be used</span></div>
<div class="line"><span class="lineno">  224</span>      <span class="comment"># to suppress other boxes any more</span></div>
<div class="line"><span class="lineno">  225</span>      new_iou = _clear_iou(iou, suppressed_boxes)</div>
<div class="line"><span class="lineno">  226</span>      iou_changed = (new_iou != iou)</div>
<div class="line"><span class="lineno">  227</span>      iou = new_iou</div>
<div class="line"><span class="lineno">  228</span>    <span class="comment"># remaining boxes that can still suppress others, are selected boxes.</span></div>
<div class="line"><span class="lineno">  229</span>    output_boxes.append(_get_suppressing_boxes(iou))</div>
<div class="line"><span class="lineno">  230</span>    <span class="keywordflow">if</span> len(output_boxes) &gt;= max_output_size:</div>
<div class="line"><span class="lineno">  231</span>      <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno">  232</span> </div>
<div class="line"><span class="lineno">  233</span>  Args:</div>
<div class="line"><span class="lineno">  234</span>    boxes: A 2-D float `Tensor` of shape `[num_boxes, 4]`.</div>
<div class="line"><span class="lineno">  235</span>    scores: A 1-D float `Tensor` of shape `[num_boxes]` representing a single</div>
<div class="line"><span class="lineno">  236</span>      score corresponding to each box (each row of boxes).</div>
<div class="line"><span class="lineno">  237</span>    max_output_size: a scalar integer `Tensor` representing the maximum number</div>
<div class="line"><span class="lineno">  238</span>      of boxes to be selected by non max suppression.</div>
<div class="line"><span class="lineno">  239</span>    iou_threshold: a float representing the threshold <span class="keywordflow">for</span> deciding whether boxes</div>
<div class="line"><span class="lineno">  240</span>      overlap too much <span class="keyword">with</span> respect to IOU.</div>
<div class="line"><span class="lineno">  241</span>    score_threshold: A float representing the threshold <span class="keywordflow">for</span> deciding when to</div>
<div class="line"><span class="lineno">  242</span>      remove boxes based on score.</div>
<div class="line"><span class="lineno">  243</span> </div>
<div class="line"><span class="lineno">  244</span>  Returns:</div>
<div class="line"><span class="lineno">  245</span>    selected_indices: a tensor of shape [anchors].</div>
<div class="line"><span class="lineno">  246</span>    num_valid_boxes: a scalar int tensor.</div>
<div class="line"><span class="lineno">  247</span>    nms_proposals: a tensor <span class="keyword">with</span> a shape of [anchors, 4]. It has</div>
<div class="line"><span class="lineno">  248</span>      same dtype <span class="keyword">as</span> input boxes.</div>
<div class="line"><span class="lineno">  249</span>    nms_scores: a tensor <span class="keyword">with</span> a shape of [anchors]. It has same</div>
<div class="line"><span class="lineno">  250</span>      dtype <span class="keyword">as</span> input scores.</div>
<div class="line"><span class="lineno">  251</span>    argsort_ids: a tensor of shape [anchors], mapping <span class="keyword">from</span> input order of boxes</div>
<div class="line"><span class="lineno">  252</span>      to output order of boxes.</div>
<div class="line"><span class="lineno">  253</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  254</span><span class="stringliteral">  num_boxes = tf.shape(boxes)[0]</span></div>
<div class="line"><span class="lineno">  255</span><span class="stringliteral">  pad = tf.cast(</span></div>
<div class="line"><span class="lineno">  256</span><span class="stringliteral">      tf.ceil(tf.cast(num_boxes, tf.float32) / _NMS_TILE_SIZE),</span></div>
<div class="line"><span class="lineno">  257</span><span class="stringliteral">      tf.int32) * _NMS_TILE_SIZE - num_boxes</span></div>
<div class="line"><span class="lineno">  258</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  259</span><span class="stringliteral">  scores, argsort_ids = tf.nn.top_k(scores, k=num_boxes, sorted=</span><span class="keyword">True</span>)</div>
<div class="line"><span class="lineno">  260</span>  boxes = tf.gather(boxes, argsort_ids)</div>
<div class="line"><span class="lineno">  261</span>  num_boxes = tf.shape(boxes)[0]</div>
<div class="line"><span class="lineno">  262</span>  num_boxes += pad</div>
<div class="line"><span class="lineno">  263</span>  boxes = tf.pad(</div>
<div class="line"><span class="lineno">  264</span>      tf.cast(boxes, tf.float32), [[0, pad], [0, 0]], constant_values=-1)</div>
<div class="line"><span class="lineno">  265</span>  scores = tf.pad(tf.cast(scores, tf.float32), [[0, pad]])</div>
<div class="line"><span class="lineno">  266</span> </div>
<div class="line"><span class="lineno">  267</span>  <span class="comment"># mask boxes to -1 by score threshold</span></div>
<div class="line"><span class="lineno">  268</span>  scores_mask = tf.expand_dims(</div>
<div class="line"><span class="lineno">  269</span>      tf.cast(scores &gt; score_threshold, boxes.dtype), axis=1)</div>
<div class="line"><span class="lineno">  270</span>  boxes = ((boxes + 1.) * scores_mask) - 1.</div>
<div class="line"><span class="lineno">  271</span> </div>
<div class="line"><span class="lineno">  272</span>  boxes = tf.expand_dims(boxes, axis=0)</div>
<div class="line"><span class="lineno">  273</span>  scores = tf.expand_dims(scores, axis=0)</div>
<div class="line"><span class="lineno">  274</span> </div>
<div class="line"><span class="lineno">  275</span>  <span class="keyword">def </span>_loop_cond(unused_boxes, unused_threshold, output_size, idx):</div>
<div class="line"><span class="lineno">  276</span>    <span class="keywordflow">return</span> tf.logical_and(</div>
<div class="line"><span class="lineno">  277</span>        tf.reduce_min(output_size) &lt; max_output_size,</div>
<div class="line"><span class="lineno">  278</span>        idx &lt; num_boxes // _NMS_TILE_SIZE)</div>
<div class="line"><span class="lineno">  279</span> </div>
<div class="line"><span class="lineno">  280</span>  selected_boxes, _, output_size, _ = tf.while_loop(</div>
<div class="line"><span class="lineno">  281</span>      _loop_cond, _suppression_loop_body,</div>
<div class="line"><span class="lineno">  282</span>      [boxes, iou_threshold,</div>
<div class="line"><span class="lineno">  283</span>       tf.zeros([1], tf.int32),</div>
<div class="line"><span class="lineno">  284</span>       tf.constant(0)])</div>
<div class="line"><span class="lineno">  285</span>  idx = num_boxes - tf.cast(</div>
<div class="line"><span class="lineno">  286</span>      tf.nn.top_k(</div>
<div class="line"><span class="lineno">  287</span>          tf.cast(tf.reduce_any(selected_boxes &gt; 0, [2]), tf.int32) *</div>
<div class="line"><span class="lineno">  288</span>          tf.expand_dims(tf.range(num_boxes, 0, -1), 0), max_output_size)[0],</div>
<div class="line"><span class="lineno">  289</span>      tf.int32)</div>
<div class="line"><span class="lineno">  290</span>  idx = tf.minimum(idx, num_boxes - 1 - pad)</div>
<div class="line"><span class="lineno">  291</span>  idx = tf.reshape(idx + tf.reshape(tf.range(1) * num_boxes, [-1, 1]), [-1])</div>
<div class="line"><span class="lineno">  292</span>  num_valid_boxes = tf.reduce_sum(output_size)</div>
<div class="line"><span class="lineno">  293</span>  <span class="keywordflow">return</span> (idx, num_valid_boxes, tf.reshape(boxes, [-1, 4]),</div>
<div class="line"><span class="lineno">  294</span>          tf.reshape(scores, [-1]), argsort_ids)</div>
<div class="line"><span class="lineno">  295</span> </div>
<div class="line"><span class="lineno">  296</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing_afdb21198d6a9443ec277742c9938612b_cgraph.png" border="0" usemap="#ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_afdb21198d6a9443ec277742c9938612b_cgraph" alt=""/></div>
<map name="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_afdb21198d6a9443ec277742c9938612b_cgraph" id="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_afdb21198d6a9443ec277742c9938612b_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,213,60"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a612ecf46d8c84ee42d5fb8cce480d2c5" title=" " alt="" coords="261,13,425,53"/>
<area shape="poly" title=" " alt="" coords="213,30,248,30,248,35,213,35"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing_afdb21198d6a9443ec277742c9938612b_icgraph.png" border="0" usemap="#ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_afdb21198d6a9443ec277742c9938612b_icgraph" alt=""/></div>
<map name="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_afdb21198d6a9443ec277742c9938612b_icgraph" id="ad2/de3/namespacedetection__utils_1_1core_1_1post__processing_afdb21198d6a9443ec277742c9938612b_icgraph">
<area shape="rect" title=" " alt="" coords="479,45,687,100"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a0d33e143f24dc55fe43809b17882217d" title=" " alt="" coords="248,5,431,60"/>
<area shape="poly" title=" " alt="" coords="465,56,430,50,431,45,466,51"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a58b5edbb0a9b33010aae722c82050006" title=" " alt="" coords="257,84,421,139"/>
<area shape="poly" title=" " alt="" coords="466,94,422,101,421,96,465,89"/>
<area shape="rect" href="../../d2/de3/namespacedetection__utils_1_1core_1_1post__processing.html#a766a437a0d89839c4e6828b54205d000" title=" " alt="" coords="5,45,200,100"/>
<area shape="poly" title=" " alt="" coords="235,53,201,59,200,54,234,48"/>
<area shape="poly" title=" " alt="" coords="243,98,200,91,201,86,244,93"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="aaa179acbbda14bd507b72a2fb36b0fef" name="aaa179acbbda14bd507b72a2fb36b0fef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaa179acbbda14bd507b72a2fb36b0fef">&#9670;&#160;</a></span>_NMS_TILE_SIZE</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int detection_utils.core.post_processing._NMS_TILE_SIZE = 512</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d53/post__processing_8py_source.html#l00032">32</a> of file <a class="el" href="../../d1/d53/post__processing_8py_source.html">post_processing.py</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
