<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RESIIST: detection_utils.utils.spatial_transform_ops Namespace Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">RESIIST
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d8/d97/namespacedetection__utils.html">detection_utils</a></li><li class="navelem"><a class="el" href="../../d5/d2b/namespacedetection__utils_1_1utils.html">utils</a></li><li class="navelem"><a class="el" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html">spatial_transform_ops</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">detection_utils.utils.spatial_transform_ops Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:abe997a2270fa0be3f0b735de66b75f0a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#abe997a2270fa0be3f0b735de66b75f0a">_coordinate_vector_1d</a> (start, end, size, align_endpoints)</td></tr>
<tr class="separator:abe997a2270fa0be3f0b735de66b75f0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b3b992126c8aa180645bbdc91ab2ab4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a5b3b992126c8aa180645bbdc91ab2ab4">box_grid_coordinate_vectors</a> (boxes, size_y, size_x, align_corners=False)</td></tr>
<tr class="separator:a5b3b992126c8aa180645bbdc91ab2ab4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a6d6d840fa93e0b16a80e70305e1a28"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a6a6d6d840fa93e0b16a80e70305e1a28">feature_grid_coordinate_vectors</a> (box_grid_y, box_grid_x)</td></tr>
<tr class="separator:a6a6d6d840fa93e0b16a80e70305e1a28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3291d38759256f56082ba68c15ee3729"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a3291d38759256f56082ba68c15ee3729">_valid_indicator</a> (feature_grid_y, feature_grid_x, true_feature_shapes)</td></tr>
<tr class="separator:a3291d38759256f56082ba68c15ee3729"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a4d6db5a345f555ce10b6302410b569"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a3a4d6db5a345f555ce10b6302410b569">ravel_indices</a> (feature_grid_y, feature_grid_x, num_levels, height, width, box_levels)</td></tr>
<tr class="separator:a3a4d6db5a345f555ce10b6302410b569"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b2fa444b108acb7b4b0941ff26e5337"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a0b2fa444b108acb7b4b0941ff26e5337">pad_to_max_size</a> (features)</td></tr>
<tr class="separator:a0b2fa444b108acb7b4b0941ff26e5337"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1bc7d27a65ee67f70cac9d685069f3c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#ae1bc7d27a65ee67f70cac9d685069f3c">_gather_valid_indices</a> (tensor, indices, padding_value=0.0)</td></tr>
<tr class="separator:ae1bc7d27a65ee67f70cac9d685069f3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae321d4963245a9cc5577f5f7870fd967"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#ae321d4963245a9cc5577f5f7870fd967">multilevel_roi_align</a> (features, boxes, box_levels, output_size, num_samples_per_cell_y=1, num_samples_per_cell_x=1, align_corners=False, extrapolation_value=0.0, scope=None)</td></tr>
<tr class="separator:ae321d4963245a9cc5577f5f7870fd967"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a40d33cf1473f2a41b951a05f2576f5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a2a40d33cf1473f2a41b951a05f2576f5">native_crop_and_resize</a> (image, boxes, crop_size, scope=None)</td></tr>
<tr class="separator:a2a40d33cf1473f2a41b951a05f2576f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58306e39931ae17ac983f67617fcd07b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a58306e39931ae17ac983f67617fcd07b">matmul_crop_and_resize</a> (image, boxes, crop_size, extrapolation_value=0.0, scope=None)</td></tr>
<tr class="separator:a58306e39931ae17ac983f67617fcd07b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Spatial transformation ops like RoIAlign, CropAndResize.</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="abe997a2270fa0be3f0b735de66b75f0a" name="abe997a2270fa0be3f0b735de66b75f0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe997a2270fa0be3f0b735de66b75f0a">&#9670;&#160;</a></span>_coordinate_vector_1d()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.utils.spatial_transform_ops._coordinate_vector_1d </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>align_endpoints</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Generates uniformly spaced coordinate vector.

Args:
  start: A float tensor of shape [batch, num_boxes] indicating start values.
  end: A float tensor of shape [batch, num_boxes] indicating end values.
  size: Number of points in coordinate vector.
  align_endpoints: Whether to align first and last points exactly to
    endpoints.

Returns:
  A 3D float tensor of shape [batch, num_boxes, size] containing grid
  coordinates.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html#l00024">24</a> of file <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html">spatial_transform_ops.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   24</span><span class="keyword">def </span>_coordinate_vector_1d(start, end, size, align_endpoints):</div>
<div class="line"><span class="lineno">   25</span>  <span class="stringliteral">&quot;&quot;&quot;Generates uniformly spaced coordinate vector.</span></div>
<div class="line"><span class="lineno">   26</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   27</span><span class="stringliteral">  Args:</span></div>
<div class="line"><span class="lineno">   28</span><span class="stringliteral">    start: A float tensor of shape [batch, num_boxes] indicating start values.</span></div>
<div class="line"><span class="lineno">   29</span><span class="stringliteral">    end: A float tensor of shape [batch, num_boxes] indicating end values.</span></div>
<div class="line"><span class="lineno">   30</span><span class="stringliteral">    size: Number of points </span><span class="keywordflow">in</span> coordinate vector.</div>
<div class="line"><span class="lineno">   31</span>    align_endpoints: Whether to align first <span class="keywordflow">and</span> last points exactly to</div>
<div class="line"><span class="lineno">   32</span>      endpoints.</div>
<div class="line"><span class="lineno">   33</span> </div>
<div class="line"><span class="lineno">   34</span>  Returns:</div>
<div class="line"><span class="lineno">   35</span>    A 3D float tensor of shape [batch, num_boxes, size] containing grid</div>
<div class="line"><span class="lineno">   36</span>    coordinates.</div>
<div class="line"><span class="lineno">   37</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   38</span><span class="stringliteral">  start = tf.expand_dims(start, -1)</span></div>
<div class="line"><span class="lineno">   39</span><span class="stringliteral">  end = tf.expand_dims(end, -1)</span></div>
<div class="line"><span class="lineno">   40</span><span class="stringliteral">  length = end - start</span></div>
<div class="line"><span class="lineno">   41</span><span class="stringliteral">  </span><span class="keywordflow">if</span> align_endpoints:</div>
<div class="line"><span class="lineno">   42</span>    relative_grid_spacing = tf.linspace(0.0, 1.0, size)</div>
<div class="line"><span class="lineno">   43</span>    offset = 0 <span class="keywordflow">if</span> size &gt; 1 <span class="keywordflow">else</span> length / 2</div>
<div class="line"><span class="lineno">   44</span>  <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">   45</span>    relative_grid_spacing = tf.linspace(0.0, 1.0, size + 1)[:-1]</div>
<div class="line"><span class="lineno">   46</span>    offset = length / (2 * size)</div>
<div class="line"><span class="lineno">   47</span>  relative_grid_spacing = tf.reshape(relative_grid_spacing, [1, 1, size])</div>
<div class="line"><span class="lineno">   48</span>  relative_grid_spacing = tf.cast(relative_grid_spacing, dtype=start.dtype)</div>
<div class="line"><span class="lineno">   49</span>  absolute_grid = start + offset + relative_grid_spacing * length</div>
<div class="line"><span class="lineno">   50</span>  <span class="keywordflow">return</span> absolute_grid</div>
<div class="line"><span class="lineno">   51</span> </div>
<div class="line"><span class="lineno">   52</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_abe997a2270fa0be3f0b735de66b75f0a_icgraph.png" border="0" usemap="#ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_abe997a2270fa0be3f0b735de66b75f0a_icgraph" alt=""/></div>
<map name="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_abe997a2270fa0be3f0b735de66b75f0a_icgraph" id="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_abe997a2270fa0be3f0b735de66b75f0a_icgraph">
<area shape="rect" title=" " alt="" coords="747,5,929,60"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a5b3b992126c8aa180645bbdc91ab2ab4" title=" " alt="" coords="468,5,699,60"/>
<area shape="poly" title=" " alt="" coords="733,35,699,35,699,30,733,30"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#ae321d4963245a9cc5577f5f7870fd967" title=" " alt="" coords="244,5,420,60"/>
<area shape="poly" title=" " alt="" coords="454,35,420,35,420,30,454,30"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a58306e39931ae17ac983f67617fcd07b" title=" " alt="" coords="5,5,196,60"/>
<area shape="poly" title=" " alt="" coords="230,35,196,35,196,30,230,30"/>
</map>
</div>

</div>
</div>
<a id="ae1bc7d27a65ee67f70cac9d685069f3c" name="ae1bc7d27a65ee67f70cac9d685069f3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae1bc7d27a65ee67f70cac9d685069f3c">&#9670;&#160;</a></span>_gather_valid_indices()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.utils.spatial_transform_ops._gather_valid_indices </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>tensor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>indices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>padding_value</em> = <code>0.0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Gather values for valid indices.

TODO(rathodv): We can't use ops.gather_with_padding_values due to cyclic
dependency. Start using it after migrating all users of spatial ops to import
this module directly rather than util/ops.py

Args:
  tensor: A tensor to gather valid values from.
  indices: A 1-D int32 tensor containing indices along axis 0 of `tensor`.
    Invalid indices must be marked with -1.
  padding_value: Value to return for invalid indices.

Returns:
  A tensor sliced based on indices. For indices that are equal to -1, returns
  rows of padding value.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html#l00235">235</a> of file <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html">spatial_transform_ops.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  235</span><span class="keyword">def </span>_gather_valid_indices(tensor, indices, padding_value=0.0):</div>
<div class="line"><span class="lineno">  236</span>  <span class="stringliteral">&quot;&quot;&quot;Gather values for valid indices.</span></div>
<div class="line"><span class="lineno">  237</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  238</span><span class="stringliteral">  TODO(rathodv): We can&#39;t use ops.gather_with_padding_values due to cyclic</span></div>
<div class="line"><span class="lineno">  239</span><span class="stringliteral">  dependency. Start using it after migrating all users of spatial ops to </span><span class="keyword">import</span></div>
<div class="line"><span class="lineno">  240</span>  this module directly rather than util/ops.py</div>
<div class="line"><span class="lineno">  241</span> </div>
<div class="line"><span class="lineno">  242</span>  Args:</div>
<div class="line"><span class="lineno">  243</span>    tensor: A tensor to gather valid values <span class="keyword">from</span>.</div>
<div class="line"><span class="lineno">  244</span>    indices: A 1-D int32 tensor containing indices along axis 0 of `tensor`.</div>
<div class="line"><span class="lineno">  245</span>      Invalid indices must be marked <span class="keyword">with</span> -1.</div>
<div class="line"><span class="lineno">  246</span>    padding_value: Value to <span class="keywordflow">return</span> <span class="keywordflow">for</span> invalid indices.</div>
<div class="line"><span class="lineno">  247</span> </div>
<div class="line"><span class="lineno">  248</span>  Returns:</div>
<div class="line"><span class="lineno">  249</span>    A tensor sliced based on indices. For indices that are equal to -1, returns</div>
<div class="line"><span class="lineno">  250</span>    rows of padding value.</div>
<div class="line"><span class="lineno">  251</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  252</span><span class="stringliteral">  padded_tensor = tf.concat(</span></div>
<div class="line"><span class="lineno">  253</span><span class="stringliteral">      [</span></div>
<div class="line"><span class="lineno">  254</span><span class="stringliteral">          padding_value *</span></div>
<div class="line"><span class="lineno">  255</span><span class="stringliteral">          tf.ones([1, tf.shape(tensor)[-1]], dtype=tensor.dtype), tensor</span></div>
<div class="line"><span class="lineno">  256</span><span class="stringliteral">      ],</span></div>
<div class="line"><span class="lineno">  257</span><span class="stringliteral">      axis=0,</span></div>
<div class="line"><span class="lineno">  258</span><span class="stringliteral">  )</span></div>
<div class="line"><span class="lineno">  259</span><span class="stringliteral">  </span><span class="comment"># tf.concat gradient op uses tf.where(condition) (which is not</span></div>
<div class="line"><span class="lineno">  260</span>  <span class="comment"># supported on TPU) when the inputs to it are tf.IndexedSlices instead of</span></div>
<div class="line"><span class="lineno">  261</span>  <span class="comment"># tf.Tensor. Since gradient op for tf.gather returns tf.IndexedSlices,</span></div>
<div class="line"><span class="lineno">  262</span>  <span class="comment"># we add a dummy op inbetween tf.concat and tf.gather to ensure tf.concat</span></div>
<div class="line"><span class="lineno">  263</span>  <span class="comment"># gradient function gets tf.Tensor inputs and not tf.IndexedSlices.</span></div>
<div class="line"><span class="lineno">  264</span>  padded_tensor *= 1.0</div>
<div class="line"><span class="lineno">  265</span>  <span class="keywordflow">return</span> tf.gather(padded_tensor, indices + 1)</div>
<div class="line"><span class="lineno">  266</span> </div>
<div class="line"><span class="lineno">  267</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_ae1bc7d27a65ee67f70cac9d685069f3c_icgraph.png" border="0" usemap="#ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_ae1bc7d27a65ee67f70cac9d685069f3c_icgraph" alt=""/></div>
<map name="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_ae1bc7d27a65ee67f70cac9d685069f3c_icgraph" id="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_ae1bc7d27a65ee67f70cac9d685069f3c_icgraph">
<area shape="rect" title=" " alt="" coords="468,5,659,60"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#ae321d4963245a9cc5577f5f7870fd967" title=" " alt="" coords="244,5,420,60"/>
<area shape="poly" title=" " alt="" coords="454,35,420,35,420,30,454,30"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a58306e39931ae17ac983f67617fcd07b" title=" " alt="" coords="5,5,196,60"/>
<area shape="poly" title=" " alt="" coords="230,35,196,35,196,30,230,30"/>
</map>
</div>

</div>
</div>
<a id="a3291d38759256f56082ba68c15ee3729" name="a3291d38759256f56082ba68c15ee3729"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3291d38759256f56082ba68c15ee3729">&#9670;&#160;</a></span>_valid_indicator()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.utils.spatial_transform_ops._valid_indicator </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>feature_grid_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>feature_grid_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>true_feature_shapes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<pre class="fragment">Computes a indicator vector for valid indices.

Computes an indicator vector which is true for points on feature map and
false for points off feature map.

Args:
  feature_grid_y: An int32 tensor of shape [batch, num_boxes, size_y]
    containing y coordinate vector.
  feature_grid_x: An int32 tensor of shape [batch, num_boxes, size_x]
    containing x coordinate vector.
  true_feature_shapes: A int32 tensor of shape [batch, num_boxes, 2]
    containing valid height and width of feature maps. Feature maps are
    assumed to be aligned to the left top corner.

Returns:
  indices: A 1D bool tensor indicating valid feature indices.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html#l00125">125</a> of file <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html">spatial_transform_ops.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  125</span><span class="keyword">def </span>_valid_indicator(feature_grid_y, feature_grid_x, true_feature_shapes):</div>
<div class="line"><span class="lineno">  126</span>  <span class="stringliteral">&quot;&quot;&quot;Computes a indicator vector for valid indices.</span></div>
<div class="line"><span class="lineno">  127</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  128</span><span class="stringliteral">  Computes an indicator vector which </span><span class="keywordflow">is</span> true <span class="keywordflow">for</span> points on feature map <span class="keywordflow">and</span></div>
<div class="line"><span class="lineno">  129</span>  false <span class="keywordflow">for</span> points off feature map.</div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>  Args:</div>
<div class="line"><span class="lineno">  132</span>    feature_grid_y: An int32 tensor of shape [batch, num_boxes, size_y]</div>
<div class="line"><span class="lineno">  133</span>      containing y coordinate vector.</div>
<div class="line"><span class="lineno">  134</span>    feature_grid_x: An int32 tensor of shape [batch, num_boxes, size_x]</div>
<div class="line"><span class="lineno">  135</span>      containing x coordinate vector.</div>
<div class="line"><span class="lineno">  136</span>    true_feature_shapes: A int32 tensor of shape [batch, num_boxes, 2]</div>
<div class="line"><span class="lineno">  137</span>      containing valid height <span class="keywordflow">and</span> width of feature maps. Feature maps are</div>
<div class="line"><span class="lineno">  138</span>      assumed to be aligned to the left top corner.</div>
<div class="line"><span class="lineno">  139</span> </div>
<div class="line"><span class="lineno">  140</span>  Returns:</div>
<div class="line"><span class="lineno">  141</span>    indices: A 1D bool tensor indicating valid feature indices.</div>
<div class="line"><span class="lineno">  142</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  143</span><span class="stringliteral">  height = tf.cast(true_feature_shapes[:, :, 0:1], dtype=feature_grid_y.dtype)</span></div>
<div class="line"><span class="lineno">  144</span><span class="stringliteral">  width = tf.cast(true_feature_shapes[:, :, 1:2], dtype=feature_grid_x.dtype)</span></div>
<div class="line"><span class="lineno">  145</span><span class="stringliteral">  valid_indicator = tf.logical_and(</span></div>
<div class="line"><span class="lineno">  146</span><span class="stringliteral">      tf.expand_dims(</span></div>
<div class="line"><span class="lineno">  147</span><span class="stringliteral">          tf.logical_and(feature_grid_y &gt;= 0, tf.less(feature_grid_y, height)),</span></div>
<div class="line"><span class="lineno">  148</span><span class="stringliteral">          3),</span></div>
<div class="line"><span class="lineno">  149</span><span class="stringliteral">      tf.expand_dims(</span></div>
<div class="line"><span class="lineno">  150</span><span class="stringliteral">          tf.logical_and(feature_grid_x &gt;= 0, tf.less(feature_grid_x, width)),</span></div>
<div class="line"><span class="lineno">  151</span><span class="stringliteral">          2))</span></div>
<div class="line"><span class="lineno">  152</span><span class="stringliteral">  </span><span class="keywordflow">return</span> tf.reshape(valid_indicator, [-1])</div>
<div class="line"><span class="lineno">  153</span> </div>
<div class="line"><span class="lineno">  154</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a3291d38759256f56082ba68c15ee3729_icgraph.png" border="0" usemap="#ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a3291d38759256f56082ba68c15ee3729_icgraph" alt=""/></div>
<map name="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a3291d38759256f56082ba68c15ee3729_icgraph" id="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a3291d38759256f56082ba68c15ee3729_icgraph">
<area shape="rect" title=" " alt="" coords="468,13,671,53"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#ae321d4963245a9cc5577f5f7870fd967" title=" " alt="" coords="244,5,420,60"/>
<area shape="poly" title=" " alt="" coords="454,35,420,35,420,30,454,30"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a58306e39931ae17ac983f67617fcd07b" title=" " alt="" coords="5,5,196,60"/>
<area shape="poly" title=" " alt="" coords="230,35,196,35,196,30,230,30"/>
</map>
</div>

</div>
</div>
<a id="a5b3b992126c8aa180645bbdc91ab2ab4" name="a5b3b992126c8aa180645bbdc91ab2ab4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5b3b992126c8aa180645bbdc91ab2ab4">&#9670;&#160;</a></span>box_grid_coordinate_vectors()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.utils.spatial_transform_ops.box_grid_coordinate_vectors </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>boxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>size_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>size_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>align_corners</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Generates coordinate vectors for a `size x size` grid in boxes.

Each box is subdivided uniformly into a grid consisting of size x size
rectangular cells. This function returns coordinate vectors describing
the center of each cell.

If `align_corners` is true, grid points are uniformly spread such that the
corner points on the grid exactly overlap corners of the boxes.

Note that output coordinates are expressed in the same coordinate frame as
input boxes.

Args:
  boxes: A float tensor of shape [batch, num_boxes, 4] containing boxes of the
    form [ymin, xmin, ymax, xmax].
  size_y: Size of the grid in y axis.
  size_x: Size of the grid in x axis.
  align_corners: Whether to align the corner grid points exactly with box
    corners.

Returns:
  box_grid_y: A float tensor of shape [batch, num_boxes, size_y] containing y
    coordinates for grid points.
  box_grid_x: A float tensor of shape [batch, num_boxes, size_x] containing x
    coordinates for grid points.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html#l00053">53</a> of file <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html">spatial_transform_ops.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   53</span><span class="keyword">def </span>box_grid_coordinate_vectors(boxes, size_y, size_x, align_corners=False):</div>
<div class="line"><span class="lineno">   54</span>  <span class="stringliteral">&quot;&quot;&quot;Generates coordinate vectors for a `size x size` grid in boxes.</span></div>
<div class="line"><span class="lineno">   55</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   56</span><span class="stringliteral">  Each box </span><span class="keywordflow">is</span> subdivided uniformly into a grid consisting of size x size</div>
<div class="line"><span class="lineno">   57</span>  rectangular cells. This function returns coordinate vectors describing</div>
<div class="line"><span class="lineno">   58</span>  the center of each cell.</div>
<div class="line"><span class="lineno">   59</span> </div>
<div class="line"><span class="lineno">   60</span>  If `align_corners` <span class="keywordflow">is</span> true, grid points are uniformly spread such that the</div>
<div class="line"><span class="lineno">   61</span>  corner points on the grid exactly overlap corners of the boxes.</div>
<div class="line"><span class="lineno">   62</span> </div>
<div class="line"><span class="lineno">   63</span>  Note that output coordinates are expressed <span class="keywordflow">in</span> the same coordinate frame <span class="keyword">as</span></div>
<div class="line"><span class="lineno">   64</span>  input boxes.</div>
<div class="line"><span class="lineno">   65</span> </div>
<div class="line"><span class="lineno">   66</span>  Args:</div>
<div class="line"><span class="lineno">   67</span>    boxes: A float tensor of shape [batch, num_boxes, 4] containing boxes of the</div>
<div class="line"><span class="lineno">   68</span>      form [ymin, xmin, ymax, xmax].</div>
<div class="line"><span class="lineno">   69</span>    size_y: Size of the grid <span class="keywordflow">in</span> y axis.</div>
<div class="line"><span class="lineno">   70</span>    size_x: Size of the grid <span class="keywordflow">in</span> x axis.</div>
<div class="line"><span class="lineno">   71</span>    align_corners: Whether to align the corner grid points exactly <span class="keyword">with</span> box</div>
<div class="line"><span class="lineno">   72</span>      corners.</div>
<div class="line"><span class="lineno">   73</span> </div>
<div class="line"><span class="lineno">   74</span>  Returns:</div>
<div class="line"><span class="lineno">   75</span>    box_grid_y: A float tensor of shape [batch, num_boxes, size_y] containing y</div>
<div class="line"><span class="lineno">   76</span>      coordinates <span class="keywordflow">for</span> grid points.</div>
<div class="line"><span class="lineno">   77</span>    box_grid_x: A float tensor of shape [batch, num_boxes, size_x] containing x</div>
<div class="line"><span class="lineno">   78</span>      coordinates <span class="keywordflow">for</span> grid points.</div>
<div class="line"><span class="lineno">   79</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   80</span><span class="stringliteral">  ymin, xmin, ymax, xmax = tf.unstack(boxes, axis=-1)</span></div>
<div class="line"><span class="lineno">   81</span><span class="stringliteral">  box_grid_y = _coordinate_vector_1d(ymin, ymax, size_y, align_corners)</span></div>
<div class="line"><span class="lineno">   82</span><span class="stringliteral">  box_grid_x = _coordinate_vector_1d(xmin, xmax, size_x, align_corners)</span></div>
<div class="line"><span class="lineno">   83</span><span class="stringliteral">  </span><span class="keywordflow">return</span> box_grid_y, box_grid_x</div>
<div class="line"><span class="lineno">   84</span> </div>
<div class="line"><span class="lineno">   85</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a5b3b992126c8aa180645bbdc91ab2ab4_cgraph.png" border="0" usemap="#ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a5b3b992126c8aa180645bbdc91ab2ab4_cgraph" alt=""/></div>
<map name="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a5b3b992126c8aa180645bbdc91ab2ab4_cgraph" id="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a5b3b992126c8aa180645bbdc91ab2ab4_cgraph">
<area shape="rect" title=" " alt="" coords="5,5,236,60"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#abe997a2270fa0be3f0b735de66b75f0a" title=" " alt="" coords="284,5,467,60"/>
<area shape="poly" title=" " alt="" coords="236,30,270,30,270,35,236,35"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a5b3b992126c8aa180645bbdc91ab2ab4_icgraph.png" border="0" usemap="#ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a5b3b992126c8aa180645bbdc91ab2ab4_icgraph" alt=""/></div>
<map name="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a5b3b992126c8aa180645bbdc91ab2ab4_icgraph" id="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a5b3b992126c8aa180645bbdc91ab2ab4_icgraph">
<area shape="rect" title=" " alt="" coords="468,5,699,60"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#ae321d4963245a9cc5577f5f7870fd967" title=" " alt="" coords="244,5,420,60"/>
<area shape="poly" title=" " alt="" coords="454,35,420,35,420,30,454,30"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a58306e39931ae17ac983f67617fcd07b" title=" " alt="" coords="5,5,196,60"/>
<area shape="poly" title=" " alt="" coords="230,35,196,35,196,30,230,30"/>
</map>
</div>

</div>
</div>
<a id="a6a6d6d840fa93e0b16a80e70305e1a28" name="a6a6d6d840fa93e0b16a80e70305e1a28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a6d6d840fa93e0b16a80e70305e1a28">&#9670;&#160;</a></span>feature_grid_coordinate_vectors()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.utils.spatial_transform_ops.feature_grid_coordinate_vectors </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>box_grid_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>box_grid_x</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Returns feature grid point coordinate vectors for bilinear interpolation.

Box grid is specified in absolute coordinate system with origin at left top
(0, 0). The returned coordinate vectors contain 0-based feature point indices.

This function snaps each point in the box grid to nearest 4 points on the
feature map.

In this function we also follow the convention of treating feature pixels as
point objects with no spatial extent.

Args:
  box_grid_y: A float tensor of shape [batch, num_boxes, size] containing y
    coordinate vector of the box grid.
  box_grid_x: A float tensor of shape [batch, num_boxes, size] containing x
    coordinate vector of the box grid.

Returns:
  feature_grid_y0: An int32 tensor of shape [batch, num_boxes, size]
    containing y coordinate vector for the top neighbors.
  feature_grid_x0: A int32 tensor of shape [batch, num_boxes, size]
    containing x coordinate vector for the left neighbors.
  feature_grid_y1: A int32 tensor of shape [batch, num_boxes, size]
    containing y coordinate vector for the bottom neighbors.
  feature_grid_x1: A int32 tensor of shape [batch, num_boxes, size]
    containing x coordinate vector for the right neighbors.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html#l00086">86</a> of file <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html">spatial_transform_ops.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   86</span><span class="keyword">def </span>feature_grid_coordinate_vectors(box_grid_y, box_grid_x):</div>
<div class="line"><span class="lineno">   87</span>  <span class="stringliteral">&quot;&quot;&quot;Returns feature grid point coordinate vectors for bilinear interpolation.</span></div>
<div class="line"><span class="lineno">   88</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   89</span><span class="stringliteral">  Box grid </span><span class="keywordflow">is</span> specified <span class="keywordflow">in</span> absolute coordinate system <span class="keyword">with</span> origin at left top</div>
<div class="line"><span class="lineno">   90</span>  (0, 0). The returned coordinate vectors contain 0-based feature point indices.</div>
<div class="line"><span class="lineno">   91</span> </div>
<div class="line"><span class="lineno">   92</span>  This function snaps each point <span class="keywordflow">in</span> the box grid to nearest 4 points on the</div>
<div class="line"><span class="lineno">   93</span>  feature map.</div>
<div class="line"><span class="lineno">   94</span> </div>
<div class="line"><span class="lineno">   95</span>  In this function we also follow the convention of treating feature pixels <span class="keyword">as</span></div>
<div class="line"><span class="lineno">   96</span>  point objects <span class="keyword">with</span> no spatial extent.</div>
<div class="line"><span class="lineno">   97</span> </div>
<div class="line"><span class="lineno">   98</span>  Args:</div>
<div class="line"><span class="lineno">   99</span>    box_grid_y: A float tensor of shape [batch, num_boxes, size] containing y</div>
<div class="line"><span class="lineno">  100</span>      coordinate vector of the box grid.</div>
<div class="line"><span class="lineno">  101</span>    box_grid_x: A float tensor of shape [batch, num_boxes, size] containing x</div>
<div class="line"><span class="lineno">  102</span>      coordinate vector of the box grid.</div>
<div class="line"><span class="lineno">  103</span> </div>
<div class="line"><span class="lineno">  104</span>  Returns:</div>
<div class="line"><span class="lineno">  105</span>    feature_grid_y0: An int32 tensor of shape [batch, num_boxes, size]</div>
<div class="line"><span class="lineno">  106</span>      containing y coordinate vector <span class="keywordflow">for</span> the top neighbors.</div>
<div class="line"><span class="lineno">  107</span>    feature_grid_x0: A int32 tensor of shape [batch, num_boxes, size]</div>
<div class="line"><span class="lineno">  108</span>      containing x coordinate vector <span class="keywordflow">for</span> the left neighbors.</div>
<div class="line"><span class="lineno">  109</span>    feature_grid_y1: A int32 tensor of shape [batch, num_boxes, size]</div>
<div class="line"><span class="lineno">  110</span>      containing y coordinate vector <span class="keywordflow">for</span> the bottom neighbors.</div>
<div class="line"><span class="lineno">  111</span>    feature_grid_x1: A int32 tensor of shape [batch, num_boxes, size]</div>
<div class="line"><span class="lineno">  112</span>      containing x coordinate vector <span class="keywordflow">for</span> the right neighbors.</div>
<div class="line"><span class="lineno">  113</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  114</span><span class="stringliteral">  feature_grid_y0 = tf.floor(box_grid_y)</span></div>
<div class="line"><span class="lineno">  115</span><span class="stringliteral">  feature_grid_x0 = tf.floor(box_grid_x)</span></div>
<div class="line"><span class="lineno">  116</span><span class="stringliteral">  feature_grid_y1 = tf.floor(box_grid_y + 1)</span></div>
<div class="line"><span class="lineno">  117</span><span class="stringliteral">  feature_grid_x1 = tf.floor(box_grid_x + 1)</span></div>
<div class="line"><span class="lineno">  118</span><span class="stringliteral">  feature_grid_y0 = tf.cast(feature_grid_y0, dtype=tf.int32)</span></div>
<div class="line"><span class="lineno">  119</span><span class="stringliteral">  feature_grid_y1 = tf.cast(feature_grid_y1, dtype=tf.int32)</span></div>
<div class="line"><span class="lineno">  120</span><span class="stringliteral">  feature_grid_x0 = tf.cast(feature_grid_x0, dtype=tf.int32)</span></div>
<div class="line"><span class="lineno">  121</span><span class="stringliteral">  feature_grid_x1 = tf.cast(feature_grid_x1, dtype=tf.int32)</span></div>
<div class="line"><span class="lineno">  122</span><span class="stringliteral">  </span><span class="keywordflow">return</span> (feature_grid_y0, feature_grid_x0, feature_grid_y1, feature_grid_x1)</div>
<div class="line"><span class="lineno">  123</span> </div>
<div class="line"><span class="lineno">  124</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a6a6d6d840fa93e0b16a80e70305e1a28_icgraph.png" border="0" usemap="#ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a6a6d6d840fa93e0b16a80e70305e1a28_icgraph" alt=""/></div>
<map name="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a6a6d6d840fa93e0b16a80e70305e1a28_icgraph" id="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a6a6d6d840fa93e0b16a80e70305e1a28_icgraph">
<area shape="rect" title=" " alt="" coords="468,5,651,60"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#ae321d4963245a9cc5577f5f7870fd967" title=" " alt="" coords="244,5,420,60"/>
<area shape="poly" title=" " alt="" coords="455,35,420,35,420,30,455,30"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a58306e39931ae17ac983f67617fcd07b" title=" " alt="" coords="5,5,196,60"/>
<area shape="poly" title=" " alt="" coords="230,35,196,35,196,30,230,30"/>
</map>
</div>

</div>
</div>
<a id="a58306e39931ae17ac983f67617fcd07b" name="a58306e39931ae17ac983f67617fcd07b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58306e39931ae17ac983f67617fcd07b">&#9670;&#160;</a></span>matmul_crop_and_resize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.utils.spatial_transform_ops.matmul_crop_and_resize </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>boxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>crop_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>extrapolation_value</em> = <code>0.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>scope</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Matrix multiplication based implementation of the crop and resize op.

Extracts crops from the input image tensor and bilinearly resizes them
(possibly with aspect ratio change) to a common output size specified by
crop_size. This is more general than the crop_to_bounding_box op which
extracts a fixed size slice from the input image and does not allow
resizing or aspect ratio change.

Returns a tensor with crops from the input image at positions defined at
the bounding box locations in boxes. The cropped boxes are all resized
(with bilinear interpolation) to a fixed size = `[crop_height, crop_width]`.
The result is a 5-D tensor `[batch, num_boxes, crop_height, crop_width,
depth]`.

Note that this operation is meant to replicate the behavior of the standard
tf.image.crop_and_resize operation but there are a few differences.
Specifically:
  1) There is no `box_indices` argument --- to run this op on multiple images,
    one must currently call this op independently on each image.
  2) The `crop_size` parameter is assumed to be statically defined.
    Moreover, the number of boxes must be strictly nonzero.

Args:
  image: A `Tensor`. Must be one of the following types: `uint8`, `int8`,
    `int16`, `int32`, `int64`, `half`, 'bfloat16', `float32`, `float64`.
    A 4-D tensor of shape `[batch, image_height, image_width, depth]`.
    Both `image_height` and `image_width` need to be positive.
  boxes: A `Tensor` of type `float32` or 'bfloat16'.
    A 3-D tensor of shape `[batch, num_boxes, 4]`. The boxes are specified in
    normalized coordinates and are of the form `[y1, x1, y2, x2]`. A
    normalized coordinate value of `y` is mapped to the image coordinate at
    `y * (image_height - 1)`, so as the `[0, 1]` interval of normalized image
    height is mapped to `[0, image_height - 1] in image height coordinates.
    We do allow y1 &gt; y2, in which case the sampled crop is an up-down flipped
    version of the original image. The width dimension is treated similarly.
    Normalized coordinates outside the `[0, 1]` range are allowed, in which
    case we use `extrapolation_value` to extrapolate the input image values.
  crop_size: A list of two integers `[crop_height, crop_width]`. All
    cropped image patches are resized to this size. The aspect ratio of the
    image content is not preserved. Both `crop_height` and `crop_width` need
    to be positive.
  extrapolation_value: a float value to use for extrapolation.
  scope: A name for the operation (optional).

Returns:
  A 5-D tensor of shape `[batch, num_boxes, crop_height, crop_width, depth]`
</pre> 
<p class="definition">Definition at line <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html#l00424">424</a> of file <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html">spatial_transform_ops.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  425</span>                           scope=<span class="keywordtype">None</span>):</div>
<div class="line"><span class="lineno">  426</span>  <span class="stringliteral">&quot;&quot;&quot;Matrix multiplication based implementation of the crop and resize op.</span></div>
<div class="line"><span class="lineno">  427</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  428</span><span class="stringliteral">  Extracts crops </span><span class="keyword">from</span> the input image tensor <span class="keywordflow">and</span> bilinearly resizes them</div>
<div class="line"><span class="lineno">  429</span>  (possibly <span class="keyword">with</span> aspect ratio change) to a common output size specified by</div>
<div class="line"><span class="lineno">  430</span>  crop_size. This <span class="keywordflow">is</span> more general than the crop_to_bounding_box op which</div>
<div class="line"><span class="lineno">  431</span>  extracts a fixed size slice <span class="keyword">from</span> the input image <span class="keywordflow">and</span> does <span class="keywordflow">not</span> allow</div>
<div class="line"><span class="lineno">  432</span>  resizing <span class="keywordflow">or</span> aspect ratio change.</div>
<div class="line"><span class="lineno">  433</span> </div>
<div class="line"><span class="lineno">  434</span>  Returns a tensor <span class="keyword">with</span> crops <span class="keyword">from</span> the input image at positions defined at</div>
<div class="line"><span class="lineno">  435</span>  the bounding box locations <span class="keywordflow">in</span> boxes. The cropped boxes are all resized</div>
<div class="line"><span class="lineno">  436</span>  (<span class="keyword">with</span> bilinear interpolation) to a fixed size = `[crop_height, crop_width]`.</div>
<div class="line"><span class="lineno">  437</span>  The result <span class="keywordflow">is</span> a 5-D tensor `[batch, num_boxes, crop_height, crop_width,</div>
<div class="line"><span class="lineno">  438</span>  depth]`.</div>
<div class="line"><span class="lineno">  439</span> </div>
<div class="line"><span class="lineno">  440</span>  Note that this operation <span class="keywordflow">is</span> meant to replicate the behavior of the standard</div>
<div class="line"><span class="lineno">  441</span>  tf.image.crop_and_resize operation but there are a few differences.</div>
<div class="line"><span class="lineno">  442</span>  Specifically:</div>
<div class="line"><span class="lineno">  443</span>    1) There <span class="keywordflow">is</span> no `box_indices` argument --- to run this op on multiple images,</div>
<div class="line"><span class="lineno">  444</span>      one must currently call this op independently on each image.</div>
<div class="line"><span class="lineno">  445</span>    2) The `crop_size` parameter <span class="keywordflow">is</span> assumed to be statically defined.</div>
<div class="line"><span class="lineno">  446</span>      Moreover, the number of boxes must be strictly nonzero.</div>
<div class="line"><span class="lineno">  447</span> </div>
<div class="line"><span class="lineno">  448</span>  Args:</div>
<div class="line"><span class="lineno">  449</span>    image: A `Tensor`. Must be one of the following types: `uint8`, `int8`,</div>
<div class="line"><span class="lineno">  450</span>      `int16`, `int32`, `int64`, `half`, <span class="stringliteral">&#39;bfloat16&#39;</span>, `float32`, `float64`.</div>
<div class="line"><span class="lineno">  451</span>      A 4-D tensor of shape `[batch, image_height, image_width, depth]`.</div>
<div class="line"><span class="lineno">  452</span>      Both `image_height` <span class="keywordflow">and</span> `image_width` need to be positive.</div>
<div class="line"><span class="lineno">  453</span>    boxes: A `Tensor` of type `float32` <span class="keywordflow">or</span> <span class="stringliteral">&#39;bfloat16&#39;</span>.</div>
<div class="line"><span class="lineno">  454</span>      A 3-D tensor of shape `[batch, num_boxes, 4]`. The boxes are specified <span class="keywordflow">in</span></div>
<div class="line"><span class="lineno">  455</span>      normalized coordinates <span class="keywordflow">and</span> are of the form `[y1, x1, y2, x2]`. A</div>
<div class="line"><span class="lineno">  456</span>      normalized coordinate value of `y` <span class="keywordflow">is</span> mapped to the image coordinate at</div>
<div class="line"><span class="lineno">  457</span>      `y * (image_height - 1)`, so <span class="keyword">as</span> the `[0, 1]` interval of normalized image</div>
<div class="line"><span class="lineno">  458</span>      height <span class="keywordflow">is</span> mapped to `[0, image_height - 1] <span class="keywordflow">in</span> image height coordinates.</div>
<div class="line"><span class="lineno">  459</span>      We do allow y1 &gt; y2, <span class="keywordflow">in</span> which case the sampled crop <span class="keywordflow">is</span> an up-down flipped</div>
<div class="line"><span class="lineno">  460</span>      version of the original image. The width dimension <span class="keywordflow">is</span> treated similarly.</div>
<div class="line"><span class="lineno">  461</span>      Normalized coordinates outside the `[0, 1]` range are allowed, <span class="keywordflow">in</span> which</div>
<div class="line"><span class="lineno">  462</span>      case we use `extrapolation_value` to extrapolate the input image values.</div>
<div class="line"><span class="lineno">  463</span>    crop_size: A list of two integers `[crop_height, crop_width]`. All</div>
<div class="line"><span class="lineno">  464</span>      cropped image patches are resized to this size. The aspect ratio of the</div>
<div class="line"><span class="lineno">  465</span>      image content <span class="keywordflow">is</span> <span class="keywordflow">not</span> preserved. Both `crop_height` <span class="keywordflow">and</span> `crop_width` need</div>
<div class="line"><span class="lineno">  466</span>      to be positive.</div>
<div class="line"><span class="lineno">  467</span>    extrapolation_value: a float value to use <span class="keywordflow">for</span> extrapolation.</div>
<div class="line"><span class="lineno">  468</span>    scope: A name <span class="keywordflow">for</span> the operation (optional).</div>
<div class="line"><span class="lineno">  469</span> </div>
<div class="line"><span class="lineno">  470</span>  Returns:</div>
<div class="line"><span class="lineno">  471</span>    A 5-D tensor of shape `[batch, num_boxes, crop_height, crop_width, depth]`</div>
<div class="line"><span class="lineno">  472</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  473</span><span class="stringliteral">  </span><span class="keyword">with</span> tf.name_scope(scope, <span class="stringliteral">&#39;MatMulCropAndResize&#39;</span>):</div>
<div class="line"><span class="lineno">  474</span>    box_levels = tf.zeros(tf.shape(boxes)[:2], dtype=tf.int32)</div>
<div class="line"><span class="lineno">  475</span>    <span class="keywordflow">return</span> multilevel_roi_align([image],</div>
<div class="line"><span class="lineno">  476</span>                                boxes,</div>
<div class="line"><span class="lineno">  477</span>                                box_levels,</div>
<div class="line"><span class="lineno">  478</span>                                crop_size,</div>
<div class="line"><span class="lineno">  479</span>                                align_corners=<span class="keyword">True</span>,</div>
<div class="line"><span class="lineno">  480</span>                                extrapolation_value=extrapolation_value)</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a58306e39931ae17ac983f67617fcd07b_cgraph.png" border="0" usemap="#ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a58306e39931ae17ac983f67617fcd07b_cgraph" alt=""/></div>
<map name="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a58306e39931ae17ac983f67617fcd07b_cgraph" id="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a58306e39931ae17ac983f67617fcd07b_cgraph">
<area shape="rect" title=" " alt="" coords="5,189,196,244"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#ae321d4963245a9cc5577f5f7870fd967" title=" " alt="" coords="244,189,420,244"/>
<area shape="poly" title=" " alt="" coords="196,214,230,214,230,219,196,219"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#ae1bc7d27a65ee67f70cac9d685069f3c" title=" " alt="" coords="488,5,679,60"/>
<area shape="poly" title=" " alt="" coords="351,187,399,129,431,98,466,70,477,64,480,69,470,75,435,102,403,132,355,191"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a3291d38759256f56082ba68c15ee3729" title=" " alt="" coords="482,85,685,125"/>
<area shape="poly" title=" " alt="" coords="372,187,416,160,467,134,486,127,488,132,469,139,419,164,375,192"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a5b3b992126c8aa180645bbdc91ab2ab4" title=" " alt="" coords="468,149,699,204"/>
<area shape="poly" title=" " alt="" coords="420,200,454,194,455,200,421,205"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a6a6d6d840fa93e0b16a80e70305e1a28" title=" " alt="" coords="492,228,675,283"/>
<area shape="poly" title=" " alt="" coords="421,228,479,237,478,242,420,233"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a0b2fa444b108acb7b4b0941ff26e5337" title=" " alt="" coords="475,307,692,347"/>
<area shape="poly" title=" " alt="" coords="376,242,420,268,469,292,492,300,490,305,467,296,418,272,374,246"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a3a4d6db5a345f555ce10b6302410b569" title=" " alt="" coords="489,371,678,411"/>
<area shape="poly" title=" " alt="" coords="354,242,402,301,434,331,469,357,481,363,479,368,467,362,431,335,398,304,350,246"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#abe997a2270fa0be3f0b735de66b75f0a" title=" " alt="" coords="747,149,929,204"/>
<area shape="poly" title=" " alt="" coords="699,174,733,174,733,179,699,179"/>
</map>
</div>

</div>
</div>
<a id="ae321d4963245a9cc5577f5f7870fd967" name="ae321d4963245a9cc5577f5f7870fd967"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae321d4963245a9cc5577f5f7870fd967">&#9670;&#160;</a></span>multilevel_roi_align()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.utils.spatial_transform_ops.multilevel_roi_align </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>features</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>boxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>box_levels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>output_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>num_samples_per_cell_y</em> = <code>1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>num_samples_per_cell_x</em> = <code>1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>align_corners</em> = <code>False</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>extrapolation_value</em> = <code>0.0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>scope</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Applies RoI Align op and returns feature for boxes.

Given multiple features maps indexed by different levels, and a set of boxes
where each box is mapped to a certain level, this function selectively crops
and resizes boxes from the corresponding feature maps.

We follow the RoI Align technique in https://arxiv.org/pdf/1703.06870.pdf
figure 3. Specifically, each box is subdivided uniformly into a grid
consisting of output_size[0] x output_size[1] rectangular cells. Within each
cell we select `num_points` points uniformly and compute feature values using
bilinear interpolation. Finally, we average pool the interpolated values in
each cell to obtain a [output_size[0], output_size[1], channels] feature.

If `align_corners` is true, sampling points are uniformly spread such that
corner points exactly overlap corners of the boxes.

In this function we also follow the convention of treating feature pixels as
point objects with no spatial extent.

Args:
  features: A list of 4D float tensors of shape [batch_size, max_height,
    max_width, channels] containing features.
  boxes: A 3D float tensor of shape [batch_size, num_boxes, 4] containing
    boxes of the form [ymin, xmin, ymax, xmax] in normalized coordinates.
  box_levels: A 3D int32 tensor of shape [batch_size, num_boxes, 1]
    representing the feature level index for each box.
  output_size: An list of two integers [size_y, size_x] indicating the output
    feature size for each box.
  num_samples_per_cell_y: Number of grid points to sample along y axis in each
    cell.
  num_samples_per_cell_x: Number of grid points to sample along x axis in each
    cell.
  align_corners: Whether to align the corner grid points exactly with box
    corners.
  extrapolation_value: a float value to use for extrapolation.
  scope: Scope name to use for this op.

Returns:
  A 5D float tensor of shape [batch_size, num_boxes, output_size[0],
  output_size[1], channels] representing the cropped features.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html#l00268">268</a> of file <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html">spatial_transform_ops.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  271</span>                         scope=<span class="keywordtype">None</span>):</div>
<div class="line"><span class="lineno">  272</span>  <span class="stringliteral">&quot;&quot;&quot;Applies RoI Align op and returns feature for boxes.</span></div>
<div class="line"><span class="lineno">  273</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  274</span><span class="stringliteral">  Given multiple features maps indexed by different levels, </span><span class="keywordflow">and</span> a set of boxes</div>
<div class="line"><span class="lineno">  275</span>  where each box <span class="keywordflow">is</span> mapped to a certain level, this function selectively crops</div>
<div class="line"><span class="lineno">  276</span>  <span class="keywordflow">and</span> resizes boxes <span class="keyword">from</span> the corresponding feature maps.</div>
<div class="line"><span class="lineno">  277</span> </div>
<div class="line"><span class="lineno">  278</span>  We follow the RoI Align technique <span class="keywordflow">in</span> https://arxiv.org/pdf/1703.06870.pdf</div>
<div class="line"><span class="lineno">  279</span>  figure 3. Specifically, each box <span class="keywordflow">is</span> subdivided uniformly into a grid</div>
<div class="line"><span class="lineno">  280</span>  consisting of output_size[0] x output_size[1] rectangular cells. Within each</div>
<div class="line"><span class="lineno">  281</span>  cell we select `num_points` points uniformly <span class="keywordflow">and</span> compute feature values using</div>
<div class="line"><span class="lineno">  282</span>  bilinear interpolation. Finally, we average pool the interpolated values <span class="keywordflow">in</span></div>
<div class="line"><span class="lineno">  283</span>  each cell to obtain a [output_size[0], output_size[1], channels] feature.</div>
<div class="line"><span class="lineno">  284</span> </div>
<div class="line"><span class="lineno">  285</span>  If `align_corners` <span class="keywordflow">is</span> true, sampling points are uniformly spread such that</div>
<div class="line"><span class="lineno">  286</span>  corner points exactly overlap corners of the boxes.</div>
<div class="line"><span class="lineno">  287</span> </div>
<div class="line"><span class="lineno">  288</span>  In this function we also follow the convention of treating feature pixels <span class="keyword">as</span></div>
<div class="line"><span class="lineno">  289</span>  point objects <span class="keyword">with</span> no spatial extent.</div>
<div class="line"><span class="lineno">  290</span> </div>
<div class="line"><span class="lineno">  291</span>  Args:</div>
<div class="line"><span class="lineno">  292</span>    features: A list of 4D float tensors of shape [batch_size, max_height,</div>
<div class="line"><span class="lineno">  293</span>      max_width, channels] containing features.</div>
<div class="line"><span class="lineno">  294</span>    boxes: A 3D float tensor of shape [batch_size, num_boxes, 4] containing</div>
<div class="line"><span class="lineno">  295</span>      boxes of the form [ymin, xmin, ymax, xmax] <span class="keywordflow">in</span> normalized coordinates.</div>
<div class="line"><span class="lineno">  296</span>    box_levels: A 3D int32 tensor of shape [batch_size, num_boxes, 1]</div>
<div class="line"><span class="lineno">  297</span>      representing the feature level index <span class="keywordflow">for</span> each box.</div>
<div class="line"><span class="lineno">  298</span>    output_size: An list of two integers [size_y, size_x] indicating the output</div>
<div class="line"><span class="lineno">  299</span>      feature size <span class="keywordflow">for</span> each box.</div>
<div class="line"><span class="lineno">  300</span>    num_samples_per_cell_y: Number of grid points to sample along y axis <span class="keywordflow">in</span> each</div>
<div class="line"><span class="lineno">  301</span>      cell.</div>
<div class="line"><span class="lineno">  302</span>    num_samples_per_cell_x: Number of grid points to sample along x axis <span class="keywordflow">in</span> each</div>
<div class="line"><span class="lineno">  303</span>      cell.</div>
<div class="line"><span class="lineno">  304</span>    align_corners: Whether to align the corner grid points exactly <span class="keyword">with</span> box</div>
<div class="line"><span class="lineno">  305</span>      corners.</div>
<div class="line"><span class="lineno">  306</span>    extrapolation_value: a float value to use <span class="keywordflow">for</span> extrapolation.</div>
<div class="line"><span class="lineno">  307</span>    scope: Scope name to use <span class="keywordflow">for</span> this op.</div>
<div class="line"><span class="lineno">  308</span> </div>
<div class="line"><span class="lineno">  309</span>  Returns:</div>
<div class="line"><span class="lineno">  310</span>    A 5D float tensor of shape [batch_size, num_boxes, output_size[0],</div>
<div class="line"><span class="lineno">  311</span>    output_size[1], channels] representing the cropped features.</div>
<div class="line"><span class="lineno">  312</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  313</span><span class="stringliteral">  </span><span class="keyword">with</span> tf.name_scope(scope, <span class="stringliteral">&#39;MultiLevelRoIAlign&#39;</span>):</div>
<div class="line"><span class="lineno">  314</span>    features, true_feature_shapes = pad_to_max_size(features)</div>
<div class="line"><span class="lineno">  315</span>    batch_size = tf.shape(features)[0]</div>
<div class="line"><span class="lineno">  316</span>    num_levels = features.get_shape().as_list()[1]</div>
<div class="line"><span class="lineno">  317</span>    max_feature_height = tf.shape(features)[2]</div>
<div class="line"><span class="lineno">  318</span>    max_feature_width = tf.shape(features)[3]</div>
<div class="line"><span class="lineno">  319</span>    num_filters = features.get_shape().as_list()[4]</div>
<div class="line"><span class="lineno">  320</span>    num_boxes = tf.shape(boxes)[1]</div>
<div class="line"><span class="lineno">  321</span> </div>
<div class="line"><span class="lineno">  322</span>    <span class="comment"># Convert boxes to absolute co-ordinates.</span></div>
<div class="line"><span class="lineno">  323</span>    true_feature_shapes = tf.cast(true_feature_shapes, dtype=boxes.dtype)</div>
<div class="line"><span class="lineno">  324</span>    true_feature_shapes = tf.gather(true_feature_shapes, box_levels)</div>
<div class="line"><span class="lineno">  325</span>    boxes *= tf.concat([true_feature_shapes - 1] * 2, axis=-1)</div>
<div class="line"><span class="lineno">  326</span> </div>
<div class="line"><span class="lineno">  327</span>    size_y = output_size[0] * num_samples_per_cell_y</div>
<div class="line"><span class="lineno">  328</span>    size_x = output_size[1] * num_samples_per_cell_x</div>
<div class="line"><span class="lineno">  329</span>    box_grid_y, box_grid_x = box_grid_coordinate_vectors(</div>
<div class="line"><span class="lineno">  330</span>        boxes, size_y=size_y, size_x=size_x, align_corners=align_corners)</div>
<div class="line"><span class="lineno">  331</span>    (feature_grid_y0, feature_grid_x0, feature_grid_y1,</div>
<div class="line"><span class="lineno">  332</span>     feature_grid_x1) = feature_grid_coordinate_vectors(box_grid_y, box_grid_x)</div>
<div class="line"><span class="lineno">  333</span>    feature_grid_y = tf.reshape(</div>
<div class="line"><span class="lineno">  334</span>        tf.stack([feature_grid_y0, feature_grid_y1], axis=3),</div>
<div class="line"><span class="lineno">  335</span>        [batch_size, num_boxes, -1])</div>
<div class="line"><span class="lineno">  336</span>    feature_grid_x = tf.reshape(</div>
<div class="line"><span class="lineno">  337</span>        tf.stack([feature_grid_x0, feature_grid_x1], axis=3),</div>
<div class="line"><span class="lineno">  338</span>        [batch_size, num_boxes, -1])</div>
<div class="line"><span class="lineno">  339</span>    feature_coordinates = ravel_indices(feature_grid_y, feature_grid_x,</div>
<div class="line"><span class="lineno">  340</span>                                        num_levels, max_feature_height,</div>
<div class="line"><span class="lineno">  341</span>                                        max_feature_width, box_levels)</div>
<div class="line"><span class="lineno">  342</span>    valid_indices = _valid_indicator(feature_grid_y, feature_grid_x,</div>
<div class="line"><span class="lineno">  343</span>                                     true_feature_shapes)</div>
<div class="line"><span class="lineno">  344</span>    feature_coordinates = tf.where(valid_indices, feature_coordinates,</div>
<div class="line"><span class="lineno">  345</span>                                   -1 * tf.ones_like(feature_coordinates))</div>
<div class="line"><span class="lineno">  346</span>    flattened_features = tf.reshape(features, [-1, num_filters])</div>
<div class="line"><span class="lineno">  347</span>    flattened_feature_values = _gather_valid_indices(flattened_features,</div>
<div class="line"><span class="lineno">  348</span>                                                     feature_coordinates,</div>
<div class="line"><span class="lineno">  349</span>                                                     extrapolation_value)</div>
<div class="line"><span class="lineno">  350</span>    features_per_box = tf.reshape(</div>
<div class="line"><span class="lineno">  351</span>        flattened_feature_values,</div>
<div class="line"><span class="lineno">  352</span>        [batch_size, num_boxes, size_y * 2, size_x * 2, num_filters])</div>
<div class="line"><span class="lineno">  353</span> </div>
<div class="line"><span class="lineno">  354</span>    <span class="comment"># Cast tensors into dtype of features.</span></div>
<div class="line"><span class="lineno">  355</span>    box_grid_y = tf.cast(box_grid_y, dtype=features_per_box.dtype)</div>
<div class="line"><span class="lineno">  356</span>    box_grid_x = tf.cast(box_grid_x, dtype=features_per_box.dtype)</div>
<div class="line"><span class="lineno">  357</span>    feature_grid_y0 = tf.cast(feature_grid_y0, dtype=features_per_box.dtype)</div>
<div class="line"><span class="lineno">  358</span>    feature_grid_x0 = tf.cast(feature_grid_x0, dtype=features_per_box.dtype)</div>
<div class="line"><span class="lineno">  359</span> </div>
<div class="line"><span class="lineno">  360</span>    <span class="comment"># RoI Align operation is a bilinear interpolation of four</span></div>
<div class="line"><span class="lineno">  361</span>    <span class="comment"># neighboring feature points f0, f1, f2, and f3 onto point y, x given by</span></div>
<div class="line"><span class="lineno">  362</span>    <span class="comment"># f(y, x) = [hy, ly] * [[f00, f01], * [hx, lx]^T</span></div>
<div class="line"><span class="lineno">  363</span>    <span class="comment">#                       [f10, f11]]</span></div>
<div class="line"><span class="lineno">  364</span>    <span class="comment">#</span></div>
<div class="line"><span class="lineno">  365</span>    <span class="comment"># Unrolling the matrix multiplies gives us:</span></div>
<div class="line"><span class="lineno">  366</span>    <span class="comment"># f(y, x) = (hy * hx) f00 + (hy * lx) f01 + (ly * hx) f10 + (lx * ly) f11</span></div>
<div class="line"><span class="lineno">  367</span>    <span class="comment"># f(y, x) = w00 * f00 + w01 * f01 + w10 * f10 + w11 * f11</span></div>
<div class="line"><span class="lineno">  368</span>    <span class="comment">#</span></div>
<div class="line"><span class="lineno">  369</span>    <span class="comment"># This can be computed by applying pointwise multiplication and sum_pool in</span></div>
<div class="line"><span class="lineno">  370</span>    <span class="comment"># a 2x2 window.</span></div>
<div class="line"><span class="lineno">  371</span>    ly = box_grid_y - feature_grid_y0</div>
<div class="line"><span class="lineno">  372</span>    lx = box_grid_x - feature_grid_x0</div>
<div class="line"><span class="lineno">  373</span>    hy = 1.0 - ly</div>
<div class="line"><span class="lineno">  374</span>    hx = 1.0 - lx</div>
<div class="line"><span class="lineno">  375</span> </div>
<div class="line"><span class="lineno">  376</span>    kernel_y = tf.reshape(</div>
<div class="line"><span class="lineno">  377</span>        tf.stack([hy, ly], axis=3), [batch_size, num_boxes, size_y * 2, 1])</div>
<div class="line"><span class="lineno">  378</span> </div>
<div class="line"><span class="lineno">  379</span>    kernel_x = tf.reshape(</div>
<div class="line"><span class="lineno">  380</span>        tf.stack([hx, lx], axis=3), [batch_size, num_boxes, 1, size_x * 2])</div>
<div class="line"><span class="lineno">  381</span> </div>
<div class="line"><span class="lineno">  382</span>    <span class="comment"># Multiplier 4 is to make tf.nn.avg_pool behave like sum_pool.</span></div>
<div class="line"><span class="lineno">  383</span>    interpolation_kernel = kernel_y * kernel_x * 4</div>
<div class="line"><span class="lineno">  384</span> </div>
<div class="line"><span class="lineno">  385</span>    <span class="comment"># Interpolate the gathered features with computed interpolation kernels.</span></div>
<div class="line"><span class="lineno">  386</span>    features_per_box *= tf.expand_dims(interpolation_kernel, axis=4),</div>
<div class="line"><span class="lineno">  387</span>    features_per_box = tf.reshape(</div>
<div class="line"><span class="lineno">  388</span>        features_per_box,</div>
<div class="line"><span class="lineno">  389</span>        [batch_size * num_boxes, size_y * 2, size_x * 2, num_filters])</div>
<div class="line"><span class="lineno">  390</span> </div>
<div class="line"><span class="lineno">  391</span>    <span class="comment"># This combines the two pooling operations - sum_pool to perform bilinear</span></div>
<div class="line"><span class="lineno">  392</span>    <span class="comment"># interpolation and avg_pool to pool the values in each bin.</span></div>
<div class="line"><span class="lineno">  393</span>    features_per_box = tf.nn.avg_pool(</div>
<div class="line"><span class="lineno">  394</span>        features_per_box,</div>
<div class="line"><span class="lineno">  395</span>        [1, num_samples_per_cell_y * 2, num_samples_per_cell_x * 2, 1],</div>
<div class="line"><span class="lineno">  396</span>        [1, num_samples_per_cell_y * 2, num_samples_per_cell_x * 2, 1], <span class="stringliteral">&#39;VALID&#39;</span>)</div>
<div class="line"><span class="lineno">  397</span>    features_per_box = tf.reshape(</div>
<div class="line"><span class="lineno">  398</span>        features_per_box,</div>
<div class="line"><span class="lineno">  399</span>        [batch_size, num_boxes, output_size[0], output_size[1], num_filters])</div>
<div class="line"><span class="lineno">  400</span> </div>
<div class="line"><span class="lineno">  401</span>    <span class="keywordflow">return</span> features_per_box</div>
<div class="line"><span class="lineno">  402</span> </div>
<div class="line"><span class="lineno">  403</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_ae321d4963245a9cc5577f5f7870fd967_cgraph.png" border="0" usemap="#ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_ae321d4963245a9cc5577f5f7870fd967_cgraph" alt=""/></div>
<map name="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_ae321d4963245a9cc5577f5f7870fd967_cgraph" id="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_ae321d4963245a9cc5577f5f7870fd967_cgraph">
<area shape="rect" title=" " alt="" coords="5,189,181,244"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#ae1bc7d27a65ee67f70cac9d685069f3c" title=" " alt="" coords="249,5,440,60"/>
<area shape="poly" title=" " alt="" coords="112,187,160,129,192,98,228,70,239,64,241,69,231,75,196,102,164,132,116,191"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a3291d38759256f56082ba68c15ee3729" title=" " alt="" coords="243,85,446,125"/>
<area shape="poly" title=" " alt="" coords="133,187,178,160,228,134,248,127,250,132,230,139,180,164,136,192"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a5b3b992126c8aa180645bbdc91ab2ab4" title=" " alt="" coords="229,149,460,204"/>
<area shape="poly" title=" " alt="" coords="181,200,216,194,217,200,182,205"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a6a6d6d840fa93e0b16a80e70305e1a28" title=" " alt="" coords="253,228,436,283"/>
<area shape="poly" title=" " alt="" coords="182,228,240,237,239,242,181,233"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a0b2fa444b108acb7b4b0941ff26e5337" title=" " alt="" coords="236,307,453,347"/>
<area shape="poly" title=" " alt="" coords="138,242,182,268,230,292,253,300,251,305,228,296,179,272,135,246"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a3a4d6db5a345f555ce10b6302410b569" title=" " alt="" coords="250,371,439,411"/>
<area shape="poly" title=" " alt="" coords="115,242,163,301,195,331,231,357,242,363,240,368,228,362,192,335,160,304,111,246"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#abe997a2270fa0be3f0b735de66b75f0a" title=" " alt="" coords="508,149,691,204"/>
<area shape="poly" title=" " alt="" coords="460,174,494,174,494,179,460,179"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_ae321d4963245a9cc5577f5f7870fd967_icgraph.png" border="0" usemap="#ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_ae321d4963245a9cc5577f5f7870fd967_icgraph" alt=""/></div>
<map name="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_ae321d4963245a9cc5577f5f7870fd967_icgraph" id="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_ae321d4963245a9cc5577f5f7870fd967_icgraph">
<area shape="rect" title=" " alt="" coords="244,5,420,60"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a58306e39931ae17ac983f67617fcd07b" title=" " alt="" coords="5,5,196,60"/>
<area shape="poly" title=" " alt="" coords="230,35,196,35,196,30,230,30"/>
</map>
</div>

</div>
</div>
<a id="a2a40d33cf1473f2a41b951a05f2576f5" name="a2a40d33cf1473f2a41b951a05f2576f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a40d33cf1473f2a41b951a05f2576f5">&#9670;&#160;</a></span>native_crop_and_resize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.utils.spatial_transform_ops.native_crop_and_resize </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>boxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>crop_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>scope</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Same as `matmul_crop_and_resize` but uses tf.image.crop_and_resize.</pre> 
<p class="definition">Definition at line <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html#l00404">404</a> of file <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html">spatial_transform_ops.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  404</span><span class="keyword">def </span>native_crop_and_resize(image, boxes, crop_size, scope=None):</div>
<div class="line"><span class="lineno">  405</span>  <span class="stringliteral">&quot;&quot;&quot;Same as `matmul_crop_and_resize` but uses tf.image.crop_and_resize.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  406</span>  <span class="keyword">def </span>get_box_inds(proposals):</div>
<div class="line"><span class="lineno">  407</span>    proposals_shape = proposals.get_shape().as_list()</div>
<div class="line"><span class="lineno">  408</span>    <span class="keywordflow">if</span> any(dim <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">for</span> dim <span class="keywordflow">in</span> proposals_shape):</div>
<div class="line"><span class="lineno">  409</span>      proposals_shape = tf.shape(proposals)</div>
<div class="line"><span class="lineno">  410</span>    ones_mat = tf.ones(proposals_shape[:2], dtype=tf.int32)</div>
<div class="line"><span class="lineno">  411</span>    multiplier = tf.expand_dims(</div>
<div class="line"><span class="lineno">  412</span>        tf.range(start=0, limit=proposals_shape[0]), 1)</div>
<div class="line"><span class="lineno">  413</span>    <span class="keywordflow">return</span> tf.reshape(ones_mat * multiplier, [-1])</div>
<div class="line"><span class="lineno">  414</span> </div>
<div class="line"><span class="lineno">  415</span>  <span class="keyword">with</span> tf.name_scope(scope, <span class="stringliteral">&#39;CropAndResize&#39;</span>):</div>
<div class="line"><span class="lineno">  416</span>    cropped_regions = tf.image.crop_and_resize(</div>
<div class="line"><span class="lineno">  417</span>        image, tf.reshape(boxes, [-1] + boxes.shape.as_list()[2:]),</div>
<div class="line"><span class="lineno">  418</span>        get_box_inds(boxes), crop_size)</div>
<div class="line"><span class="lineno">  419</span>    final_shape = tf.concat([tf.shape(boxes)[:2],</div>
<div class="line"><span class="lineno">  420</span>                             tf.shape(cropped_regions)[1:]], axis=0)</div>
<div class="line"><span class="lineno">  421</span>    <span class="keywordflow">return</span> tf.reshape(cropped_regions, final_shape)</div>
<div class="line"><span class="lineno">  422</span> </div>
<div class="line"><span class="lineno">  423</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a0b2fa444b108acb7b4b0941ff26e5337" name="a0b2fa444b108acb7b4b0941ff26e5337"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b2fa444b108acb7b4b0941ff26e5337">&#9670;&#160;</a></span>pad_to_max_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.utils.spatial_transform_ops.pad_to_max_size </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>features</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Pads features to max height and max width and stacks them up.

Args:
  features: A list of num_levels 4D float tensors of shape [batch, height_i,
    width_i, channels] containing feature maps.

Returns:
  stacked_features: A 5D float tensor of shape [batch, num_levels, max_height,
    max_width, channels] containing stacked features.
  true_feature_shapes: A 2D int32 tensor of shape [num_levels, 2] containing
    height and width of the feature maps before padding.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html#l00207">207</a> of file <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html">spatial_transform_ops.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  207</span><span class="keyword">def </span>pad_to_max_size(features):</div>
<div class="line"><span class="lineno">  208</span>  <span class="stringliteral">&quot;&quot;&quot;Pads features to max height and max width and stacks them up.</span></div>
<div class="line"><span class="lineno">  209</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  210</span><span class="stringliteral">  Args:</span></div>
<div class="line"><span class="lineno">  211</span><span class="stringliteral">    features: A list of num_levels 4D float tensors of shape [batch, height_i,</span></div>
<div class="line"><span class="lineno">  212</span><span class="stringliteral">      width_i, channels] containing feature maps.</span></div>
<div class="line"><span class="lineno">  213</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  214</span><span class="stringliteral">  Returns:</span></div>
<div class="line"><span class="lineno">  215</span><span class="stringliteral">    stacked_features: A 5D float tensor of shape [batch, num_levels, max_height,</span></div>
<div class="line"><span class="lineno">  216</span><span class="stringliteral">      max_width, channels] containing stacked features.</span></div>
<div class="line"><span class="lineno">  217</span><span class="stringliteral">    true_feature_shapes: A 2D int32 tensor of shape [num_levels, 2] containing</span></div>
<div class="line"><span class="lineno">  218</span><span class="stringliteral">      height </span><span class="keywordflow">and</span> width of the feature maps before padding.</div>
<div class="line"><span class="lineno">  219</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  220</span><span class="stringliteral">  heights = [tf.shape(feature)[1] </span><span class="keywordflow">for</span> feature <span class="keywordflow">in</span> features]</div>
<div class="line"><span class="lineno">  221</span>  widths = [tf.shape(feature)[2] <span class="keywordflow">for</span> feature <span class="keywordflow">in</span> features]</div>
<div class="line"><span class="lineno">  222</span>  max_height = tf.reduce_max(heights)</div>
<div class="line"><span class="lineno">  223</span>  max_width = tf.reduce_max(widths)</div>
<div class="line"><span class="lineno">  224</span> </div>
<div class="line"><span class="lineno">  225</span>  features_all = [</div>
<div class="line"><span class="lineno">  226</span>      tf.image.pad_to_bounding_box(feature, 0, 0, max_height,</div>
<div class="line"><span class="lineno">  227</span>                                   max_width) <span class="keywordflow">for</span> feature <span class="keywordflow">in</span> features</div>
<div class="line"><span class="lineno">  228</span>  ]</div>
<div class="line"><span class="lineno">  229</span>  features_all = tf.stack(features_all, axis=1)</div>
<div class="line"><span class="lineno">  230</span>  true_feature_shapes = tf.stack([tf.shape(feature)[1:3]</div>
<div class="line"><span class="lineno">  231</span>                                  <span class="keywordflow">for</span> feature <span class="keywordflow">in</span> features])</div>
<div class="line"><span class="lineno">  232</span>  <span class="keywordflow">return</span> features_all, true_feature_shapes</div>
<div class="line"><span class="lineno">  233</span> </div>
<div class="line"><span class="lineno">  234</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a0b2fa444b108acb7b4b0941ff26e5337_icgraph.png" border="0" usemap="#ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a0b2fa444b108acb7b4b0941ff26e5337_icgraph" alt=""/></div>
<map name="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a0b2fa444b108acb7b4b0941ff26e5337_icgraph" id="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a0b2fa444b108acb7b4b0941ff26e5337_icgraph">
<area shape="rect" title=" " alt="" coords="468,13,685,53"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#ae321d4963245a9cc5577f5f7870fd967" title=" " alt="" coords="244,5,420,60"/>
<area shape="poly" title=" " alt="" coords="454,35,420,35,420,30,454,30"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a58306e39931ae17ac983f67617fcd07b" title=" " alt="" coords="5,5,196,60"/>
<area shape="poly" title=" " alt="" coords="230,35,196,35,196,30,230,30"/>
</map>
</div>

</div>
</div>
<a id="a3a4d6db5a345f555ce10b6302410b569" name="a3a4d6db5a345f555ce10b6302410b569"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a4d6db5a345f555ce10b6302410b569">&#9670;&#160;</a></span>ravel_indices()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.utils.spatial_transform_ops.ravel_indices </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>feature_grid_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>feature_grid_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>num_levels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>height</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>box_levels</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Returns grid indices in a flattened feature map of shape [-1, channels].

The returned 1-D array can be used to gather feature grid points from a
feature map that has been flattened from [batch, num_levels, max_height,
max_width, channels] to [batch * num_levels * max_height * max_width,
channels].

Args:
  feature_grid_y: An int32 tensor of shape [batch, num_boxes, size_y]
    containing y coordinate vector.
  feature_grid_x: An int32 tensor of shape [batch, num_boxes, size_x]
    containing x coordinate vector.
  num_levels: Number of feature levels.
  height: An integer indicating the padded height of feature maps.
  width: An integer indicating the padded width of feature maps.
  box_levels: An int32 tensor of shape [batch, num_boxes] indicating
    feature level assigned to each box.

Returns:
  indices: A 1D int32 tensor containing feature point indices in a flattened
    feature grid.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html#l00155">155</a> of file <a class="el" href="../../de/d48/spatial__transform__ops_8py_source.html">spatial_transform_ops.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  156</span>                  box_levels):</div>
<div class="line"><span class="lineno">  157</span>  <span class="stringliteral">&quot;&quot;&quot;Returns grid indices in a flattened feature map of shape [-1, channels].</span></div>
<div class="line"><span class="lineno">  158</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  159</span><span class="stringliteral">  The returned 1-D array can be used to gather feature grid points </span><span class="keyword">from</span> a</div>
<div class="line"><span class="lineno">  160</span>  feature map that has been flattened <span class="keyword">from</span> [batch, num_levels, max_height,</div>
<div class="line"><span class="lineno">  161</span>  max_width, channels] to [batch * num_levels * max_height * max_width,</div>
<div class="line"><span class="lineno">  162</span>  channels].</div>
<div class="line"><span class="lineno">  163</span> </div>
<div class="line"><span class="lineno">  164</span>  Args:</div>
<div class="line"><span class="lineno">  165</span>    feature_grid_y: An int32 tensor of shape [batch, num_boxes, size_y]</div>
<div class="line"><span class="lineno">  166</span>      containing y coordinate vector.</div>
<div class="line"><span class="lineno">  167</span>    feature_grid_x: An int32 tensor of shape [batch, num_boxes, size_x]</div>
<div class="line"><span class="lineno">  168</span>      containing x coordinate vector.</div>
<div class="line"><span class="lineno">  169</span>    num_levels: Number of feature levels.</div>
<div class="line"><span class="lineno">  170</span>    height: An integer indicating the padded height of feature maps.</div>
<div class="line"><span class="lineno">  171</span>    width: An integer indicating the padded width of feature maps.</div>
<div class="line"><span class="lineno">  172</span>    box_levels: An int32 tensor of shape [batch, num_boxes] indicating</div>
<div class="line"><span class="lineno">  173</span>      feature level assigned to each box.</div>
<div class="line"><span class="lineno">  174</span> </div>
<div class="line"><span class="lineno">  175</span>  Returns:</div>
<div class="line"><span class="lineno">  176</span>    indices: A 1D int32 tensor containing feature point indices <span class="keywordflow">in</span> a flattened</div>
<div class="line"><span class="lineno">  177</span>      feature grid.</div>
<div class="line"><span class="lineno">  178</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  179</span><span class="stringliteral">  num_boxes = tf.shape(feature_grid_y)[1]</span></div>
<div class="line"><span class="lineno">  180</span><span class="stringliteral">  batch_size = tf.shape(feature_grid_y)[0]</span></div>
<div class="line"><span class="lineno">  181</span><span class="stringliteral">  size_y = tf.shape(feature_grid_y)[2]</span></div>
<div class="line"><span class="lineno">  182</span><span class="stringliteral">  size_x = tf.shape(feature_grid_x)[2]</span></div>
<div class="line"><span class="lineno">  183</span><span class="stringliteral">  height_dim_offset = width</span></div>
<div class="line"><span class="lineno">  184</span><span class="stringliteral">  level_dim_offset = height * height_dim_offset</span></div>
<div class="line"><span class="lineno">  185</span><span class="stringliteral">  batch_dim_offset = num_levels * level_dim_offset</span></div>
<div class="line"><span class="lineno">  186</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">  187</span><span class="stringliteral">  batch_dim_indices = (</span></div>
<div class="line"><span class="lineno">  188</span><span class="stringliteral">      tf.reshape(</span></div>
<div class="line"><span class="lineno">  189</span><span class="stringliteral">          tf.range(batch_size) * batch_dim_offset, [batch_size, 1, 1, 1]) *</span></div>
<div class="line"><span class="lineno">  190</span><span class="stringliteral">      tf.ones([1, num_boxes, size_y, size_x], dtype=tf.int32))</span></div>
<div class="line"><span class="lineno">  191</span><span class="stringliteral">  box_level_indices = (</span></div>
<div class="line"><span class="lineno">  192</span><span class="stringliteral">      tf.reshape(box_levels * level_dim_offset, [batch_size, num_boxes, 1, 1]) *</span></div>
<div class="line"><span class="lineno">  193</span><span class="stringliteral">      tf.ones([1, 1, size_y, size_x], dtype=tf.int32))</span></div>
<div class="line"><span class="lineno">  194</span><span class="stringliteral">  height_indices = (</span></div>
<div class="line"><span class="lineno">  195</span><span class="stringliteral">      tf.reshape(feature_grid_y * height_dim_offset,</span></div>
<div class="line"><span class="lineno">  196</span><span class="stringliteral">                 [batch_size, num_boxes, size_y, 1]) *</span></div>
<div class="line"><span class="lineno">  197</span><span class="stringliteral">      tf.ones([1, 1, 1, size_x], dtype=tf.int32))</span></div>
<div class="line"><span class="lineno">  198</span><span class="stringliteral">  width_indices = (</span></div>
<div class="line"><span class="lineno">  199</span><span class="stringliteral">      tf.reshape(feature_grid_x, [batch_size, num_boxes, 1, size_x])</span></div>
<div class="line"><span class="lineno">  200</span><span class="stringliteral">      * tf.ones([1, 1, size_y, 1], dtype=tf.int32))</span></div>
<div class="line"><span class="lineno">  201</span><span class="stringliteral">  indices = (</span></div>
<div class="line"><span class="lineno">  202</span><span class="stringliteral">      batch_dim_indices + box_level_indices + height_indices + width_indices)</span></div>
<div class="line"><span class="lineno">  203</span><span class="stringliteral">  flattened_indices = tf.reshape(indices, [-1])</span></div>
<div class="line"><span class="lineno">  204</span><span class="stringliteral">  </span><span class="keywordflow">return</span> flattened_indices</div>
<div class="line"><span class="lineno">  205</span> </div>
<div class="line"><span class="lineno">  206</span> </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a3a4d6db5a345f555ce10b6302410b569_icgraph.png" border="0" usemap="#ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a3a4d6db5a345f555ce10b6302410b569_icgraph" alt=""/></div>
<map name="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a3a4d6db5a345f555ce10b6302410b569_icgraph" id="ad4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops_a3a4d6db5a345f555ce10b6302410b569_icgraph">
<area shape="rect" title=" " alt="" coords="468,13,657,53"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#ae321d4963245a9cc5577f5f7870fd967" title=" " alt="" coords="244,5,420,60"/>
<area shape="poly" title=" " alt="" coords="455,35,420,35,420,30,455,30"/>
<area shape="rect" href="../../d4/ddc/namespacedetection__utils_1_1utils_1_1spatial__transform__ops.html#a58306e39931ae17ac983f67617fcd07b" title=" " alt="" coords="5,5,196,60"/>
<area shape="poly" title=" " alt="" coords="230,35,196,35,196,30,230,30"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
