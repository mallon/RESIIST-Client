<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RESIIST: detection_utils.utils.model_util Namespace Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">RESIIST
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d8/d97/namespacedetection__utils.html">detection_utils</a></li><li class="navelem"><a class="el" href="../../d5/d2b/namespacedetection__utils_1_1utils.html">utils</a></li><li class="navelem"><a class="el" href="../../d6/dd6/namespacedetection__utils_1_1utils_1_1model__util.html">model_util</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">detection_utils.utils.model_util Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5403fa1ee5f3cea5dec4d68933d75285"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/dd6/namespacedetection__utils_1_1utils_1_1model__util.html#a5403fa1ee5f3cea5dec4d68933d75285">extract_submodel</a> (model, inputs, outputs, name=None)</td></tr>
<tr class="separator:a5403fa1ee5f3cea5dec4d68933d75285"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Utility functions for manipulating Keras models.</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="a5403fa1ee5f3cea5dec4d68933d75285" name="a5403fa1ee5f3cea5dec4d68933d75285"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5403fa1ee5f3cea5dec4d68933d75285">&#9670;&#160;</a></span>extract_submodel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">detection_utils.utils.model_util.extract_submodel </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>inputs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>outputs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>name</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Extracts a section of a Keras model into a new model.

This method walks an existing model from the specified outputs back to the
specified inputs in order to construct a new model containing only a portion
of the old model, while sharing the layers and weights with the original
model.

WARNING: This method does not work for submodels containing layers that have
been used multiple times in the original model, or in other models beyond
the original model. (E.g. does not work for submodels that contain layers that
use shared weights). This also means that multiple overlapping submodels
cannot be extracted from the same model.

It also relies on recursion and will hit python's recursion limit for large
submodels.

Args:
  model: The existing Keras model this method extracts a submodel from.
  inputs: The layer inputs in the existing model that start the submodel
  outputs: The layer outputs in the existing model that should be output by
    the submodel
  name: The name for the extracted model

Returns:
  The extracted submodel specified by the given inputs and outputs
</pre> 
<p class="definition">Definition at line <a class="el" href="../../db/d78/model__util_8py_source.html#l00025">25</a> of file <a class="el" href="../../db/d78/model__util_8py_source.html">model_util.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   25</span><span class="keyword">def </span>extract_submodel(model, inputs, outputs, name=None):</div>
<div class="line"><span class="lineno">   26</span>  <span class="stringliteral">&quot;&quot;&quot;Extracts a section of a Keras model into a new model.</span></div>
<div class="line"><span class="lineno">   27</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   28</span><span class="stringliteral">  This method walks an existing model </span><span class="keyword">from</span> the specified outputs back to the</div>
<div class="line"><span class="lineno">   29</span>  specified inputs <span class="keywordflow">in</span> order to construct a new model containing only a portion</div>
<div class="line"><span class="lineno">   30</span>  of the old model, <span class="keywordflow">while</span> sharing the layers <span class="keywordflow">and</span> weights <span class="keyword">with</span> the original</div>
<div class="line"><span class="lineno">   31</span>  model.</div>
<div class="line"><span class="lineno">   32</span> </div>
<div class="line"><span class="lineno">   33</span>  WARNING: This method does <span class="keywordflow">not</span> work <span class="keywordflow">for</span> submodels containing layers that have</div>
<div class="line"><span class="lineno">   34</span>  been used multiple times <span class="keywordflow">in</span> the original model, <span class="keywordflow">or</span> <span class="keywordflow">in</span> other models beyond</div>
<div class="line"><span class="lineno">   35</span>  the original model. (E.g. does <span class="keywordflow">not</span> work <span class="keywordflow">for</span> submodels that contain layers that</div>
<div class="line"><span class="lineno">   36</span>  use shared weights). This also means that multiple overlapping submodels</div>
<div class="line"><span class="lineno">   37</span>  cannot be extracted <span class="keyword">from</span> the same model.</div>
<div class="line"><span class="lineno">   38</span> </div>
<div class="line"><span class="lineno">   39</span>  It also relies on recursion <span class="keywordflow">and</span> will hit python<span class="stringliteral">&#39;s recursion limit for large</span></div>
<div class="line"><span class="lineno">   40</span><span class="stringliteral">  submodels.</span></div>
<div class="line"><span class="lineno">   41</span><span class="stringliteral"></span> </div>
<div class="line"><span class="lineno">   42</span><span class="stringliteral">  Args:</span></div>
<div class="line"><span class="lineno">   43</span><span class="stringliteral">    model: The existing Keras model this method extracts a submodel </span><span class="keyword">from</span>.</div>
<div class="line"><span class="lineno">   44</span>    inputs: The layer inputs <span class="keywordflow">in</span> the existing model that start the submodel</div>
<div class="line"><span class="lineno">   45</span>    outputs: The layer outputs <span class="keywordflow">in</span> the existing model that should be output by</div>
<div class="line"><span class="lineno">   46</span>      the submodel</div>
<div class="line"><span class="lineno">   47</span>    name: The name <span class="keywordflow">for</span> the extracted model</div>
<div class="line"><span class="lineno">   48</span> </div>
<div class="line"><span class="lineno">   49</span>  Returns:</div>
<div class="line"><span class="lineno">   50</span>    The extracted submodel specified by the given inputs <span class="keywordflow">and</span> outputs</div>
<div class="line"><span class="lineno">   51</span>  <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   52</span><span class="stringliteral">  output_to_layer = {}</span></div>
<div class="line"><span class="lineno">   53</span><span class="stringliteral">  output_to_layer_input = {}</span></div>
<div class="line"><span class="lineno">   54</span><span class="stringliteral">  </span><span class="keywordflow">for</span> layer <span class="keywordflow">in</span> model.layers:</div>
<div class="line"><span class="lineno">   55</span>    layer_output = layer.output</div>
<div class="line"><span class="lineno">   56</span>    layer_inputs = layer.input</div>
<div class="line"><span class="lineno">   57</span>    output_to_layer[layer_output] = layer</div>
<div class="line"><span class="lineno">   58</span>    output_to_layer_input[layer_output] = layer_inputs</div>
<div class="line"><span class="lineno">   59</span> </div>
<div class="line"><span class="lineno">   60</span>  model_inputs_dict = {}</div>
<div class="line"><span class="lineno">   61</span>  memoized_results = {}</div>
<div class="line"><span class="lineno">   62</span> </div>
<div class="line"><span class="lineno">   63</span>  <span class="comment"># Relies on recursion, very low limit in python</span></div>
<div class="line"><span class="lineno">   64</span>  <span class="keyword">def </span>_recurse_in_model(tensor):</div>
<div class="line"><span class="lineno">   65</span>    <span class="stringliteral">&quot;&quot;&quot;Walk the existing model recursively to copy a submodel.&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   66</span>    <span class="keywordflow">if</span> tensor <span class="keywordflow">in</span> memoized_results:</div>
<div class="line"><span class="lineno">   67</span>      <span class="keywordflow">return</span> memoized_results[tensor]</div>
<div class="line"><span class="lineno">   68</span>    <span class="keywordflow">if</span> (tensor == inputs) <span class="keywordflow">or</span> (isinstance(inputs, list) <span class="keywordflow">and</span> tensor <span class="keywordflow">in</span> inputs):</div>
<div class="line"><span class="lineno">   69</span>      <span class="keywordflow">if</span> tensor <span class="keywordflow">not</span> <span class="keywordflow">in</span> model_inputs_dict:</div>
<div class="line"><span class="lineno">   70</span>        model_inputs_dict[tensor] = tf.keras.layers.Input(tensor=tensor)</div>
<div class="line"><span class="lineno">   71</span>      out = model_inputs_dict[tensor]</div>
<div class="line"><span class="lineno">   72</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">   73</span>      cur_inputs = output_to_layer_input[tensor]</div>
<div class="line"><span class="lineno">   74</span>      cur_layer = output_to_layer[tensor]</div>
<div class="line"><span class="lineno">   75</span>      <span class="keywordflow">if</span> isinstance(cur_inputs, list):</div>
<div class="line"><span class="lineno">   76</span>        out = cur_layer([_recurse_in_model(inp) <span class="keywordflow">for</span> inp <span class="keywordflow">in</span> cur_inputs])</div>
<div class="line"><span class="lineno">   77</span>      <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">   78</span>        out = cur_layer(_recurse_in_model(cur_inputs))</div>
<div class="line"><span class="lineno">   79</span>    memoized_results[tensor] = out</div>
<div class="line"><span class="lineno">   80</span>    <span class="keywordflow">return</span> out</div>
<div class="line"><span class="lineno">   81</span> </div>
<div class="line"><span class="lineno">   82</span>  <span class="keywordflow">if</span> isinstance(outputs, list):</div>
<div class="line"><span class="lineno">   83</span>    model_outputs = [_recurse_in_model(tensor) <span class="keywordflow">for</span> tensor <span class="keywordflow">in</span> outputs]</div>
<div class="line"><span class="lineno">   84</span>  <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">   85</span>    model_outputs = _recurse_in_model(outputs)</div>
<div class="line"><span class="lineno">   86</span> </div>
<div class="line"><span class="lineno">   87</span>  <span class="keywordflow">if</span> isinstance(inputs, list):</div>
<div class="line"><span class="lineno">   88</span>    model_inputs = [model_inputs_dict[tensor] <span class="keywordflow">for</span> tensor <span class="keywordflow">in</span> inputs]</div>
<div class="line"><span class="lineno">   89</span>  <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">   90</span>    model_inputs = model_inputs_dict[inputs]</div>
<div class="line"><span class="lineno">   91</span> </div>
<div class="line"><span class="lineno">   92</span>  <span class="keywordflow">return</span> tf.keras.Model(inputs=model_inputs, outputs=model_outputs, name=name)</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7
</small></address>
</body>
</html>
