\doxysection{detection\+\_\+utils.\+core.\+balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+Balanced\+Positive\+Negative\+Sampler Class Reference}
\hypertarget{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler}{}\label{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler}\index{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler@{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler}}


Inheritance diagram for detection\+\_\+utils.\+core.\+balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+Balanced\+Positive\+Negative\+Sampler\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=305pt]{d4/d8c/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for detection\+\_\+utils.\+core.\+balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+Balanced\+Positive\+Negative\+Sampler\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=305pt]{d8/dba/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a4bb04705236af59e8b4938304074f35c}{\+\_\+\+\_\+init\+\_\+\+\_\+}} (self, positive\+\_\+fraction=0.\+5, is\+\_\+static=False)
\item 
\mbox{\hyperlink{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a47ecd1ba4a6e9f0be57ff1b85f7a6c56}{subsample}} (self, indicator, batch\+\_\+size, labels, scope=None)
\end{DoxyCompactItemize}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler_a0e60af5bd531feb28ad2c179b8e745a4}{\+\_\+\+\_\+init\+\_\+\+\_\+}} (self)
\item 
\mbox{\hyperlink{classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler_af62418aa0c50303f6b5f4e8f5130651f}{subsample}} (self, indicator, batch\+\_\+size, \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}params)
\end{DoxyCompactItemize}
\doxysubsubsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a114dc7eba49d5c24ca4a9645e6557aca}{\+\_\+get\+\_\+num\+\_\+pos\+\_\+neg\+\_\+samples}} (self, sorted\+\_\+indices\+\_\+tensor, sample\+\_\+size)
\item 
\mbox{\hyperlink{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_adbe6d71b81e8ef0007043b6a7ae23692}{\+\_\+get\+\_\+values\+\_\+from\+\_\+start\+\_\+and\+\_\+end}} (self, input\+\_\+tensor, num\+\_\+start\+\_\+samples, num\+\_\+end\+\_\+samples, total\+\_\+num\+\_\+samples)
\item 
\mbox{\hyperlink{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_aa87afbab24c4a5d1214eb918bf534436}{\+\_\+static\+\_\+subsample}} (self, indicator, batch\+\_\+size, labels)
\end{DoxyCompactItemize}
\doxysubsubsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a52824e1d5b1e9c3a085f9bd1e733f008}{\+\_\+positive\+\_\+fraction}}
\item 
\mbox{\hyperlink{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a0cf7a20373c2870b4ea3b316403adb8c}{\+\_\+is\+\_\+static}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Additional Inherited Members}
\doxysubsection*{Static Public Member Functions inherited from \mbox{\hyperlink{classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler}{detection\+\_\+utils.\+core.\+minibatch\+\_\+sampler.\+Minibatch\+Sampler}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler_a2c2eda2a51cf3969cfe0211ac6658ba6}{subsample\+\_\+indicator}} (indicator, num\+\_\+samples)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\begin{DoxyVerb}Subsamples minibatches to a desired balance of positives and negatives.\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{balanced__positive__negative__sampler_8py_source_l00039}{39}} of file \mbox{\hyperlink{balanced__positive__negative__sampler_8py_source}{balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+py}}.



\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a4bb04705236af59e8b4938304074f35c}\label{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a4bb04705236af59e8b4938304074f35c} 
\index{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler@{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler}!\_\_init\_\_@{\_\_init\_\_}}
\index{\_\_init\_\_@{\_\_init\_\_}!detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler@{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler}}
\doxysubsubsection{\texorpdfstring{\_\_init\_\_()}{\_\_init\_\_()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+Balanced\+Positive\+Negative\+Sampler.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{positive\+\_\+fraction = {\ttfamily 0.5},  }\item[{}]{is\+\_\+static = {\ttfamily False} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Constructs a minibatch sampler.

Args:
  positive_fraction: desired fraction of positive examples (scalar in [0,1])
    in the batch.
  is_static: If True, uses an implementation with static shape guarantees.

Raises:
  ValueError: if positive_fraction < 0, or positive_fraction > 1
\end{DoxyVerb}
 

Reimplemented from \mbox{\hyperlink{classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler_a0e60af5bd531feb28ad2c179b8e745a4}{detection\+\_\+utils.\+core.\+minibatch\+\_\+sampler.\+Minibatch\+Sampler}}.



Definition at line \mbox{\hyperlink{balanced__positive__negative__sampler_8py_source_l00042}{42}} of file \mbox{\hyperlink{balanced__positive__negative__sampler_8py_source}{balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00042\ \ \ \textcolor{keyword}{def\ }\_\_init\_\_(self,\ positive\_fraction=0.5,\ is\_static=False):}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Constructs\ a\ minibatch\ sampler.}}
\DoxyCodeLine{00044\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00045\ \textcolor{stringliteral}{\ \ \ \ Args:}}
\DoxyCodeLine{00046\ \textcolor{stringliteral}{\ \ \ \ \ \ positive\_fraction:\ desired\ fraction\ of\ positive\ examples\ (scalar\ }\textcolor{keywordflow}{in}\ [0,1])}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{in}\ the\ batch.}
\DoxyCodeLine{00048\ \ \ \ \ \ \ is\_static:\ If\ \textcolor{keyword}{True},\ uses\ an\ implementation\ \textcolor{keyword}{with}\ static\ shape\ guarantees.}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \ \ Raises:}
\DoxyCodeLine{00051\ \ \ \ \ \ \ ValueError:\ \textcolor{keywordflow}{if}\ positive\_fraction\ <\ 0,\ \textcolor{keywordflow}{or}\ positive\_fraction\ >\ 1}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00053\ \textcolor{stringliteral}{\ \ \ \ }\textcolor{keywordflow}{if}\ positive\_fraction\ <\ 0\ \textcolor{keywordflow}{or}\ positive\_fraction\ >\ 1:}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'positive\_fraction\ should\ be\ in\ range\ [0,1].\ '}}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'Received:\ \%s.'}\ \%\ positive\_fraction)}
\DoxyCodeLine{00056\ \ \ \ \ self.\_positive\_fraction\ =\ positive\_fraction}
\DoxyCodeLine{00057\ \ \ \ \ self.\_is\_static\ =\ is\_static}
\DoxyCodeLine{00058\ }

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\Hypertarget{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a114dc7eba49d5c24ca4a9645e6557aca}\label{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a114dc7eba49d5c24ca4a9645e6557aca} 
\index{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler@{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler}!\_get\_num\_pos\_neg\_samples@{\_get\_num\_pos\_neg\_samples}}
\index{\_get\_num\_pos\_neg\_samples@{\_get\_num\_pos\_neg\_samples}!detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler@{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler}}
\doxysubsubsection{\texorpdfstring{\_get\_num\_pos\_neg\_samples()}{\_get\_num\_pos\_neg\_samples()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+Balanced\+Positive\+Negative\+Sampler.\+\_\+get\+\_\+num\+\_\+pos\+\_\+neg\+\_\+samples (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{sorted\+\_\+indices\+\_\+tensor,  }\item[{}]{sample\+\_\+size }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Counts the number of positives and negatives numbers to be sampled.

Args:
  sorted_indices_tensor: A sorted int32 tensor of shape [N] which contains
    the signed indices of the examples where the sign is based on the label
    value. The examples that cannot be sampled are set to 0. It samples
    atmost sample_size*positive_fraction positive examples and remaining
    from negative examples.
  sample_size: Size of subsamples.

Returns:
  A tuple containing the number of positive and negative labels in the
  subsample.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{balanced__positive__negative__sampler_8py_source_l00059}{59}} of file \mbox{\hyperlink{balanced__positive__negative__sampler_8py_source}{balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00059\ \ \ \textcolor{keyword}{def\ }\_get\_num\_pos\_neg\_samples(self,\ sorted\_indices\_tensor,\ sample\_size):}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Counts\ the\ number\ of\ positives\ and\ negatives\ numbers\ to\ be\ sampled.}}
\DoxyCodeLine{00061\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00062\ \textcolor{stringliteral}{\ \ \ \ Args:}}
\DoxyCodeLine{00063\ \textcolor{stringliteral}{\ \ \ \ \ \ sorted\_indices\_tensor:\ A\ sorted\ int32\ tensor\ of\ shape\ [N]\ which\ contains}}
\DoxyCodeLine{00064\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ the\ signed\ indices\ of\ the\ examples\ where\ the\ sign\ }\textcolor{keywordflow}{is}\ based\ on\ the\ label}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ value.\ The\ examples\ that\ cannot\ be\ sampled\ are\ set\ to\ 0.\ It\ samples}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ atmost\ sample\_size*positive\_fraction\ positive\ examples\ \textcolor{keywordflow}{and}\ remaining}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \textcolor{keyword}{from}\ negative\ examples.}
\DoxyCodeLine{00068\ \ \ \ \ \ \ sample\_size:\ Size\ of\ subsamples.}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \ \ Returns:}
\DoxyCodeLine{00071\ \ \ \ \ \ \ A\ tuple\ containing\ the\ number\ of\ positive\ \textcolor{keywordflow}{and}\ negative\ labels\ \textcolor{keywordflow}{in}\ the}
\DoxyCodeLine{00072\ \ \ \ \ \ \ subsample.}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00074\ \textcolor{stringliteral}{\ \ \ \ input\_length\ =\ tf.shape(sorted\_indices\_tensor)[0]}}
\DoxyCodeLine{00075\ \textcolor{stringliteral}{\ \ \ \ valid\_positive\_index\ =\ tf.greater(sorted\_indices\_tensor,}}
\DoxyCodeLine{00076\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tf.zeros(input\_length,\ tf.int32))}}
\DoxyCodeLine{00077\ \textcolor{stringliteral}{\ \ \ \ num\_sampled\_pos\ =\ tf.reduce\_sum(tf.cast(valid\_positive\_index,\ tf.int32))}}
\DoxyCodeLine{00078\ \textcolor{stringliteral}{\ \ \ \ max\_num\_positive\_samples\ =\ tf.constant(}}
\DoxyCodeLine{00079\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ int(sample\_size\ *\ self.\_positive\_fraction),\ tf.int32)}}
\DoxyCodeLine{00080\ \textcolor{stringliteral}{\ \ \ \ num\_positive\_samples\ =\ tf.minimum(max\_num\_positive\_samples,\ num\_sampled\_pos)}}
\DoxyCodeLine{00081\ \textcolor{stringliteral}{\ \ \ \ num\_negative\_samples\ =\ tf.constant(sample\_size,}}
\DoxyCodeLine{00082\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tf.int32)\ -\/\ num\_positive\_samples}}
\DoxyCodeLine{00083\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00084\ \textcolor{stringliteral}{\ \ \ \ }\textcolor{keywordflow}{return}\ num\_positive\_samples,\ num\_negative\_samples}
\DoxyCodeLine{00085\ }

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a114dc7eba49d5c24ca4a9645e6557aca_icgraph}
\end{center}
\end{figure}
\Hypertarget{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_adbe6d71b81e8ef0007043b6a7ae23692}\label{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_adbe6d71b81e8ef0007043b6a7ae23692} 
\index{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler@{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler}!\_get\_values\_from\_start\_and\_end@{\_get\_values\_from\_start\_and\_end}}
\index{\_get\_values\_from\_start\_and\_end@{\_get\_values\_from\_start\_and\_end}!detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler@{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler}}
\doxysubsubsection{\texorpdfstring{\_get\_values\_from\_start\_and\_end()}{\_get\_values\_from\_start\_and\_end()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+Balanced\+Positive\+Negative\+Sampler.\+\_\+get\+\_\+values\+\_\+from\+\_\+start\+\_\+and\+\_\+end (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{input\+\_\+tensor,  }\item[{}]{num\+\_\+start\+\_\+samples,  }\item[{}]{num\+\_\+end\+\_\+samples,  }\item[{}]{total\+\_\+num\+\_\+samples }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}slices num_start_samples and last num_end_samples from input_tensor.

Args:
  input_tensor: An int32 tensor of shape [N] to be sliced.
  num_start_samples: Number of examples to be sliced from the beginning
    of the input tensor.
  num_end_samples: Number of examples to be sliced from the end of the
    input tensor.
  total_num_samples: Sum of is num_start_samples and num_end_samples. This
    should be a scalar.

Returns:
  A tensor containing the first num_start_samples and last num_end_samples
  from input_tensor.\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{balanced__positive__negative__sampler_8py_source_l00086}{86}} of file \mbox{\hyperlink{balanced__positive__negative__sampler_8py_source}{balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ num\_end\_samples,\ total\_num\_samples):}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}slices\ num\_start\_samples\ and\ last\ num\_end\_samples\ from\ input\_tensor.}}
\DoxyCodeLine{00089\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00090\ \textcolor{stringliteral}{\ \ \ \ Args:}}
\DoxyCodeLine{00091\ \textcolor{stringliteral}{\ \ \ \ \ \ input\_tensor:\ An\ int32\ tensor\ of\ shape\ [N]\ to\ be\ sliced.}}
\DoxyCodeLine{00092\ \textcolor{stringliteral}{\ \ \ \ \ \ num\_start\_samples:\ Number\ of\ examples\ to\ be\ sliced\ }\textcolor{keyword}{from}\ the\ beginning}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ of\ the\ input\ tensor.}
\DoxyCodeLine{00094\ \ \ \ \ \ \ num\_end\_samples:\ Number\ of\ examples\ to\ be\ sliced\ \textcolor{keyword}{from}\ the\ end\ of\ the}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ input\ tensor.}
\DoxyCodeLine{00096\ \ \ \ \ \ \ total\_num\_samples:\ Sum\ of\ \textcolor{keywordflow}{is}\ num\_start\_samples\ \textcolor{keywordflow}{and}\ num\_end\_samples.\ This}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ should\ be\ a\ scalar.}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \ \ Returns:}
\DoxyCodeLine{00100\ \ \ \ \ \ \ A\ tensor\ containing\ the\ first\ num\_start\_samples\ \textcolor{keywordflow}{and}\ last\ num\_end\_samples}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \textcolor{keyword}{from}\ input\_tensor.}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00104\ \textcolor{stringliteral}{\ \ \ \ input\_length\ =\ tf.shape(input\_tensor)[0]}}
\DoxyCodeLine{00105\ \textcolor{stringliteral}{\ \ \ \ start\_positions\ =\ tf.less(tf.range(input\_length),\ num\_start\_samples)}}
\DoxyCodeLine{00106\ \textcolor{stringliteral}{\ \ \ \ end\_positions\ =\ tf.greater\_equal(}}
\DoxyCodeLine{00107\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ tf.range(input\_length),\ input\_length\ -\/\ num\_end\_samples)}}
\DoxyCodeLine{00108\ \textcolor{stringliteral}{\ \ \ \ selected\_positions\ =\ tf.logical\_or(start\_positions,\ end\_positions)}}
\DoxyCodeLine{00109\ \textcolor{stringliteral}{\ \ \ \ selected\_positions\ =\ tf.cast(selected\_positions,\ tf.float32)}}
\DoxyCodeLine{00110\ \textcolor{stringliteral}{\ \ \ \ indexed\_positions\ =\ tf.multiply(tf.cumsum(selected\_positions),}}
\DoxyCodeLine{00111\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ selected\_positions)}}
\DoxyCodeLine{00112\ \textcolor{stringliteral}{\ \ \ \ one\_hot\_selector\ =\ tf.one\_hot(tf.cast(indexed\_positions,\ tf.int32)\ -\/\ 1,}}
\DoxyCodeLine{00113\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ total\_num\_samples,}}
\DoxyCodeLine{00114\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dtype=tf.float32)}}
\DoxyCodeLine{00115\ \textcolor{stringliteral}{\ \ \ \ }\textcolor{keywordflow}{return}\ tf.cast(tf.tensordot(tf.cast(input\_tensor,\ tf.float32),}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ one\_hot\_selector,\ axes=[0,\ 0]),\ tf.int32)}
\DoxyCodeLine{00117\ }

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_adbe6d71b81e8ef0007043b6a7ae23692_icgraph}
\end{center}
\end{figure}
\Hypertarget{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_aa87afbab24c4a5d1214eb918bf534436}\label{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_aa87afbab24c4a5d1214eb918bf534436} 
\index{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler@{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler}!\_static\_subsample@{\_static\_subsample}}
\index{\_static\_subsample@{\_static\_subsample}!detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler@{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler}}
\doxysubsubsection{\texorpdfstring{\_static\_subsample()}{\_static\_subsample()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+Balanced\+Positive\+Negative\+Sampler.\+\_\+static\+\_\+subsample (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{indicator,  }\item[{}]{batch\+\_\+size,  }\item[{}]{labels }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Returns subsampled minibatch.

Args:
  indicator: boolean tensor of shape [N] whose True entries can be sampled.
    N should be a complie time constant.
  batch_size: desired batch size. This scalar cannot be None.
  labels: boolean tensor of shape [N] denoting positive(=True) and negative
    (=False) examples. N should be a complie time constant.

Returns:
  sampled_idx_indicator: boolean tensor of shape [N], True for entries which
    are sampled. It ensures the length of output of the subsample is always
    batch_size, even when number of examples set to True in indicator is
    less than batch_size.

Raises:
  ValueError: if labels and indicator are not 1D boolean tensors.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{balanced__positive__negative__sampler_8py_source_l00118}{118}} of file \mbox{\hyperlink{balanced__positive__negative__sampler_8py_source}{balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00118\ \ \ \textcolor{keyword}{def\ }\_static\_subsample(self,\ indicator,\ batch\_size,\ labels):}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Returns\ subsampled\ minibatch.}}
\DoxyCodeLine{00120\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00121\ \textcolor{stringliteral}{\ \ \ \ Args:}}
\DoxyCodeLine{00122\ \textcolor{stringliteral}{\ \ \ \ \ \ indicator:\ boolean\ tensor\ of\ shape\ [N]\ whose\ }\textcolor{keyword}{True}\ entries\ can\ be\ sampled.}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ N\ should\ be\ a\ complie\ time\ constant.}
\DoxyCodeLine{00124\ \ \ \ \ \ \ batch\_size:\ desired\ batch\ size.\ This\ scalar\ cannot\ be\ \textcolor{keywordtype}{None}.}
\DoxyCodeLine{00125\ \ \ \ \ \ \ labels:\ boolean\ tensor\ of\ shape\ [N]\ denoting\ positive(=\textcolor{keyword}{True})\ \textcolor{keywordflow}{and}\ negative}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ (=\textcolor{keyword}{False})\ examples.\ N\ should\ be\ a\ complie\ time\ constant.}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \ \ Returns:}
\DoxyCodeLine{00129\ \ \ \ \ \ \ sampled\_idx\_indicator:\ boolean\ tensor\ of\ shape\ [N],\ \textcolor{keyword}{True}\ \textcolor{keywordflow}{for}\ entries\ which}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ are\ sampled.\ It\ ensures\ the\ length\ of\ output\ of\ the\ subsample\ \textcolor{keywordflow}{is}\ always}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ batch\_size,\ even\ when\ number\ of\ examples\ set\ to\ \textcolor{keyword}{True}\ \textcolor{keywordflow}{in}\ indicator\ \textcolor{keywordflow}{is}}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ less\ than\ batch\_size.}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ Raises:}
\DoxyCodeLine{00135\ \ \ \ \ \ \ ValueError:\ \textcolor{keywordflow}{if}\ labels\ \textcolor{keywordflow}{and}\ indicator\ are\ \textcolor{keywordflow}{not}\ 1D\ boolean\ tensors.}
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00137\ \textcolor{stringliteral}{\ \ \ \ }\textcolor{comment}{\#\ Check\ if\ indicator\ and\ labels\ have\ a\ static\ size.}}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ indicator.shape.is\_fully\_defined():}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'indicator\ must\ be\ static\ in\ shape\ when\ is\_static\ is'}}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'True'})}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ labels.shape.is\_fully\_defined():}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'labels\ must\ be\ static\ in\ shape\ when\ is\_static\ is'}}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'True'})}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ isinstance(batch\_size,\ int):}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'batch\_size\ has\ to\ be\ an\ integer\ when\ is\_static\ is'}}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'True.'})}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \ \ input\_length\ =\ tf.shape(indicator)[0]}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{comment}{\#\ Set\ the\ number\ of\ examples\ set\ True\ in\ indicator\ to\ be\ at\ least}}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{comment}{\#\ batch\_size.}}
\DoxyCodeLine{00152\ \ \ \ \ num\_true\_sampled\ =\ tf.reduce\_sum(tf.cast(indicator,\ tf.float32))}
\DoxyCodeLine{00153\ \ \ \ \ additional\_false\_sample\ =\ tf.less\_equal(}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ tf.cumsum(tf.cast(tf.logical\_not(indicator),\ tf.float32)),}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ batch\_size\ -\/\ num\_true\_sampled)}
\DoxyCodeLine{00156\ \ \ \ \ indicator\ =\ tf.logical\_or(indicator,\ additional\_false\_sample)}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{comment}{\#\ Shuffle\ indicator\ and\ label.\ Need\ to\ store\ the\ permutation\ to\ restore\ the}}
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{comment}{\#\ order\ post\ sampling.}}
\DoxyCodeLine{00160\ \ \ \ \ permutation\ =\ tf.random\_shuffle(tf.range(input\_length))}
\DoxyCodeLine{00161\ \ \ \ \ indicator\ =\ ops.matmul\_gather\_on\_zeroth\_axis(}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ tf.cast(indicator,\ tf.float32),\ permutation)}
\DoxyCodeLine{00163\ \ \ \ \ labels\ =\ ops.matmul\_gather\_on\_zeroth\_axis(}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ tf.cast(labels,\ tf.float32),\ permutation)}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{comment}{\#\ index\ (starting\ from\ 1)\ when\ indicator\ is\ True,\ 0\ when\ False}}
\DoxyCodeLine{00167\ \ \ \ \ indicator\_idx\ =\ tf.where(}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ tf.cast(indicator,\ tf.bool),\ tf.range(1,\ input\_length\ +\ 1),}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ tf.zeros(input\_length,\ tf.int32))}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{comment}{\#\ Replace\ -\/1\ for\ negative,\ +1\ for\ positive\ labels}}
\DoxyCodeLine{00172\ \ \ \ \ signed\_label\ =\ tf.where(}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ tf.cast(labels,\ tf.bool),\ tf.ones(input\_length,\ tf.int32),}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ tf.scalar\_mul(-\/1,\ tf.ones(input\_length,\ tf.int32)))}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{comment}{\#\ negative\ of\ index\ for\ negative\ label,\ positive\ index\ for\ positive\ label,}}
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{comment}{\#\ 0\ when\ indicator\ is\ False.}}
\DoxyCodeLine{00177\ \ \ \ \ signed\_indicator\_idx\ =\ tf.multiply(indicator\_idx,\ signed\_label)}
\DoxyCodeLine{00178\ \ \ \ \ sorted\_signed\_indicator\_idx\ =\ tf.nn.top\_k(}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ signed\_indicator\_idx,\ input\_length,\ sorted=\textcolor{keyword}{True}).values}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \ \ [num\_positive\_samples,}
\DoxyCodeLine{00182\ \ \ \ \ \ num\_negative\_samples]\ =\ self.\_get\_num\_pos\_neg\_samples(}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ sorted\_signed\_indicator\_idx,\ batch\_size)}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \ \ sampled\_idx\ =\ self.\_get\_values\_from\_start\_and\_end(}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ sorted\_signed\_indicator\_idx,\ num\_positive\_samples,}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ num\_negative\_samples,\ batch\_size)}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{comment}{\#\ Shift\ the\ indices\ to\ start\ from\ 0\ and\ remove\ any\ samples\ that\ are\ set\ as}}
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{comment}{\#\ False.}}
\DoxyCodeLine{00191\ \ \ \ \ sampled\_idx\ =\ tf.abs(sampled\_idx)\ -\/\ tf.ones(batch\_size,\ tf.int32)}
\DoxyCodeLine{00192\ \ \ \ \ sampled\_idx\ =\ tf.multiply(}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ tf.cast(tf.greater\_equal(sampled\_idx,\ tf.constant(0)),\ tf.int32),}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ sampled\_idx)}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \ \ sampled\_idx\_indicator\ =\ tf.cast(tf.reduce\_sum(}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ tf.one\_hot(sampled\_idx,\ depth=input\_length),}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ axis=0),\ tf.bool)}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{comment}{\#\ project\ back\ the\ order\ based\ on\ stored\ permutations}}
\DoxyCodeLine{00201\ \ \ \ \ reprojections\ =\ tf.one\_hot(permutation,\ depth=input\_length,}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dtype=tf.float32)}
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{keywordflow}{return}\ tf.cast(tf.tensordot(}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ tf.cast(sampled\_idx\_indicator,\ tf.float32),}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ reprojections,\ axes=[0,\ 0]),\ tf.bool)}
\DoxyCodeLine{00206\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_aa87afbab24c4a5d1214eb918bf534436_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_aa87afbab24c4a5d1214eb918bf534436_icgraph}
\end{center}
\end{figure}
\Hypertarget{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a47ecd1ba4a6e9f0be57ff1b85f7a6c56}\label{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a47ecd1ba4a6e9f0be57ff1b85f7a6c56} 
\index{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler@{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler}!subsample@{subsample}}
\index{subsample@{subsample}!detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler@{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler}}
\doxysubsubsection{\texorpdfstring{subsample()}{subsample()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+Balanced\+Positive\+Negative\+Sampler.\+subsample (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{indicator,  }\item[{}]{batch\+\_\+size,  }\item[{}]{labels,  }\item[{}]{scope = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Returns subsampled minibatch.

Args:
  indicator: boolean tensor of shape [N] whose True entries can be sampled.
  batch_size: desired batch size. If None, keeps all positive samples and
    randomly selects negative samples so that the positive sample fraction
    matches self._positive_fraction. It cannot be None is is_static is True.
  labels: boolean tensor of shape [N] denoting positive(=True) and negative
      (=False) examples.
  scope: name scope.

Returns:
  sampled_idx_indicator: boolean tensor of shape [N], True for entries which
    are sampled.

Raises:
  ValueError: if labels and indicator are not 1D boolean tensors.
\end{DoxyVerb}
 

Reimplemented from \mbox{\hyperlink{classdetection__utils_1_1core_1_1minibatch__sampler_1_1_minibatch_sampler_af62418aa0c50303f6b5f4e8f5130651f}{detection\+\_\+utils.\+core.\+minibatch\+\_\+sampler.\+Minibatch\+Sampler}}.



Definition at line \mbox{\hyperlink{balanced__positive__negative__sampler_8py_source_l00207}{207}} of file \mbox{\hyperlink{balanced__positive__negative__sampler_8py_source}{balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00207\ \ \ \textcolor{keyword}{def\ }subsample(self,\ indicator,\ batch\_size,\ labels,\ scope=None):}
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Returns\ subsampled\ minibatch.}}
\DoxyCodeLine{00209\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00210\ \textcolor{stringliteral}{\ \ \ \ Args:}}
\DoxyCodeLine{00211\ \textcolor{stringliteral}{\ \ \ \ \ \ indicator:\ boolean\ tensor\ of\ shape\ [N]\ whose\ }\textcolor{keyword}{True}\ entries\ can\ be\ sampled.}
\DoxyCodeLine{00212\ \ \ \ \ \ \ batch\_size:\ desired\ batch\ size.\ If\ \textcolor{keywordtype}{None},\ keeps\ all\ positive\ samples\ \textcolor{keywordflow}{and}}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ randomly\ selects\ negative\ samples\ so\ that\ the\ positive\ sample\ fraction}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ matches\ self.\_positive\_fraction.\ It\ cannot\ be\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{is}\ is\_static\ \textcolor{keywordflow}{is}\ \textcolor{keyword}{True}.}
\DoxyCodeLine{00215\ \ \ \ \ \ \ labels:\ boolean\ tensor\ of\ shape\ [N]\ denoting\ positive(=\textcolor{keyword}{True})\ \textcolor{keywordflow}{and}\ negative}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ (=\textcolor{keyword}{False})\ examples.}
\DoxyCodeLine{00217\ \ \ \ \ \ \ scope:\ name\ scope.}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \ \ \ \ Returns:}
\DoxyCodeLine{00220\ \ \ \ \ \ \ sampled\_idx\_indicator:\ boolean\ tensor\ of\ shape\ [N],\ \textcolor{keyword}{True}\ \textcolor{keywordflow}{for}\ entries\ which}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ are\ sampled.}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \ \ \ \ Raises:}
\DoxyCodeLine{00224\ \ \ \ \ \ \ ValueError:\ \textcolor{keywordflow}{if}\ labels\ \textcolor{keywordflow}{and}\ indicator\ are\ \textcolor{keywordflow}{not}\ 1D\ boolean\ tensors.}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00226\ \textcolor{stringliteral}{\ \ \ \ }\textcolor{keywordflow}{if}\ len(indicator.get\_shape().as\_list())\ !=\ 1:}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'indicator\ must\ be\ 1\ dimensional,\ got\ a\ tensor\ of\ '}}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'shape\ \%s'}\ \%\ indicator.get\_shape())}
\DoxyCodeLine{00229\ \ \ \ \ \textcolor{keywordflow}{if}\ len(labels.get\_shape().as\_list())\ !=\ 1:}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'labels\ must\ be\ 1\ dimensional,\ got\ a\ tensor\ of\ '}}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'shape\ \%s'}\ \%\ labels.get\_shape())}
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{keywordflow}{if}\ labels.dtype\ !=\ tf.bool:}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'labels\ should\ be\ of\ type\ bool.\ Received:\ \%s'}\ \%}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ labels.dtype)}
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{keywordflow}{if}\ indicator.dtype\ !=\ tf.bool:}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'indicator\ should\ be\ of\ type\ bool.\ Received:\ \%s'}\ \%}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ indicator.dtype)}
\DoxyCodeLine{00238\ \ \ \ \ \textcolor{keyword}{with}\ tf.name\_scope(scope,\ \textcolor{stringliteral}{'BalancedPositiveNegativeSampler'}):}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\_is\_static:}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\_static\_subsample(indicator,\ batch\_size,\ labels)}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Only\ sample\ from\ indicated\ samples}}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ negative\_idx\ =\ tf.logical\_not(labels)}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ positive\_idx\ =\ tf.logical\_and(labels,\ indicator)}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ negative\_idx\ =\ tf.logical\_and(negative\_idx,\ indicator)}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Sample\ positive\ and\ negative\ samples\ separately}}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ batch\_size\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ max\_num\_pos\ =\ tf.reduce\_sum(tf.cast(positive\_idx,\ dtype=tf.int32))}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ max\_num\_pos\ =\ int(self.\_positive\_fraction\ *\ batch\_size)}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ sampled\_pos\_idx\ =\ self.subsample\_indicator(positive\_idx,\ max\_num\_pos)}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ num\_sampled\_pos\ =\ tf.reduce\_sum(tf.cast(sampled\_pos\_idx,\ tf.int32))}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ batch\_size\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ negative\_positive\_ratio\ =\ (}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 1\ -\/\ self.\_positive\_fraction)\ /\ self.\_positive\_fraction}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ max\_num\_neg\ =\ tf.cast(}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ negative\_positive\_ratio\ *}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tf.cast(num\_sampled\_pos,\ dtype=tf.float32),}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dtype=tf.int32)}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \ \ max\_num\_neg\ =\ batch\_size\ -\/\ num\_sampled\_pos}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ sampled\_neg\_idx\ =\ self.subsample\_indicator(negative\_idx,\ max\_num\_neg)}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ tf.logical\_or(sampled\_pos\_idx,\ sampled\_neg\_idx)}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/d8a/classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a47ecd1ba4a6e9f0be57ff1b85f7a6c56_cgraph}
\end{center}
\end{figure}


\doxysubsection{Member Data Documentation}
\Hypertarget{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a0cf7a20373c2870b4ea3b316403adb8c}\label{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a0cf7a20373c2870b4ea3b316403adb8c} 
\index{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler@{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler}!\_is\_static@{\_is\_static}}
\index{\_is\_static@{\_is\_static}!detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler@{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler}}
\doxysubsubsection{\texorpdfstring{\_is\_static}{\_is\_static}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+Balanced\+Positive\+Negative\+Sampler.\+\_\+is\+\_\+static\hspace{0.3cm}{\ttfamily [protected]}}



Definition at line \mbox{\hyperlink{balanced__positive__negative__sampler_8py_source_l00057}{57}} of file \mbox{\hyperlink{balanced__positive__negative__sampler_8py_source}{balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+py}}.

\Hypertarget{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a52824e1d5b1e9c3a085f9bd1e733f008}\label{classdetection__utils_1_1core_1_1balanced__positive__negative__sampler_1_1_balanced_positive_negative_sampler_a52824e1d5b1e9c3a085f9bd1e733f008} 
\index{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler@{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler}!\_positive\_fraction@{\_positive\_fraction}}
\index{\_positive\_fraction@{\_positive\_fraction}!detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler@{detection\_utils.core.balanced\_positive\_negative\_sampler.BalancedPositiveNegativeSampler}}
\doxysubsubsection{\texorpdfstring{\_positive\_fraction}{\_positive\_fraction}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+Balanced\+Positive\+Negative\+Sampler.\+\_\+positive\+\_\+fraction\hspace{0.3cm}{\ttfamily [protected]}}



Definition at line \mbox{\hyperlink{balanced__positive__negative__sampler_8py_source_l00056}{56}} of file \mbox{\hyperlink{balanced__positive__negative__sampler_8py_source}{balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+py}}.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
src/main/resources/processing/video/detections/detection\+\_\+utils/core/\mbox{\hyperlink{balanced__positive__negative__sampler_8py}{balanced\+\_\+positive\+\_\+negative\+\_\+sampler.\+py}}\end{DoxyCompactItemize}
