\doxysection{detection\+\_\+utils.\+core.\+preprocessor Namespace Reference}
\hypertarget{namespacedetection__utils_1_1core_1_1preprocessor}{}\label{namespacedetection__utils_1_1core_1_1preprocessor}\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a72948ea20f73ededa0777968bb83c27f}{\+\_\+apply\+\_\+with\+\_\+random\+\_\+selector}} (x, func, num\+\_\+cases, preprocess\+\_\+vars\+\_\+cache=None, key=\textquotesingle{}\textquotesingle{})
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a190734dcb563069386fbf10f1cdb044c}{\+\_\+apply\+\_\+with\+\_\+random\+\_\+selector\+\_\+tuples}} (x, func, num\+\_\+cases, preprocess\+\_\+vars\+\_\+cache=None, key=\textquotesingle{}\textquotesingle{})
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a8fea0b9f060eea936fac7e5dd5102df7}{\+\_\+get\+\_\+or\+\_\+create\+\_\+preprocess\+\_\+rand\+\_\+vars}} (generator\+\_\+func, function\+\_\+id, preprocess\+\_\+vars\+\_\+cache, key=\textquotesingle{}\textquotesingle{})
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a3338c3143bc5c5a5f5cbf32be983a2f7}{\+\_\+random\+\_\+integer}} (minval, maxval, seed)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a21e6f1c05910c4acb3c33771326514b5}{\+\_\+rgb\+\_\+to\+\_\+grayscale}} (images, name=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_ad8750c531fcec2fa0f79087324bbbe86}{normalize\+\_\+image}} (image, original\+\_\+minval, original\+\_\+maxval, target\+\_\+minval, target\+\_\+maxval)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a201500daba3cc396f12a14daa7c3e782}{retain\+\_\+boxes\+\_\+above\+\_\+threshold}} (boxes, labels, label\+\_\+weights, label\+\_\+confidences=None, multiclass\+\_\+scores=None, masks=None, keypoints=None, threshold=0.\+0)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a326551a2f9d710995bf095ba1de2f76e}{drop\+\_\+label\+\_\+probabilistically}} (boxes, labels, label\+\_\+weights, label\+\_\+confidences=None, multiclass\+\_\+scores=None, masks=None, keypoints=None, dropped\+\_\+label=None, drop\+\_\+probability=0.\+0, seed=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_aedfac18f6ff4fa9921ab6862cf931b37}{remap\+\_\+labels}} (labels, original\+\_\+labels=None, new\+\_\+label=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a9de9f58390f2e1d905e660c6f3f8b3da}{\+\_\+flip\+\_\+boxes\+\_\+left\+\_\+right}} (boxes)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_ab7aadde1361f08d837700bfdc9e01b13}{\+\_\+flip\+\_\+boxes\+\_\+up\+\_\+down}} (boxes)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a5ed6539fa8576bc65e30e46a3f030140}{\+\_\+rot90\+\_\+boxes}} (boxes)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_aab2ac5f063f9892ff6d043f70b5026e9}{\+\_\+flip\+\_\+masks\+\_\+left\+\_\+right}} (masks)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a916daef65c5c27ef1c9a3efd2d89e80a}{\+\_\+flip\+\_\+masks\+\_\+up\+\_\+down}} (masks)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_ad4f95650b0d5024695ff3d9e18284e3c}{\+\_\+rot90\+\_\+masks}} (masks)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a9ad2674a88326abe9a620d33dc6dbaa7}{random\+\_\+horizontal\+\_\+flip}} (image, boxes=None, masks=None, keypoints=None, keypoint\+\_\+flip\+\_\+permutation=None, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_ae3b102c4ba64515724d250cb08523bf3}{random\+\_\+vertical\+\_\+flip}} (image, boxes=None, masks=None, keypoints=None, keypoint\+\_\+flip\+\_\+permutation=None, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a29eea225a5c9bad4c280532e7e51d401}{random\+\_\+rotation90}} (image, boxes=None, masks=None, keypoints=None, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a8d0c42728a0663d83a70ed01f309c393}{random\+\_\+pixel\+\_\+value\+\_\+scale}} (image, minval=0.\+9, maxval=1.\+1, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_adc0c8803b353e7a6795ba372e1a1640a}{random\+\_\+image\+\_\+scale}} (image, masks=None, min\+\_\+scale\+\_\+ratio=0.\+5, max\+\_\+scale\+\_\+ratio=2.\+0, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a0f844301a276e66ee5b6443f5ea4594b}{\+\_\+augment\+\_\+only\+\_\+rgb\+\_\+channels}} (image, augment\+\_\+function)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a643bc2872b76f353d6f342b56070c112}{random\+\_\+rgb\+\_\+to\+\_\+gray}} (image, probability=0.\+1, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a1a79d5114c3c558ffb325b491e93921a}{random\+\_\+adjust\+\_\+brightness}} (image, max\+\_\+delta=0.\+2, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a299a97f4d9fc15b96cd138d910b0d4d7}{random\+\_\+adjust\+\_\+contrast}} (image, min\+\_\+delta=0.\+8, max\+\_\+delta=1.\+25, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a1840c66a7b36bfefbcf7e2832cdbd881}{random\+\_\+adjust\+\_\+hue}} (image, max\+\_\+delta=0.\+02, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_ab7fcba6b229393eb466d7163c8b27e36}{random\+\_\+adjust\+\_\+saturation}} (image, min\+\_\+delta=0.\+8, max\+\_\+delta=1.\+25, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a6b87ac3b4ca959406f78a5e8f2782848}{random\+\_\+distort\+\_\+color}} (image, color\+\_\+ordering=0, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a882986d9b1f998bc17947fce90f1af4d}{random\+\_\+jitter\+\_\+boxes}} (boxes, ratio=0.\+05, seed=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_ae7996143b3e46240e14ccb89e89f3fe3}{\+\_\+strict\+\_\+random\+\_\+crop\+\_\+image}} (image, boxes, labels, label\+\_\+weights, label\+\_\+confidences=None, multiclass\+\_\+scores=None, masks=None, keypoints=None, min\+\_\+object\+\_\+covered=1.\+0, aspect\+\_\+ratio\+\_\+range=(0.\+75, 1.\+33), area\+\_\+range=(0.\+1, 1.\+0), overlap\+\_\+thresh=0.\+3, clip\+\_\+boxes=True, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_ae53f685c9e071ec37c0829148e5067fe}{random\+\_\+crop\+\_\+image}} (image, boxes, labels, label\+\_\+weights, label\+\_\+confidences=None, multiclass\+\_\+scores=None, masks=None, keypoints=None, min\+\_\+object\+\_\+covered=1.\+0, aspect\+\_\+ratio\+\_\+range=(0.\+75, 1.\+33), area\+\_\+range=(0.\+1, 1.\+0), overlap\+\_\+thresh=0.\+3, clip\+\_\+boxes=True, random\+\_\+coef=0.\+0, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a052201bdd4a37a3579ad79d129b0f4dc}{random\+\_\+pad\+\_\+image}} (image, boxes, keypoints=None, min\+\_\+image\+\_\+size=None, max\+\_\+image\+\_\+size=None, pad\+\_\+color=None, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a3abbb64d99b25decfe25fec40a92a6b9}{random\+\_\+absolute\+\_\+pad\+\_\+image}} (image, boxes, max\+\_\+height\+\_\+padding, max\+\_\+width\+\_\+padding, pad\+\_\+color=None, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_ad862ff65e576da434816a69fd341b3ff}{random\+\_\+crop\+\_\+pad\+\_\+image}} (image, boxes, labels, label\+\_\+weights, label\+\_\+confidences=None, multiclass\+\_\+scores=None, min\+\_\+object\+\_\+covered=1.\+0, aspect\+\_\+ratio\+\_\+range=(0.\+75, 1.\+33), area\+\_\+range=(0.\+1, 1.\+0), overlap\+\_\+thresh=0.\+3, clip\+\_\+boxes=True, random\+\_\+coef=0.\+0, min\+\_\+padded\+\_\+size\+\_\+ratio=(1.\+0, 1.\+0), max\+\_\+padded\+\_\+size\+\_\+ratio=(2.\+0, 2.\+0), pad\+\_\+color=None, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_aed03769aeaaf1e8b96f676996f870e8c}{random\+\_\+crop\+\_\+to\+\_\+aspect\+\_\+ratio}} (image, boxes, labels, label\+\_\+weights, label\+\_\+confidences=None, multiclass\+\_\+scores=None, masks=None, keypoints=None, aspect\+\_\+ratio=1.\+0, overlap\+\_\+thresh=0.\+3, clip\+\_\+boxes=True, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_ab0a1f9342a5127f9b80e0ffdfe94fc59}{random\+\_\+pad\+\_\+to\+\_\+aspect\+\_\+ratio}} (image, boxes, masks=None, keypoints=None, aspect\+\_\+ratio=1.\+0, min\+\_\+padded\+\_\+size\+\_\+ratio=(1.\+0, 1.\+0), max\+\_\+padded\+\_\+size\+\_\+ratio=(2.\+0, 2.\+0), seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a840b20876c98b893ebbca8c363ecb020}{random\+\_\+black\+\_\+patches}} (image, max\+\_\+black\+\_\+patches=10, probability=0.\+5, size\+\_\+to\+\_\+image\+\_\+ratio=0.\+1, random\+\_\+seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a881d3a421a6d182837d12f713e87281f}{autoaugment\+\_\+image}} (image, boxes, policy\+\_\+name=\textquotesingle{}v0\textquotesingle{})
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a3e5b56ca6c5c071667bfe3e86359cd31}{image\+\_\+to\+\_\+float}} (image)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a06cc1c1f5cce3566bc6f1a4a865b613e}{random\+\_\+resize\+\_\+method}} (image, target\+\_\+size, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_aa16c94ed6a6e3e2ee8e39a4a5d0212ba}{resize\+\_\+to\+\_\+range}} (image, masks=None, min\+\_\+dimension=None, max\+\_\+dimension=None, method=tf.\+image.\+Resize\+Method.\+BILINEAR, align\+\_\+corners=False, pad\+\_\+to\+\_\+max\+\_\+dimension=False, per\+\_\+channel\+\_\+pad\+\_\+value=(0, 0, 0))
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a6a294fdb039f62a6de9b9be007481357}{\+\_\+get\+\_\+image\+\_\+info}} (image)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_ae31da8a2456c9fd96e951ec2564a04ef}{resize\+\_\+to\+\_\+min\+\_\+dimension}} (image, masks=None, min\+\_\+dimension=600, method=tf.\+image.\+Resize\+Method.\+BILINEAR)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a0ad8ce6e9aabff130be4839677d2ece3}{resize\+\_\+to\+\_\+max\+\_\+dimension}} (image, masks=None, max\+\_\+dimension=600, method=tf.\+image.\+Resize\+Method.\+BILINEAR)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a0b0e9e173acdfd6bdc495be778c346e3}{scale\+\_\+boxes\+\_\+to\+\_\+pixel\+\_\+coordinates}} (image, boxes, keypoints=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a594f3c0e2cdc3464ad0cf5c85359293b}{resize\+\_\+image}} (image, masks=None, new\+\_\+height=600, new\+\_\+width=1024, method=tf.\+image.\+Resize\+Method.\+BILINEAR, align\+\_\+corners=False)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a42ac33ac786175636312abd4941aa915}{subtract\+\_\+channel\+\_\+mean}} (image, means=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a84b00d370e579ea07663c48b7c6a0696}{one\+\_\+hot\+\_\+encoding}} (labels, num\+\_\+classes=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_aa1129985bff113d599809697210e2628}{rgb\+\_\+to\+\_\+gray}} (image)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a28ed9f2cfed49a54b767a131fb3e7cde}{random\+\_\+self\+\_\+concat\+\_\+image}} (image, boxes, labels, label\+\_\+weights, label\+\_\+confidences=None, multiclass\+\_\+scores=None, concat\+\_\+vertical\+\_\+probability=0.\+1, concat\+\_\+horizontal\+\_\+probability=0.\+1, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a91a2c48d4f04433025c2994248222729}{ssd\+\_\+random\+\_\+crop}} (image, boxes, labels, label\+\_\+weights, label\+\_\+confidences=None, multiclass\+\_\+scores=None, masks=None, keypoints=None, min\+\_\+object\+\_\+covered=(0.\+0, 0.\+1, 0.\+3, 0.\+5, 0.\+7, 0.\+9, 1.\+0), aspect\+\_\+ratio\+\_\+range=((0.\+5, 2.\+0),) \texorpdfstring{$\ast$}{*}7, area\+\_\+range=((0.\+1, 1.\+0),) \texorpdfstring{$\ast$}{*}7, overlap\+\_\+thresh=(0.\+0, 0.\+1, 0.\+3, 0.\+5, 0.\+7, 0.\+9, 1.\+0), clip\+\_\+boxes=(True,) \texorpdfstring{$\ast$}{*}7, random\+\_\+coef=(0.\+15,) \texorpdfstring{$\ast$}{*}7, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a6141ebcaa14a24e9903a50821b45b576}{ssd\+\_\+random\+\_\+crop\+\_\+pad}} (image, boxes, labels, label\+\_\+weights, label\+\_\+confidences=None, multiclass\+\_\+scores=None, min\+\_\+object\+\_\+covered=(0.\+1, 0.\+3, 0.\+5, 0.\+7, 0.\+9, 1.\+0), aspect\+\_\+ratio\+\_\+range=((0.\+5, 2.\+0),) \texorpdfstring{$\ast$}{*}6, area\+\_\+range=((0.\+1, 1.\+0),) \texorpdfstring{$\ast$}{*}6, overlap\+\_\+thresh=(0.\+1, 0.\+3, 0.\+5, 0.\+7, 0.\+9, 1.\+0), clip\+\_\+boxes=(True,) \texorpdfstring{$\ast$}{*}6, random\+\_\+coef=(0.\+15,) \texorpdfstring{$\ast$}{*}6, min\+\_\+padded\+\_\+size\+\_\+ratio=((1.\+0, 1.\+0),) \texorpdfstring{$\ast$}{*}6, max\+\_\+padded\+\_\+size\+\_\+ratio=((2.\+0, 2.\+0),) \texorpdfstring{$\ast$}{*}6, pad\+\_\+color=(None,) \texorpdfstring{$\ast$}{*}6, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_ae771c28299fc187bd974238ae577fb02}{ssd\+\_\+random\+\_\+crop\+\_\+fixed\+\_\+aspect\+\_\+ratio}} (image, boxes, labels, label\+\_\+weights, label\+\_\+confidences=None, multiclass\+\_\+scores=None, masks=None, keypoints=None, min\+\_\+object\+\_\+covered=(0.\+0, 0.\+1, 0.\+3, 0.\+5, 0.\+7, 0.\+9, 1.\+0), aspect\+\_\+ratio=1.\+0, area\+\_\+range=((0.\+1, 1.\+0),) \texorpdfstring{$\ast$}{*}7, overlap\+\_\+thresh=(0.\+0, 0.\+1, 0.\+3, 0.\+5, 0.\+7, 0.\+9, 1.\+0), clip\+\_\+boxes=(True,) \texorpdfstring{$\ast$}{*}7, random\+\_\+coef=(0.\+15,) \texorpdfstring{$\ast$}{*}7, seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_ac4cb1ebd49aea7a953dff66c0b64cc19}{ssd\+\_\+random\+\_\+crop\+\_\+pad\+\_\+fixed\+\_\+aspect\+\_\+ratio}} (image, boxes, labels, label\+\_\+weights, label\+\_\+confidences=None, multiclass\+\_\+scores=None, masks=None, keypoints=None, min\+\_\+object\+\_\+covered=(0.\+0, 0.\+1, 0.\+3, 0.\+5, 0.\+7, 0.\+9, 1.\+0), aspect\+\_\+ratio=1.\+0, aspect\+\_\+ratio\+\_\+range=((0.\+5, 2.\+0),) \texorpdfstring{$\ast$}{*}7, area\+\_\+range=((0.\+1, 1.\+0),) \texorpdfstring{$\ast$}{*}7, overlap\+\_\+thresh=(0.\+0, 0.\+1, 0.\+3, 0.\+5, 0.\+7, 0.\+9, 1.\+0), clip\+\_\+boxes=(True,) \texorpdfstring{$\ast$}{*}7, random\+\_\+coef=(0.\+15,) \texorpdfstring{$\ast$}{*}7, min\+\_\+padded\+\_\+size\+\_\+ratio=(1.\+0, 1.\+0), max\+\_\+padded\+\_\+size\+\_\+ratio=(2.\+0, 2.\+0), seed=None, preprocess\+\_\+vars\+\_\+cache=None)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a7799bfed7d66c1a99cc9da524ec482b1}{convert\+\_\+class\+\_\+logits\+\_\+to\+\_\+softmax}} (multiclass\+\_\+scores, temperature=1.\+0)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_af58a25a2d72d84c921a575c3900c74d0}{get\+\_\+default\+\_\+func\+\_\+arg\+\_\+map}} (include\+\_\+label\+\_\+weights=True, include\+\_\+label\+\_\+confidences=False, include\+\_\+multiclass\+\_\+scores=False, include\+\_\+instance\+\_\+masks=False, include\+\_\+keypoints=False)
\item 
\mbox{\hyperlink{namespacedetection__utils_1_1core_1_1preprocessor_a7806fdbc8bcd478d285ebb8873c8321c}{preprocess}} (tensor\+\_\+dict, preprocess\+\_\+options, func\+\_\+arg\+\_\+map=None, preprocess\+\_\+vars\+\_\+cache=None)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\begin{DoxyVerb}Preprocess images and bounding boxes for detection.

We perform two sets of operations in preprocessing stage:
(a) operations that are applied to both training and testing data,
(b) operations that are applied only to training data for the purpose of
    data augmentation.

A preprocessing function receives a set of inputs,
e.g. an image and bounding boxes,
performs an operation on them, and returns them.
Some examples are: randomly cropping the image, randomly mirroring the image,
                   randomly changing the brightness, contrast, hue and
                   randomly jittering the bounding boxes.

The preprocess function receives a tensor_dict which is a dictionary that maps
different field names to their tensors. For example,
tensor_dict[fields.InputDataFields.image] holds the image tensor.
The image is a rank 4 tensor: [1, height, width, channels] with
dtype=tf.float32. The groundtruth_boxes is a rank 2 tensor: [N, 4] where
in each row there is a box with [ymin xmin ymax xmax].
Boxes are in normalized coordinates meaning
their coordinate values range in [0, 1]

To preprocess multiple images with the same operations in cases where
nondeterministic operations are used, a preprocessor_cache.PreprocessorCache
object can be passed into the preprocess function or individual operations.
All nondeterministic operations except random_jitter_boxes support caching.
E.g.
Let tensor_dict{1,2,3,4,5} be copies of the same inputs.
Let preprocess_options contain nondeterministic operation(s) excluding
random_jitter_boxes.

cache1 = preprocessor_cache.PreprocessorCache()
cache2 = preprocessor_cache.PreprocessorCache()
a = preprocess(tensor_dict1, preprocess_options, preprocess_vars_cache=cache1)
b = preprocess(tensor_dict2, preprocess_options, preprocess_vars_cache=cache1)
c = preprocess(tensor_dict3, preprocess_options, preprocess_vars_cache=cache2)
d = preprocess(tensor_dict4, preprocess_options, preprocess_vars_cache=cache2)
e = preprocess(tensor_dict5, preprocess_options)

Then correspondings tensors of object pairs (a,b) and (c,d)
are guaranteed to be equal element-wise, but the equality of any other object
pair cannot be determined.

Important Note: In tensor_dict, images is a rank 4 tensor, but preprocessing
functions receive a rank 3 tensor for processing the image. Thus, inside the
preprocess function we squeeze the image to become a rank 3 tensor and then
we pass it to the functions. At the end of the preprocess we expand the image
back to rank 4.
\end{DoxyVerb}
 

\doxysubsection{Function Documentation}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a72948ea20f73ededa0777968bb83c27f}\label{namespacedetection__utils_1_1core_1_1preprocessor_a72948ea20f73ededa0777968bb83c27f} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!\_apply\_with\_random\_selector@{\_apply\_with\_random\_selector}}
\index{\_apply\_with\_random\_selector@{\_apply\_with\_random\_selector}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{\_apply\_with\_random\_selector()}{\_apply\_with\_random\_selector()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+\_\+apply\+\_\+with\+\_\+random\+\_\+selector (\begin{DoxyParamCaption}\item[{}]{x,  }\item[{}]{func,  }\item[{}]{num\+\_\+cases,  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None},  }\item[{}]{key = {\ttfamily \textquotesingle{}\textquotesingle{}} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Computes func(x, sel), with sel sampled from [0...num_cases-1].

If both preprocess_vars_cache AND key are the same between two calls, sel will
be the same value in both calls.

Args:
  x: input Tensor.
  func: Python function to apply.
  num_cases: Python int32, number of cases to sample sel from.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.
  key: variable identifier for preprocess_vars_cache.

Returns:
  The result of func(x, sel), where func receives the value of the
  selector as a python integer, but sel is sampled dynamically.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00089}{89}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ key=\textcolor{stringliteral}{''}):}
\DoxyCodeLine{00094\ \ \ \textcolor{stringliteral}{"{}"{}"{}Computes\ func(x,\ sel),\ with\ sel\ sampled\ from\ [0...num\_cases-\/1].}}
\DoxyCodeLine{00095\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00096\ \textcolor{stringliteral}{\ \ If\ both\ preprocess\_vars\_cache\ AND\ key\ are\ the\ same\ between\ two\ calls,\ sel\ will}}
\DoxyCodeLine{00097\ \textcolor{stringliteral}{\ \ be\ the\ same\ value\ }\textcolor{keywordflow}{in}\ both\ calls.}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ Args:}
\DoxyCodeLine{00100\ \ \ \ \ x:\ input\ Tensor.}
\DoxyCodeLine{00101\ \ \ \ \ func:\ Python\ function\ to\ apply.}
\DoxyCodeLine{00102\ \ \ \ \ num\_cases:\ Python\ int32,\ number\ of\ cases\ to\ sample\ sel\ \textcolor{keyword}{from}.}
\DoxyCodeLine{00103\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{00107\ \ \ \ \ key:\ variable\ identifier\ \textcolor{keywordflow}{for}\ preprocess\_vars\_cache.}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ Returns:}
\DoxyCodeLine{00110\ \ \ \ \ The\ result\ of\ func(x,\ sel),\ where\ func\ receives\ the\ value\ of\ the}
\DoxyCodeLine{00111\ \ \ \ \ selector\ \textcolor{keyword}{as}\ a\ python\ integer,\ but\ sel\ \textcolor{keywordflow}{is}\ sampled\ dynamically.}
\DoxyCodeLine{00112\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00113\ \textcolor{stringliteral}{\ \ generator\_func\ =\ functools.partial(}}
\DoxyCodeLine{00114\ \textcolor{stringliteral}{\ \ \ \ \ \ tf.random\_uniform,\ [],\ maxval=num\_cases,\ dtype=tf.int32)}}
\DoxyCodeLine{00115\ \textcolor{stringliteral}{\ \ rand\_sel\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}}
\DoxyCodeLine{00116\ \textcolor{stringliteral}{\ \ \ \ \ \ generator\_func,\ preprocessor\_cache.PreprocessorCache.SELECTOR,}}
\DoxyCodeLine{00117\ \textcolor{stringliteral}{\ \ \ \ \ \ preprocess\_vars\_cache,\ key)}}
\DoxyCodeLine{00118\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00119\ \textcolor{stringliteral}{\ \ }\textcolor{comment}{\#\ Pass\ the\ real\ x\ only\ to\ one\ of\ the\ func\ calls.}}
\DoxyCodeLine{00120\ \ \ \textcolor{keywordflow}{return}\ control\_flow\_ops.merge([func(}
\DoxyCodeLine{00121\ \ \ \ \ \ \ control\_flow\_ops.switch(x,\ tf.equal(rand\_sel,\ case))[1],\ case)}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ case\ \textcolor{keywordflow}{in}\ range(num\_cases)])[0]}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a72948ea20f73ededa0777968bb83c27f_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a72948ea20f73ededa0777968bb83c27f_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a190734dcb563069386fbf10f1cdb044c}\label{namespacedetection__utils_1_1core_1_1preprocessor_a190734dcb563069386fbf10f1cdb044c} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!\_apply\_with\_random\_selector\_tuples@{\_apply\_with\_random\_selector\_tuples}}
\index{\_apply\_with\_random\_selector\_tuples@{\_apply\_with\_random\_selector\_tuples}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{\_apply\_with\_random\_selector\_tuples()}{\_apply\_with\_random\_selector\_tuples()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+\_\+apply\+\_\+with\+\_\+random\+\_\+selector\+\_\+tuples (\begin{DoxyParamCaption}\item[{}]{x,  }\item[{}]{func,  }\item[{}]{num\+\_\+cases,  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None},  }\item[{}]{key = {\ttfamily \textquotesingle{}\textquotesingle{}} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Computes func(x, sel), with sel sampled from [0...num_cases-1].

If both preprocess_vars_cache AND key are the same between two calls, sel will
be the same value in both calls.

Args:
  x: A tuple of input tensors.
  func: Python function to apply.
  num_cases: Python int32, number of cases to sample sel from.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.
  key: variable identifier for preprocess_vars_cache.

Returns:
  The result of func(x, sel), where func receives the value of the
  selector as a python integer, but sel is sampled dynamically.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00125}{125}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ key=\textcolor{stringliteral}{''}):}
\DoxyCodeLine{00130\ \ \ \textcolor{stringliteral}{"{}"{}"{}Computes\ func(x,\ sel),\ with\ sel\ sampled\ from\ [0...num\_cases-\/1].}}
\DoxyCodeLine{00131\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00132\ \textcolor{stringliteral}{\ \ If\ both\ preprocess\_vars\_cache\ AND\ key\ are\ the\ same\ between\ two\ calls,\ sel\ will}}
\DoxyCodeLine{00133\ \textcolor{stringliteral}{\ \ be\ the\ same\ value\ }\textcolor{keywordflow}{in}\ both\ calls.}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ Args:}
\DoxyCodeLine{00136\ \ \ \ \ x:\ A\ tuple\ of\ input\ tensors.}
\DoxyCodeLine{00137\ \ \ \ \ func:\ Python\ function\ to\ apply.}
\DoxyCodeLine{00138\ \ \ \ \ num\_cases:\ Python\ int32,\ number\ of\ cases\ to\ sample\ sel\ \textcolor{keyword}{from}.}
\DoxyCodeLine{00139\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{00143\ \ \ \ \ key:\ variable\ identifier\ \textcolor{keywordflow}{for}\ preprocess\_vars\_cache.}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ Returns:}
\DoxyCodeLine{00146\ \ \ \ \ The\ result\ of\ func(x,\ sel),\ where\ func\ receives\ the\ value\ of\ the}
\DoxyCodeLine{00147\ \ \ \ \ selector\ \textcolor{keyword}{as}\ a\ python\ integer,\ but\ sel\ \textcolor{keywordflow}{is}\ sampled\ dynamically.}
\DoxyCodeLine{00148\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00149\ \textcolor{stringliteral}{\ \ num\_inputs\ =\ len(x)}}
\DoxyCodeLine{00150\ \textcolor{stringliteral}{\ \ generator\_func\ =\ functools.partial(}}
\DoxyCodeLine{00151\ \textcolor{stringliteral}{\ \ \ \ \ \ tf.random\_uniform,\ [],\ maxval=num\_cases,\ dtype=tf.int32)}}
\DoxyCodeLine{00152\ \textcolor{stringliteral}{\ \ rand\_sel\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}}
\DoxyCodeLine{00153\ \textcolor{stringliteral}{\ \ \ \ \ \ generator\_func,\ preprocessor\_cache.PreprocessorCache.SELECTOR\_TUPLES,}}
\DoxyCodeLine{00154\ \textcolor{stringliteral}{\ \ \ \ \ \ preprocess\_vars\_cache,\ key)}}
\DoxyCodeLine{00155\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00156\ \textcolor{stringliteral}{\ \ }\textcolor{comment}{\#\ Pass\ the\ real\ x\ only\ to\ one\ of\ the\ func\ calls.}}
\DoxyCodeLine{00157\ \ \ tuples\ =\ [list()\ \textcolor{keywordflow}{for}\ t\ \textcolor{keywordflow}{in}\ x]}
\DoxyCodeLine{00158\ \ \ \textcolor{keywordflow}{for}\ case\ \textcolor{keywordflow}{in}\ range(num\_cases):}
\DoxyCodeLine{00159\ \ \ \ \ new\_x\ =\ [control\_flow\_ops.switch(t,\ tf.equal(rand\_sel,\ case))[1]\ \textcolor{keywordflow}{for}\ t\ \textcolor{keywordflow}{in}\ x]}
\DoxyCodeLine{00160\ \ \ \ \ output\ =\ func(tuple(new\_x),\ case)}
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keywordflow}{for}\ j\ \textcolor{keywordflow}{in}\ range(num\_inputs):}
\DoxyCodeLine{00162\ \ \ \ \ \ \ tuples[j].append(output[j])}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ range(num\_inputs):}
\DoxyCodeLine{00165\ \ \ \ \ tuples[i]\ =\ control\_flow\_ops.merge(tuples[i])[0]}
\DoxyCodeLine{00166\ \ \ \textcolor{keywordflow}{return}\ tuple(tuples)}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a190734dcb563069386fbf10f1cdb044c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a190734dcb563069386fbf10f1cdb044c_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a0f844301a276e66ee5b6443f5ea4594b}\label{namespacedetection__utils_1_1core_1_1preprocessor_a0f844301a276e66ee5b6443f5ea4594b} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!\_augment\_only\_rgb\_channels@{\_augment\_only\_rgb\_channels}}
\index{\_augment\_only\_rgb\_channels@{\_augment\_only\_rgb\_channels}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{\_augment\_only\_rgb\_channels()}{\_augment\_only\_rgb\_channels()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+\_\+augment\+\_\+only\+\_\+rgb\+\_\+channels (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{augment\+\_\+function }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Augments only the RGB slice of an image with additional channels.\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00945}{945}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00945\ \textcolor{keyword}{def\ }\_augment\_only\_rgb\_channels(image,\ augment\_function):}
\DoxyCodeLine{00946\ \ \ \textcolor{stringliteral}{"{}"{}"{}Augments\ only\ the\ RGB\ slice\ of\ an\ image\ with\ additional\ channels."{}"{}"{}}}
\DoxyCodeLine{00947\ \ \ rgb\_slice\ =\ image[:,\ :,\ :3]}
\DoxyCodeLine{00948\ \ \ augmented\_rgb\_slice\ =\ augment\_function(rgb\_slice)}
\DoxyCodeLine{00949\ \ \ image\ =\ tf.concat([augmented\_rgb\_slice,\ image[:,\ :,\ 3:]],\ -\/1)}
\DoxyCodeLine{00950\ \ \ \textcolor{keywordflow}{return}\ image}
\DoxyCodeLine{00951\ }
\DoxyCodeLine{00952\ }

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a0f844301a276e66ee5b6443f5ea4594b_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a9de9f58390f2e1d905e660c6f3f8b3da}\label{namespacedetection__utils_1_1core_1_1preprocessor_a9de9f58390f2e1d905e660c6f3f8b3da} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!\_flip\_boxes\_left\_right@{\_flip\_boxes\_left\_right}}
\index{\_flip\_boxes\_left\_right@{\_flip\_boxes\_left\_right}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{\_flip\_boxes\_left\_right()}{\_flip\_boxes\_left\_right()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+\_\+flip\+\_\+boxes\+\_\+left\+\_\+right (\begin{DoxyParamCaption}\item[{}]{boxes }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Left-right flip the boxes.

Args:
  boxes: rank 2 float32 tensor containing the bounding boxes -> [N, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].

Returns:
  Flipped boxes.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00461}{461}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00461\ \textcolor{keyword}{def\ }\_flip\_boxes\_left\_right(boxes):}
\DoxyCodeLine{00462\ \ \ \textcolor{stringliteral}{"{}"{}"{}Left-\/right\ flip\ the\ boxes.}}
\DoxyCodeLine{00463\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00464\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{00465\ \textcolor{stringliteral}{\ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ -\/>\ [N,\ 4].}}
\DoxyCodeLine{00466\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ }\textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{00469\ }
\DoxyCodeLine{00470\ \ \ Returns:}
\DoxyCodeLine{00471\ \ \ \ \ Flipped\ boxes.}
\DoxyCodeLine{00472\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00473\ \textcolor{stringliteral}{\ \ ymin,\ xmin,\ ymax,\ xmax\ =\ tf.split(value=boxes,\ num\_or\_size\_splits=4,\ axis=1)}}
\DoxyCodeLine{00474\ \textcolor{stringliteral}{\ \ flipped\_xmin\ =\ tf.subtract(1.0,\ xmax)}}
\DoxyCodeLine{00475\ \textcolor{stringliteral}{\ \ flipped\_xmax\ =\ tf.subtract(1.0,\ xmin)}}
\DoxyCodeLine{00476\ \textcolor{stringliteral}{\ \ flipped\_boxes\ =\ tf.concat([ymin,\ flipped\_xmin,\ ymax,\ flipped\_xmax],\ 1)}}
\DoxyCodeLine{00477\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{return}\ flipped\_boxes}
\DoxyCodeLine{00478\ }
\DoxyCodeLine{00479\ }

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a9de9f58390f2e1d905e660c6f3f8b3da_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_ab7aadde1361f08d837700bfdc9e01b13}\label{namespacedetection__utils_1_1core_1_1preprocessor_ab7aadde1361f08d837700bfdc9e01b13} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!\_flip\_boxes\_up\_down@{\_flip\_boxes\_up\_down}}
\index{\_flip\_boxes\_up\_down@{\_flip\_boxes\_up\_down}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{\_flip\_boxes\_up\_down()}{\_flip\_boxes\_up\_down()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+\_\+flip\+\_\+boxes\+\_\+up\+\_\+down (\begin{DoxyParamCaption}\item[{}]{boxes }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Up-down flip the boxes.

Args:
  boxes: rank 2 float32 tensor containing the bounding boxes -> [N, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].

Returns:
  Flipped boxes.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00480}{480}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00480\ \textcolor{keyword}{def\ }\_flip\_boxes\_up\_down(boxes):}
\DoxyCodeLine{00481\ \ \ \textcolor{stringliteral}{"{}"{}"{}Up-\/down\ flip\ the\ boxes.}}
\DoxyCodeLine{00482\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00483\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{00484\ \textcolor{stringliteral}{\ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ -\/>\ [N,\ 4].}}
\DoxyCodeLine{00485\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ }\textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{00488\ }
\DoxyCodeLine{00489\ \ \ Returns:}
\DoxyCodeLine{00490\ \ \ \ \ Flipped\ boxes.}
\DoxyCodeLine{00491\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00492\ \textcolor{stringliteral}{\ \ ymin,\ xmin,\ ymax,\ xmax\ =\ tf.split(value=boxes,\ num\_or\_size\_splits=4,\ axis=1)}}
\DoxyCodeLine{00493\ \textcolor{stringliteral}{\ \ flipped\_ymin\ =\ tf.subtract(1.0,\ ymax)}}
\DoxyCodeLine{00494\ \textcolor{stringliteral}{\ \ flipped\_ymax\ =\ tf.subtract(1.0,\ ymin)}}
\DoxyCodeLine{00495\ \textcolor{stringliteral}{\ \ flipped\_boxes\ =\ tf.concat([flipped\_ymin,\ xmin,\ flipped\_ymax,\ xmax],\ 1)}}
\DoxyCodeLine{00496\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{return}\ flipped\_boxes}
\DoxyCodeLine{00497\ }
\DoxyCodeLine{00498\ }

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_ab7aadde1361f08d837700bfdc9e01b13_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_aab2ac5f063f9892ff6d043f70b5026e9}\label{namespacedetection__utils_1_1core_1_1preprocessor_aab2ac5f063f9892ff6d043f70b5026e9} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!\_flip\_masks\_left\_right@{\_flip\_masks\_left\_right}}
\index{\_flip\_masks\_left\_right@{\_flip\_masks\_left\_right}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{\_flip\_masks\_left\_right()}{\_flip\_masks\_left\_right()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+\_\+flip\+\_\+masks\+\_\+left\+\_\+right (\begin{DoxyParamCaption}\item[{}]{masks }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Left-right flip masks.

Args:
  masks: rank 3 float32 tensor with shape
    [num_instances, height, width] representing instance masks.

Returns:
  flipped masks: rank 3 float32 tensor with shape
    [num_instances, height, width] representing instance masks.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00521}{521}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00521\ \textcolor{keyword}{def\ }\_flip\_masks\_left\_right(masks):}
\DoxyCodeLine{00522\ \ \ \textcolor{stringliteral}{"{}"{}"{}Left-\/right\ flip\ masks.}}
\DoxyCodeLine{00523\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00524\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{00525\ \textcolor{stringliteral}{\ \ \ \ masks:\ rank\ 3\ float32\ tensor\ }\textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00526\ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ representing\ instance\ masks.}
\DoxyCodeLine{00527\ }
\DoxyCodeLine{00528\ \ \ Returns:}
\DoxyCodeLine{00529\ \ \ \ \ flipped\ masks:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00530\ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ representing\ instance\ masks.}
\DoxyCodeLine{00531\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00532\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{return}\ masks[:,\ :,\ ::-\/1]}
\DoxyCodeLine{00533\ }
\DoxyCodeLine{00534\ }

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_aab2ac5f063f9892ff6d043f70b5026e9_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a916daef65c5c27ef1c9a3efd2d89e80a}\label{namespacedetection__utils_1_1core_1_1preprocessor_a916daef65c5c27ef1c9a3efd2d89e80a} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!\_flip\_masks\_up\_down@{\_flip\_masks\_up\_down}}
\index{\_flip\_masks\_up\_down@{\_flip\_masks\_up\_down}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{\_flip\_masks\_up\_down()}{\_flip\_masks\_up\_down()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+\_\+flip\+\_\+masks\+\_\+up\+\_\+down (\begin{DoxyParamCaption}\item[{}]{masks }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Up-down flip masks.

Args:
  masks: rank 3 float32 tensor with shape
    [num_instances, height, width] representing instance masks.

Returns:
  flipped masks: rank 3 float32 tensor with shape
    [num_instances, height, width] representing instance masks.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00535}{535}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00535\ \textcolor{keyword}{def\ }\_flip\_masks\_up\_down(masks):}
\DoxyCodeLine{00536\ \ \ \textcolor{stringliteral}{"{}"{}"{}Up-\/down\ flip\ masks.}}
\DoxyCodeLine{00537\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00538\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{00539\ \textcolor{stringliteral}{\ \ \ \ masks:\ rank\ 3\ float32\ tensor\ }\textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00540\ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ representing\ instance\ masks.}
\DoxyCodeLine{00541\ }
\DoxyCodeLine{00542\ \ \ Returns:}
\DoxyCodeLine{00543\ \ \ \ \ flipped\ masks:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00544\ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ representing\ instance\ masks.}
\DoxyCodeLine{00545\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00546\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{return}\ masks[:,\ ::-\/1,\ :]}
\DoxyCodeLine{00547\ }
\DoxyCodeLine{00548\ }

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a916daef65c5c27ef1c9a3efd2d89e80a_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a6a294fdb039f62a6de9b9be007481357}\label{namespacedetection__utils_1_1core_1_1preprocessor_a6a294fdb039f62a6de9b9be007481357} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!\_get\_image\_info@{\_get\_image\_info}}
\index{\_get\_image\_info@{\_get\_image\_info}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{\_get\_image\_info()}{\_get\_image\_info()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+\_\+get\+\_\+image\+\_\+info (\begin{DoxyParamCaption}\item[{}]{image }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Returns the height, width and number of channels in the image.\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l02470}{2470}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02470\ \textcolor{keyword}{def\ }\_get\_image\_info(image):}
\DoxyCodeLine{02471\ \ \ \textcolor{stringliteral}{"{}"{}"{}Returns\ the\ height,\ width\ and\ number\ of\ channels\ in\ the\ image."{}"{}"{}}}
\DoxyCodeLine{02472\ \ \ image\_height\ =\ tf.shape(image)[0]}
\DoxyCodeLine{02473\ \ \ image\_width\ =\ tf.shape(image)[1]}
\DoxyCodeLine{02474\ \ \ num\_channels\ =\ tf.shape(image)[2]}
\DoxyCodeLine{02475\ \ \ \textcolor{keywordflow}{return}\ (image\_height,\ image\_width,\ num\_channels)}
\DoxyCodeLine{02476\ }
\DoxyCodeLine{02477\ }
\DoxyCodeLine{02478\ \textcolor{comment}{\#\ TODO(alirezafathi):\ Make\ sure\ the\ static\ shapes\ are\ preserved.}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a6a294fdb039f62a6de9b9be007481357_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a8fea0b9f060eea936fac7e5dd5102df7}\label{namespacedetection__utils_1_1core_1_1preprocessor_a8fea0b9f060eea936fac7e5dd5102df7} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!\_get\_or\_create\_preprocess\_rand\_vars@{\_get\_or\_create\_preprocess\_rand\_vars}}
\index{\_get\_or\_create\_preprocess\_rand\_vars@{\_get\_or\_create\_preprocess\_rand\_vars}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{\_get\_or\_create\_preprocess\_rand\_vars()}{\_get\_or\_create\_preprocess\_rand\_vars()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+\_\+get\+\_\+or\+\_\+create\+\_\+preprocess\+\_\+rand\+\_\+vars (\begin{DoxyParamCaption}\item[{}]{generator\+\_\+func,  }\item[{}]{function\+\_\+id,  }\item[{}]{preprocess\+\_\+vars\+\_\+cache,  }\item[{}]{key = {\ttfamily \textquotesingle{}\textquotesingle{}} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Returns a tensor stored in preprocess_vars_cache or using generator_func.

If the tensor was previously generated and appears in the PreprocessorCache,
the previously generated tensor will be returned. Otherwise, a new tensor
is generated using generator_func and stored in the cache.

Args:
  generator_func: A 0-argument function that generates a tensor.
  function_id: identifier for the preprocessing function used.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.
  key: identifier for the variable stored.
Returns:
  The generated tensor.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00169}{169}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ key=\textcolor{stringliteral}{''}):}
\DoxyCodeLine{00173\ \ \ \textcolor{stringliteral}{"{}"{}"{}Returns\ a\ tensor\ stored\ in\ preprocess\_vars\_cache\ or\ using\ generator\_func.}}
\DoxyCodeLine{00174\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00175\ \textcolor{stringliteral}{\ \ If\ the\ tensor\ was\ previously\ generated\ }\textcolor{keywordflow}{and}\ appears\ \textcolor{keywordflow}{in}\ the\ PreprocessorCache,}
\DoxyCodeLine{00176\ \ \ the\ previously\ generated\ tensor\ will\ be\ returned.\ Otherwise,\ a\ new\ tensor}
\DoxyCodeLine{00177\ \ \ \textcolor{keywordflow}{is}\ generated\ using\ generator\_func\ \textcolor{keywordflow}{and}\ stored\ \textcolor{keywordflow}{in}\ the\ cache.}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ Args:}
\DoxyCodeLine{00180\ \ \ \ \ generator\_func:\ A\ 0-\/argument\ function\ that\ generates\ a\ tensor.}
\DoxyCodeLine{00181\ \ \ \ \ function\_id:\ identifier\ \textcolor{keywordflow}{for}\ the\ preprocessing\ function\ used.}
\DoxyCodeLine{00182\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{00186\ \ \ \ \ key:\ identifier\ \textcolor{keywordflow}{for}\ the\ variable\ stored.}
\DoxyCodeLine{00187\ \ \ Returns:}
\DoxyCodeLine{00188\ \ \ \ \ The\ generated\ tensor.}
\DoxyCodeLine{00189\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00190\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{if}\ preprocess\_vars\_cache\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00191\ \ \ \ \ var\ =\ preprocess\_vars\_cache.get(function\_id,\ key)}
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keywordflow}{if}\ var\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00193\ \ \ \ \ \ \ var\ =\ generator\_func()}
\DoxyCodeLine{00194\ \ \ \ \ \ \ preprocess\_vars\_cache.update(function\_id,\ key,\ var)}
\DoxyCodeLine{00195\ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00196\ \ \ \ \ var\ =\ generator\_func()}
\DoxyCodeLine{00197\ \ \ \textcolor{keywordflow}{return}\ var}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ }

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a8fea0b9f060eea936fac7e5dd5102df7_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a3338c3143bc5c5a5f5cbf32be983a2f7}\label{namespacedetection__utils_1_1core_1_1preprocessor_a3338c3143bc5c5a5f5cbf32be983a2f7} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!\_random\_integer@{\_random\_integer}}
\index{\_random\_integer@{\_random\_integer}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{\_random\_integer()}{\_random\_integer()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+\_\+random\+\_\+integer (\begin{DoxyParamCaption}\item[{}]{minval,  }\item[{}]{maxval,  }\item[{}]{seed }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Returns a random 0-D tensor between minval and maxval.

Args:
  minval: minimum value of the random tensor.
  maxval: maximum value of the random tensor.
  seed: random seed.

Returns:
  A random 0-D tensor between minval and maxval.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00200}{200}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00200\ \textcolor{keyword}{def\ }\_random\_integer(minval,\ maxval,\ seed):}
\DoxyCodeLine{00201\ \ \ \textcolor{stringliteral}{"{}"{}"{}Returns\ a\ random\ 0-\/D\ tensor\ between\ minval\ and\ maxval.}}
\DoxyCodeLine{00202\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00203\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{00204\ \textcolor{stringliteral}{\ \ \ \ minval:\ minimum\ value\ of\ the\ random\ tensor.}}
\DoxyCodeLine{00205\ \textcolor{stringliteral}{\ \ \ \ maxval:\ maximum\ value\ of\ the\ random\ tensor.}}
\DoxyCodeLine{00206\ \textcolor{stringliteral}{\ \ \ \ seed:\ random\ seed.}}
\DoxyCodeLine{00207\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00208\ \textcolor{stringliteral}{\ \ Returns:}}
\DoxyCodeLine{00209\ \textcolor{stringliteral}{\ \ \ \ A\ random\ 0-\/D\ tensor\ between\ minval\ }\textcolor{keywordflow}{and}\ maxval.}
\DoxyCodeLine{00210\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00211\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{return}\ tf.random\_uniform(}
\DoxyCodeLine{00212\ \ \ \ \ \ \ [],\ minval=minval,\ maxval=maxval,\ dtype=tf.int32,\ seed=seed)}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \textcolor{comment}{\#\ TODO(mttang):\ This\ method\ is\ needed\ because\ the\ current}}
\DoxyCodeLine{00216\ \textcolor{comment}{\#\ tf.image.rgb\_to\_grayscale\ method\ does\ not\ support\ quantization.\ Replace\ with}}
\DoxyCodeLine{00217\ \textcolor{comment}{\#\ tf.image.rgb\_to\_grayscale\ after\ quantization\ support\ is\ added.}}

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a3338c3143bc5c5a5f5cbf32be983a2f7_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a21e6f1c05910c4acb3c33771326514b5}\label{namespacedetection__utils_1_1core_1_1preprocessor_a21e6f1c05910c4acb3c33771326514b5} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!\_rgb\_to\_grayscale@{\_rgb\_to\_grayscale}}
\index{\_rgb\_to\_grayscale@{\_rgb\_to\_grayscale}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{\_rgb\_to\_grayscale()}{\_rgb\_to\_grayscale()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+\_\+rgb\+\_\+to\+\_\+grayscale (\begin{DoxyParamCaption}\item[{}]{images,  }\item[{}]{name = {\ttfamily None} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Converts one or more images from RGB to Grayscale.

Outputs a tensor of the same `DType` and rank as `images`.  The size of the
last dimension of the output is 1, containing the Grayscale value of the
pixels.

Args:
  images: The RGB tensor to convert. Last dimension must have size 3 and
    should contain RGB values.
  name: A name for the operation (optional).

Returns:
  The converted grayscale image(s).
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00218}{218}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00218\ \textcolor{keyword}{def\ }\_rgb\_to\_grayscale(images,\ name=None):}
\DoxyCodeLine{00219\ \ \ \textcolor{stringliteral}{"{}"{}"{}Converts\ one\ or\ more\ images\ from\ RGB\ to\ Grayscale.}}
\DoxyCodeLine{00220\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00221\ \textcolor{stringliteral}{\ \ Outputs\ a\ tensor\ of\ the\ same\ \`{}DType\`{}\ }\textcolor{keywordflow}{and}\ rank\ \textcolor{keyword}{as}\ \`{}images\`{}.\ \ The\ size\ of\ the}
\DoxyCodeLine{00222\ \ \ last\ dimension\ of\ the\ output\ \textcolor{keywordflow}{is}\ 1,\ containing\ the\ Grayscale\ value\ of\ the}
\DoxyCodeLine{00223\ \ \ pixels.}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ Args:}
\DoxyCodeLine{00226\ \ \ \ \ images:\ The\ RGB\ tensor\ to\ convert.\ Last\ dimension\ must\ have\ size\ 3\ \textcolor{keywordflow}{and}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ should\ contain\ RGB\ values.}
\DoxyCodeLine{00228\ \ \ \ \ name:\ A\ name\ \textcolor{keywordflow}{for}\ the\ operation\ (optional).}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ Returns:}
\DoxyCodeLine{00231\ \ \ \ \ The\ converted\ grayscale\ image(s).}
\DoxyCodeLine{00232\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00233\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{with}\ tf.name\_scope(name,\ \textcolor{stringliteral}{'rgb\_to\_grayscale'},\ [images])\ \textcolor{keyword}{as}\ name:}
\DoxyCodeLine{00234\ \ \ \ \ images\ =\ tf.convert\_to\_tensor(images,\ name=\textcolor{stringliteral}{'images'})}
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{comment}{\#\ Remember\ original\ dtype\ to\ so\ we\ can\ convert\ back\ if\ needed}}
\DoxyCodeLine{00236\ \ \ \ \ orig\_dtype\ =\ images.dtype}
\DoxyCodeLine{00237\ \ \ \ \ flt\_image\ =\ tf.image.convert\_image\_dtype(images,\ tf.float32)}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \ \ \textcolor{comment}{\#\ Reference\ for\ converting\ between\ RGB\ and\ grayscale.}}
\DoxyCodeLine{00240\ \ \ \ \ \textcolor{comment}{\#\ https://en.wikipedia.org/wiki/Luma\_\%28video\%29}}
\DoxyCodeLine{00241\ \ \ \ \ rgb\_weights\ =\ [0.2989,\ 0.5870,\ 0.1140]}
\DoxyCodeLine{00242\ \ \ \ \ rank\_1\ =\ tf.expand\_dims(tf.rank(images)\ -\/\ 1,\ 0)}
\DoxyCodeLine{00243\ \ \ \ \ gray\_float\ =\ tf.reduce\_sum(}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ flt\_image\ *\ rgb\_weights,\ rank\_1,\ keep\_dims=\textcolor{keyword}{True})}
\DoxyCodeLine{00245\ \ \ \ \ gray\_float.set\_shape(images.get\_shape()[:-\/1].concatenate([1]))}
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{keywordflow}{return}\ tf.image.convert\_image\_dtype(gray\_float,\ orig\_dtype,\ name=name)}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ }

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a21e6f1c05910c4acb3c33771326514b5_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a5ed6539fa8576bc65e30e46a3f030140}\label{namespacedetection__utils_1_1core_1_1preprocessor_a5ed6539fa8576bc65e30e46a3f030140} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!\_rot90\_boxes@{\_rot90\_boxes}}
\index{\_rot90\_boxes@{\_rot90\_boxes}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{\_rot90\_boxes()}{\_rot90\_boxes()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+\_\+rot90\+\_\+boxes (\begin{DoxyParamCaption}\item[{}]{boxes }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Rotate boxes counter-clockwise by 90 degrees.

Args:
  boxes: rank 2 float32 tensor containing the bounding boxes -> [N, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].

Returns:
  Rotated boxes.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00499}{499}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00499\ \textcolor{keyword}{def\ }\_rot90\_boxes(boxes):}
\DoxyCodeLine{00500\ \ \ \textcolor{stringliteral}{"{}"{}"{}Rotate\ boxes\ counter-\/clockwise\ by\ 90\ degrees.}}
\DoxyCodeLine{00501\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00502\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{00503\ \textcolor{stringliteral}{\ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ -\/>\ [N,\ 4].}}
\DoxyCodeLine{00504\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ }\textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ Returns:}
\DoxyCodeLine{00509\ \ \ \ \ Rotated\ boxes.}
\DoxyCodeLine{00510\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00511\ \textcolor{stringliteral}{\ \ ymin,\ xmin,\ ymax,\ xmax\ =\ tf.split(value=boxes,\ num\_or\_size\_splits=4,\ axis=1)}}
\DoxyCodeLine{00512\ \textcolor{stringliteral}{\ \ rotated\_ymin\ =\ tf.subtract(1.0,\ xmax)}}
\DoxyCodeLine{00513\ \textcolor{stringliteral}{\ \ rotated\_ymax\ =\ tf.subtract(1.0,\ xmin)}}
\DoxyCodeLine{00514\ \textcolor{stringliteral}{\ \ rotated\_xmin\ =\ ymin}}
\DoxyCodeLine{00515\ \textcolor{stringliteral}{\ \ rotated\_xmax\ =\ ymax}}
\DoxyCodeLine{00516\ \textcolor{stringliteral}{\ \ rotated\_boxes\ =\ tf.concat(}}
\DoxyCodeLine{00517\ \textcolor{stringliteral}{\ \ \ \ \ \ [rotated\_ymin,\ rotated\_xmin,\ rotated\_ymax,\ rotated\_xmax],\ 1)}}
\DoxyCodeLine{00518\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{return}\ rotated\_boxes}
\DoxyCodeLine{00519\ }
\DoxyCodeLine{00520\ }

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a5ed6539fa8576bc65e30e46a3f030140_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_ad4f95650b0d5024695ff3d9e18284e3c}\label{namespacedetection__utils_1_1core_1_1preprocessor_ad4f95650b0d5024695ff3d9e18284e3c} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!\_rot90\_masks@{\_rot90\_masks}}
\index{\_rot90\_masks@{\_rot90\_masks}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{\_rot90\_masks()}{\_rot90\_masks()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+\_\+rot90\+\_\+masks (\begin{DoxyParamCaption}\item[{}]{masks }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Rotate masks counter-clockwise by 90 degrees.

Args:
  masks: rank 3 float32 tensor with shape
    [num_instances, height, width] representing instance masks.

Returns:
  rotated masks: rank 3 float32 tensor with shape
    [num_instances, height, width] representing instance masks.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00549}{549}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00549\ \textcolor{keyword}{def\ }\_rot90\_masks(masks):}
\DoxyCodeLine{00550\ \ \ \textcolor{stringliteral}{"{}"{}"{}Rotate\ masks\ counter-\/clockwise\ by\ 90\ degrees.}}
\DoxyCodeLine{00551\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00552\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{00553\ \textcolor{stringliteral}{\ \ \ \ masks:\ rank\ 3\ float32\ tensor\ }\textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00554\ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ representing\ instance\ masks.}
\DoxyCodeLine{00555\ }
\DoxyCodeLine{00556\ \ \ Returns:}
\DoxyCodeLine{00557\ \ \ \ \ rotated\ masks:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00558\ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ representing\ instance\ masks.}
\DoxyCodeLine{00559\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00560\ \textcolor{stringliteral}{\ \ masks\ =\ tf.transpose(masks,\ [0,\ 2,\ 1])}}
\DoxyCodeLine{00561\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{return}\ masks[:,\ ::-\/1,\ :]}
\DoxyCodeLine{00562\ }
\DoxyCodeLine{00563\ }

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_ad4f95650b0d5024695ff3d9e18284e3c_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_ae7996143b3e46240e14ccb89e89f3fe3}\label{namespacedetection__utils_1_1core_1_1preprocessor_ae7996143b3e46240e14ccb89e89f3fe3} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!\_strict\_random\_crop\_image@{\_strict\_random\_crop\_image}}
\index{\_strict\_random\_crop\_image@{\_strict\_random\_crop\_image}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{\_strict\_random\_crop\_image()}{\_strict\_random\_crop\_image()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+\_\+strict\+\_\+random\+\_\+crop\+\_\+image (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{boxes,  }\item[{}]{labels,  }\item[{}]{label\+\_\+weights,  }\item[{}]{label\+\_\+confidences = {\ttfamily None},  }\item[{}]{multiclass\+\_\+scores = {\ttfamily None},  }\item[{}]{masks = {\ttfamily None},  }\item[{}]{keypoints = {\ttfamily None},  }\item[{}]{min\+\_\+object\+\_\+covered = {\ttfamily 1.0},  }\item[{}]{aspect\+\_\+ratio\+\_\+range = {\ttfamily (0.75,~1.33)},  }\item[{}]{area\+\_\+range = {\ttfamily (0.1,~1.0)},  }\item[{}]{overlap\+\_\+thresh = {\ttfamily 0.3},  }\item[{}]{clip\+\_\+boxes = {\ttfamily True},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

\begin{DoxyVerb}Performs random crop.

Note: Keypoint coordinates that are outside the crop will be set to NaN, which
is consistent with the original keypoint encoding for non-existing keypoints.
This function always crops the image and is supposed to be used by
`random_crop_image` function which sometimes returns the image unchanged.

Args:
  image: rank 3 float32 tensor containing 1 image -> [height, width, channels]
         with pixel values varying between [0, 1].
  boxes: rank 2 float32 tensor containing the bounding boxes with shape
         [num_instances, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].
  labels: rank 1 int32 tensor containing the object classes.
  label_weights: float32 tensor of shape [num_instances] representing the
    weight for each box.
  label_confidences: (optional) float32 tensor of shape [num_instances]
    representing the confidence for each box.
  multiclass_scores: (optional) float32 tensor of shape
    [num_instances, num_classes] representing the score for each box for each
    class.
  masks: (optional) rank 3 float32 tensor with shape
         [num_instances, height, width] containing instance masks. The masks
         are of the same height, width as the input `image`.
  keypoints: (optional) rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]. The keypoints are in y-x
             normalized coordinates.
  min_object_covered: the cropped image must cover at least this fraction of
                      at least one of the input bounding boxes.
  aspect_ratio_range: allowed range for aspect ratio of cropped image.
  area_range: allowed range for area ratio between cropped image and the
              original image.
  overlap_thresh: minimum overlap thresh with new cropped
                  image to keep the box.
  clip_boxes: whether to clip the boxes to the cropped image.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: image which is the same rank as input image.
  boxes: boxes which is the same rank as input boxes.
         Boxes are in normalized form.
  labels: new labels.

  If label_weights, multiclass_scores, masks, or keypoints is not None, the
  function also returns:
  label_weights: rank 1 float32 tensor with shape [num_instances].
  multiclass_scores: rank 2 float32 tensor with shape
                     [num_instances, num_classes]
  masks: rank 3 float32 tensor with shape [num_instances, height, width]
         containing instance masks.
  keypoints: rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l01253}{1253}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{01267\ \ \ \textcolor{stringliteral}{"{}"{}"{}Performs\ random\ crop.}}
\DoxyCodeLine{01268\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01269\ \textcolor{stringliteral}{\ \ Note:\ Keypoint\ coordinates\ that\ are\ outside\ the\ crop\ will\ be\ set\ to\ NaN,\ which}}
\DoxyCodeLine{01270\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{is}\ consistent\ \textcolor{keyword}{with}\ the\ original\ keypoint\ encoding\ \textcolor{keywordflow}{for}\ non-\/existing\ keypoints.}
\DoxyCodeLine{01271\ \ \ This\ function\ always\ crops\ the\ image\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{is}\ supposed\ to\ be\ used\ by}
\DoxyCodeLine{01272\ \ \ \`{}random\_crop\_image\`{}\ function\ which\ sometimes\ returns\ the\ image\ unchanged.}
\DoxyCodeLine{01273\ }
\DoxyCodeLine{01274\ \ \ Args:}
\DoxyCodeLine{01275\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ containing\ 1\ image\ -\/>\ [height,\ width,\ channels]}
\DoxyCodeLine{01276\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 1].}
\DoxyCodeLine{01277\ \ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{01278\ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ 4].}
\DoxyCodeLine{01279\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{01280\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{01281\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{01282\ \ \ \ \ labels:\ rank\ 1\ int32\ tensor\ containing\ the\ object\ classes.}
\DoxyCodeLine{01283\ \ \ \ \ label\_weights:\ float32\ tensor\ of\ shape\ [num\_instances]\ representing\ the}
\DoxyCodeLine{01284\ \ \ \ \ \ \ weight\ \textcolor{keywordflow}{for}\ each\ box.}
\DoxyCodeLine{01285\ \ \ \ \ label\_confidences:\ (optional)\ float32\ tensor\ of\ shape\ [num\_instances]}
\DoxyCodeLine{01286\ \ \ \ \ \ \ representing\ the\ confidence\ \textcolor{keywordflow}{for}\ each\ box.}
\DoxyCodeLine{01287\ \ \ \ \ multiclass\_scores:\ (optional)\ float32\ tensor\ of\ shape}
\DoxyCodeLine{01288\ \ \ \ \ \ \ [num\_instances,\ num\_classes]\ representing\ the\ score\ \textcolor{keywordflow}{for}\ each\ box\ \textcolor{keywordflow}{for}\ each}
\DoxyCodeLine{01289\ \ \ \ \ \ \ \textcolor{keyword}{class}.}
\DoxyCodeLine{01290\ \ \ \ \ masks:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{01291\ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ containing\ instance\ masks.\ The\ masks}
\DoxyCodeLine{01292\ \ \ \ \ \ \ \ \ \ \ \ are\ of\ the\ same\ height,\ width\ \textcolor{keyword}{as}\ the\ input\ \`{}image\`{}.}
\DoxyCodeLine{01293\ \ \ \ \ keypoints:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{01294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2].\ The\ keypoints\ are\ \textcolor{keywordflow}{in}\ y-\/x}
\DoxyCodeLine{01295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ normalized\ coordinates.}
\DoxyCodeLine{01296\ \ \ \ \ min\_object\_covered:\ the\ cropped\ image\ must\ cover\ at\ least\ this\ fraction\ of}
\DoxyCodeLine{01297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ at\ least\ one\ of\ the\ input\ bounding\ boxes.}
\DoxyCodeLine{01298\ \ \ \ \ aspect\_ratio\_range:\ allowed\ range\ \textcolor{keywordflow}{for}\ aspect\ ratio\ of\ cropped\ image.}
\DoxyCodeLine{01299\ \ \ \ \ area\_range:\ allowed\ range\ \textcolor{keywordflow}{for}\ area\ ratio\ between\ cropped\ image\ \textcolor{keywordflow}{and}\ the}
\DoxyCodeLine{01300\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.}
\DoxyCodeLine{01301\ \ \ \ \ overlap\_thresh:\ minimum\ overlap\ thresh\ \textcolor{keyword}{with}\ new\ cropped}
\DoxyCodeLine{01302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ image\ to\ keep\ the\ box.}
\DoxyCodeLine{01303\ \ \ \ \ clip\_boxes:\ whether\ to\ clip\ the\ boxes\ to\ the\ cropped\ image.}
\DoxyCodeLine{01304\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{01305\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{01306\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{01307\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{01308\ }
\DoxyCodeLine{01309\ \ \ Returns:}
\DoxyCodeLine{01310\ \ \ \ \ image:\ image\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ image.}
\DoxyCodeLine{01311\ \ \ \ \ boxes:\ boxes\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ boxes.}
\DoxyCodeLine{01312\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form.}
\DoxyCodeLine{01313\ \ \ \ \ labels:\ new\ labels.}
\DoxyCodeLine{01314\ }
\DoxyCodeLine{01315\ \ \ \ \ If\ label\_weights,\ multiclass\_scores,\ masks,\ \textcolor{keywordflow}{or}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},\ the}
\DoxyCodeLine{01316\ \ \ \ \ function\ also\ returns:}
\DoxyCodeLine{01317\ \ \ \ \ label\_weights:\ rank\ 1\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [num\_instances].}
\DoxyCodeLine{01318\ \ \ \ \ multiclass\_scores:\ rank\ 2\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{01319\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_classes]}
\DoxyCodeLine{01320\ \ \ \ \ masks:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [num\_instances,\ height,\ width]}
\DoxyCodeLine{01321\ \ \ \ \ \ \ \ \ \ \ \ containing\ instance\ masks.}
\DoxyCodeLine{01322\ \ \ \ \ keypoints:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{01323\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2]}
\DoxyCodeLine{01324\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{01325\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'RandomCropImage'},\ values=[image,\ boxes]):}
\DoxyCodeLine{01326\ \ \ \ \ image\_shape\ =\ tf.shape(image)}
\DoxyCodeLine{01327\ }
\DoxyCodeLine{01328\ \ \ \ \ \textcolor{comment}{\#\ boxes\ are\ [N,\ 4].\ Lets\ first\ make\ them\ [N,\ 1,\ 4].}}
\DoxyCodeLine{01329\ \ \ \ \ boxes\_expanded\ =\ tf.expand\_dims(}
\DoxyCodeLine{01330\ \ \ \ \ \ \ \ \ tf.clip\_by\_value(}
\DoxyCodeLine{01331\ \ \ \ \ \ \ \ \ \ \ \ \ boxes,\ clip\_value\_min=0.0,\ clip\_value\_max=1.0),\ 1)}
\DoxyCodeLine{01332\ }
\DoxyCodeLine{01333\ \ \ \ \ generator\_func\ =\ functools.partial(}
\DoxyCodeLine{01334\ \ \ \ \ \ \ \ \ tf.image.sample\_distorted\_bounding\_box,}
\DoxyCodeLine{01335\ \ \ \ \ \ \ \ \ image\_shape,}
\DoxyCodeLine{01336\ \ \ \ \ \ \ \ \ bounding\_boxes=boxes\_expanded,}
\DoxyCodeLine{01337\ \ \ \ \ \ \ \ \ min\_object\_covered=min\_object\_covered,}
\DoxyCodeLine{01338\ \ \ \ \ \ \ \ \ aspect\_ratio\_range=aspect\_ratio\_range,}
\DoxyCodeLine{01339\ \ \ \ \ \ \ \ \ area\_range=area\_range,}
\DoxyCodeLine{01340\ \ \ \ \ \ \ \ \ max\_attempts=100,}
\DoxyCodeLine{01341\ \ \ \ \ \ \ \ \ use\_image\_if\_no\_bounding\_boxes=\textcolor{keyword}{True})}
\DoxyCodeLine{01342\ }
\DoxyCodeLine{01343\ \ \ \ \ \textcolor{comment}{\#\ for\ ssd\ cropping,\ each\ value\ of\ min\_object\_covered\ has\ its\ own}}
\DoxyCodeLine{01344\ \ \ \ \ \textcolor{comment}{\#\ cached\ random\ variable}}
\DoxyCodeLine{01345\ \ \ \ \ sample\_distorted\_bounding\_box\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}
\DoxyCodeLine{01346\ \ \ \ \ \ \ \ \ generator\_func,}
\DoxyCodeLine{01347\ \ \ \ \ \ \ \ \ preprocessor\_cache.PreprocessorCache.STRICT\_CROP\_IMAGE,}
\DoxyCodeLine{01348\ \ \ \ \ \ \ \ \ preprocess\_vars\_cache,\ key=min\_object\_covered)}
\DoxyCodeLine{01349\ }
\DoxyCodeLine{01350\ \ \ \ \ im\_box\_begin,\ im\_box\_size,\ im\_box\ =\ sample\_distorted\_bounding\_box}
\DoxyCodeLine{01351\ }
\DoxyCodeLine{01352\ \ \ \ \ new\_image\ =\ tf.slice(image,\ im\_box\_begin,\ im\_box\_size)}
\DoxyCodeLine{01353\ \ \ \ \ new\_image.set\_shape([\textcolor{keywordtype}{None},\ \textcolor{keywordtype}{None},\ image.get\_shape()[2]])}
\DoxyCodeLine{01354\ }
\DoxyCodeLine{01355\ \ \ \ \ \textcolor{comment}{\#\ [1,\ 4]}}
\DoxyCodeLine{01356\ \ \ \ \ im\_box\_rank2\ =\ tf.squeeze(im\_box,\ axis=[0])}
\DoxyCodeLine{01357\ \ \ \ \ \textcolor{comment}{\#\ [4]}}
\DoxyCodeLine{01358\ \ \ \ \ im\_box\_rank1\ =\ tf.squeeze(im\_box)}
\DoxyCodeLine{01359\ }
\DoxyCodeLine{01360\ \ \ \ \ boxlist\ =\ box\_list.BoxList(boxes)}
\DoxyCodeLine{01361\ \ \ \ \ boxlist.add\_field(\textcolor{stringliteral}{'labels'},\ labels)}
\DoxyCodeLine{01362\ }
\DoxyCodeLine{01363\ \ \ \ \ \textcolor{keywordflow}{if}\ label\_weights\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01364\ \ \ \ \ \ \ boxlist.add\_field(\textcolor{stringliteral}{'label\_weights'},\ label\_weights)}
\DoxyCodeLine{01365\ }
\DoxyCodeLine{01366\ \ \ \ \ \textcolor{keywordflow}{if}\ label\_confidences\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01367\ \ \ \ \ \ \ boxlist.add\_field(\textcolor{stringliteral}{'label\_confidences'},\ label\_confidences)}
\DoxyCodeLine{01368\ }
\DoxyCodeLine{01369\ \ \ \ \ \textcolor{keywordflow}{if}\ multiclass\_scores\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01370\ \ \ \ \ \ \ boxlist.add\_field(\textcolor{stringliteral}{'multiclass\_scores'},\ multiclass\_scores)}
\DoxyCodeLine{01371\ }
\DoxyCodeLine{01372\ \ \ \ \ im\_boxlist\ =\ box\_list.BoxList(im\_box\_rank2)}
\DoxyCodeLine{01373\ }
\DoxyCodeLine{01374\ \ \ \ \ \textcolor{comment}{\#\ remove\ boxes\ that\ are\ outside\ cropped\ image}}
\DoxyCodeLine{01375\ \ \ \ \ boxlist,\ inside\_window\_ids\ =\ box\_list\_ops.prune\_completely\_outside\_window(}
\DoxyCodeLine{01376\ \ \ \ \ \ \ \ \ boxlist,\ im\_box\_rank1)}
\DoxyCodeLine{01377\ }
\DoxyCodeLine{01378\ \ \ \ \ \textcolor{comment}{\#\ remove\ boxes\ that\ are\ outside\ image}}
\DoxyCodeLine{01379\ \ \ \ \ overlapping\_boxlist,\ keep\_ids\ =\ box\_list\_ops.prune\_non\_overlapping\_boxes(}
\DoxyCodeLine{01380\ \ \ \ \ \ \ \ \ boxlist,\ im\_boxlist,\ overlap\_thresh)}
\DoxyCodeLine{01381\ }
\DoxyCodeLine{01382\ \ \ \ \ \textcolor{comment}{\#\ change\ the\ coordinate\ of\ the\ remaining\ boxes}}
\DoxyCodeLine{01383\ \ \ \ \ new\_labels\ =\ overlapping\_boxlist.get\_field(\textcolor{stringliteral}{'labels'})}
\DoxyCodeLine{01384\ \ \ \ \ new\_boxlist\ =\ box\_list\_ops.change\_coordinate\_frame(overlapping\_boxlist,}
\DoxyCodeLine{01385\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im\_box\_rank1)}
\DoxyCodeLine{01386\ \ \ \ \ new\_boxes\ =\ new\_boxlist.get()}
\DoxyCodeLine{01387\ \ \ \ \ \textcolor{keywordflow}{if}\ clip\_boxes:}
\DoxyCodeLine{01388\ \ \ \ \ \ \ new\_boxes\ =\ tf.clip\_by\_value(}
\DoxyCodeLine{01389\ \ \ \ \ \ \ \ \ \ \ new\_boxes,\ clip\_value\_min=0.0,\ clip\_value\_max=1.0)}
\DoxyCodeLine{01390\ }
\DoxyCodeLine{01391\ \ \ \ \ result\ =\ [new\_image,\ new\_boxes,\ new\_labels]}
\DoxyCodeLine{01392\ }
\DoxyCodeLine{01393\ \ \ \ \ \textcolor{keywordflow}{if}\ label\_weights\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01394\ \ \ \ \ \ \ new\_label\_weights\ =\ overlapping\_boxlist.get\_field(\textcolor{stringliteral}{'label\_weights'})}
\DoxyCodeLine{01395\ \ \ \ \ \ \ result.append(new\_label\_weights)}
\DoxyCodeLine{01396\ }
\DoxyCodeLine{01397\ \ \ \ \ \textcolor{keywordflow}{if}\ label\_confidences\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01398\ \ \ \ \ \ \ new\_label\_confidences\ =\ overlapping\_boxlist.get\_field(\textcolor{stringliteral}{'label\_confidences'})}
\DoxyCodeLine{01399\ \ \ \ \ \ \ result.append(new\_label\_confidences)}
\DoxyCodeLine{01400\ }
\DoxyCodeLine{01401\ \ \ \ \ \textcolor{keywordflow}{if}\ multiclass\_scores\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01402\ \ \ \ \ \ \ new\_multiclass\_scores\ =\ overlapping\_boxlist.get\_field(\textcolor{stringliteral}{'multiclass\_scores'})}
\DoxyCodeLine{01403\ \ \ \ \ \ \ result.append(new\_multiclass\_scores)}
\DoxyCodeLine{01404\ }
\DoxyCodeLine{01405\ \ \ \ \ \textcolor{keywordflow}{if}\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01406\ \ \ \ \ \ \ masks\_of\_boxes\_inside\_window\ =\ tf.gather(masks,\ inside\_window\_ids)}
\DoxyCodeLine{01407\ \ \ \ \ \ \ masks\_of\_boxes\_completely\_inside\_window\ =\ tf.gather(}
\DoxyCodeLine{01408\ \ \ \ \ \ \ \ \ \ \ masks\_of\_boxes\_inside\_window,\ keep\_ids)}
\DoxyCodeLine{01409\ \ \ \ \ \ \ masks\_box\_begin\ =\ [0,\ im\_box\_begin[0],\ im\_box\_begin[1]]}
\DoxyCodeLine{01410\ \ \ \ \ \ \ masks\_box\_size\ =\ [-\/1,\ im\_box\_size[0],\ im\_box\_size[1]]}
\DoxyCodeLine{01411\ \ \ \ \ \ \ new\_masks\ =\ tf.slice(}
\DoxyCodeLine{01412\ \ \ \ \ \ \ \ \ \ \ masks\_of\_boxes\_completely\_inside\_window,}
\DoxyCodeLine{01413\ \ \ \ \ \ \ \ \ \ \ masks\_box\_begin,\ masks\_box\_size)}
\DoxyCodeLine{01414\ \ \ \ \ \ \ result.append(new\_masks)}
\DoxyCodeLine{01415\ }
\DoxyCodeLine{01416\ \ \ \ \ \textcolor{keywordflow}{if}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01417\ \ \ \ \ \ \ keypoints\_of\_boxes\_inside\_window\ =\ tf.gather(keypoints,\ inside\_window\_ids)}
\DoxyCodeLine{01418\ \ \ \ \ \ \ keypoints\_of\_boxes\_completely\_inside\_window\ =\ tf.gather(}
\DoxyCodeLine{01419\ \ \ \ \ \ \ \ \ \ \ keypoints\_of\_boxes\_inside\_window,\ keep\_ids)}
\DoxyCodeLine{01420\ \ \ \ \ \ \ new\_keypoints\ =\ keypoint\_ops.change\_coordinate\_frame(}
\DoxyCodeLine{01421\ \ \ \ \ \ \ \ \ \ \ keypoints\_of\_boxes\_completely\_inside\_window,\ im\_box\_rank1)}
\DoxyCodeLine{01422\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ clip\_boxes:}
\DoxyCodeLine{01423\ \ \ \ \ \ \ \ \ new\_keypoints\ =\ keypoint\_ops.prune\_outside\_window(new\_keypoints,}
\DoxyCodeLine{01424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [0.0,\ 0.0,\ 1.0,\ 1.0])}
\DoxyCodeLine{01425\ \ \ \ \ \ \ result.append(new\_keypoints)}
\DoxyCodeLine{01426\ }
\DoxyCodeLine{01427\ \ \ \ \ \textcolor{keywordflow}{return}\ tuple(result)}
\DoxyCodeLine{01428\ }
\DoxyCodeLine{01429\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_ae7996143b3e46240e14ccb89e89f3fe3_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_ae7996143b3e46240e14ccb89e89f3fe3_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a881d3a421a6d182837d12f713e87281f}\label{namespacedetection__utils_1_1core_1_1preprocessor_a881d3a421a6d182837d12f713e87281f} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!autoaugment\_image@{autoaugment\_image}}
\index{autoaugment\_image@{autoaugment\_image}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{autoaugment\_image()}{autoaugment\_image()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+autoaugment\+\_\+image (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{boxes,  }\item[{}]{policy\+\_\+name = {\ttfamily \textquotesingle{}v0\textquotesingle{}} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Apply an autoaugment policy to the image and boxes.


Args:
  image: rank 3 float32 tensor contains 1 image -> [height, width, channels]
         with pixel values varying between [0, 255].
  boxes: rank 2 float32 tensor containing the bounding boxes with shape
         [num_instances, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].
  policy_name: The name of the AutoAugment policy to use. The available
    options are `v0`, `v1`, `v2`, `v3` and `test`. `v0` is the policy used for
    all of the results in the paper and was found to achieve the best results
    on the COCO dataset. `v1`, `v2` and `v3` are additional good policies
    found on the COCO dataset that have slight variation in what operations
    were used during the search procedure along with how many operations are
    applied in parallel to a single image (2 vs 3).


Returns:
  image: the augmented image.
  boxes: boxes which is the same rank as input boxes. Boxes are in normalized
         form. boxes will have been augmented along with image.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l02288}{2288}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02288\ \textcolor{keyword}{def\ }autoaugment\_image(image,\ boxes,\ policy\_name='v0'):}
\DoxyCodeLine{02289\ \ \ \textcolor{stringliteral}{"{}"{}"{}Apply\ an\ autoaugment\ policy\ to\ the\ image\ and\ boxes.}}
\DoxyCodeLine{02290\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02291\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02292\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{02293\ \textcolor{stringliteral}{\ \ \ \ image:\ rank\ 3\ float32\ tensor\ contains\ 1\ image\ -\/>\ [height,\ width,\ channels]}}
\DoxyCodeLine{02294\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ }\textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 255].}
\DoxyCodeLine{02295\ \ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{02296\ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ 4].}
\DoxyCodeLine{02297\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{02298\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{02299\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{02300\ \ \ \ \ policy\_name:\ The\ name\ of\ the\ AutoAugment\ policy\ to\ use.\ The\ available}
\DoxyCodeLine{02301\ \ \ \ \ \ \ options\ are\ \`{}v0\`{},\ \`{}v1\`{},\ \`{}v2\`{},\ \`{}v3\`{}\ \textcolor{keywordflow}{and}\ \`{}test\`{}.\ \`{}v0\`{}\ \textcolor{keywordflow}{is}\ the\ policy\ used\ \textcolor{keywordflow}{for}}
\DoxyCodeLine{02302\ \ \ \ \ \ \ all\ of\ the\ results\ \textcolor{keywordflow}{in}\ the\ paper\ \textcolor{keywordflow}{and}\ was\ found\ to\ achieve\ the\ best\ results}
\DoxyCodeLine{02303\ \ \ \ \ \ \ on\ the\ COCO\ dataset.\ \`{}v1\`{},\ \`{}v2\`{}\ \textcolor{keywordflow}{and}\ \`{}v3\`{}\ are\ additional\ good\ policies}
\DoxyCodeLine{02304\ \ \ \ \ \ \ found\ on\ the\ COCO\ dataset\ that\ have\ slight\ variation\ \textcolor{keywordflow}{in}\ what\ operations}
\DoxyCodeLine{02305\ \ \ \ \ \ \ were\ used\ during\ the\ search\ procedure\ along\ \textcolor{keyword}{with}\ how\ many\ operations\ are}
\DoxyCodeLine{02306\ \ \ \ \ \ \ applied\ \textcolor{keywordflow}{in}\ parallel\ to\ a\ single\ image\ (2\ vs\ 3).}
\DoxyCodeLine{02307\ }
\DoxyCodeLine{02308\ }
\DoxyCodeLine{02309\ \ \ Returns:}
\DoxyCodeLine{02310\ \ \ \ \ image:\ the\ augmented\ image.}
\DoxyCodeLine{02311\ \ \ \ \ boxes:\ boxes\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ boxes.\ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized}
\DoxyCodeLine{02312\ \ \ \ \ \ \ \ \ \ \ \ form.\ boxes\ will\ have\ been\ augmented\ along\ \textcolor{keyword}{with}\ image.}
\DoxyCodeLine{02313\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{02314\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{return}\ autoaugment\_utils.distort\_image\_with\_autoaugment(}
\DoxyCodeLine{02315\ \ \ \ \ \ \ image,\ boxes,\ policy\_name)}
\DoxyCodeLine{02316\ }
\DoxyCodeLine{02317\ }

\end{DoxyCode}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a7799bfed7d66c1a99cc9da524ec482b1}\label{namespacedetection__utils_1_1core_1_1preprocessor_a7799bfed7d66c1a99cc9da524ec482b1} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!convert\_class\_logits\_to\_softmax@{convert\_class\_logits\_to\_softmax}}
\index{convert\_class\_logits\_to\_softmax@{convert\_class\_logits\_to\_softmax}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{convert\_class\_logits\_to\_softmax()}{convert\_class\_logits\_to\_softmax()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+convert\+\_\+class\+\_\+logits\+\_\+to\+\_\+softmax (\begin{DoxyParamCaption}\item[{}]{multiclass\+\_\+scores,  }\item[{}]{temperature = {\ttfamily 1.0} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Converts multiclass logits to softmax scores after applying temperature.

Args:
  multiclass_scores: float32 tensor of shape
    [num_instances, num_classes] representing the score for each box for each
    class.
  temperature: Scale factor to use prior to applying softmax. Larger
    temperatures give more uniform distruibutions after softmax.

Returns:
  multiclass_scores: float32 tensor of shape
    [num_instances, num_classes] with scaling and softmax applied.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l03405}{3405}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03405\ \textcolor{keyword}{def\ }convert\_class\_logits\_to\_softmax(multiclass\_scores,\ temperature=1.0):}
\DoxyCodeLine{03406\ \ \ \textcolor{stringliteral}{"{}"{}"{}Converts\ multiclass\ logits\ to\ softmax\ scores\ after\ applying\ temperature.}}
\DoxyCodeLine{03407\ \textcolor{stringliteral}{}}
\DoxyCodeLine{03408\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{03409\ \textcolor{stringliteral}{\ \ \ \ multiclass\_scores:\ float32\ tensor\ of\ shape}}
\DoxyCodeLine{03410\ \textcolor{stringliteral}{\ \ \ \ \ \ [num\_instances,\ num\_classes]\ representing\ the\ score\ }\textcolor{keywordflow}{for}\ each\ box\ \textcolor{keywordflow}{for}\ each}
\DoxyCodeLine{03411\ \ \ \ \ \ \ \textcolor{keyword}{class}.}
\DoxyCodeLine{03412\ \ \ \ \ temperature:\ Scale\ factor\ to\ use\ prior\ to\ applying\ softmax.\ Larger}
\DoxyCodeLine{03413\ \ \ \ \ \ \ temperatures\ give\ more\ uniform\ distruibutions\ after\ softmax.}
\DoxyCodeLine{03414\ }
\DoxyCodeLine{03415\ \ \ Returns:}
\DoxyCodeLine{03416\ \ \ \ \ multiclass\_scores:\ float32\ tensor\ of\ shape}
\DoxyCodeLine{03417\ \ \ \ \ \ \ [num\_instances,\ num\_classes]\ \textcolor{keyword}{with}\ scaling\ \textcolor{keywordflow}{and}\ softmax\ applied.}
\DoxyCodeLine{03418\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{03419\ \textcolor{stringliteral}{}}
\DoxyCodeLine{03420\ \textcolor{stringliteral}{\ \ }\textcolor{comment}{\#\ Multiclass\ scores\ must\ be\ stored\ as\ logits.\ Apply\ temp\ and\ softmax.}}
\DoxyCodeLine{03421\ \ \ multiclass\_scores\_scaled\ =\ tf.divide(}
\DoxyCodeLine{03422\ \ \ \ \ \ \ multiclass\_scores,\ temperature,\ name=\textcolor{stringliteral}{'scale\_logits'})}
\DoxyCodeLine{03423\ \ \ multiclass\_scores\ =\ tf.nn.softmax(multiclass\_scores\_scaled,\ name=\textcolor{stringliteral}{'softmax'})}
\DoxyCodeLine{03424\ }
\DoxyCodeLine{03425\ \ \ \textcolor{keywordflow}{return}\ multiclass\_scores}
\DoxyCodeLine{03426\ }
\DoxyCodeLine{03427\ }

\end{DoxyCode}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a326551a2f9d710995bf095ba1de2f76e}\label{namespacedetection__utils_1_1core_1_1preprocessor_a326551a2f9d710995bf095ba1de2f76e} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!drop\_label\_probabilistically@{drop\_label\_probabilistically}}
\index{drop\_label\_probabilistically@{drop\_label\_probabilistically}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{drop\_label\_probabilistically()}{drop\_label\_probabilistically()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+drop\+\_\+label\+\_\+probabilistically (\begin{DoxyParamCaption}\item[{}]{boxes,  }\item[{}]{labels,  }\item[{}]{label\+\_\+weights,  }\item[{}]{label\+\_\+confidences = {\ttfamily None},  }\item[{}]{multiclass\+\_\+scores = {\ttfamily None},  }\item[{}]{masks = {\ttfamily None},  }\item[{}]{keypoints = {\ttfamily None},  }\item[{}]{dropped\+\_\+label = {\ttfamily None},  }\item[{}]{drop\+\_\+probability = {\ttfamily 0.0},  }\item[{}]{seed = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Drops boxes of a certain label with probability drop_probability.

Boxes of the label dropped_label will not appear in the returned tensor.

Args:
  boxes: float32 tensor of shape [num_instance, 4] representing boxes
    location in normalized coordinates.
  labels: rank 1 int32 tensor of shape [num_instance] containing the object
    classes.
  label_weights: float32 tensor of shape [num_instance] representing the
    weight for each box.
  label_confidences: float32 tensor of shape [num_instance] representing the
    confidence for each box.
  multiclass_scores: (optional) float32 tensor of shape
    [num_instances, num_classes] representing the score for each box for each
    class.
  masks: (optional) rank 3 float32 tensor with shape
    [num_instances, height, width] containing instance masks. The masks are of
    the same height, width as the input `image`.
  keypoints: (optional) rank 3 float32 tensor with shape
    [num_instances, num_keypoints, 2]. The keypoints are in y-x normalized
    coordinates.
  dropped_label: int32 id of label to drop.
  drop_probability: float32 probability of dropping a label.
  seed: random seed.

Returns:
  retained_boxes: [num_retained_instance, 4]
  retianed_labels: [num_retained_instance]
  retained_label_weights: [num_retained_instance]

  If multiclass_scores, masks, or keypoints are not None, the function also
    returns:

  retained_multiclass_scores: [num_retained_instance, num_classes]
  retained_masks: [num_retained_instance, height, width]
  retained_keypoints: [num_retained_instance, num_keypoints, 2]
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00355}{355}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ seed=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{00365\ \ \ \textcolor{stringliteral}{"{}"{}"{}Drops\ boxes\ of\ a\ certain\ label\ with\ probability\ drop\_probability.}}
\DoxyCodeLine{00366\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00367\ \textcolor{stringliteral}{\ \ Boxes\ of\ the\ label\ dropped\_label\ will\ }\textcolor{keywordflow}{not}\ appear\ \textcolor{keywordflow}{in}\ the\ returned\ tensor.}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \ \ Args:}
\DoxyCodeLine{00370\ \ \ \ \ boxes:\ float32\ tensor\ of\ shape\ [num\_instance,\ 4]\ representing\ boxes}
\DoxyCodeLine{00371\ \ \ \ \ \ \ location\ \textcolor{keywordflow}{in}\ normalized\ coordinates.}
\DoxyCodeLine{00372\ \ \ \ \ labels:\ rank\ 1\ int32\ tensor\ of\ shape\ [num\_instance]\ containing\ the\ object}
\DoxyCodeLine{00373\ \ \ \ \ \ \ classes.}
\DoxyCodeLine{00374\ \ \ \ \ label\_weights:\ float32\ tensor\ of\ shape\ [num\_instance]\ representing\ the}
\DoxyCodeLine{00375\ \ \ \ \ \ \ weight\ \textcolor{keywordflow}{for}\ each\ box.}
\DoxyCodeLine{00376\ \ \ \ \ label\_confidences:\ float32\ tensor\ of\ shape\ [num\_instance]\ representing\ the}
\DoxyCodeLine{00377\ \ \ \ \ \ \ confidence\ \textcolor{keywordflow}{for}\ each\ box.}
\DoxyCodeLine{00378\ \ \ \ \ multiclass\_scores:\ (optional)\ float32\ tensor\ of\ shape}
\DoxyCodeLine{00379\ \ \ \ \ \ \ [num\_instances,\ num\_classes]\ representing\ the\ score\ \textcolor{keywordflow}{for}\ each\ box\ \textcolor{keywordflow}{for}\ each}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \textcolor{keyword}{class}.}
\DoxyCodeLine{00381\ \ \ \ \ masks:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00382\ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ containing\ instance\ masks.\ The\ masks\ are\ of}
\DoxyCodeLine{00383\ \ \ \ \ \ \ the\ same\ height,\ width\ \textcolor{keyword}{as}\ the\ input\ \`{}image\`{}.}
\DoxyCodeLine{00384\ \ \ \ \ keypoints:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00385\ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2].\ The\ keypoints\ are\ \textcolor{keywordflow}{in}\ y-\/x\ normalized}
\DoxyCodeLine{00386\ \ \ \ \ \ \ coordinates.}
\DoxyCodeLine{00387\ \ \ \ \ dropped\_label:\ int32\ id\ of\ label\ to\ drop.}
\DoxyCodeLine{00388\ \ \ \ \ drop\_probability:\ float32\ probability\ of\ dropping\ a\ label.}
\DoxyCodeLine{00389\ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{00390\ }
\DoxyCodeLine{00391\ \ \ Returns:}
\DoxyCodeLine{00392\ \ \ \ \ retained\_boxes:\ [num\_retained\_instance,\ 4]}
\DoxyCodeLine{00393\ \ \ \ \ retianed\_labels:\ [num\_retained\_instance]}
\DoxyCodeLine{00394\ \ \ \ \ retained\_label\_weights:\ [num\_retained\_instance]}
\DoxyCodeLine{00395\ }
\DoxyCodeLine{00396\ \ \ \ \ If\ multiclass\_scores,\ masks,\ \textcolor{keywordflow}{or}\ keypoints\ are\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},\ the\ function\ also}
\DoxyCodeLine{00397\ \ \ \ \ \ \ returns:}
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00399\ \ \ \ \ retained\_multiclass\_scores:\ [num\_retained\_instance,\ num\_classes]}
\DoxyCodeLine{00400\ \ \ \ \ retained\_masks:\ [num\_retained\_instance,\ height,\ width]}
\DoxyCodeLine{00401\ \ \ \ \ retained\_keypoints:\ [num\_retained\_instance,\ num\_keypoints,\ 2]}
\DoxyCodeLine{00402\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00403\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'DropLabelProbabilistically'},}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ values=[boxes,\ labels]):}
\DoxyCodeLine{00405\ \ \ \ \ indices\ =\ tf.where(}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ tf.logical\_or(}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \ \ \ \ tf.random\_uniform(tf.shape(labels),\ seed=seed)\ >\ drop\_probability,}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \ \ \ \ tf.not\_equal(labels,\ dropped\_label)))}
\DoxyCodeLine{00409\ \ \ \ \ indices\ =\ tf.squeeze(indices,\ axis=1)}
\DoxyCodeLine{00410\ }
\DoxyCodeLine{00411\ \ \ \ \ retained\_boxes\ =\ tf.gather(boxes,\ indices)}
\DoxyCodeLine{00412\ \ \ \ \ retained\_labels\ =\ tf.gather(labels,\ indices)}
\DoxyCodeLine{00413\ \ \ \ \ retained\_label\_weights\ =\ tf.gather(label\_weights,\ indices)}
\DoxyCodeLine{00414\ \ \ \ \ result\ =\ [retained\_boxes,\ retained\_labels,\ retained\_label\_weights]}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00416\ \ \ \ \ \textcolor{keywordflow}{if}\ label\_confidences\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00417\ \ \ \ \ \ \ retained\_label\_confidences\ =\ tf.gather(label\_confidences,\ indices)}
\DoxyCodeLine{00418\ \ \ \ \ \ \ result.append(retained\_label\_confidences)}
\DoxyCodeLine{00419\ }
\DoxyCodeLine{00420\ \ \ \ \ \textcolor{keywordflow}{if}\ multiclass\_scores\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00421\ \ \ \ \ \ \ retained\_multiclass\_scores\ =\ tf.gather(multiclass\_scores,\ indices)}
\DoxyCodeLine{00422\ \ \ \ \ \ \ result.append(retained\_multiclass\_scores)}
\DoxyCodeLine{00423\ }
\DoxyCodeLine{00424\ \ \ \ \ \textcolor{keywordflow}{if}\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00425\ \ \ \ \ \ \ retained\_masks\ =\ tf.gather(masks,\ indices)}
\DoxyCodeLine{00426\ \ \ \ \ \ \ result.append(retained\_masks)}
\DoxyCodeLine{00427\ }
\DoxyCodeLine{00428\ \ \ \ \ \textcolor{keywordflow}{if}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00429\ \ \ \ \ \ \ retained\_keypoints\ =\ tf.gather(keypoints,\ indices)}
\DoxyCodeLine{00430\ \ \ \ \ \ \ result.append(retained\_keypoints)}
\DoxyCodeLine{00431\ }
\DoxyCodeLine{00432\ \ \ \ \ \textcolor{keywordflow}{return}\ result}
\DoxyCodeLine{00433\ }
\DoxyCodeLine{00434\ }

\end{DoxyCode}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_af58a25a2d72d84c921a575c3900c74d0}\label{namespacedetection__utils_1_1core_1_1preprocessor_af58a25a2d72d84c921a575c3900c74d0} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!get\_default\_func\_arg\_map@{get\_default\_func\_arg\_map}}
\index{get\_default\_func\_arg\_map@{get\_default\_func\_arg\_map}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{get\_default\_func\_arg\_map()}{get\_default\_func\_arg\_map()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+get\+\_\+default\+\_\+func\+\_\+arg\+\_\+map (\begin{DoxyParamCaption}\item[{}]{include\+\_\+label\+\_\+weights = {\ttfamily True},  }\item[{}]{include\+\_\+label\+\_\+confidences = {\ttfamily False},  }\item[{}]{include\+\_\+multiclass\+\_\+scores = {\ttfamily False},  }\item[{}]{include\+\_\+instance\+\_\+masks = {\ttfamily False},  }\item[{}]{include\+\_\+keypoints = {\ttfamily False} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Returns the default mapping from a preprocessor function to its args.

Args:
  include_label_weights: If True, preprocessing functions will modify the
    label weights, too.
  include_label_confidences: If True, preprocessing functions will modify the
    label confidences, too.
  include_multiclass_scores: If True, preprocessing functions will modify the
    multiclass scores, too.
  include_instance_masks: If True, preprocessing functions will modify the
    instance masks, too.
  include_keypoints: If True, preprocessing functions will modify the
    keypoints, too.

Returns:
  A map from preprocessing functions to the arguments they receive.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l03428}{3428}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03432\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ include\_keypoints=\textcolor{keyword}{False}):}
\DoxyCodeLine{03433\ \ \ \textcolor{stringliteral}{"{}"{}"{}Returns\ the\ default\ mapping\ from\ a\ preprocessor\ function\ to\ its\ args.}}
\DoxyCodeLine{03434\ \textcolor{stringliteral}{}}
\DoxyCodeLine{03435\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{03436\ \textcolor{stringliteral}{\ \ \ \ include\_label\_weights:\ If\ }\textcolor{keyword}{True},\ preprocessing\ functions\ will\ modify\ the}
\DoxyCodeLine{03437\ \ \ \ \ \ \ label\ weights,\ too.}
\DoxyCodeLine{03438\ \ \ \ \ include\_label\_confidences:\ If\ \textcolor{keyword}{True},\ preprocessing\ functions\ will\ modify\ the}
\DoxyCodeLine{03439\ \ \ \ \ \ \ label\ confidences,\ too.}
\DoxyCodeLine{03440\ \ \ \ \ include\_multiclass\_scores:\ If\ \textcolor{keyword}{True},\ preprocessing\ functions\ will\ modify\ the}
\DoxyCodeLine{03441\ \ \ \ \ \ \ multiclass\ scores,\ too.}
\DoxyCodeLine{03442\ \ \ \ \ include\_instance\_masks:\ If\ \textcolor{keyword}{True},\ preprocessing\ functions\ will\ modify\ the}
\DoxyCodeLine{03443\ \ \ \ \ \ \ instance\ masks,\ too.}
\DoxyCodeLine{03444\ \ \ \ \ include\_keypoints:\ If\ \textcolor{keyword}{True},\ preprocessing\ functions\ will\ modify\ the}
\DoxyCodeLine{03445\ \ \ \ \ \ \ keypoints,\ too.}
\DoxyCodeLine{03446\ }
\DoxyCodeLine{03447\ \ \ Returns:}
\DoxyCodeLine{03448\ \ \ \ \ A\ map\ \textcolor{keyword}{from}\ preprocessing\ functions\ to\ the\ arguments\ they\ receive.}
\DoxyCodeLine{03449\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{03450\ \textcolor{stringliteral}{\ \ groundtruth\_label\_weights\ =\ }\textcolor{keywordtype}{None}}
\DoxyCodeLine{03451\ \ \ \textcolor{keywordflow}{if}\ include\_label\_weights:}
\DoxyCodeLine{03452\ \ \ \ \ groundtruth\_label\_weights\ =\ (}
\DoxyCodeLine{03453\ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_weights)}
\DoxyCodeLine{03454\ }
\DoxyCodeLine{03455\ \ \ groundtruth\_label\_confidences\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{03456\ \ \ \textcolor{keywordflow}{if}\ include\_label\_confidences:}
\DoxyCodeLine{03457\ \ \ \ \ groundtruth\_label\_confidences\ =\ (}
\DoxyCodeLine{03458\ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_confidences)}
\DoxyCodeLine{03459\ }
\DoxyCodeLine{03460\ \ \ multiclass\_scores\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{03461\ \ \ \textcolor{keywordflow}{if}\ include\_multiclass\_scores:}
\DoxyCodeLine{03462\ \ \ \ \ multiclass\_scores\ =\ (fields.InputDataFields.multiclass\_scores)}
\DoxyCodeLine{03463\ }
\DoxyCodeLine{03464\ \ \ groundtruth\_instance\_masks\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{03465\ \ \ \textcolor{keywordflow}{if}\ include\_instance\_masks:}
\DoxyCodeLine{03466\ \ \ \ \ groundtruth\_instance\_masks\ =\ (}
\DoxyCodeLine{03467\ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_instance\_masks)}
\DoxyCodeLine{03468\ }
\DoxyCodeLine{03469\ \ \ groundtruth\_keypoints\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{03470\ \ \ \textcolor{keywordflow}{if}\ include\_keypoints:}
\DoxyCodeLine{03471\ \ \ \ \ groundtruth\_keypoints\ =\ fields.InputDataFields.groundtruth\_keypoints}
\DoxyCodeLine{03472\ }
\DoxyCodeLine{03473\ \ \ prep\_func\_arg\_map\ =\ \{}
\DoxyCodeLine{03474\ \ \ \ \ \ \ normalize\_image:\ (fields.InputDataFields.image,),}
\DoxyCodeLine{03475\ \ \ \ \ \ \ random\_horizontal\_flip:\ (}
\DoxyCodeLine{03476\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.image,}
\DoxyCodeLine{03477\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_boxes,}
\DoxyCodeLine{03478\ \ \ \ \ \ \ \ \ \ \ groundtruth\_instance\_masks,}
\DoxyCodeLine{03479\ \ \ \ \ \ \ \ \ \ \ groundtruth\_keypoints,}
\DoxyCodeLine{03480\ \ \ \ \ \ \ ),}
\DoxyCodeLine{03481\ \ \ \ \ \ \ random\_vertical\_flip:\ (}
\DoxyCodeLine{03482\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.image,}
\DoxyCodeLine{03483\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_boxes,}
\DoxyCodeLine{03484\ \ \ \ \ \ \ \ \ \ \ groundtruth\_instance\_masks,}
\DoxyCodeLine{03485\ \ \ \ \ \ \ \ \ \ \ groundtruth\_keypoints,}
\DoxyCodeLine{03486\ \ \ \ \ \ \ ),}
\DoxyCodeLine{03487\ \ \ \ \ \ \ random\_rotation90:\ (}
\DoxyCodeLine{03488\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.image,}
\DoxyCodeLine{03489\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_boxes,}
\DoxyCodeLine{03490\ \ \ \ \ \ \ \ \ \ \ groundtruth\_instance\_masks,}
\DoxyCodeLine{03491\ \ \ \ \ \ \ \ \ \ \ groundtruth\_keypoints,}
\DoxyCodeLine{03492\ \ \ \ \ \ \ ),}
\DoxyCodeLine{03493\ \ \ \ \ \ \ random\_pixel\_value\_scale:\ (fields.InputDataFields.image,),}
\DoxyCodeLine{03494\ \ \ \ \ \ \ random\_image\_scale:\ (}
\DoxyCodeLine{03495\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.image,}
\DoxyCodeLine{03496\ \ \ \ \ \ \ \ \ \ \ groundtruth\_instance\_masks,}
\DoxyCodeLine{03497\ \ \ \ \ \ \ ),}
\DoxyCodeLine{03498\ \ \ \ \ \ \ random\_rgb\_to\_gray:\ (fields.InputDataFields.image,),}
\DoxyCodeLine{03499\ \ \ \ \ \ \ random\_adjust\_brightness:\ (fields.InputDataFields.image,),}
\DoxyCodeLine{03500\ \ \ \ \ \ \ random\_adjust\_contrast:\ (fields.InputDataFields.image,),}
\DoxyCodeLine{03501\ \ \ \ \ \ \ random\_adjust\_hue:\ (fields.InputDataFields.image,),}
\DoxyCodeLine{03502\ \ \ \ \ \ \ random\_adjust\_saturation:\ (fields.InputDataFields.image,),}
\DoxyCodeLine{03503\ \ \ \ \ \ \ random\_distort\_color:\ (fields.InputDataFields.image,),}
\DoxyCodeLine{03504\ \ \ \ \ \ \ random\_jitter\_boxes:\ (fields.InputDataFields.groundtruth\_boxes,),}
\DoxyCodeLine{03505\ \ \ \ \ \ \ random\_crop\_image:\ (fields.InputDataFields.image,}
\DoxyCodeLine{03506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_boxes,}
\DoxyCodeLine{03507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_classes,}
\DoxyCodeLine{03508\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_weights,}
\DoxyCodeLine{03509\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_confidences,}
\DoxyCodeLine{03510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ multiclass\_scores,}
\DoxyCodeLine{03511\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ groundtruth\_instance\_masks,}
\DoxyCodeLine{03512\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ groundtruth\_keypoints),}
\DoxyCodeLine{03513\ \ \ \ \ \ \ random\_pad\_image:\ (fields.InputDataFields.image,}
\DoxyCodeLine{03514\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_boxes,}
\DoxyCodeLine{03515\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ groundtruth\_keypoints),}
\DoxyCodeLine{03516\ \ \ \ \ \ \ random\_absolute\_pad\_image:\ (fields.InputDataFields.image,}
\DoxyCodeLine{03517\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_boxes),}
\DoxyCodeLine{03518\ \ \ \ \ \ \ random\_crop\_pad\_image:\ (fields.InputDataFields.image,}
\DoxyCodeLine{03519\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_boxes,}
\DoxyCodeLine{03520\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_classes,}
\DoxyCodeLine{03521\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_weights,}
\DoxyCodeLine{03522\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_confidences,}
\DoxyCodeLine{03523\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ multiclass\_scores),}
\DoxyCodeLine{03524\ \ \ \ \ \ \ random\_crop\_to\_aspect\_ratio:\ (}
\DoxyCodeLine{03525\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.image,}
\DoxyCodeLine{03526\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_boxes,}
\DoxyCodeLine{03527\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_classes,}
\DoxyCodeLine{03528\ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_weights,}
\DoxyCodeLine{03529\ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_confidences,}
\DoxyCodeLine{03530\ \ \ \ \ \ \ \ \ \ \ multiclass\_scores,}
\DoxyCodeLine{03531\ \ \ \ \ \ \ \ \ \ \ groundtruth\_instance\_masks,}
\DoxyCodeLine{03532\ \ \ \ \ \ \ \ \ \ \ groundtruth\_keypoints,}
\DoxyCodeLine{03533\ \ \ \ \ \ \ ),}
\DoxyCodeLine{03534\ \ \ \ \ \ \ random\_pad\_to\_aspect\_ratio:\ (}
\DoxyCodeLine{03535\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.image,}
\DoxyCodeLine{03536\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_boxes,}
\DoxyCodeLine{03537\ \ \ \ \ \ \ \ \ \ \ groundtruth\_instance\_masks,}
\DoxyCodeLine{03538\ \ \ \ \ \ \ \ \ \ \ groundtruth\_keypoints,}
\DoxyCodeLine{03539\ \ \ \ \ \ \ ),}
\DoxyCodeLine{03540\ \ \ \ \ \ \ random\_black\_patches:\ (fields.InputDataFields.image,),}
\DoxyCodeLine{03541\ \ \ \ \ \ \ autoaugment\_image:\ (fields.InputDataFields.image,}
\DoxyCodeLine{03542\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_boxes,),}
\DoxyCodeLine{03543\ \ \ \ \ \ \ retain\_boxes\_above\_threshold:\ (}
\DoxyCodeLine{03544\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_boxes,}
\DoxyCodeLine{03545\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_classes,}
\DoxyCodeLine{03546\ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_weights,}
\DoxyCodeLine{03547\ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_confidences,}
\DoxyCodeLine{03548\ \ \ \ \ \ \ \ \ \ \ multiclass\_scores,}
\DoxyCodeLine{03549\ \ \ \ \ \ \ \ \ \ \ groundtruth\_instance\_masks,}
\DoxyCodeLine{03550\ \ \ \ \ \ \ \ \ \ \ groundtruth\_keypoints,}
\DoxyCodeLine{03551\ \ \ \ \ \ \ ),}
\DoxyCodeLine{03552\ \ \ \ \ \ \ drop\_label\_probabilistically:\ (}
\DoxyCodeLine{03553\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_boxes,}
\DoxyCodeLine{03554\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_classes,}
\DoxyCodeLine{03555\ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_weights,}
\DoxyCodeLine{03556\ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_confidences,}
\DoxyCodeLine{03557\ \ \ \ \ \ \ \ \ \ \ multiclass\_scores,}
\DoxyCodeLine{03558\ \ \ \ \ \ \ \ \ \ \ groundtruth\_instance\_masks,}
\DoxyCodeLine{03559\ \ \ \ \ \ \ \ \ \ \ groundtruth\_keypoints,}
\DoxyCodeLine{03560\ \ \ \ \ \ \ ),}
\DoxyCodeLine{03561\ \ \ \ \ \ \ remap\_labels:\ (fields.InputDataFields.groundtruth\_classes,),}
\DoxyCodeLine{03562\ \ \ \ \ \ \ image\_to\_float:\ (fields.InputDataFields.image,),}
\DoxyCodeLine{03563\ \ \ \ \ \ \ random\_resize\_method:\ (fields.InputDataFields.image,),}
\DoxyCodeLine{03564\ \ \ \ \ \ \ resize\_to\_range:\ (}
\DoxyCodeLine{03565\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.image,}
\DoxyCodeLine{03566\ \ \ \ \ \ \ \ \ \ \ groundtruth\_instance\_masks,}
\DoxyCodeLine{03567\ \ \ \ \ \ \ ),}
\DoxyCodeLine{03568\ \ \ \ \ \ \ resize\_to\_min\_dimension:\ (}
\DoxyCodeLine{03569\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.image,}
\DoxyCodeLine{03570\ \ \ \ \ \ \ \ \ \ \ groundtruth\_instance\_masks,}
\DoxyCodeLine{03571\ \ \ \ \ \ \ ),}
\DoxyCodeLine{03572\ \ \ \ \ \ \ scale\_boxes\_to\_pixel\_coordinates:\ (}
\DoxyCodeLine{03573\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.image,}
\DoxyCodeLine{03574\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_boxes,}
\DoxyCodeLine{03575\ \ \ \ \ \ \ \ \ \ \ groundtruth\_keypoints,}
\DoxyCodeLine{03576\ \ \ \ \ \ \ ),}
\DoxyCodeLine{03577\ \ \ \ \ \ \ resize\_image:\ (}
\DoxyCodeLine{03578\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.image,}
\DoxyCodeLine{03579\ \ \ \ \ \ \ \ \ \ \ groundtruth\_instance\_masks,}
\DoxyCodeLine{03580\ \ \ \ \ \ \ ),}
\DoxyCodeLine{03581\ \ \ \ \ \ \ subtract\_channel\_mean:\ (fields.InputDataFields.image,),}
\DoxyCodeLine{03582\ \ \ \ \ \ \ one\_hot\_encoding:\ (fields.InputDataFields.groundtruth\_image\_classes,),}
\DoxyCodeLine{03583\ \ \ \ \ \ \ rgb\_to\_gray:\ (fields.InputDataFields.image,),}
\DoxyCodeLine{03584\ \ \ \ \ \ \ random\_self\_concat\_image:\ (fields.InputDataFields.image,}
\DoxyCodeLine{03585\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_boxes,}
\DoxyCodeLine{03586\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_classes,}
\DoxyCodeLine{03587\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_weights,}
\DoxyCodeLine{03588\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_confidences,}
\DoxyCodeLine{03589\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ multiclass\_scores),}
\DoxyCodeLine{03590\ \ \ \ \ \ \ ssd\_random\_crop:\ (fields.InputDataFields.image,}
\DoxyCodeLine{03591\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_boxes,}
\DoxyCodeLine{03592\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_classes,}
\DoxyCodeLine{03593\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_weights,}
\DoxyCodeLine{03594\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_confidences,}
\DoxyCodeLine{03595\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ multiclass\_scores,}
\DoxyCodeLine{03596\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ groundtruth\_instance\_masks,}
\DoxyCodeLine{03597\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ groundtruth\_keypoints),}
\DoxyCodeLine{03598\ \ \ \ \ \ \ ssd\_random\_crop\_pad:\ (fields.InputDataFields.image,}
\DoxyCodeLine{03599\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_boxes,}
\DoxyCodeLine{03600\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_classes,}
\DoxyCodeLine{03601\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_weights,}
\DoxyCodeLine{03602\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_confidences,}
\DoxyCodeLine{03603\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ multiclass\_scores),}
\DoxyCodeLine{03604\ \ \ \ \ \ \ ssd\_random\_crop\_fixed\_aspect\_ratio:\ (}
\DoxyCodeLine{03605\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.image,}
\DoxyCodeLine{03606\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_boxes,}
\DoxyCodeLine{03607\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_classes,}
\DoxyCodeLine{03608\ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_weights,}
\DoxyCodeLine{03609\ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_confidences,}
\DoxyCodeLine{03610\ \ \ \ \ \ \ \ \ \ \ multiclass\_scores,}
\DoxyCodeLine{03611\ \ \ \ \ \ \ \ \ \ \ groundtruth\_instance\_masks,}
\DoxyCodeLine{03612\ \ \ \ \ \ \ \ \ \ \ groundtruth\_keypoints),}
\DoxyCodeLine{03613\ \ \ \ \ \ \ ssd\_random\_crop\_pad\_fixed\_aspect\_ratio:\ (}
\DoxyCodeLine{03614\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.image,}
\DoxyCodeLine{03615\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_boxes,}
\DoxyCodeLine{03616\ \ \ \ \ \ \ \ \ \ \ fields.InputDataFields.groundtruth\_classes,}
\DoxyCodeLine{03617\ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_weights,}
\DoxyCodeLine{03618\ \ \ \ \ \ \ \ \ \ \ groundtruth\_label\_confidences,}
\DoxyCodeLine{03619\ \ \ \ \ \ \ \ \ \ \ multiclass\_scores,}
\DoxyCodeLine{03620\ \ \ \ \ \ \ \ \ \ \ groundtruth\_instance\_masks,}
\DoxyCodeLine{03621\ \ \ \ \ \ \ \ \ \ \ groundtruth\_keypoints,}
\DoxyCodeLine{03622\ \ \ \ \ \ \ ),}
\DoxyCodeLine{03623\ \ \ \ \ \ \ convert\_class\_logits\_to\_softmax:\ (multiclass\_scores,),}
\DoxyCodeLine{03624\ \ \ \}}
\DoxyCodeLine{03625\ }
\DoxyCodeLine{03626\ \ \ \textcolor{keywordflow}{return}\ prep\_func\_arg\_map}
\DoxyCodeLine{03627\ }
\DoxyCodeLine{03628\ }

\end{DoxyCode}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_af58a25a2d72d84c921a575c3900c74d0_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a3e5b56ca6c5c071667bfe3e86359cd31}\label{namespacedetection__utils_1_1core_1_1preprocessor_a3e5b56ca6c5c071667bfe3e86359cd31} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!image\_to\_float@{image\_to\_float}}
\index{image\_to\_float@{image\_to\_float}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{image\_to\_float()}{image\_to\_float()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+image\+\_\+to\+\_\+float (\begin{DoxyParamCaption}\item[{}]{image }\end{DoxyParamCaption})}

\begin{DoxyVerb}Used in Faster R-CNN. Casts image pixel values to float.

Args:
  image: input image which might be in tf.uint8 or sth else format

Returns:
  image: image in tf.float32 format.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l02318}{2318}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02318\ \textcolor{keyword}{def\ }image\_to\_float(image):}
\DoxyCodeLine{02319\ \ \ \textcolor{stringliteral}{"{}"{}"{}Used\ in\ Faster\ R-\/CNN.\ Casts\ image\ pixel\ values\ to\ float.}}
\DoxyCodeLine{02320\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02321\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{02322\ \textcolor{stringliteral}{\ \ \ \ image:\ input\ image\ which\ might\ be\ }\textcolor{keywordflow}{in}\ tf.uint8\ \textcolor{keywordflow}{or}\ sth\ \textcolor{keywordflow}{else}\ format}
\DoxyCodeLine{02323\ }
\DoxyCodeLine{02324\ \ \ Returns:}
\DoxyCodeLine{02325\ \ \ \ \ image:\ image\ \textcolor{keywordflow}{in}\ tf.float32\ format.}
\DoxyCodeLine{02326\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{02327\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'ImageToFloat'},\ values=[image]):}
\DoxyCodeLine{02328\ \ \ \ \ image\ =\ tf.cast(image,\ dtype=tf.float32)}
\DoxyCodeLine{02329\ \ \ \ \ \textcolor{keywordflow}{return}\ image}
\DoxyCodeLine{02330\ }
\DoxyCodeLine{02331\ }

\end{DoxyCode}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_ad8750c531fcec2fa0f79087324bbbe86}\label{namespacedetection__utils_1_1core_1_1preprocessor_ad8750c531fcec2fa0f79087324bbbe86} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!normalize\_image@{normalize\_image}}
\index{normalize\_image@{normalize\_image}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{normalize\_image()}{normalize\_image()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+normalize\+\_\+image (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{original\+\_\+minval,  }\item[{}]{original\+\_\+maxval,  }\item[{}]{target\+\_\+minval,  }\item[{}]{target\+\_\+maxval }\end{DoxyParamCaption})}

\begin{DoxyVerb}Normalizes pixel values in the image.

Moves the pixel values from the current [original_minval, original_maxval]
range to a the [target_minval, target_maxval] range.

Args:
  image: rank 3 float32 tensor containing 1
         image -> [height, width, channels].
  original_minval: current image minimum value.
  original_maxval: current image maximum value.
  target_minval: target image minimum value.
  target_maxval: target image maximum value.

Returns:
  image: image which is the same shape as input image.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00249}{249}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ target\_maxval):}
\DoxyCodeLine{00251\ \ \ \textcolor{stringliteral}{"{}"{}"{}Normalizes\ pixel\ values\ in\ the\ image.}}
\DoxyCodeLine{00252\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00253\ \textcolor{stringliteral}{\ \ Moves\ the\ pixel\ values\ }\textcolor{keyword}{from}\ the\ current\ [original\_minval,\ original\_maxval]}
\DoxyCodeLine{00254\ \ \ range\ to\ a\ the\ [target\_minval,\ target\_maxval]\ range.}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ Args:}
\DoxyCodeLine{00257\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ containing\ 1}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ image\ -\/>\ [height,\ width,\ channels].}
\DoxyCodeLine{00259\ \ \ \ \ original\_minval:\ current\ image\ minimum\ value.}
\DoxyCodeLine{00260\ \ \ \ \ original\_maxval:\ current\ image\ maximum\ value.}
\DoxyCodeLine{00261\ \ \ \ \ target\_minval:\ target\ image\ minimum\ value.}
\DoxyCodeLine{00262\ \ \ \ \ target\_maxval:\ target\ image\ maximum\ value.}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ Returns:}
\DoxyCodeLine{00265\ \ \ \ \ image:\ image\ which\ \textcolor{keywordflow}{is}\ the\ same\ shape\ \textcolor{keyword}{as}\ input\ image.}
\DoxyCodeLine{00266\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00267\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'NormalizeImage'},\ values=[image]):}
\DoxyCodeLine{00268\ \ \ \ \ original\_minval\ =\ float(original\_minval)}
\DoxyCodeLine{00269\ \ \ \ \ original\_maxval\ =\ float(original\_maxval)}
\DoxyCodeLine{00270\ \ \ \ \ target\_minval\ =\ float(target\_minval)}
\DoxyCodeLine{00271\ \ \ \ \ target\_maxval\ =\ float(target\_maxval)}
\DoxyCodeLine{00272\ \ \ \ \ image\ =\ tf.cast(image,\ dtype=tf.float32)}
\DoxyCodeLine{00273\ \ \ \ \ image\ =\ tf.subtract(image,\ original\_minval)}
\DoxyCodeLine{00274\ \ \ \ \ image\ =\ tf.multiply(image,\ (target\_maxval\ -\/\ target\_minval)\ /}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (original\_maxval\ -\/\ original\_minval))}
\DoxyCodeLine{00276\ \ \ \ \ image\ =\ tf.add(image,\ target\_minval)}
\DoxyCodeLine{00277\ \ \ \ \ \textcolor{keywordflow}{return}\ image}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ }

\end{DoxyCode}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a84b00d370e579ea07663c48b7c6a0696}\label{namespacedetection__utils_1_1core_1_1preprocessor_a84b00d370e579ea07663c48b7c6a0696} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!one\_hot\_encoding@{one\_hot\_encoding}}
\index{one\_hot\_encoding@{one\_hot\_encoding}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{one\_hot\_encoding()}{one\_hot\_encoding()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+one\+\_\+hot\+\_\+encoding (\begin{DoxyParamCaption}\item[{}]{labels,  }\item[{}]{num\+\_\+classes = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}One-hot encodes the multiclass labels.

Example usage:
  labels = tf.constant([1, 4], dtype=tf.int32)
  one_hot = OneHotEncoding(labels, num_classes=5)
  one_hot.eval()    # evaluates to [0, 1, 0, 0, 1]

Args:
  labels: A tensor of shape [None] corresponding to the labels.
  num_classes: Number of classes in the dataset.
Returns:
  onehot_labels: a tensor of shape [num_classes] corresponding to the one hot
    encoding of the labels.
Raises:
  ValueError: if num_classes is not specified.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l02712}{2712}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02712\ \textcolor{keyword}{def\ }one\_hot\_encoding(labels,\ num\_classes=None):}
\DoxyCodeLine{02713\ \ \ \textcolor{stringliteral}{"{}"{}"{}One-\/hot\ encodes\ the\ multiclass\ labels.}}
\DoxyCodeLine{02714\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02715\ \textcolor{stringliteral}{\ \ Example\ usage:}}
\DoxyCodeLine{02716\ \textcolor{stringliteral}{\ \ \ \ labels\ =\ tf.constant([1,\ 4],\ dtype=tf.int32)}}
\DoxyCodeLine{02717\ \textcolor{stringliteral}{\ \ \ \ one\_hot\ =\ OneHotEncoding(labels,\ num\_classes=5)}}
\DoxyCodeLine{02718\ \textcolor{stringliteral}{\ \ \ \ one\_hot.eval()\ \ \ \ }\textcolor{comment}{\#\ evaluates\ to\ [0,\ 1,\ 0,\ 0,\ 1]}}
\DoxyCodeLine{02719\ }
\DoxyCodeLine{02720\ \ \ Args:}
\DoxyCodeLine{02721\ \ \ \ \ labels:\ A\ tensor\ of\ shape\ [\textcolor{keywordtype}{None}]\ corresponding\ to\ the\ labels.}
\DoxyCodeLine{02722\ \ \ \ \ num\_classes:\ Number\ of\ classes\ \textcolor{keywordflow}{in}\ the\ dataset.}
\DoxyCodeLine{02723\ \ \ Returns:}
\DoxyCodeLine{02724\ \ \ \ \ onehot\_labels:\ a\ tensor\ of\ shape\ [num\_classes]\ corresponding\ to\ the\ one\ hot}
\DoxyCodeLine{02725\ \ \ \ \ \ \ encoding\ of\ the\ labels.}
\DoxyCodeLine{02726\ \ \ Raises:}
\DoxyCodeLine{02727\ \ \ \ \ ValueError:\ \textcolor{keywordflow}{if}\ num\_classes\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ specified.}
\DoxyCodeLine{02728\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{02729\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'OneHotEncoding'},\ values=[labels]):}
\DoxyCodeLine{02730\ \ \ \ \ \textcolor{keywordflow}{if}\ num\_classes\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02731\ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'num\_classes\ must\ be\ specified'})}
\DoxyCodeLine{02732\ }
\DoxyCodeLine{02733\ \ \ \ \ labels\ =\ tf.one\_hot(labels,\ num\_classes,\ 1,\ 0)}
\DoxyCodeLine{02734\ \ \ \ \ \textcolor{keywordflow}{return}\ tf.reduce\_max(labels,\ 0)}
\DoxyCodeLine{02735\ }
\DoxyCodeLine{02736\ }

\end{DoxyCode}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a7806fdbc8bcd478d285ebb8873c8321c}\label{namespacedetection__utils_1_1core_1_1preprocessor_a7806fdbc8bcd478d285ebb8873c8321c} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!preprocess@{preprocess}}
\index{preprocess@{preprocess}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{preprocess()}{preprocess()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+preprocess (\begin{DoxyParamCaption}\item[{}]{tensor\+\_\+dict,  }\item[{}]{preprocess\+\_\+options,  }\item[{}]{func\+\_\+arg\+\_\+map = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Preprocess images and bounding boxes.

Various types of preprocessing (to be implemented) based on the
preprocess_options dictionary e.g. "crop image" (affects image and possibly
boxes), "white balance image" (affects only image), etc. If self._options
is None, no preprocessing is done.

Args:
  tensor_dict: dictionary that contains images, boxes, and can contain other
               things as well.
               images-> rank 4 float32 tensor contains
                        1 image -> [1, height, width, 3].
                        with pixel values varying between [0, 1]
               boxes-> rank 2 float32 tensor containing
                       the bounding boxes -> [N, 4].
                       Boxes are in normalized form meaning
                       their coordinates vary between [0, 1].
                       Each row is in the form
                       of [ymin, xmin, ymax, xmax].
  preprocess_options: It is a list of tuples, where each tuple contains a
                      function and a dictionary that contains arguments and
                      their values.
  func_arg_map: mapping from preprocessing functions to arguments that they
                expect to receive and return.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  tensor_dict: which contains the preprocessed images, bounding boxes, etc.

Raises:
  ValueError: (a) If the functions passed to Preprocess
                  are not in func_arg_map.
              (b) If the arguments that a function needs
                  do not exist in tensor_dict.
              (c) If image in tensor_dict is not rank 4
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l03629}{3629}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03632\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{03633\ \ \ \textcolor{stringliteral}{"{}"{}"{}Preprocess\ images\ and\ bounding\ boxes.}}
\DoxyCodeLine{03634\ \textcolor{stringliteral}{}}
\DoxyCodeLine{03635\ \textcolor{stringliteral}{\ \ Various\ types\ of\ preprocessing\ (to\ be\ implemented)\ based\ on\ the}}
\DoxyCodeLine{03636\ \textcolor{stringliteral}{\ \ preprocess\_options\ dictionary\ e.g.\ "{}crop\ image"{}}\ (affects\ image\ \textcolor{keywordflow}{and}\ possibly}
\DoxyCodeLine{03637\ \ \ boxes),\ \textcolor{stringliteral}{"{}white\ balance\ image"{}}\ (affects\ only\ image),\ etc.\ If\ self.\_options}
\DoxyCodeLine{03638\ \ \ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None},\ no\ preprocessing\ \textcolor{keywordflow}{is}\ done.}
\DoxyCodeLine{03639\ }
\DoxyCodeLine{03640\ \ \ Args:}
\DoxyCodeLine{03641\ \ \ \ \ tensor\_dict:\ dictionary\ that\ contains\ images,\ boxes,\ \textcolor{keywordflow}{and}\ can\ contain\ other}
\DoxyCodeLine{03642\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ things\ \textcolor{keyword}{as}\ well.}
\DoxyCodeLine{03643\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ images-\/>\ rank\ 4\ float32\ tensor\ contains}
\DoxyCodeLine{03644\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 1\ image\ -\/>\ [1,\ height,\ width,\ 3].}
\DoxyCodeLine{03645\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 1]}
\DoxyCodeLine{03646\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxes-\/>\ rank\ 2\ float32\ tensor\ containing}
\DoxyCodeLine{03647\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ the\ bounding\ boxes\ -\/>\ [N,\ 4].}
\DoxyCodeLine{03648\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning}
\DoxyCodeLine{03649\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ their\ coordinates\ vary\ between\ [0,\ 1].}
\DoxyCodeLine{03650\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form}
\DoxyCodeLine{03651\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{03652\ \ \ \ \ preprocess\_options:\ It\ \textcolor{keywordflow}{is}\ a\ list\ of\ tuples,\ where\ each\ tuple\ contains\ a}
\DoxyCodeLine{03653\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{and}\ a\ dictionary\ that\ contains\ arguments\ \textcolor{keywordflow}{and}}
\DoxyCodeLine{03654\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ their\ values.}
\DoxyCodeLine{03655\ \ \ \ \ func\_arg\_map:\ mapping\ \textcolor{keyword}{from}\ preprocessing\ functions\ to\ arguments\ that\ they}
\DoxyCodeLine{03656\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ expect\ to\ receive\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{return}.}
\DoxyCodeLine{03657\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{03658\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{03659\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{03660\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{03661\ }
\DoxyCodeLine{03662\ \ \ Returns:}
\DoxyCodeLine{03663\ \ \ \ \ tensor\_dict:\ which\ contains\ the\ preprocessed\ images,\ bounding\ boxes,\ etc.}
\DoxyCodeLine{03664\ }
\DoxyCodeLine{03665\ \ \ Raises:}
\DoxyCodeLine{03666\ \ \ \ \ ValueError:\ (a)\ If\ the\ functions\ passed\ to\ Preprocess}
\DoxyCodeLine{03667\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ are\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ func\_arg\_map.}
\DoxyCodeLine{03668\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (b)\ If\ the\ arguments\ that\ a\ function\ needs}
\DoxyCodeLine{03669\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ do\ \textcolor{keywordflow}{not}\ exist\ \textcolor{keywordflow}{in}\ tensor\_dict.}
\DoxyCodeLine{03670\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (c)\ If\ image\ \textcolor{keywordflow}{in}\ tensor\_dict\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ rank\ 4}
\DoxyCodeLine{03671\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{03672\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{if}\ func\_arg\_map\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{03673\ \ \ \ \ func\_arg\_map\ =\ get\_default\_func\_arg\_map()}
\DoxyCodeLine{03674\ }
\DoxyCodeLine{03675\ \ \ \textcolor{comment}{\#\ changes\ the\ images\ to\ image\ (rank\ 4\ to\ rank\ 3)\ since\ the\ functions}}
\DoxyCodeLine{03676\ \ \ \textcolor{comment}{\#\ receive\ rank\ 3\ tensor\ for\ image}}
\DoxyCodeLine{03677\ \ \ \textcolor{keywordflow}{if}\ fields.InputDataFields.image\ \textcolor{keywordflow}{in}\ tensor\_dict:}
\DoxyCodeLine{03678\ \ \ \ \ images\ =\ tensor\_dict[fields.InputDataFields.image]}
\DoxyCodeLine{03679\ \ \ \ \ \textcolor{keywordflow}{if}\ len(images.get\_shape())\ !=\ 4:}
\DoxyCodeLine{03680\ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'images\ in\ tensor\_dict\ should\ be\ rank\ 4'})}
\DoxyCodeLine{03681\ \ \ \ \ image\ =\ tf.squeeze(images,\ axis=0)}
\DoxyCodeLine{03682\ \ \ \ \ tensor\_dict[fields.InputDataFields.image]\ =\ image}
\DoxyCodeLine{03683\ }
\DoxyCodeLine{03684\ \ \ \textcolor{comment}{\#\ Preprocess\ inputs\ based\ on\ preprocess\_options}}
\DoxyCodeLine{03685\ \ \ \textcolor{keywordflow}{for}\ option\ \textcolor{keywordflow}{in}\ preprocess\_options:}
\DoxyCodeLine{03686\ \ \ \ \ func,\ params\ =\ option}
\DoxyCodeLine{03687\ \ \ \ \ \textcolor{keywordflow}{if}\ func\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ func\_arg\_map:}
\DoxyCodeLine{03688\ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'The\ function\ \%s\ does\ not\ exist\ in\ func\_arg\_map'}\ \%}
\DoxyCodeLine{03689\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (func.\_\_name\_\_))}
\DoxyCodeLine{03690\ \ \ \ \ arg\_names\ =\ func\_arg\_map[func]}
\DoxyCodeLine{03691\ \ \ \ \ \textcolor{keywordflow}{for}\ a\ \textcolor{keywordflow}{in}\ arg\_names:}
\DoxyCodeLine{03692\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ a\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{and}\ a\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ tensor\_dict:}
\DoxyCodeLine{03693\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'The\ function\ \%s\ requires\ argument\ \%s'}\ \%}
\DoxyCodeLine{03694\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (func.\_\_name\_\_,\ a))}
\DoxyCodeLine{03695\ }
\DoxyCodeLine{03696\ \ \ \ \ \textcolor{keyword}{def\ }get\_arg(key):}
\DoxyCodeLine{03697\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ tensor\_dict[key]\ \textcolor{keywordflow}{if}\ key\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{else}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{03698\ }
\DoxyCodeLine{03699\ \ \ \ \ args\ =\ [get\_arg(a)\ \textcolor{keywordflow}{for}\ a\ \textcolor{keywordflow}{in}\ arg\_names]}
\DoxyCodeLine{03700\ \ \ \ \ \textcolor{keywordflow}{if}\ preprocess\_vars\_cache\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{03701\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ six.PY2:}
\DoxyCodeLine{03702\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ pylint:\ disable=deprecated-\/method}}
\DoxyCodeLine{03703\ \ \ \ \ \ \ \ \ arg\_spec\ =\ inspect.getargspec(func)}
\DoxyCodeLine{03704\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ pylint:\ enable=deprecated-\/method}}
\DoxyCodeLine{03705\ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{03706\ \ \ \ \ \ \ \ \ arg\_spec\ =\ inspect.getfullargspec(func)}
\DoxyCodeLine{03707\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{'preprocess\_vars\_cache'}\ \textcolor{keywordflow}{in}\ arg\_spec.args:}
\DoxyCodeLine{03708\ \ \ \ \ \ \ \ \ params[\textcolor{stringliteral}{'preprocess\_vars\_cache'}]\ =\ preprocess\_vars\_cache}
\DoxyCodeLine{03709\ }
\DoxyCodeLine{03710\ \ \ \ \ results\ =\ func(*args,\ **params)}
\DoxyCodeLine{03711\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ isinstance(results,\ (list,\ tuple)):}
\DoxyCodeLine{03712\ \ \ \ \ \ \ results\ =\ (results,)}
\DoxyCodeLine{03713\ \ \ \ \ \textcolor{comment}{\#\ Removes\ None\ args\ since\ the\ return\ values\ will\ not\ contain\ those.}}
\DoxyCodeLine{03714\ \ \ \ \ arg\_names\ =\ [arg\_name\ \textcolor{keywordflow}{for}\ arg\_name\ \textcolor{keywordflow}{in}\ arg\_names\ \textcolor{keywordflow}{if}\ arg\_name\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}]}
\DoxyCodeLine{03715\ \ \ \ \ \textcolor{keywordflow}{for}\ res,\ arg\_name\ \textcolor{keywordflow}{in}\ zip(results,\ arg\_names):}
\DoxyCodeLine{03716\ \ \ \ \ \ \ tensor\_dict[arg\_name]\ =\ res}
\DoxyCodeLine{03717\ }
\DoxyCodeLine{03718\ \ \ \textcolor{comment}{\#\ changes\ the\ image\ to\ images\ (rank\ 3\ to\ rank\ 4)\ to\ be\ compatible\ to\ what}}
\DoxyCodeLine{03719\ \ \ \textcolor{comment}{\#\ we\ received\ in\ the\ first\ place}}
\DoxyCodeLine{03720\ \ \ \textcolor{keywordflow}{if}\ fields.InputDataFields.image\ \textcolor{keywordflow}{in}\ tensor\_dict:}
\DoxyCodeLine{03721\ \ \ \ \ image\ =\ tensor\_dict[fields.InputDataFields.image]}
\DoxyCodeLine{03722\ \ \ \ \ images\ =\ tf.expand\_dims(image,\ 0)}
\DoxyCodeLine{03723\ \ \ \ \ tensor\_dict[fields.InputDataFields.image]\ =\ images}
\DoxyCodeLine{03724\ }
\DoxyCodeLine{03725\ \ \ \textcolor{keywordflow}{return}\ tensor\_dict}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a7806fdbc8bcd478d285ebb8873c8321c_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a3abbb64d99b25decfe25fec40a92a6b9}\label{namespacedetection__utils_1_1core_1_1preprocessor_a3abbb64d99b25decfe25fec40a92a6b9} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_absolute\_pad\_image@{random\_absolute\_pad\_image}}
\index{random\_absolute\_pad\_image@{random\_absolute\_pad\_image}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_absolute\_pad\_image()}{random\_absolute\_pad\_image()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+absolute\+\_\+pad\+\_\+image (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{boxes,  }\item[{}]{max\+\_\+height\+\_\+padding,  }\item[{}]{max\+\_\+width\+\_\+padding,  }\item[{}]{pad\+\_\+color = {\ttfamily None},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Randomly pads the image by small absolute amounts.

As random_pad_image above, but the padding is of size [0, max_height_padding]
or [0, max_width_padding] instead of padding to a fixed size of
max_height_padding for all images.

Args:
  image: rank 3 float32 tensor containing 1 image -> [height, width, channels]
         with pixel values varying between [0, 1].
  boxes: rank 2 float32 tensor containing the bounding boxes -> [N, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].
  max_height_padding: a scalar tf.int32 tensor denoting the maximum amount of
                      height padding. The padding will be chosen uniformly at
                      random from [0, max_height_padding).
  max_width_padding: a scalar tf.int32 tensor denoting the maximum amount of
                     width padding. The padding will be chosen uniformly at
                     random from [0, max_width_padding).
  pad_color: padding color. A rank 1 tensor of [3] with dtype=tf.float32.
             if set as None, it will be set to average color of the input
             image.
  seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: Image shape will be [new_height, new_width, channels].
  boxes: boxes which is the same rank as input boxes. Boxes are in normalized
         form.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l01696}{1696}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01702\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{01703\ \ \ \textcolor{stringliteral}{"{}"{}"{}Randomly\ pads\ the\ image\ by\ small\ absolute\ amounts.}}
\DoxyCodeLine{01704\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01705\ \textcolor{stringliteral}{\ \ As\ random\_pad\_image\ above,\ but\ the\ padding\ }\textcolor{keywordflow}{is}\ of\ size\ [0,\ max\_height\_padding]}
\DoxyCodeLine{01706\ \ \ \textcolor{keywordflow}{or}\ [0,\ max\_width\_padding]\ instead\ of\ padding\ to\ a\ fixed\ size\ of}
\DoxyCodeLine{01707\ \ \ max\_height\_padding\ \textcolor{keywordflow}{for}\ all\ images.}
\DoxyCodeLine{01708\ }
\DoxyCodeLine{01709\ \ \ Args:}
\DoxyCodeLine{01710\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ containing\ 1\ image\ -\/>\ [height,\ width,\ channels]}
\DoxyCodeLine{01711\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 1].}
\DoxyCodeLine{01712\ \ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ -\/>\ [N,\ 4].}
\DoxyCodeLine{01713\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{01714\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{01715\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{01716\ \ \ \ \ max\_height\_padding:\ a\ scalar\ tf.int32\ tensor\ denoting\ the\ maximum\ amount\ of}
\DoxyCodeLine{01717\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ height\ padding.\ The\ padding\ will\ be\ chosen\ uniformly\ at}
\DoxyCodeLine{01718\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ random\ \textcolor{keyword}{from}\ [0,\ max\_height\_padding).}
\DoxyCodeLine{01719\ \ \ \ \ max\_width\_padding:\ a\ scalar\ tf.int32\ tensor\ denoting\ the\ maximum\ amount\ of}
\DoxyCodeLine{01720\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ width\ padding.\ The\ padding\ will\ be\ chosen\ uniformly\ at}
\DoxyCodeLine{01721\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ random\ \textcolor{keyword}{from}\ [0,\ max\_width\_padding).}
\DoxyCodeLine{01722\ \ \ \ \ pad\_color:\ padding\ color.\ A\ rank\ 1\ tensor\ of\ [3]\ \textcolor{keyword}{with}\ dtype=tf.float32.}
\DoxyCodeLine{01723\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ set\ \textcolor{keyword}{as}\ \textcolor{keywordtype}{None},\ it\ will\ be\ set\ to\ average\ color\ of\ the\ input}
\DoxyCodeLine{01724\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ image.}
\DoxyCodeLine{01725\ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{01726\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{01727\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{01728\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{01729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{01730\ }
\DoxyCodeLine{01731\ \ \ Returns:}
\DoxyCodeLine{01732\ \ \ \ \ image:\ Image\ shape\ will\ be\ [new\_height,\ new\_width,\ channels].}
\DoxyCodeLine{01733\ \ \ \ \ boxes:\ boxes\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ boxes.\ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized}
\DoxyCodeLine{01734\ \ \ \ \ \ \ \ \ \ \ \ form.}
\DoxyCodeLine{01735\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{01736\ \textcolor{stringliteral}{\ \ min\_image\_size\ =\ tf.shape(image)[:2]}}
\DoxyCodeLine{01737\ \textcolor{stringliteral}{\ \ max\_image\_size\ =\ min\_image\_size\ +\ tf.cast(}}
\DoxyCodeLine{01738\ \textcolor{stringliteral}{\ \ \ \ \ \ [max\_height\_padding,\ max\_width\_padding],\ dtype=tf.int32)}}
\DoxyCodeLine{01739\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{return}\ random\_pad\_image(image,\ boxes,\ min\_image\_size=min\_image\_size,}
\DoxyCodeLine{01740\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ max\_image\_size=max\_image\_size,\ pad\_color=pad\_color,}
\DoxyCodeLine{01741\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ seed=seed,}
\DoxyCodeLine{01742\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache)}
\DoxyCodeLine{01743\ }
\DoxyCodeLine{01744\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a3abbb64d99b25decfe25fec40a92a6b9_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a1a79d5114c3c558ffb325b491e93921a}\label{namespacedetection__utils_1_1core_1_1preprocessor_a1a79d5114c3c558ffb325b491e93921a} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_adjust\_brightness@{random\_adjust\_brightness}}
\index{random\_adjust\_brightness@{random\_adjust\_brightness}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_adjust\_brightness()}{random\_adjust\_brightness()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+adjust\+\_\+brightness (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{max\+\_\+delta = {\ttfamily 0.2},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Randomly adjusts brightness.

Makes sure the output image is still between 0 and 255.

Args:
  image: rank 3 float32 tensor contains 1 image -> [height, width, channels]
         with pixel values varying between [0, 255].
  max_delta: how much to change the brightness. A value between [0, 1).
  seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: image which is the same shape as input image.
  boxes: boxes which is the same shape as input boxes.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00992}{992}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00995\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{00996\ \ \ \textcolor{stringliteral}{"{}"{}"{}Randomly\ adjusts\ brightness.}}
\DoxyCodeLine{00997\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00998\ \textcolor{stringliteral}{\ \ Makes\ sure\ the\ output\ image\ }\textcolor{keywordflow}{is}\ still\ between\ 0\ \textcolor{keywordflow}{and}\ 255.}
\DoxyCodeLine{00999\ }
\DoxyCodeLine{01000\ \ \ Args:}
\DoxyCodeLine{01001\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ contains\ 1\ image\ -\/>\ [height,\ width,\ channels]}
\DoxyCodeLine{01002\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 255].}
\DoxyCodeLine{01003\ \ \ \ \ max\_delta:\ how\ much\ to\ change\ the\ brightness.\ A\ value\ between\ [0,\ 1).}
\DoxyCodeLine{01004\ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{01005\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{01006\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{01007\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{01008\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{01009\ }
\DoxyCodeLine{01010\ \ \ Returns:}
\DoxyCodeLine{01011\ \ \ \ \ image:\ image\ which\ \textcolor{keywordflow}{is}\ the\ same\ shape\ \textcolor{keyword}{as}\ input\ image.}
\DoxyCodeLine{01012\ \ \ \ \ boxes:\ boxes\ which\ \textcolor{keywordflow}{is}\ the\ same\ shape\ \textcolor{keyword}{as}\ input\ boxes.}
\DoxyCodeLine{01013\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{01014\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'RandomAdjustBrightness'},\ values=[image]):}
\DoxyCodeLine{01015\ \ \ \ \ generator\_func\ =\ functools.partial(tf.random\_uniform,\ [],}
\DoxyCodeLine{01016\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/max\_delta,\ max\_delta,\ seed=seed)}
\DoxyCodeLine{01017\ \ \ \ \ delta\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}
\DoxyCodeLine{01018\ \ \ \ \ \ \ \ \ generator\_func,}
\DoxyCodeLine{01019\ \ \ \ \ \ \ \ \ preprocessor\_cache.PreprocessorCache.ADJUST\_BRIGHTNESS,}
\DoxyCodeLine{01020\ \ \ \ \ \ \ \ \ preprocess\_vars\_cache)}
\DoxyCodeLine{01021\ }
\DoxyCodeLine{01022\ \ \ \ \ \textcolor{keyword}{def\ }\_adjust\_brightness(image):}
\DoxyCodeLine{01023\ \ \ \ \ \ \ image\ =\ tf.image.adjust\_brightness(image\ /\ 255,\ delta)\ *\ 255}
\DoxyCodeLine{01024\ \ \ \ \ \ \ image\ =\ tf.clip\_by\_value(image,\ clip\_value\_min=0.0,\ clip\_value\_max=255.0)}
\DoxyCodeLine{01025\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ image}
\DoxyCodeLine{01026\ }
\DoxyCodeLine{01027\ \ \ \ \ image\ =\ \_augment\_only\_rgb\_channels(image,\ \_adjust\_brightness)}
\DoxyCodeLine{01028\ \ \ \ \ \textcolor{keywordflow}{return}\ image}
\DoxyCodeLine{01029\ }
\DoxyCodeLine{01030\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a1a79d5114c3c558ffb325b491e93921a_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a1a79d5114c3c558ffb325b491e93921a_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a299a97f4d9fc15b96cd138d910b0d4d7}\label{namespacedetection__utils_1_1core_1_1preprocessor_a299a97f4d9fc15b96cd138d910b0d4d7} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_adjust\_contrast@{random\_adjust\_contrast}}
\index{random\_adjust\_contrast@{random\_adjust\_contrast}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_adjust\_contrast()}{random\_adjust\_contrast()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+adjust\+\_\+contrast (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{min\+\_\+delta = {\ttfamily 0.8},  }\item[{}]{max\+\_\+delta = {\ttfamily 1.25},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Randomly adjusts contrast.

Makes sure the output image is still between 0 and 255.

Args:
  image: rank 3 float32 tensor contains 1 image -> [height, width, channels]
         with pixel values varying between [0, 255].
  min_delta: see max_delta.
  max_delta: how much to change the contrast. Contrast will change with a
             value between min_delta and max_delta. This value will be
             multiplied to the current contrast of the image.
  seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: image which is the same shape as input image.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l01031}{1031}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{01036\ \ \ \textcolor{stringliteral}{"{}"{}"{}Randomly\ adjusts\ contrast.}}
\DoxyCodeLine{01037\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01038\ \textcolor{stringliteral}{\ \ Makes\ sure\ the\ output\ image\ }\textcolor{keywordflow}{is}\ still\ between\ 0\ \textcolor{keywordflow}{and}\ 255.}
\DoxyCodeLine{01039\ }
\DoxyCodeLine{01040\ \ \ Args:}
\DoxyCodeLine{01041\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ contains\ 1\ image\ -\/>\ [height,\ width,\ channels]}
\DoxyCodeLine{01042\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 255].}
\DoxyCodeLine{01043\ \ \ \ \ min\_delta:\ see\ max\_delta.}
\DoxyCodeLine{01044\ \ \ \ \ max\_delta:\ how\ much\ to\ change\ the\ contrast.\ Contrast\ will\ change\ \textcolor{keyword}{with}\ a}
\DoxyCodeLine{01045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ value\ between\ min\_delta\ \textcolor{keywordflow}{and}\ max\_delta.\ This\ value\ will\ be}
\DoxyCodeLine{01046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ multiplied\ to\ the\ current\ contrast\ of\ the\ image.}
\DoxyCodeLine{01047\ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{01048\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{01049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{01050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{01051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{01052\ }
\DoxyCodeLine{01053\ \ \ Returns:}
\DoxyCodeLine{01054\ \ \ \ \ image:\ image\ which\ \textcolor{keywordflow}{is}\ the\ same\ shape\ \textcolor{keyword}{as}\ input\ image.}
\DoxyCodeLine{01055\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{01056\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'RandomAdjustContrast'},\ values=[image]):}
\DoxyCodeLine{01057\ \ \ \ \ generator\_func\ =\ functools.partial(tf.random\_uniform,\ [],}
\DoxyCodeLine{01058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ min\_delta,\ max\_delta,\ seed=seed)}
\DoxyCodeLine{01059\ \ \ \ \ contrast\_factor\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}
\DoxyCodeLine{01060\ \ \ \ \ \ \ \ \ generator\_func,}
\DoxyCodeLine{01061\ \ \ \ \ \ \ \ \ preprocessor\_cache.PreprocessorCache.ADJUST\_CONTRAST,}
\DoxyCodeLine{01062\ \ \ \ \ \ \ \ \ preprocess\_vars\_cache)}
\DoxyCodeLine{01063\ }
\DoxyCodeLine{01064\ \ \ \ \ \textcolor{keyword}{def\ }\_adjust\_contrast(image):}
\DoxyCodeLine{01065\ \ \ \ \ \ \ image\ =\ tf.image.adjust\_contrast(image\ /\ 255,\ contrast\_factor)\ *\ 255}
\DoxyCodeLine{01066\ \ \ \ \ \ \ image\ =\ tf.clip\_by\_value(image,\ clip\_value\_min=0.0,\ clip\_value\_max=255.0)}
\DoxyCodeLine{01067\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ image}
\DoxyCodeLine{01068\ \ \ \ \ image\ =\ \_augment\_only\_rgb\_channels(image,\ \_adjust\_contrast)}
\DoxyCodeLine{01069\ \ \ \ \ \textcolor{keywordflow}{return}\ image}
\DoxyCodeLine{01070\ }
\DoxyCodeLine{01071\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a299a97f4d9fc15b96cd138d910b0d4d7_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a299a97f4d9fc15b96cd138d910b0d4d7_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a1840c66a7b36bfefbcf7e2832cdbd881}\label{namespacedetection__utils_1_1core_1_1preprocessor_a1840c66a7b36bfefbcf7e2832cdbd881} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_adjust\_hue@{random\_adjust\_hue}}
\index{random\_adjust\_hue@{random\_adjust\_hue}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_adjust\_hue()}{random\_adjust\_hue()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+adjust\+\_\+hue (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{max\+\_\+delta = {\ttfamily 0.02},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Randomly adjusts hue.

Makes sure the output image is still between 0 and 255.

Args:
  image: rank 3 float32 tensor contains 1 image -> [height, width, channels]
         with pixel values varying between [0, 255].
  max_delta: change hue randomly with a value between 0 and max_delta.
  seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: image which is the same shape as input image.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l01072}{1072}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{01076\ \ \ \textcolor{stringliteral}{"{}"{}"{}Randomly\ adjusts\ hue.}}
\DoxyCodeLine{01077\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01078\ \textcolor{stringliteral}{\ \ Makes\ sure\ the\ output\ image\ }\textcolor{keywordflow}{is}\ still\ between\ 0\ \textcolor{keywordflow}{and}\ 255.}
\DoxyCodeLine{01079\ }
\DoxyCodeLine{01080\ \ \ Args:}
\DoxyCodeLine{01081\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ contains\ 1\ image\ -\/>\ [height,\ width,\ channels]}
\DoxyCodeLine{01082\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 255].}
\DoxyCodeLine{01083\ \ \ \ \ max\_delta:\ change\ hue\ randomly\ \textcolor{keyword}{with}\ a\ value\ between\ 0\ \textcolor{keywordflow}{and}\ max\_delta.}
\DoxyCodeLine{01084\ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{01085\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{01086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{01087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{01088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{01089\ }
\DoxyCodeLine{01090\ \ \ Returns:}
\DoxyCodeLine{01091\ \ \ \ \ image:\ image\ which\ \textcolor{keywordflow}{is}\ the\ same\ shape\ \textcolor{keyword}{as}\ input\ image.}
\DoxyCodeLine{01092\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{01093\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'RandomAdjustHue'},\ values=[image]):}
\DoxyCodeLine{01094\ \ \ \ \ generator\_func\ =\ functools.partial(tf.random\_uniform,\ [],}
\DoxyCodeLine{01095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/max\_delta,\ max\_delta,\ seed=seed)}
\DoxyCodeLine{01096\ \ \ \ \ delta\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}
\DoxyCodeLine{01097\ \ \ \ \ \ \ \ \ generator\_func,\ preprocessor\_cache.PreprocessorCache.ADJUST\_HUE,}
\DoxyCodeLine{01098\ \ \ \ \ \ \ \ \ preprocess\_vars\_cache)}
\DoxyCodeLine{01099\ \ \ \ \ \textcolor{keyword}{def\ }\_adjust\_hue(image):}
\DoxyCodeLine{01100\ \ \ \ \ \ \ image\ =\ tf.image.adjust\_hue(image\ /\ 255,\ delta)\ *\ 255}
\DoxyCodeLine{01101\ \ \ \ \ \ \ image\ =\ tf.clip\_by\_value(image,\ clip\_value\_min=0.0,\ clip\_value\_max=255.0)}
\DoxyCodeLine{01102\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ image}
\DoxyCodeLine{01103\ \ \ \ \ image\ =\ \_augment\_only\_rgb\_channels(image,\ \_adjust\_hue)}
\DoxyCodeLine{01104\ \ \ \ \ \textcolor{keywordflow}{return}\ image}
\DoxyCodeLine{01105\ }
\DoxyCodeLine{01106\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a1840c66a7b36bfefbcf7e2832cdbd881_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a1840c66a7b36bfefbcf7e2832cdbd881_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_ab7fcba6b229393eb466d7163c8b27e36}\label{namespacedetection__utils_1_1core_1_1preprocessor_ab7fcba6b229393eb466d7163c8b27e36} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_adjust\_saturation@{random\_adjust\_saturation}}
\index{random\_adjust\_saturation@{random\_adjust\_saturation}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_adjust\_saturation()}{random\_adjust\_saturation()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+adjust\+\_\+saturation (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{min\+\_\+delta = {\ttfamily 0.8},  }\item[{}]{max\+\_\+delta = {\ttfamily 1.25},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Randomly adjusts saturation.

Makes sure the output image is still between 0 and 255.

Args:
  image: rank 3 float32 tensor contains 1 image -> [height, width, channels]
         with pixel values varying between [0, 255].
  min_delta: see max_delta.
  max_delta: how much to change the saturation. Saturation will change with a
             value between min_delta and max_delta. This value will be
             multiplied to the current saturation of the image.
  seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: image which is the same shape as input image.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l01107}{1107}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{01112\ \ \ \textcolor{stringliteral}{"{}"{}"{}Randomly\ adjusts\ saturation.}}
\DoxyCodeLine{01113\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01114\ \textcolor{stringliteral}{\ \ Makes\ sure\ the\ output\ image\ }\textcolor{keywordflow}{is}\ still\ between\ 0\ \textcolor{keywordflow}{and}\ 255.}
\DoxyCodeLine{01115\ }
\DoxyCodeLine{01116\ \ \ Args:}
\DoxyCodeLine{01117\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ contains\ 1\ image\ -\/>\ [height,\ width,\ channels]}
\DoxyCodeLine{01118\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 255].}
\DoxyCodeLine{01119\ \ \ \ \ min\_delta:\ see\ max\_delta.}
\DoxyCodeLine{01120\ \ \ \ \ max\_delta:\ how\ much\ to\ change\ the\ saturation.\ Saturation\ will\ change\ \textcolor{keyword}{with}\ a}
\DoxyCodeLine{01121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ value\ between\ min\_delta\ \textcolor{keywordflow}{and}\ max\_delta.\ This\ value\ will\ be}
\DoxyCodeLine{01122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ multiplied\ to\ the\ current\ saturation\ of\ the\ image.}
\DoxyCodeLine{01123\ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{01124\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{01125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{01126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{01127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{01128\ }
\DoxyCodeLine{01129\ \ \ Returns:}
\DoxyCodeLine{01130\ \ \ \ \ image:\ image\ which\ \textcolor{keywordflow}{is}\ the\ same\ shape\ \textcolor{keyword}{as}\ input\ image.}
\DoxyCodeLine{01131\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{01132\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'RandomAdjustSaturation'},\ values=[image]):}
\DoxyCodeLine{01133\ \ \ \ \ generator\_func\ =\ functools.partial(tf.random\_uniform,\ [],}
\DoxyCodeLine{01134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ min\_delta,\ max\_delta,\ seed=seed)}
\DoxyCodeLine{01135\ \ \ \ \ saturation\_factor\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \ \ generator\_func,}
\DoxyCodeLine{01137\ \ \ \ \ \ \ \ \ preprocessor\_cache.PreprocessorCache.ADJUST\_SATURATION,}
\DoxyCodeLine{01138\ \ \ \ \ \ \ \ \ preprocess\_vars\_cache)}
\DoxyCodeLine{01139\ \ \ \ \ \textcolor{keyword}{def\ }\_adjust\_saturation(image):}
\DoxyCodeLine{01140\ \ \ \ \ \ \ image\ =\ tf.image.adjust\_saturation(image\ /\ 255,\ saturation\_factor)\ *\ 255}
\DoxyCodeLine{01141\ \ \ \ \ \ \ image\ =\ tf.clip\_by\_value(image,\ clip\_value\_min=0.0,\ clip\_value\_max=255.0)}
\DoxyCodeLine{01142\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ image}
\DoxyCodeLine{01143\ \ \ \ \ image\ =\ \_augment\_only\_rgb\_channels(image,\ \_adjust\_saturation)}
\DoxyCodeLine{01144\ \ \ \ \ \textcolor{keywordflow}{return}\ image}
\DoxyCodeLine{01145\ }
\DoxyCodeLine{01146\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_ab7fcba6b229393eb466d7163c8b27e36_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_ab7fcba6b229393eb466d7163c8b27e36_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a840b20876c98b893ebbca8c363ecb020}\label{namespacedetection__utils_1_1core_1_1preprocessor_a840b20876c98b893ebbca8c363ecb020} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_black\_patches@{random\_black\_patches}}
\index{random\_black\_patches@{random\_black\_patches}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_black\_patches()}{random\_black\_patches()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+black\+\_\+patches (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{max\+\_\+black\+\_\+patches = {\ttfamily 10},  }\item[{}]{probability = {\ttfamily 0.5},  }\item[{}]{size\+\_\+to\+\_\+image\+\_\+ratio = {\ttfamily 0.1},  }\item[{}]{random\+\_\+seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Randomly adds some black patches to the image.

This op adds up to max_black_patches square black patches of a fixed size
to the image where size is specified via the size_to_image_ratio parameter.

Args:
  image: rank 3 float32 tensor containing 1 image -> [height, width, channels]
         with pixel values varying between [0, 1].
  max_black_patches: number of times that the function tries to add a
                     black box to the image.
  probability: at each try, what is the chance of adding a box.
  size_to_image_ratio: Determines the ratio of the size of the black patches
                       to the size of the image.
                       box_size = size_to_image_ratio *
                                  min(image_width, image_height)
  random_seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l02198}{2198}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{02204\ \ \ \textcolor{stringliteral}{"{}"{}"{}Randomly\ adds\ some\ black\ patches\ to\ the\ image.}}
\DoxyCodeLine{02205\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02206\ \textcolor{stringliteral}{\ \ This\ op\ adds\ up\ to\ max\_black\_patches\ square\ black\ patches\ of\ a\ fixed\ size}}
\DoxyCodeLine{02207\ \textcolor{stringliteral}{\ \ to\ the\ image\ where\ size\ }\textcolor{keywordflow}{is}\ specified\ via\ the\ size\_to\_image\_ratio\ parameter.}
\DoxyCodeLine{02208\ }
\DoxyCodeLine{02209\ \ \ Args:}
\DoxyCodeLine{02210\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ containing\ 1\ image\ -\/>\ [height,\ width,\ channels]}
\DoxyCodeLine{02211\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 1].}
\DoxyCodeLine{02212\ \ \ \ \ max\_black\_patches:\ number\ of\ times\ that\ the\ function\ tries\ to\ add\ a}
\DoxyCodeLine{02213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ black\ box\ to\ the\ image.}
\DoxyCodeLine{02214\ \ \ \ \ probability:\ at\ each\ \textcolor{keywordflow}{try},\ what\ \textcolor{keywordflow}{is}\ the\ chance\ of\ adding\ a\ box.}
\DoxyCodeLine{02215\ \ \ \ \ size\_to\_image\_ratio:\ Determines\ the\ ratio\ of\ the\ size\ of\ the\ black\ patches}
\DoxyCodeLine{02216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\ the\ size\ of\ the\ image.}
\DoxyCodeLine{02217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ box\_size\ =\ size\_to\_image\_ratio\ *}
\DoxyCodeLine{02218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ min(image\_width,\ image\_height)}
\DoxyCodeLine{02219\ \ \ \ \ random\_seed:\ random\ seed.}
\DoxyCodeLine{02220\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{02221\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{02222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{02223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{02224\ }
\DoxyCodeLine{02225\ \ \ Returns:}
\DoxyCodeLine{02226\ \ \ \ \ image}
\DoxyCodeLine{02227\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{02228\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{def\ }add\_black\_patch\_to\_image(image,\ idx):}
\DoxyCodeLine{02229\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Function\ for\ adding\ one\ patch\ to\ the\ image.}}
\DoxyCodeLine{02230\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02231\ \textcolor{stringliteral}{\ \ \ \ Args:}}
\DoxyCodeLine{02232\ \textcolor{stringliteral}{\ \ \ \ \ \ image:\ image}}
\DoxyCodeLine{02233\ \textcolor{stringliteral}{\ \ \ \ \ \ idx:\ counter\ }\textcolor{keywordflow}{for}\ number\ of\ patches\ that\ could\ have\ been\ added}
\DoxyCodeLine{02234\ }
\DoxyCodeLine{02235\ \ \ \ \ Returns:}
\DoxyCodeLine{02236\ \ \ \ \ \ \ image\ \textcolor{keyword}{with}\ a\ randomly\ added\ black\ box}
\DoxyCodeLine{02237\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{02238\ \textcolor{stringliteral}{\ \ \ \ image\_shape\ =\ tf.shape(image)}}
\DoxyCodeLine{02239\ \textcolor{stringliteral}{\ \ \ \ image\_height\ =\ image\_shape[0]}}
\DoxyCodeLine{02240\ \textcolor{stringliteral}{\ \ \ \ image\_width\ =\ image\_shape[1]}}
\DoxyCodeLine{02241\ \textcolor{stringliteral}{\ \ \ \ box\_size\ =\ tf.cast(}}
\DoxyCodeLine{02242\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ tf.multiply(}}
\DoxyCodeLine{02243\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ tf.minimum(}}
\DoxyCodeLine{02244\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tf.cast(image\_height,\ dtype=tf.float32),}}
\DoxyCodeLine{02245\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tf.cast(image\_width,\ dtype=tf.float32)),\ size\_to\_image\_ratio),}}
\DoxyCodeLine{02246\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ dtype=tf.int32)}}
\DoxyCodeLine{02247\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02248\ \textcolor{stringliteral}{\ \ \ \ generator\_func\ =\ functools.partial(tf.random\_uniform,\ [],\ minval=0.0,}}
\DoxyCodeLine{02249\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ maxval=(1.0\ -\/\ size\_to\_image\_ratio),}}
\DoxyCodeLine{02250\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ seed=random\_seed)}}
\DoxyCodeLine{02251\ \textcolor{stringliteral}{\ \ \ \ normalized\_y\_min\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}}
\DoxyCodeLine{02252\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ generator\_func,}}
\DoxyCodeLine{02253\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ preprocessor\_cache.PreprocessorCache.ADD\_BLACK\_PATCH,}}
\DoxyCodeLine{02254\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ preprocess\_vars\_cache,\ key=str(idx)\ +\ 'y'})}
\DoxyCodeLine{02255\ \ \ \ \ normalized\_x\_min\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}
\DoxyCodeLine{02256\ \ \ \ \ \ \ \ \ generator\_func,}
\DoxyCodeLine{02257\ \ \ \ \ \ \ \ \ preprocessor\_cache.PreprocessorCache.ADD\_BLACK\_PATCH,}
\DoxyCodeLine{02258\ \ \ \ \ \ \ \ \ preprocess\_vars\_cache,\ key=str(idx)\ +\ \textcolor{stringliteral}{'x'})}
\DoxyCodeLine{02259\ }
\DoxyCodeLine{02260\ \ \ \ \ y\_min\ =\ tf.cast(}
\DoxyCodeLine{02261\ \ \ \ \ \ \ \ \ normalized\_y\_min\ *\ tf.cast(image\_height,\ dtype=tf.float32),}
\DoxyCodeLine{02262\ \ \ \ \ \ \ \ \ dtype=tf.int32)}
\DoxyCodeLine{02263\ \ \ \ \ x\_min\ =\ tf.cast(}
\DoxyCodeLine{02264\ \ \ \ \ \ \ \ \ normalized\_x\_min\ *\ tf.cast(image\_width,\ dtype=tf.float32),}
\DoxyCodeLine{02265\ \ \ \ \ \ \ \ \ dtype=tf.int32)}
\DoxyCodeLine{02266\ \ \ \ \ black\_box\ =\ tf.ones([box\_size,\ box\_size,\ 3],\ dtype=tf.float32)}
\DoxyCodeLine{02267\ \ \ \ \ mask\ =\ 1.0\ -\/\ tf.image.pad\_to\_bounding\_box(black\_box,\ y\_min,\ x\_min,}
\DoxyCodeLine{02268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ image\_height,\ image\_width)}
\DoxyCodeLine{02269\ \ \ \ \ image\ =\ tf.multiply(image,\ mask)}
\DoxyCodeLine{02270\ \ \ \ \ \textcolor{keywordflow}{return}\ image}
\DoxyCodeLine{02271\ }
\DoxyCodeLine{02272\ \ \ \textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'RandomBlackPatchInImage'},\ values=[image]):}
\DoxyCodeLine{02273\ \ \ \ \ \textcolor{keywordflow}{for}\ idx\ \textcolor{keywordflow}{in}\ range(max\_black\_patches):}
\DoxyCodeLine{02274\ \ \ \ \ \ \ generator\_func\ =\ functools.partial(tf.random\_uniform,\ [],}
\DoxyCodeLine{02275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ minval=0.0,\ maxval=1.0,}
\DoxyCodeLine{02276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dtype=tf.float32,\ seed=random\_seed)}
\DoxyCodeLine{02277\ \ \ \ \ \ \ random\_prob\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}
\DoxyCodeLine{02278\ \ \ \ \ \ \ \ \ \ \ generator\_func,}
\DoxyCodeLine{02279\ \ \ \ \ \ \ \ \ \ \ preprocessor\_cache.PreprocessorCache.BLACK\_PATCHES,}
\DoxyCodeLine{02280\ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache,\ key=idx)}
\DoxyCodeLine{02281\ \ \ \ \ \ \ image\ =\ tf.cond(}
\DoxyCodeLine{02282\ \ \ \ \ \ \ \ \ \ \ tf.greater(random\_prob,\ probability),\ \textcolor{keyword}{lambda}:\ image,}
\DoxyCodeLine{02283\ \ \ \ \ \ \ \ \ \ \ functools.partial(add\_black\_patch\_to\_image,\ image=image,\ idx=idx))}
\DoxyCodeLine{02284\ \ \ \ \ \textcolor{keywordflow}{return}\ image}
\DoxyCodeLine{02285\ }
\DoxyCodeLine{02286\ }
\DoxyCodeLine{02287\ \textcolor{comment}{\#\ TODO(barretzoph):\ Put\ in\ AutoAugment\ Paper\ link\ when\ paper\ is\ live.}}

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a840b20876c98b893ebbca8c363ecb020_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_ae53f685c9e071ec37c0829148e5067fe}\label{namespacedetection__utils_1_1core_1_1preprocessor_ae53f685c9e071ec37c0829148e5067fe} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_crop\_image@{random\_crop\_image}}
\index{random\_crop\_image@{random\_crop\_image}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_crop\_image()}{random\_crop\_image()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+crop\+\_\+image (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{boxes,  }\item[{}]{labels,  }\item[{}]{label\+\_\+weights,  }\item[{}]{label\+\_\+confidences = {\ttfamily None},  }\item[{}]{multiclass\+\_\+scores = {\ttfamily None},  }\item[{}]{masks = {\ttfamily None},  }\item[{}]{keypoints = {\ttfamily None},  }\item[{}]{min\+\_\+object\+\_\+covered = {\ttfamily 1.0},  }\item[{}]{aspect\+\_\+ratio\+\_\+range = {\ttfamily (0.75,~1.33)},  }\item[{}]{area\+\_\+range = {\ttfamily (0.1,~1.0)},  }\item[{}]{overlap\+\_\+thresh = {\ttfamily 0.3},  }\item[{}]{clip\+\_\+boxes = {\ttfamily True},  }\item[{}]{random\+\_\+coef = {\ttfamily 0.0},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Randomly crops the image.

Given the input image and its bounding boxes, this op randomly
crops a subimage.  Given a user-provided set of input constraints,
the crop window is resampled until it satisfies these constraints.
If within 100 trials it is unable to find a valid crop, the original
image is returned. See the Args section for a description of the input
constraints. Both input boxes and returned Boxes are in normalized
form (e.g., lie in the unit square [0, 1]).
This function will return the original image with probability random_coef.

Note: Keypoint coordinates that are outside the crop will be set to NaN, which
is consistent with the original keypoint encoding for non-existing keypoints.

Args:
  image: rank 3 float32 tensor contains 1 image -> [height, width, channels]
         with pixel values varying between [0, 1].
  boxes: rank 2 float32 tensor containing the bounding boxes with shape
         [num_instances, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].
  labels: rank 1 int32 tensor containing the object classes.
  label_weights: float32 tensor of shape [num_instances] representing the
    weight for each box.
  label_confidences: (optional) float32 tensor of shape [num_instances].
    representing the confidence for each box.
  multiclass_scores: (optional) float32 tensor of shape
    [num_instances, num_classes] representing the score for each box for each
    class.
  masks: (optional) rank 3 float32 tensor with shape
         [num_instances, height, width] containing instance masks. The masks
         are of the same height, width as the input `image`.
  keypoints: (optional) rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]. The keypoints are in y-x
             normalized coordinates.
  min_object_covered: the cropped image must cover at least this fraction of
                      at least one of the input bounding boxes.
  aspect_ratio_range: allowed range for aspect ratio of cropped image.
  area_range: allowed range for area ratio between cropped image and the
              original image.
  overlap_thresh: minimum overlap thresh with new cropped
                  image to keep the box.
  clip_boxes: whether to clip the boxes to the cropped image.
  random_coef: a random coefficient that defines the chance of getting the
               original image. If random_coef is 0, we will always get the
               cropped image, and if it is 1.0, we will always get the
               original image.
  seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: Image shape will be [new_height, new_width, channels].
  boxes: boxes which is the same rank as input boxes. Boxes are in normalized
         form.
  labels: new labels.

  If label_weights, multiclass_scores, masks, or keypoints is not None, the
  function also returns:
  label_weights: rank 1 float32 tensor with shape [num_instances].
  multiclass_scores: rank 2 float32 tensor with shape
                     [num_instances, num_classes]
  masks: rank 3 float32 tensor with shape [num_instances, height, width]
         containing instance masks.
  keypoints: rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l01430}{1430}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01445\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{01446\ \ \ \textcolor{stringliteral}{"{}"{}"{}Randomly\ crops\ the\ image.}}
\DoxyCodeLine{01447\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01448\ \textcolor{stringliteral}{\ \ Given\ the\ input\ image\ }\textcolor{keywordflow}{and}\ its\ bounding\ boxes,\ this\ op\ randomly}
\DoxyCodeLine{01449\ \ \ crops\ a\ subimage.\ \ Given\ a\ user-\/provided\ set\ of\ input\ constraints,}
\DoxyCodeLine{01450\ \ \ the\ crop\ window\ \textcolor{keywordflow}{is}\ resampled\ until\ it\ satisfies\ these\ constraints.}
\DoxyCodeLine{01451\ \ \ If\ within\ 100\ trials\ it\ \textcolor{keywordflow}{is}\ unable\ to\ find\ a\ valid\ crop,\ the\ original}
\DoxyCodeLine{01452\ \ \ image\ \textcolor{keywordflow}{is}\ returned.\ See\ the\ Args\ section\ \textcolor{keywordflow}{for}\ a\ description\ of\ the\ input}
\DoxyCodeLine{01453\ \ \ constraints.\ Both\ input\ boxes\ \textcolor{keywordflow}{and}\ returned\ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized}
\DoxyCodeLine{01454\ \ \ form\ (e.g.,\ lie\ \textcolor{keywordflow}{in}\ the\ unit\ square\ [0,\ 1]).}
\DoxyCodeLine{01455\ \ \ This\ function\ will\ \textcolor{keywordflow}{return}\ the\ original\ image\ \textcolor{keyword}{with}\ probability\ random\_coef.}
\DoxyCodeLine{01456\ }
\DoxyCodeLine{01457\ \ \ Note:\ Keypoint\ coordinates\ that\ are\ outside\ the\ crop\ will\ be\ set\ to\ NaN,\ which}
\DoxyCodeLine{01458\ \ \ \textcolor{keywordflow}{is}\ consistent\ \textcolor{keyword}{with}\ the\ original\ keypoint\ encoding\ \textcolor{keywordflow}{for}\ non-\/existing\ keypoints.}
\DoxyCodeLine{01459\ }
\DoxyCodeLine{01460\ \ \ Args:}
\DoxyCodeLine{01461\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ contains\ 1\ image\ -\/>\ [height,\ width,\ channels]}
\DoxyCodeLine{01462\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 1].}
\DoxyCodeLine{01463\ \ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{01464\ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ 4].}
\DoxyCodeLine{01465\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{01466\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{01467\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{01468\ \ \ \ \ labels:\ rank\ 1\ int32\ tensor\ containing\ the\ object\ classes.}
\DoxyCodeLine{01469\ \ \ \ \ label\_weights:\ float32\ tensor\ of\ shape\ [num\_instances]\ representing\ the}
\DoxyCodeLine{01470\ \ \ \ \ \ \ weight\ \textcolor{keywordflow}{for}\ each\ box.}
\DoxyCodeLine{01471\ \ \ \ \ label\_confidences:\ (optional)\ float32\ tensor\ of\ shape\ [num\_instances].}
\DoxyCodeLine{01472\ \ \ \ \ \ \ representing\ the\ confidence\ \textcolor{keywordflow}{for}\ each\ box.}
\DoxyCodeLine{01473\ \ \ \ \ multiclass\_scores:\ (optional)\ float32\ tensor\ of\ shape}
\DoxyCodeLine{01474\ \ \ \ \ \ \ [num\_instances,\ num\_classes]\ representing\ the\ score\ \textcolor{keywordflow}{for}\ each\ box\ \textcolor{keywordflow}{for}\ each}
\DoxyCodeLine{01475\ \ \ \ \ \ \ \textcolor{keyword}{class}.}
\DoxyCodeLine{01476\ \ \ \ \ masks:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{01477\ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ containing\ instance\ masks.\ The\ masks}
\DoxyCodeLine{01478\ \ \ \ \ \ \ \ \ \ \ \ are\ of\ the\ same\ height,\ width\ \textcolor{keyword}{as}\ the\ input\ \`{}image\`{}.}
\DoxyCodeLine{01479\ \ \ \ \ keypoints:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{01480\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2].\ The\ keypoints\ are\ \textcolor{keywordflow}{in}\ y-\/x}
\DoxyCodeLine{01481\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ normalized\ coordinates.}
\DoxyCodeLine{01482\ \ \ \ \ min\_object\_covered:\ the\ cropped\ image\ must\ cover\ at\ least\ this\ fraction\ of}
\DoxyCodeLine{01483\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ at\ least\ one\ of\ the\ input\ bounding\ boxes.}
\DoxyCodeLine{01484\ \ \ \ \ aspect\_ratio\_range:\ allowed\ range\ \textcolor{keywordflow}{for}\ aspect\ ratio\ of\ cropped\ image.}
\DoxyCodeLine{01485\ \ \ \ \ area\_range:\ allowed\ range\ \textcolor{keywordflow}{for}\ area\ ratio\ between\ cropped\ image\ \textcolor{keywordflow}{and}\ the}
\DoxyCodeLine{01486\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.}
\DoxyCodeLine{01487\ \ \ \ \ overlap\_thresh:\ minimum\ overlap\ thresh\ \textcolor{keyword}{with}\ new\ cropped}
\DoxyCodeLine{01488\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ image\ to\ keep\ the\ box.}
\DoxyCodeLine{01489\ \ \ \ \ clip\_boxes:\ whether\ to\ clip\ the\ boxes\ to\ the\ cropped\ image.}
\DoxyCodeLine{01490\ \ \ \ \ random\_coef:\ a\ random\ coefficient\ that\ defines\ the\ chance\ of\ getting\ the}
\DoxyCodeLine{01491\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.\ If\ random\_coef\ \textcolor{keywordflow}{is}\ 0,\ we\ will\ always\ get\ the}
\DoxyCodeLine{01492\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cropped\ image,\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{if}\ it\ \textcolor{keywordflow}{is}\ 1.0,\ we\ will\ always\ get\ the}
\DoxyCodeLine{01493\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.}
\DoxyCodeLine{01494\ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{01495\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{01496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{01497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{01498\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{01499\ }
\DoxyCodeLine{01500\ \ \ Returns:}
\DoxyCodeLine{01501\ \ \ \ \ image:\ Image\ shape\ will\ be\ [new\_height,\ new\_width,\ channels].}
\DoxyCodeLine{01502\ \ \ \ \ boxes:\ boxes\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ boxes.\ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized}
\DoxyCodeLine{01503\ \ \ \ \ \ \ \ \ \ \ \ form.}
\DoxyCodeLine{01504\ \ \ \ \ labels:\ new\ labels.}
\DoxyCodeLine{01505\ }
\DoxyCodeLine{01506\ \ \ \ \ If\ label\_weights,\ multiclass\_scores,\ masks,\ \textcolor{keywordflow}{or}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},\ the}
\DoxyCodeLine{01507\ \ \ \ \ function\ also\ returns:}
\DoxyCodeLine{01508\ \ \ \ \ label\_weights:\ rank\ 1\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [num\_instances].}
\DoxyCodeLine{01509\ \ \ \ \ multiclass\_scores:\ rank\ 2\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{01510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_classes]}
\DoxyCodeLine{01511\ \ \ \ \ masks:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [num\_instances,\ height,\ width]}
\DoxyCodeLine{01512\ \ \ \ \ \ \ \ \ \ \ \ containing\ instance\ masks.}
\DoxyCodeLine{01513\ \ \ \ \ keypoints:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{01514\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2]}
\DoxyCodeLine{01515\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{01516\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01517\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{def\ }strict\_random\_crop\_image\_fn():}
\DoxyCodeLine{01518\ \ \ \ \ \textcolor{keywordflow}{return}\ \_strict\_random\_crop\_image(}
\DoxyCodeLine{01519\ \ \ \ \ \ \ \ \ image,}
\DoxyCodeLine{01520\ \ \ \ \ \ \ \ \ boxes,}
\DoxyCodeLine{01521\ \ \ \ \ \ \ \ \ labels,}
\DoxyCodeLine{01522\ \ \ \ \ \ \ \ \ label\_weights,}
\DoxyCodeLine{01523\ \ \ \ \ \ \ \ \ label\_confidences=label\_confidences,}
\DoxyCodeLine{01524\ \ \ \ \ \ \ \ \ multiclass\_scores=multiclass\_scores,}
\DoxyCodeLine{01525\ \ \ \ \ \ \ \ \ masks=masks,}
\DoxyCodeLine{01526\ \ \ \ \ \ \ \ \ keypoints=keypoints,}
\DoxyCodeLine{01527\ \ \ \ \ \ \ \ \ min\_object\_covered=min\_object\_covered,}
\DoxyCodeLine{01528\ \ \ \ \ \ \ \ \ aspect\_ratio\_range=aspect\_ratio\_range,}
\DoxyCodeLine{01529\ \ \ \ \ \ \ \ \ area\_range=area\_range,}
\DoxyCodeLine{01530\ \ \ \ \ \ \ \ \ overlap\_thresh=overlap\_thresh,}
\DoxyCodeLine{01531\ \ \ \ \ \ \ \ \ clip\_boxes=clip\_boxes,}
\DoxyCodeLine{01532\ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache)}
\DoxyCodeLine{01533\ }
\DoxyCodeLine{01534\ \ \ \textcolor{comment}{\#\ avoids\ tf.cond\ to\ make\ faster\ RCNN\ training\ on\ borg.\ See\ b/140057645.}}
\DoxyCodeLine{01535\ \ \ \textcolor{keywordflow}{if}\ random\_coef\ <\ sys.float\_info.min:}
\DoxyCodeLine{01536\ \ \ \ \ result\ =\ strict\_random\_crop\_image\_fn()}
\DoxyCodeLine{01537\ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{01538\ \ \ \ \ generator\_func\ =\ functools.partial(tf.random\_uniform,\ [],\ seed=seed)}
\DoxyCodeLine{01539\ \ \ \ \ do\_a\_crop\_random\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}
\DoxyCodeLine{01540\ \ \ \ \ \ \ \ \ generator\_func,\ preprocessor\_cache.PreprocessorCache.CROP\_IMAGE,}
\DoxyCodeLine{01541\ \ \ \ \ \ \ \ \ preprocess\_vars\_cache)}
\DoxyCodeLine{01542\ \ \ \ \ do\_a\_crop\_random\ =\ tf.greater(do\_a\_crop\_random,\ random\_coef)}
\DoxyCodeLine{01543\ }
\DoxyCodeLine{01544\ \ \ \ \ outputs\ =\ [image,\ boxes,\ labels]}
\DoxyCodeLine{01545\ }
\DoxyCodeLine{01546\ \ \ \ \ \textcolor{keywordflow}{if}\ label\_weights\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01547\ \ \ \ \ \ \ outputs.append(label\_weights)}
\DoxyCodeLine{01548\ \ \ \ \ \textcolor{keywordflow}{if}\ label\_confidences\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01549\ \ \ \ \ \ \ outputs.append(label\_confidences)}
\DoxyCodeLine{01550\ \ \ \ \ \textcolor{keywordflow}{if}\ multiclass\_scores\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01551\ \ \ \ \ \ \ outputs.append(multiclass\_scores)}
\DoxyCodeLine{01552\ \ \ \ \ \textcolor{keywordflow}{if}\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01553\ \ \ \ \ \ \ outputs.append(masks)}
\DoxyCodeLine{01554\ \ \ \ \ \textcolor{keywordflow}{if}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01555\ \ \ \ \ \ \ outputs.append(keypoints)}
\DoxyCodeLine{01556\ }
\DoxyCodeLine{01557\ \ \ \ \ result\ =\ tf.cond(do\_a\_crop\_random,\ strict\_random\_crop\_image\_fn,}
\DoxyCodeLine{01558\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ tuple(outputs))}
\DoxyCodeLine{01559\ \ \ \textcolor{keywordflow}{return}\ result}
\DoxyCodeLine{01560\ }
\DoxyCodeLine{01561\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_ae53f685c9e071ec37c0829148e5067fe_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_ae53f685c9e071ec37c0829148e5067fe_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_ad862ff65e576da434816a69fd341b3ff}\label{namespacedetection__utils_1_1core_1_1preprocessor_ad862ff65e576da434816a69fd341b3ff} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_crop\_pad\_image@{random\_crop\_pad\_image}}
\index{random\_crop\_pad\_image@{random\_crop\_pad\_image}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_crop\_pad\_image()}{random\_crop\_pad\_image()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+crop\+\_\+pad\+\_\+image (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{boxes,  }\item[{}]{labels,  }\item[{}]{label\+\_\+weights,  }\item[{}]{label\+\_\+confidences = {\ttfamily None},  }\item[{}]{multiclass\+\_\+scores = {\ttfamily None},  }\item[{}]{min\+\_\+object\+\_\+covered = {\ttfamily 1.0},  }\item[{}]{aspect\+\_\+ratio\+\_\+range = {\ttfamily (0.75,~1.33)},  }\item[{}]{area\+\_\+range = {\ttfamily (0.1,~1.0)},  }\item[{}]{overlap\+\_\+thresh = {\ttfamily 0.3},  }\item[{}]{clip\+\_\+boxes = {\ttfamily True},  }\item[{}]{random\+\_\+coef = {\ttfamily 0.0},  }\item[{}]{min\+\_\+padded\+\_\+size\+\_\+ratio = {\ttfamily (1.0,~1.0)},  }\item[{}]{max\+\_\+padded\+\_\+size\+\_\+ratio = {\ttfamily (2.0,~2.0)},  }\item[{}]{pad\+\_\+color = {\ttfamily None},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Randomly crops and pads the image.

Given an input image and its bounding boxes, this op first randomly crops
the image and then randomly pads the image with background values. Parameters
min_padded_size_ratio and max_padded_size_ratio, determine the range of the
final output image size.  Specifically, the final image size will have a size
in the range of min_padded_size_ratio * tf.shape(image) and
max_padded_size_ratio * tf.shape(image). Note that these ratios are with
respect to the size of the original image, so we can't capture the same
effect easily by independently applying RandomCropImage
followed by RandomPadImage.

Args:
  image: rank 3 float32 tensor containing 1 image -> [height, width, channels]
         with pixel values varying between [0, 1].
  boxes: rank 2 float32 tensor containing the bounding boxes -> [N, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].
  labels: rank 1 int32 tensor containing the object classes.
  label_weights: rank 1 float32 containing the label weights.
  label_confidences: rank 1 float32 containing the label confidences.
  multiclass_scores: (optional) float32 tensor of shape
    [num_instances, num_classes] representing the score for each box for each
    class.
  min_object_covered: the cropped image must cover at least this fraction of
                      at least one of the input bounding boxes.
  aspect_ratio_range: allowed range for aspect ratio of cropped image.
  area_range: allowed range for area ratio between cropped image and the
              original image.
  overlap_thresh: minimum overlap thresh with new cropped
                  image to keep the box.
  clip_boxes: whether to clip the boxes to the cropped image.
  random_coef: a random coefficient that defines the chance of getting the
               original image. If random_coef is 0, we will always get the
               cropped image, and if it is 1.0, we will always get the
               original image.
  min_padded_size_ratio: min ratio of padded image height and width to the
                         input image's height and width.
  max_padded_size_ratio: max ratio of padded image height and width to the
                         input image's height and width.
  pad_color: padding color. A rank 1 tensor of [3] with dtype=tf.float32.
             if set as None, it will be set to average color of the randomly
             cropped image.
  seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  padded_image: padded image.
  padded_boxes: boxes which is the same rank as input boxes. Boxes are in
                normalized form.
  cropped_labels: cropped labels.
  if label_weights is not None also returns:
  cropped_label_weights: cropped label weights.
  if multiclass_scores is not None also returns:
  cropped_multiclass_scores: cropped_multiclass_scores.\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l01745}{1745}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01761\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{01762\ \ \ \textcolor{stringliteral}{"{}"{}"{}Randomly\ crops\ and\ pads\ the\ image.}}
\DoxyCodeLine{01763\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01764\ \textcolor{stringliteral}{\ \ Given\ an\ input\ image\ }\textcolor{keywordflow}{and}\ its\ bounding\ boxes,\ this\ op\ first\ randomly\ crops}
\DoxyCodeLine{01765\ \ \ the\ image\ \textcolor{keywordflow}{and}\ then\ randomly\ pads\ the\ image\ \textcolor{keyword}{with}\ background\ values.\ Parameters}
\DoxyCodeLine{01766\ \ \ min\_padded\_size\_ratio\ \textcolor{keywordflow}{and}\ max\_padded\_size\_ratio,\ determine\ the\ range\ of\ the}
\DoxyCodeLine{01767\ \ \ final\ output\ image\ size.\ \ Specifically,\ the\ final\ image\ size\ will\ have\ a\ size}
\DoxyCodeLine{01768\ \ \ \textcolor{keywordflow}{in}\ the\ range\ of\ min\_padded\_size\_ratio\ *\ tf.shape(image)\ \textcolor{keywordflow}{and}}
\DoxyCodeLine{01769\ \ \ max\_padded\_size\_ratio\ *\ tf.shape(image).\ Note\ that\ these\ ratios\ are\ \textcolor{keyword}{with}}
\DoxyCodeLine{01770\ \ \ respect\ to\ the\ size\ of\ the\ original\ image,\ so\ we\ can\textcolor{stringliteral}{'t\ capture\ the\ same}}
\DoxyCodeLine{01771\ \textcolor{stringliteral}{\ \ effect\ easily\ by\ independently\ applying\ RandomCropImage}}
\DoxyCodeLine{01772\ \textcolor{stringliteral}{\ \ followed\ by\ RandomPadImage.}}
\DoxyCodeLine{01773\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01774\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{01775\ \textcolor{stringliteral}{\ \ \ \ image:\ rank\ 3\ float32\ tensor\ containing\ 1\ image\ -\/>\ [height,\ width,\ channels]}}
\DoxyCodeLine{01776\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ }\textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 1].}
\DoxyCodeLine{01777\ \ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ -\/>\ [N,\ 4].}
\DoxyCodeLine{01778\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{01779\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{01780\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{01781\ \ \ \ \ labels:\ rank\ 1\ int32\ tensor\ containing\ the\ object\ classes.}
\DoxyCodeLine{01782\ \ \ \ \ label\_weights:\ rank\ 1\ float32\ containing\ the\ label\ weights.}
\DoxyCodeLine{01783\ \ \ \ \ label\_confidences:\ rank\ 1\ float32\ containing\ the\ label\ confidences.}
\DoxyCodeLine{01784\ \ \ \ \ multiclass\_scores:\ (optional)\ float32\ tensor\ of\ shape}
\DoxyCodeLine{01785\ \ \ \ \ \ \ [num\_instances,\ num\_classes]\ representing\ the\ score\ \textcolor{keywordflow}{for}\ each\ box\ \textcolor{keywordflow}{for}\ each}
\DoxyCodeLine{01786\ \ \ \ \ \ \ \textcolor{keyword}{class}.}
\DoxyCodeLine{01787\ \ \ \ \ min\_object\_covered:\ the\ cropped\ image\ must\ cover\ at\ least\ this\ fraction\ of}
\DoxyCodeLine{01788\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ at\ least\ one\ of\ the\ input\ bounding\ boxes.}
\DoxyCodeLine{01789\ \ \ \ \ aspect\_ratio\_range:\ allowed\ range\ \textcolor{keywordflow}{for}\ aspect\ ratio\ of\ cropped\ image.}
\DoxyCodeLine{01790\ \ \ \ \ area\_range:\ allowed\ range\ \textcolor{keywordflow}{for}\ area\ ratio\ between\ cropped\ image\ \textcolor{keywordflow}{and}\ the}
\DoxyCodeLine{01791\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.}
\DoxyCodeLine{01792\ \ \ \ \ overlap\_thresh:\ minimum\ overlap\ thresh\ \textcolor{keyword}{with}\ new\ cropped}
\DoxyCodeLine{01793\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ image\ to\ keep\ the\ box.}
\DoxyCodeLine{01794\ \ \ \ \ clip\_boxes:\ whether\ to\ clip\ the\ boxes\ to\ the\ cropped\ image.}
\DoxyCodeLine{01795\ \ \ \ \ random\_coef:\ a\ random\ coefficient\ that\ defines\ the\ chance\ of\ getting\ the}
\DoxyCodeLine{01796\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.\ If\ random\_coef\ \textcolor{keywordflow}{is}\ 0,\ we\ will\ always\ get\ the}
\DoxyCodeLine{01797\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cropped\ image,\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{if}\ it\ \textcolor{keywordflow}{is}\ 1.0,\ we\ will\ always\ get\ the}
\DoxyCodeLine{01798\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.}
\DoxyCodeLine{01799\ \ \ \ \ min\_padded\_size\_ratio:\ min\ ratio\ of\ padded\ image\ height\ \textcolor{keywordflow}{and}\ width\ to\ the}
\DoxyCodeLine{01800\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ input\ image\textcolor{stringliteral}{'s\ height\ and\ width.}}
\DoxyCodeLine{01801\ \textcolor{stringliteral}{\ \ \ \ max\_padded\_size\_ratio:\ max\ ratio\ of\ padded\ image\ height\ }\textcolor{keywordflow}{and}\ width\ to\ the}
\DoxyCodeLine{01802\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ input\ image\textcolor{stringliteral}{'s\ height\ and\ width.}}
\DoxyCodeLine{01803\ \textcolor{stringliteral}{\ \ \ \ pad\_color:\ padding\ color.\ A\ rank\ 1\ tensor\ of\ [3]\ }\textcolor{keyword}{with}\ dtype=tf.float32.}
\DoxyCodeLine{01804\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ set\ \textcolor{keyword}{as}\ \textcolor{keywordtype}{None},\ it\ will\ be\ set\ to\ average\ color\ of\ the\ randomly}
\DoxyCodeLine{01805\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cropped\ image.}
\DoxyCodeLine{01806\ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{01807\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{01808\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{01809\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{01810\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{01811\ }
\DoxyCodeLine{01812\ \ \ Returns:}
\DoxyCodeLine{01813\ \ \ \ \ padded\_image:\ padded\ image.}
\DoxyCodeLine{01814\ \ \ \ \ padded\_boxes:\ boxes\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ boxes.\ Boxes\ are\ \textcolor{keywordflow}{in}}
\DoxyCodeLine{01815\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ normalized\ form.}
\DoxyCodeLine{01816\ \ \ \ \ cropped\_labels:\ cropped\ labels.}
\DoxyCodeLine{01817\ \ \ \ \ \textcolor{keywordflow}{if}\ label\_weights\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}\ also\ returns:}
\DoxyCodeLine{01818\ \ \ \ \ cropped\_label\_weights:\ cropped\ label\ weights.}
\DoxyCodeLine{01819\ \ \ \ \ \textcolor{keywordflow}{if}\ multiclass\_scores\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}\ also\ returns:}
\DoxyCodeLine{01820\ \ \ \ \ cropped\_multiclass\_scores:\ cropped\_multiclass\_scores.}
\DoxyCodeLine{01821\ }
\DoxyCodeLine{01822\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{01823\ \textcolor{stringliteral}{\ \ image\_size\ =\ tf.shape(image)}}
\DoxyCodeLine{01824\ \textcolor{stringliteral}{\ \ image\_height\ =\ image\_size[0]}}
\DoxyCodeLine{01825\ \textcolor{stringliteral}{\ \ image\_width\ =\ image\_size[1]}}
\DoxyCodeLine{01826\ \textcolor{stringliteral}{\ \ result\ =\ random\_crop\_image(}}
\DoxyCodeLine{01827\ \textcolor{stringliteral}{\ \ \ \ \ \ image=image,}}
\DoxyCodeLine{01828\ \textcolor{stringliteral}{\ \ \ \ \ \ boxes=boxes,}}
\DoxyCodeLine{01829\ \textcolor{stringliteral}{\ \ \ \ \ \ labels=labels,}}
\DoxyCodeLine{01830\ \textcolor{stringliteral}{\ \ \ \ \ \ label\_weights=label\_weights,}}
\DoxyCodeLine{01831\ \textcolor{stringliteral}{\ \ \ \ \ \ label\_confidences=label\_confidences,}}
\DoxyCodeLine{01832\ \textcolor{stringliteral}{\ \ \ \ \ \ multiclass\_scores=multiclass\_scores,}}
\DoxyCodeLine{01833\ \textcolor{stringliteral}{\ \ \ \ \ \ min\_object\_covered=min\_object\_covered,}}
\DoxyCodeLine{01834\ \textcolor{stringliteral}{\ \ \ \ \ \ aspect\_ratio\_range=aspect\_ratio\_range,}}
\DoxyCodeLine{01835\ \textcolor{stringliteral}{\ \ \ \ \ \ area\_range=area\_range,}}
\DoxyCodeLine{01836\ \textcolor{stringliteral}{\ \ \ \ \ \ overlap\_thresh=overlap\_thresh,}}
\DoxyCodeLine{01837\ \textcolor{stringliteral}{\ \ \ \ \ \ clip\_boxes=clip\_boxes,}}
\DoxyCodeLine{01838\ \textcolor{stringliteral}{\ \ \ \ \ \ random\_coef=random\_coef,}}
\DoxyCodeLine{01839\ \textcolor{stringliteral}{\ \ \ \ \ \ seed=seed,}}
\DoxyCodeLine{01840\ \textcolor{stringliteral}{\ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache)}}
\DoxyCodeLine{01841\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01842\ \textcolor{stringliteral}{\ \ cropped\_image,\ cropped\_boxes,\ cropped\_labels\ =\ result[:3]}}
\DoxyCodeLine{01843\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01844\ \textcolor{stringliteral}{\ \ min\_image\_size\ =\ tf.cast(}}
\DoxyCodeLine{01845\ \textcolor{stringliteral}{\ \ \ \ \ \ tf.cast(tf.stack([image\_height,\ image\_width]),\ dtype=tf.float32)\ *}}
\DoxyCodeLine{01846\ \textcolor{stringliteral}{\ \ \ \ \ \ min\_padded\_size\_ratio,}}
\DoxyCodeLine{01847\ \textcolor{stringliteral}{\ \ \ \ \ \ dtype=tf.int32)}}
\DoxyCodeLine{01848\ \textcolor{stringliteral}{\ \ max\_image\_size\ =\ tf.cast(}}
\DoxyCodeLine{01849\ \textcolor{stringliteral}{\ \ \ \ \ \ tf.cast(tf.stack([image\_height,\ image\_width]),\ dtype=tf.float32)\ *}}
\DoxyCodeLine{01850\ \textcolor{stringliteral}{\ \ \ \ \ \ max\_padded\_size\_ratio,}}
\DoxyCodeLine{01851\ \textcolor{stringliteral}{\ \ \ \ \ \ dtype=tf.int32)}}
\DoxyCodeLine{01852\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01853\ \textcolor{stringliteral}{\ \ padded\_image,\ padded\_boxes\ =\ random\_pad\_image(}}
\DoxyCodeLine{01854\ \textcolor{stringliteral}{\ \ \ \ \ \ cropped\_image,}}
\DoxyCodeLine{01855\ \textcolor{stringliteral}{\ \ \ \ \ \ cropped\_boxes,}}
\DoxyCodeLine{01856\ \textcolor{stringliteral}{\ \ \ \ \ \ min\_image\_size=min\_image\_size,}}
\DoxyCodeLine{01857\ \textcolor{stringliteral}{\ \ \ \ \ \ max\_image\_size=max\_image\_size,}}
\DoxyCodeLine{01858\ \textcolor{stringliteral}{\ \ \ \ \ \ pad\_color=pad\_color,}}
\DoxyCodeLine{01859\ \textcolor{stringliteral}{\ \ \ \ \ \ seed=seed,}}
\DoxyCodeLine{01860\ \textcolor{stringliteral}{\ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache)}}
\DoxyCodeLine{01861\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01862\ \textcolor{stringliteral}{\ \ cropped\_padded\_output\ =\ (padded\_image,\ padded\_boxes,\ cropped\_labels)}}
\DoxyCodeLine{01863\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01864\ \textcolor{stringliteral}{\ \ index\ =\ 3}}
\DoxyCodeLine{01865\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{if}\ label\_weights\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01866\ \ \ \ \ cropped\_label\_weights\ =\ result[index]}
\DoxyCodeLine{01867\ \ \ \ \ cropped\_padded\_output\ +=\ (cropped\_label\_weights,)}
\DoxyCodeLine{01868\ \ \ \ \ index\ +=\ 1}
\DoxyCodeLine{01869\ }
\DoxyCodeLine{01870\ \ \ \textcolor{keywordflow}{if}\ label\_confidences\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01871\ \ \ \ \ cropped\_label\_confidences\ =\ result[index]}
\DoxyCodeLine{01872\ \ \ \ \ cropped\_padded\_output\ +=\ (cropped\_label\_confidences,)}
\DoxyCodeLine{01873\ \ \ \ \ index\ +=\ 1}
\DoxyCodeLine{01874\ }
\DoxyCodeLine{01875\ \ \ \textcolor{keywordflow}{if}\ multiclass\_scores\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01876\ \ \ \ \ cropped\_multiclass\_scores\ =\ result[index]}
\DoxyCodeLine{01877\ \ \ \ \ cropped\_padded\_output\ +=\ (cropped\_multiclass\_scores,)}
\DoxyCodeLine{01878\ }
\DoxyCodeLine{01879\ \ \ \textcolor{keywordflow}{return}\ cropped\_padded\_output}
\DoxyCodeLine{01880\ }
\DoxyCodeLine{01881\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_ad862ff65e576da434816a69fd341b3ff_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_ad862ff65e576da434816a69fd341b3ff_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_aed03769aeaaf1e8b96f676996f870e8c}\label{namespacedetection__utils_1_1core_1_1preprocessor_aed03769aeaaf1e8b96f676996f870e8c} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_crop\_to\_aspect\_ratio@{random\_crop\_to\_aspect\_ratio}}
\index{random\_crop\_to\_aspect\_ratio@{random\_crop\_to\_aspect\_ratio}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_crop\_to\_aspect\_ratio()}{random\_crop\_to\_aspect\_ratio()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+crop\+\_\+to\+\_\+aspect\+\_\+ratio (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{boxes,  }\item[{}]{labels,  }\item[{}]{label\+\_\+weights,  }\item[{}]{label\+\_\+confidences = {\ttfamily None},  }\item[{}]{multiclass\+\_\+scores = {\ttfamily None},  }\item[{}]{masks = {\ttfamily None},  }\item[{}]{keypoints = {\ttfamily None},  }\item[{}]{aspect\+\_\+ratio = {\ttfamily 1.0},  }\item[{}]{overlap\+\_\+thresh = {\ttfamily 0.3},  }\item[{}]{clip\+\_\+boxes = {\ttfamily True},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Randomly crops an image to the specified aspect ratio.

Randomly crops the a portion of the image such that the crop is of the
specified aspect ratio, and the crop is as large as possible. If the specified
aspect ratio is larger than the aspect ratio of the image, this op will
randomly remove rows from the top and bottom of the image. If the specified
aspect ratio is less than the aspect ratio of the image, this op will randomly
remove cols from the left and right of the image. If the specified aspect
ratio is the same as the aspect ratio of the image, this op will return the
image.

Args:
  image: rank 3 float32 tensor contains 1 image -> [height, width, channels]
         with pixel values varying between [0, 1].
  boxes: rank 2 float32 tensor containing the bounding boxes -> [N, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].
  labels: rank 1 int32 tensor containing the object classes.
  label_weights: float32 tensor of shape [num_instances] representing the
    weight for each box.
  label_confidences: (optional) float32 tensor of shape [num_instances]
    representing the confidence for each box.
  multiclass_scores: (optional) float32 tensor of shape
    [num_instances, num_classes] representing the score for each box for each
    class.
  masks: (optional) rank 3 float32 tensor with shape
         [num_instances, height, width] containing instance masks. The masks
         are of the same height, width as the input `image`.
  keypoints: (optional) rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]. The keypoints are in y-x
             normalized coordinates.
  aspect_ratio: the aspect ratio of cropped image.
  overlap_thresh: minimum overlap thresh with new cropped
                  image to keep the box.
  clip_boxes: whether to clip the boxes to the cropped image.
  seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: image which is the same rank as input image.
  boxes: boxes which is the same rank as input boxes.
         Boxes are in normalized form.
  labels: new labels.

  If label_weights, masks, keypoints, or multiclass_scores is not None, the
  function also returns:
  label_weights: rank 1 float32 tensor with shape [num_instances].
  masks: rank 3 float32 tensor with shape [num_instances, height, width]
         containing instance masks.
  keypoints: rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]
  multiclass_scores: rank 2 float32 tensor with shape
                     [num_instances, num_classes]

Raises:
  ValueError: If image is not a 3D tensor.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l01882}{1882}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01894\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{01895\ \ \ \textcolor{stringliteral}{"{}"{}"{}Randomly\ crops\ an\ image\ to\ the\ specified\ aspect\ ratio.}}
\DoxyCodeLine{01896\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01897\ \textcolor{stringliteral}{\ \ Randomly\ crops\ the\ a\ portion\ of\ the\ image\ such\ that\ the\ crop\ }\textcolor{keywordflow}{is}\ of\ the}
\DoxyCodeLine{01898\ \ \ specified\ aspect\ ratio,\ \textcolor{keywordflow}{and}\ the\ crop\ \textcolor{keywordflow}{is}\ \textcolor{keyword}{as}\ large\ \textcolor{keyword}{as}\ possible.\ If\ the\ specified}
\DoxyCodeLine{01899\ \ \ aspect\ ratio\ \textcolor{keywordflow}{is}\ larger\ than\ the\ aspect\ ratio\ of\ the\ image,\ this\ op\ will}
\DoxyCodeLine{01900\ \ \ randomly\ remove\ rows\ \textcolor{keyword}{from}\ the\ top\ \textcolor{keywordflow}{and}\ bottom\ of\ the\ image.\ If\ the\ specified}
\DoxyCodeLine{01901\ \ \ aspect\ ratio\ \textcolor{keywordflow}{is}\ less\ than\ the\ aspect\ ratio\ of\ the\ image,\ this\ op\ will\ randomly}
\DoxyCodeLine{01902\ \ \ remove\ cols\ \textcolor{keyword}{from}\ the\ left\ \textcolor{keywordflow}{and}\ right\ of\ the\ image.\ If\ the\ specified\ aspect}
\DoxyCodeLine{01903\ \ \ ratio\ \textcolor{keywordflow}{is}\ the\ same\ \textcolor{keyword}{as}\ the\ aspect\ ratio\ of\ the\ image,\ this\ op\ will\ \textcolor{keywordflow}{return}\ the}
\DoxyCodeLine{01904\ \ \ image.}
\DoxyCodeLine{01905\ }
\DoxyCodeLine{01906\ \ \ Args:}
\DoxyCodeLine{01907\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ contains\ 1\ image\ -\/>\ [height,\ width,\ channels]}
\DoxyCodeLine{01908\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 1].}
\DoxyCodeLine{01909\ \ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ -\/>\ [N,\ 4].}
\DoxyCodeLine{01910\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{01911\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{01912\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{01913\ \ \ \ \ labels:\ rank\ 1\ int32\ tensor\ containing\ the\ object\ classes.}
\DoxyCodeLine{01914\ \ \ \ \ label\_weights:\ float32\ tensor\ of\ shape\ [num\_instances]\ representing\ the}
\DoxyCodeLine{01915\ \ \ \ \ \ \ weight\ \textcolor{keywordflow}{for}\ each\ box.}
\DoxyCodeLine{01916\ \ \ \ \ label\_confidences:\ (optional)\ float32\ tensor\ of\ shape\ [num\_instances]}
\DoxyCodeLine{01917\ \ \ \ \ \ \ representing\ the\ confidence\ \textcolor{keywordflow}{for}\ each\ box.}
\DoxyCodeLine{01918\ \ \ \ \ multiclass\_scores:\ (optional)\ float32\ tensor\ of\ shape}
\DoxyCodeLine{01919\ \ \ \ \ \ \ [num\_instances,\ num\_classes]\ representing\ the\ score\ \textcolor{keywordflow}{for}\ each\ box\ \textcolor{keywordflow}{for}\ each}
\DoxyCodeLine{01920\ \ \ \ \ \ \ \textcolor{keyword}{class}.}
\DoxyCodeLine{01921\ \ \ \ \ masks:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{01922\ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ containing\ instance\ masks.\ The\ masks}
\DoxyCodeLine{01923\ \ \ \ \ \ \ \ \ \ \ \ are\ of\ the\ same\ height,\ width\ \textcolor{keyword}{as}\ the\ input\ \`{}image\`{}.}
\DoxyCodeLine{01924\ \ \ \ \ keypoints:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{01925\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2].\ The\ keypoints\ are\ \textcolor{keywordflow}{in}\ y-\/x}
\DoxyCodeLine{01926\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ normalized\ coordinates.}
\DoxyCodeLine{01927\ \ \ \ \ aspect\_ratio:\ the\ aspect\ ratio\ of\ cropped\ image.}
\DoxyCodeLine{01928\ \ \ \ \ overlap\_thresh:\ minimum\ overlap\ thresh\ \textcolor{keyword}{with}\ new\ cropped}
\DoxyCodeLine{01929\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ image\ to\ keep\ the\ box.}
\DoxyCodeLine{01930\ \ \ \ \ clip\_boxes:\ whether\ to\ clip\ the\ boxes\ to\ the\ cropped\ image.}
\DoxyCodeLine{01931\ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{01932\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{01933\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{01934\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{01935\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{01936\ }
\DoxyCodeLine{01937\ \ \ Returns:}
\DoxyCodeLine{01938\ \ \ \ \ image:\ image\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ image.}
\DoxyCodeLine{01939\ \ \ \ \ boxes:\ boxes\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ boxes.}
\DoxyCodeLine{01940\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form.}
\DoxyCodeLine{01941\ \ \ \ \ labels:\ new\ labels.}
\DoxyCodeLine{01942\ }
\DoxyCodeLine{01943\ \ \ \ \ If\ label\_weights,\ masks,\ keypoints,\ \textcolor{keywordflow}{or}\ multiclass\_scores\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},\ the}
\DoxyCodeLine{01944\ \ \ \ \ function\ also\ returns:}
\DoxyCodeLine{01945\ \ \ \ \ label\_weights:\ rank\ 1\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [num\_instances].}
\DoxyCodeLine{01946\ \ \ \ \ masks:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [num\_instances,\ height,\ width]}
\DoxyCodeLine{01947\ \ \ \ \ \ \ \ \ \ \ \ containing\ instance\ masks.}
\DoxyCodeLine{01948\ \ \ \ \ keypoints:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{01949\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2]}
\DoxyCodeLine{01950\ \ \ \ \ multiclass\_scores:\ rank\ 2\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{01951\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_classes]}
\DoxyCodeLine{01952\ }
\DoxyCodeLine{01953\ \ \ Raises:}
\DoxyCodeLine{01954\ \ \ \ \ ValueError:\ If\ image\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ a\ 3D\ tensor.}
\DoxyCodeLine{01955\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{01956\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{if}\ len(image.get\_shape())\ !=\ 3:}
\DoxyCodeLine{01957\ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'Image\ should\ be\ 3D\ tensor'})}
\DoxyCodeLine{01958\ }
\DoxyCodeLine{01959\ \ \ \textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'RandomCropToAspectRatio'},\ values=[image]):}
\DoxyCodeLine{01960\ \ \ \ \ image\_shape\ =\ tf.shape(image)}
\DoxyCodeLine{01961\ \ \ \ \ orig\_height\ =\ image\_shape[0]}
\DoxyCodeLine{01962\ \ \ \ \ orig\_width\ =\ image\_shape[1]}
\DoxyCodeLine{01963\ \ \ \ \ orig\_aspect\_ratio\ =\ tf.cast(}
\DoxyCodeLine{01964\ \ \ \ \ \ \ \ \ orig\_width,\ dtype=tf.float32)\ /\ tf.cast(}
\DoxyCodeLine{01965\ \ \ \ \ \ \ \ \ \ \ \ \ orig\_height,\ dtype=tf.float32)}
\DoxyCodeLine{01966\ \ \ \ \ new\_aspect\_ratio\ =\ tf.constant(aspect\_ratio,\ dtype=tf.float32)}
\DoxyCodeLine{01967\ }
\DoxyCodeLine{01968\ \ \ \ \ \textcolor{keyword}{def\ }target\_height\_fn():}
\DoxyCodeLine{01969\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ tf.cast(}
\DoxyCodeLine{01970\ \ \ \ \ \ \ \ \ \ \ tf.round(tf.cast(orig\_width,\ dtype=tf.float32)\ /\ new\_aspect\_ratio),}
\DoxyCodeLine{01971\ \ \ \ \ \ \ \ \ \ \ dtype=tf.int32)}
\DoxyCodeLine{01972\ }
\DoxyCodeLine{01973\ \ \ \ \ target\_height\ =\ tf.cond(orig\_aspect\_ratio\ >=\ new\_aspect\_ratio,}
\DoxyCodeLine{01974\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ orig\_height,\ target\_height\_fn)}
\DoxyCodeLine{01975\ }
\DoxyCodeLine{01976\ \ \ \ \ \textcolor{keyword}{def\ }target\_width\_fn():}
\DoxyCodeLine{01977\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ tf.cast(}
\DoxyCodeLine{01978\ \ \ \ \ \ \ \ \ \ \ tf.round(tf.cast(orig\_height,\ dtype=tf.float32)\ *\ new\_aspect\_ratio),}
\DoxyCodeLine{01979\ \ \ \ \ \ \ \ \ \ \ dtype=tf.int32)}
\DoxyCodeLine{01980\ }
\DoxyCodeLine{01981\ \ \ \ \ target\_width\ =\ tf.cond(orig\_aspect\_ratio\ <=\ new\_aspect\_ratio,}
\DoxyCodeLine{01982\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ orig\_width,\ target\_width\_fn)}
\DoxyCodeLine{01983\ }
\DoxyCodeLine{01984\ \ \ \ \ \textcolor{comment}{\#\ either\ offset\_height\ =\ 0\ and\ offset\_width\ is\ randomly\ chosen\ from}}
\DoxyCodeLine{01985\ \ \ \ \ \textcolor{comment}{\#\ [0,\ offset\_width\ -\/\ target\_width),\ or\ else\ offset\_width\ =\ 0\ and}}
\DoxyCodeLine{01986\ \ \ \ \ \textcolor{comment}{\#\ offset\_height\ is\ randomly\ chosen\ from\ [0,\ offset\_height\ -\/\ target\_height)}}
\DoxyCodeLine{01987\ \ \ \ \ offset\_height\ =\ \_random\_integer(0,\ orig\_height\ -\/\ target\_height\ +\ 1,\ seed)}
\DoxyCodeLine{01988\ \ \ \ \ offset\_width\ =\ \_random\_integer(0,\ orig\_width\ -\/\ target\_width\ +\ 1,\ seed)}
\DoxyCodeLine{01989\ }
\DoxyCodeLine{01990\ \ \ \ \ generator\_func\ =\ \textcolor{keyword}{lambda}:\ (offset\_height,\ offset\_width)}
\DoxyCodeLine{01991\ \ \ \ \ offset\_height,\ offset\_width\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}
\DoxyCodeLine{01992\ \ \ \ \ \ \ \ \ generator\_func,}
\DoxyCodeLine{01993\ \ \ \ \ \ \ \ \ preprocessor\_cache.PreprocessorCache.CROP\_TO\_ASPECT\_RATIO,}
\DoxyCodeLine{01994\ \ \ \ \ \ \ \ \ preprocess\_vars\_cache)}
\DoxyCodeLine{01995\ }
\DoxyCodeLine{01996\ \ \ \ \ new\_image\ =\ tf.image.crop\_to\_bounding\_box(}
\DoxyCodeLine{01997\ \ \ \ \ \ \ \ \ image,\ offset\_height,\ offset\_width,\ target\_height,\ target\_width)}
\DoxyCodeLine{01998\ }
\DoxyCodeLine{01999\ \ \ \ \ im\_box\ =\ tf.stack([}
\DoxyCodeLine{02000\ \ \ \ \ \ \ \ \ tf.cast(offset\_height,\ dtype=tf.float32)\ /}
\DoxyCodeLine{02001\ \ \ \ \ \ \ \ \ tf.cast(orig\_height,\ dtype=tf.float32),}
\DoxyCodeLine{02002\ \ \ \ \ \ \ \ \ tf.cast(offset\_width,\ dtype=tf.float32)\ /}
\DoxyCodeLine{02003\ \ \ \ \ \ \ \ \ tf.cast(orig\_width,\ dtype=tf.float32),}
\DoxyCodeLine{02004\ \ \ \ \ \ \ \ \ tf.cast(offset\_height\ +\ target\_height,\ dtype=tf.float32)\ /}
\DoxyCodeLine{02005\ \ \ \ \ \ \ \ \ tf.cast(orig\_height,\ dtype=tf.float32),}
\DoxyCodeLine{02006\ \ \ \ \ \ \ \ \ tf.cast(offset\_width\ +\ target\_width,\ dtype=tf.float32)\ /}
\DoxyCodeLine{02007\ \ \ \ \ \ \ \ \ tf.cast(orig\_width,\ dtype=tf.float32)}
\DoxyCodeLine{02008\ \ \ \ \ ])}
\DoxyCodeLine{02009\ }
\DoxyCodeLine{02010\ \ \ \ \ boxlist\ =\ box\_list.BoxList(boxes)}
\DoxyCodeLine{02011\ \ \ \ \ boxlist.add\_field(\textcolor{stringliteral}{'labels'},\ labels)}
\DoxyCodeLine{02012\ }
\DoxyCodeLine{02013\ \ \ \ \ boxlist.add\_field(\textcolor{stringliteral}{'label\_weights'},\ label\_weights)}
\DoxyCodeLine{02014\ }
\DoxyCodeLine{02015\ \ \ \ \ \textcolor{keywordflow}{if}\ label\_confidences\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02016\ \ \ \ \ \ \ boxlist.add\_field(\textcolor{stringliteral}{'label\_confidences'},\ label\_confidences)}
\DoxyCodeLine{02017\ }
\DoxyCodeLine{02018\ \ \ \ \ \textcolor{keywordflow}{if}\ multiclass\_scores\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02019\ \ \ \ \ \ \ boxlist.add\_field(\textcolor{stringliteral}{'multiclass\_scores'},\ multiclass\_scores)}
\DoxyCodeLine{02020\ }
\DoxyCodeLine{02021\ \ \ \ \ im\_boxlist\ =\ box\_list.BoxList(tf.expand\_dims(im\_box,\ 0))}
\DoxyCodeLine{02022\ }
\DoxyCodeLine{02023\ \ \ \ \ \textcolor{comment}{\#\ remove\ boxes\ whose\ overlap\ with\ the\ image\ is\ less\ than\ overlap\_thresh}}
\DoxyCodeLine{02024\ \ \ \ \ overlapping\_boxlist,\ keep\_ids\ =\ box\_list\_ops.prune\_non\_overlapping\_boxes(}
\DoxyCodeLine{02025\ \ \ \ \ \ \ \ \ boxlist,\ im\_boxlist,\ overlap\_thresh)}
\DoxyCodeLine{02026\ }
\DoxyCodeLine{02027\ \ \ \ \ \textcolor{comment}{\#\ change\ the\ coordinate\ of\ the\ remaining\ boxes}}
\DoxyCodeLine{02028\ \ \ \ \ new\_labels\ =\ overlapping\_boxlist.get\_field(\textcolor{stringliteral}{'labels'})}
\DoxyCodeLine{02029\ \ \ \ \ new\_boxlist\ =\ box\_list\_ops.change\_coordinate\_frame(overlapping\_boxlist,}
\DoxyCodeLine{02030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ im\_box)}
\DoxyCodeLine{02031\ \ \ \ \ \textcolor{keywordflow}{if}\ clip\_boxes:}
\DoxyCodeLine{02032\ \ \ \ \ \ \ new\_boxlist\ =\ box\_list\_ops.clip\_to\_window(}
\DoxyCodeLine{02033\ \ \ \ \ \ \ \ \ \ \ new\_boxlist,\ tf.constant([0.0,\ 0.0,\ 1.0,\ 1.0],\ tf.float32))}
\DoxyCodeLine{02034\ \ \ \ \ new\_boxes\ =\ new\_boxlist.get()}
\DoxyCodeLine{02035\ }
\DoxyCodeLine{02036\ \ \ \ \ result\ =\ [new\_image,\ new\_boxes,\ new\_labels]}
\DoxyCodeLine{02037\ }
\DoxyCodeLine{02038\ \ \ \ \ new\_label\_weights\ =\ overlapping\_boxlist.get\_field(\textcolor{stringliteral}{'label\_weights'})}
\DoxyCodeLine{02039\ \ \ \ \ result.append(new\_label\_weights)}
\DoxyCodeLine{02040\ }
\DoxyCodeLine{02041\ \ \ \ \ \textcolor{keywordflow}{if}\ label\_confidences\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02042\ \ \ \ \ \ \ new\_label\_confidences\ =\ (}
\DoxyCodeLine{02043\ \ \ \ \ \ \ \ \ \ \ overlapping\_boxlist.get\_field(\textcolor{stringliteral}{'label\_confidences'}))}
\DoxyCodeLine{02044\ \ \ \ \ \ \ result.append(new\_label\_confidences)}
\DoxyCodeLine{02045\ }
\DoxyCodeLine{02046\ \ \ \ \ \textcolor{keywordflow}{if}\ multiclass\_scores\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02047\ \ \ \ \ \ \ new\_multiclass\_scores\ =\ overlapping\_boxlist.get\_field(\textcolor{stringliteral}{'multiclass\_scores'})}
\DoxyCodeLine{02048\ \ \ \ \ \ \ result.append(new\_multiclass\_scores)}
\DoxyCodeLine{02049\ }
\DoxyCodeLine{02050\ \ \ \ \ \textcolor{keywordflow}{if}\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02051\ \ \ \ \ \ \ masks\_inside\_window\ =\ tf.gather(masks,\ keep\_ids)}
\DoxyCodeLine{02052\ \ \ \ \ \ \ masks\_box\_begin\ =\ tf.stack([0,\ offset\_height,\ offset\_width])}
\DoxyCodeLine{02053\ \ \ \ \ \ \ masks\_box\_size\ =\ tf.stack([-\/1,\ target\_height,\ target\_width])}
\DoxyCodeLine{02054\ \ \ \ \ \ \ new\_masks\ =\ tf.slice(masks\_inside\_window,\ masks\_box\_begin,\ masks\_box\_size)}
\DoxyCodeLine{02055\ \ \ \ \ \ \ result.append(new\_masks)}
\DoxyCodeLine{02056\ }
\DoxyCodeLine{02057\ \ \ \ \ \textcolor{keywordflow}{if}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02058\ \ \ \ \ \ \ keypoints\_inside\_window\ =\ tf.gather(keypoints,\ keep\_ids)}
\DoxyCodeLine{02059\ \ \ \ \ \ \ new\_keypoints\ =\ keypoint\_ops.change\_coordinate\_frame(}
\DoxyCodeLine{02060\ \ \ \ \ \ \ \ \ \ \ keypoints\_inside\_window,\ im\_box)}
\DoxyCodeLine{02061\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ clip\_boxes:}
\DoxyCodeLine{02062\ \ \ \ \ \ \ \ \ new\_keypoints\ =\ keypoint\_ops.prune\_outside\_window(new\_keypoints,}
\DoxyCodeLine{02063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [0.0,\ 0.0,\ 1.0,\ 1.0])}
\DoxyCodeLine{02064\ \ \ \ \ \ \ result.append(new\_keypoints)}
\DoxyCodeLine{02065\ }
\DoxyCodeLine{02066\ \ \ \ \ \textcolor{keywordflow}{return}\ tuple(result)}
\DoxyCodeLine{02067\ }
\DoxyCodeLine{02068\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_aed03769aeaaf1e8b96f676996f870e8c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_aed03769aeaaf1e8b96f676996f870e8c_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a6b87ac3b4ca959406f78a5e8f2782848}\label{namespacedetection__utils_1_1core_1_1preprocessor_a6b87ac3b4ca959406f78a5e8f2782848} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_distort\_color@{random\_distort\_color}}
\index{random\_distort\_color@{random\_distort\_color}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_distort\_color()}{random\_distort\_color()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+distort\+\_\+color (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{color\+\_\+ordering = {\ttfamily 0},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Randomly distorts color.

Randomly distorts color using a combination of brightness, hue, contrast and
saturation changes. Makes sure the output image is still between 0 and 255.

Args:
  image: rank 3 float32 tensor contains 1 image -> [height, width, channels]
         with pixel values varying between [0, 255].
  color_ordering: Python int, a type of distortion (valid values: 0, 1).
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: image which is the same shape as input image.

Raises:
  ValueError: if color_ordering is not in {0, 1}.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l01147}{1147}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01147\ \textcolor{keyword}{def\ }random\_distort\_color(image,\ color\_ordering=0,\ preprocess\_vars\_cache=None):}
\DoxyCodeLine{01148\ \ \ \textcolor{stringliteral}{"{}"{}"{}Randomly\ distorts\ color.}}
\DoxyCodeLine{01149\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01150\ \textcolor{stringliteral}{\ \ Randomly\ distorts\ color\ using\ a\ combination\ of\ brightness,\ hue,\ contrast\ }\textcolor{keywordflow}{and}}
\DoxyCodeLine{01151\ \ \ saturation\ changes.\ Makes\ sure\ the\ output\ image\ \textcolor{keywordflow}{is}\ still\ between\ 0\ \textcolor{keywordflow}{and}\ 255.}
\DoxyCodeLine{01152\ }
\DoxyCodeLine{01153\ \ \ Args:}
\DoxyCodeLine{01154\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ contains\ 1\ image\ -\/>\ [height,\ width,\ channels]}
\DoxyCodeLine{01155\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 255].}
\DoxyCodeLine{01156\ \ \ \ \ color\_ordering:\ Python\ int,\ a\ type\ of\ distortion\ (valid\ values:\ 0,\ 1).}
\DoxyCodeLine{01157\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{01158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{01159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{01160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{01161\ }
\DoxyCodeLine{01162\ \ \ Returns:}
\DoxyCodeLine{01163\ \ \ \ \ image:\ image\ which\ \textcolor{keywordflow}{is}\ the\ same\ shape\ \textcolor{keyword}{as}\ input\ image.}
\DoxyCodeLine{01164\ }
\DoxyCodeLine{01165\ \ \ Raises:}
\DoxyCodeLine{01166\ \ \ \ \ ValueError:\ \textcolor{keywordflow}{if}\ color\_ordering\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ \{0,\ 1\}.}
\DoxyCodeLine{01167\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{01168\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'RandomDistortColor'},\ values=[image]):}
\DoxyCodeLine{01169\ \ \ \ \ \textcolor{keywordflow}{if}\ color\_ordering\ ==\ 0:}
\DoxyCodeLine{01170\ \ \ \ \ \ \ image\ =\ random\_adjust\_brightness(}
\DoxyCodeLine{01171\ \ \ \ \ \ \ \ \ \ \ image,\ max\_delta=32.\ /\ 255.,}
\DoxyCodeLine{01172\ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache)}
\DoxyCodeLine{01173\ \ \ \ \ \ \ image\ =\ random\_adjust\_saturation(}
\DoxyCodeLine{01174\ \ \ \ \ \ \ \ \ \ \ image,\ min\_delta=0.5,\ max\_delta=1.5,}
\DoxyCodeLine{01175\ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache)}
\DoxyCodeLine{01176\ \ \ \ \ \ \ image\ =\ random\_adjust\_hue(}
\DoxyCodeLine{01177\ \ \ \ \ \ \ \ \ \ \ image,\ max\_delta=0.2,}
\DoxyCodeLine{01178\ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache)}
\DoxyCodeLine{01179\ \ \ \ \ \ \ image\ =\ random\_adjust\_contrast(}
\DoxyCodeLine{01180\ \ \ \ \ \ \ \ \ \ \ image,\ min\_delta=0.5,\ max\_delta=1.5,}
\DoxyCodeLine{01181\ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache)}
\DoxyCodeLine{01182\ }
\DoxyCodeLine{01183\ \ \ \ \ \textcolor{keywordflow}{elif}\ color\_ordering\ ==\ 1:}
\DoxyCodeLine{01184\ \ \ \ \ \ \ image\ =\ random\_adjust\_brightness(}
\DoxyCodeLine{01185\ \ \ \ \ \ \ \ \ \ \ image,\ max\_delta=32.\ /\ 255.,}
\DoxyCodeLine{01186\ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache)}
\DoxyCodeLine{01187\ \ \ \ \ \ \ image\ =\ random\_adjust\_contrast(}
\DoxyCodeLine{01188\ \ \ \ \ \ \ \ \ \ \ image,\ min\_delta=0.5,\ max\_delta=1.5,}
\DoxyCodeLine{01189\ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache)}
\DoxyCodeLine{01190\ \ \ \ \ \ \ image\ =\ random\_adjust\_saturation(}
\DoxyCodeLine{01191\ \ \ \ \ \ \ \ \ \ \ image,\ min\_delta=0.5,\ max\_delta=1.5,}
\DoxyCodeLine{01192\ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache)}
\DoxyCodeLine{01193\ \ \ \ \ \ \ image\ =\ random\_adjust\_hue(}
\DoxyCodeLine{01194\ \ \ \ \ \ \ \ \ \ \ image,\ max\_delta=0.2,}
\DoxyCodeLine{01195\ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache)}
\DoxyCodeLine{01196\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{01197\ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'color\_ordering\ must\ be\ in\ \{0,\ 1\}'})}
\DoxyCodeLine{01198\ \ \ \ \ \textcolor{keywordflow}{return}\ image}
\DoxyCodeLine{01199\ }
\DoxyCodeLine{01200\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a6b87ac3b4ca959406f78a5e8f2782848_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a9ad2674a88326abe9a620d33dc6dbaa7}\label{namespacedetection__utils_1_1core_1_1preprocessor_a9ad2674a88326abe9a620d33dc6dbaa7} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_horizontal\_flip@{random\_horizontal\_flip}}
\index{random\_horizontal\_flip@{random\_horizontal\_flip}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_horizontal\_flip()}{random\_horizontal\_flip()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+horizontal\+\_\+flip (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{boxes = {\ttfamily None},  }\item[{}]{masks = {\ttfamily None},  }\item[{}]{keypoints = {\ttfamily None},  }\item[{}]{keypoint\+\_\+flip\+\_\+permutation = {\ttfamily None},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Randomly flips the image and detections horizontally.

The probability of flipping the image is 50%.

Args:
  image: rank 3 float32 tensor with shape [height, width, channels].
  boxes: (optional) rank 2 float32 tensor with shape [N, 4]
         containing the bounding boxes.
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].
  masks: (optional) rank 3 float32 tensor with shape
         [num_instances, height, width] containing instance masks. The masks
         are of the same height, width as the input `image`.
  keypoints: (optional) rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]. The keypoints are in y-x
             normalized coordinates.
  keypoint_flip_permutation: rank 1 int32 tensor containing the keypoint flip
                             permutation.
  seed: random seed
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: image which is the same shape as input image.

  If boxes, masks, keypoints, and keypoint_flip_permutation are not None,
  the function also returns the following tensors.

  boxes: rank 2 float32 tensor containing the bounding boxes -> [N, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
  masks: rank 3 float32 tensor with shape [num_instances, height, width]
         containing instance masks.
  keypoints: rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]

Raises:
  ValueError: if keypoints are provided but keypoint_flip_permutation is not.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00564}{564}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{00571\ \ \ \textcolor{stringliteral}{"{}"{}"{}Randomly\ flips\ the\ image\ and\ detections\ horizontally.}}
\DoxyCodeLine{00572\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00573\ \textcolor{stringliteral}{\ \ The\ probability\ of\ flipping\ the\ image\ }\textcolor{keywordflow}{is}\ 50\%.}
\DoxyCodeLine{00574\ }
\DoxyCodeLine{00575\ \ \ Args:}
\DoxyCodeLine{00576\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [height,\ width,\ channels].}
\DoxyCodeLine{00577\ \ \ \ \ boxes:\ (optional)\ rank\ 2\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [N,\ 4]}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ \ \ \ containing\ the\ bounding\ boxes.}
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{00580\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{00582\ \ \ \ \ masks:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ containing\ instance\ masks.\ The\ masks}
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ \ \ \ are\ of\ the\ same\ height,\ width\ \textcolor{keyword}{as}\ the\ input\ \`{}image\`{}.}
\DoxyCodeLine{00585\ \ \ \ \ keypoints:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2].\ The\ keypoints\ are\ \textcolor{keywordflow}{in}\ y-\/x}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ normalized\ coordinates.}
\DoxyCodeLine{00588\ \ \ \ \ keypoint\_flip\_permutation:\ rank\ 1\ int32\ tensor\ containing\ the\ keypoint\ flip}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ permutation.}
\DoxyCodeLine{00590\ \ \ \ \ seed:\ random\ seed}
\DoxyCodeLine{00591\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{00595\ }
\DoxyCodeLine{00596\ \ \ Returns:}
\DoxyCodeLine{00597\ \ \ \ \ image:\ image\ which\ \textcolor{keywordflow}{is}\ the\ same\ shape\ \textcolor{keyword}{as}\ input\ image.}
\DoxyCodeLine{00598\ }
\DoxyCodeLine{00599\ \ \ \ \ If\ boxes,\ masks,\ keypoints,\ \textcolor{keywordflow}{and}\ keypoint\_flip\_permutation\ are\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},}
\DoxyCodeLine{00600\ \ \ \ \ the\ function\ also\ returns\ the\ following\ tensors.}
\DoxyCodeLine{00601\ }
\DoxyCodeLine{00602\ \ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ -\/>\ [N,\ 4].}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{00605\ \ \ \ \ masks:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [num\_instances,\ height,\ width]}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \ \ \ \ \ containing\ instance\ masks.}
\DoxyCodeLine{00607\ \ \ \ \ keypoints:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00608\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2]}
\DoxyCodeLine{00609\ }
\DoxyCodeLine{00610\ \ \ Raises:}
\DoxyCodeLine{00611\ \ \ \ \ ValueError:\ \textcolor{keywordflow}{if}\ keypoints\ are\ provided\ but\ keypoint\_flip\_permutation\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}.}
\DoxyCodeLine{00612\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00613\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00614\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{def\ }\_flip\_image(image):}
\DoxyCodeLine{00615\ \ \ \ \ \textcolor{comment}{\#\ flip\ image}}
\DoxyCodeLine{00616\ \ \ \ \ image\_flipped\ =\ tf.image.flip\_left\_right(image)}
\DoxyCodeLine{00617\ \ \ \ \ \textcolor{keywordflow}{return}\ image\_flipped}
\DoxyCodeLine{00618\ }
\DoxyCodeLine{00619\ \ \ \textcolor{keywordflow}{if}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{and}\ keypoint\_flip\_permutation\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00620\ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'keypoints\ are\ provided\ but\ keypoints\_flip\_permutation\ is\ not\ provided'})}
\DoxyCodeLine{00622\ }
\DoxyCodeLine{00623\ \ \ \textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'RandomHorizontalFlip'},\ values=[image,\ boxes]):}
\DoxyCodeLine{00624\ \ \ \ \ result\ =\ []}
\DoxyCodeLine{00625\ \ \ \ \ \textcolor{comment}{\#\ random\ variable\ defining\ whether\ to\ do\ flip\ or\ not}}
\DoxyCodeLine{00626\ \ \ \ \ generator\_func\ =\ functools.partial(tf.random\_uniform,\ [],\ seed=seed)}
\DoxyCodeLine{00627\ \ \ \ \ do\_a\_flip\_random\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}
\DoxyCodeLine{00628\ \ \ \ \ \ \ \ \ generator\_func,}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ preprocessor\_cache.PreprocessorCache.HORIZONTAL\_FLIP,}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ preprocess\_vars\_cache)}
\DoxyCodeLine{00631\ \ \ \ \ do\_a\_flip\_random\ =\ tf.greater(do\_a\_flip\_random,\ 0.5)}
\DoxyCodeLine{00632\ }
\DoxyCodeLine{00633\ \ \ \ \ \textcolor{comment}{\#\ flip\ image}}
\DoxyCodeLine{00634\ \ \ \ \ image\ =\ tf.cond(do\_a\_flip\_random,\ \textcolor{keyword}{lambda}:\ \_flip\_image(image),\ \textcolor{keyword}{lambda}:\ image)}
\DoxyCodeLine{00635\ \ \ \ \ result.append(image)}
\DoxyCodeLine{00636\ }
\DoxyCodeLine{00637\ \ \ \ \ \textcolor{comment}{\#\ flip\ boxes}}
\DoxyCodeLine{00638\ \ \ \ \ \textcolor{keywordflow}{if}\ boxes\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00639\ \ \ \ \ \ \ boxes\ =\ tf.cond(do\_a\_flip\_random,\ \textcolor{keyword}{lambda}:\ \_flip\_boxes\_left\_right(boxes),}
\DoxyCodeLine{00640\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ boxes)}
\DoxyCodeLine{00641\ \ \ \ \ \ \ result.append(boxes)}
\DoxyCodeLine{00642\ }
\DoxyCodeLine{00643\ \ \ \ \ \textcolor{comment}{\#\ flip\ masks}}
\DoxyCodeLine{00644\ \ \ \ \ \textcolor{keywordflow}{if}\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00645\ \ \ \ \ \ \ masks\ =\ tf.cond(do\_a\_flip\_random,\ \textcolor{keyword}{lambda}:\ \_flip\_masks\_left\_right(masks),}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ masks)}
\DoxyCodeLine{00647\ \ \ \ \ \ \ result.append(masks)}
\DoxyCodeLine{00648\ }
\DoxyCodeLine{00649\ \ \ \ \ \textcolor{comment}{\#\ flip\ keypoints}}
\DoxyCodeLine{00650\ \ \ \ \ \textcolor{keywordflow}{if}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{and}\ keypoint\_flip\_permutation\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00651\ \ \ \ \ \ \ permutation\ =\ keypoint\_flip\_permutation}
\DoxyCodeLine{00652\ \ \ \ \ \ \ keypoints\ =\ tf.cond(}
\DoxyCodeLine{00653\ \ \ \ \ \ \ \ \ \ \ do\_a\_flip\_random,}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ keypoint\_ops.flip\_horizontal(keypoints,\ 0.5,\ permutation),}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ keypoints)}
\DoxyCodeLine{00656\ \ \ \ \ \ \ result.append(keypoints)}
\DoxyCodeLine{00657\ }
\DoxyCodeLine{00658\ \ \ \ \ \textcolor{keywordflow}{return}\ tuple(result)}
\DoxyCodeLine{00659\ }
\DoxyCodeLine{00660\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a9ad2674a88326abe9a620d33dc6dbaa7_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_adc0c8803b353e7a6795ba372e1a1640a}\label{namespacedetection__utils_1_1core_1_1preprocessor_adc0c8803b353e7a6795ba372e1a1640a} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_image\_scale@{random\_image\_scale}}
\index{random\_image\_scale@{random\_image\_scale}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_image\_scale()}{random\_image\_scale()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+image\+\_\+scale (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{masks = {\ttfamily None},  }\item[{}]{min\+\_\+scale\+\_\+ratio = {\ttfamily 0.5},  }\item[{}]{max\+\_\+scale\+\_\+ratio = {\ttfamily 2.0},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Scales the image size.

Args:
  image: rank 3 float32 tensor contains 1 image -> [height, width, channels].
  masks: (optional) rank 3 float32 tensor containing masks with
    size [height, width, num_masks]. The value is set to None if there are no
    masks.
  min_scale_ratio: minimum scaling ratio.
  max_scale_ratio: maximum scaling ratio.
  seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: image which is the same rank as input image.
  masks: If masks is not none, resized masks which are the same rank as input
    masks will be returned.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00888}{888}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00893\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{00894\ \ \ \textcolor{stringliteral}{"{}"{}"{}Scales\ the\ image\ size.}}
\DoxyCodeLine{00895\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00896\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{00897\ \textcolor{stringliteral}{\ \ \ \ image:\ rank\ 3\ float32\ tensor\ contains\ 1\ image\ -\/>\ [height,\ width,\ channels].}}
\DoxyCodeLine{00898\ \textcolor{stringliteral}{\ \ \ \ masks:\ (optional)\ rank\ 3\ float32\ tensor\ containing\ masks\ }\textcolor{keyword}{with}}
\DoxyCodeLine{00899\ \ \ \ \ \ \ size\ [height,\ width,\ num\_masks].\ The\ value\ \textcolor{keywordflow}{is}\ set\ to\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{if}\ there\ are\ no}
\DoxyCodeLine{00900\ \ \ \ \ \ \ masks.}
\DoxyCodeLine{00901\ \ \ \ \ min\_scale\_ratio:\ minimum\ scaling\ ratio.}
\DoxyCodeLine{00902\ \ \ \ \ max\_scale\_ratio:\ maximum\ scaling\ ratio.}
\DoxyCodeLine{00903\ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{00904\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{00905\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{00906\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{00907\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{00908\ }
\DoxyCodeLine{00909\ \ \ Returns:}
\DoxyCodeLine{00910\ \ \ \ \ image:\ image\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ image.}
\DoxyCodeLine{00911\ \ \ \ \ masks:\ If\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ none,\ resized\ masks\ which\ are\ the\ same\ rank\ \textcolor{keyword}{as}\ input}
\DoxyCodeLine{00912\ \ \ \ \ \ \ masks\ will\ be\ returned.}
\DoxyCodeLine{00913\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00914\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'RandomImageScale'},\ values=[image]):}
\DoxyCodeLine{00915\ \ \ \ \ result\ =\ []}
\DoxyCodeLine{00916\ \ \ \ \ image\_shape\ =\ tf.shape(image)}
\DoxyCodeLine{00917\ \ \ \ \ image\_height\ =\ image\_shape[0]}
\DoxyCodeLine{00918\ \ \ \ \ image\_width\ =\ image\_shape[1]}
\DoxyCodeLine{00919\ \ \ \ \ generator\_func\ =\ functools.partial(}
\DoxyCodeLine{00920\ \ \ \ \ \ \ \ \ tf.random\_uniform,\ [],}
\DoxyCodeLine{00921\ \ \ \ \ \ \ \ \ minval=min\_scale\_ratio,\ maxval=max\_scale\_ratio,}
\DoxyCodeLine{00922\ \ \ \ \ \ \ \ \ dtype=tf.float32,\ seed=seed)}
\DoxyCodeLine{00923\ \ \ \ \ size\_coef\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}
\DoxyCodeLine{00924\ \ \ \ \ \ \ \ \ generator\_func,\ preprocessor\_cache.PreprocessorCache.IMAGE\_SCALE,}
\DoxyCodeLine{00925\ \ \ \ \ \ \ \ \ preprocess\_vars\_cache)}
\DoxyCodeLine{00926\ }
\DoxyCodeLine{00927\ \ \ \ \ image\_newysize\ =\ tf.cast(}
\DoxyCodeLine{00928\ \ \ \ \ \ \ \ \ tf.multiply(tf.cast(image\_height,\ dtype=tf.float32),\ size\_coef),}
\DoxyCodeLine{00929\ \ \ \ \ \ \ \ \ dtype=tf.int32)}
\DoxyCodeLine{00930\ \ \ \ \ image\_newxsize\ =\ tf.cast(}
\DoxyCodeLine{00931\ \ \ \ \ \ \ \ \ tf.multiply(tf.cast(image\_width,\ dtype=tf.float32),\ size\_coef),}
\DoxyCodeLine{00932\ \ \ \ \ \ \ \ \ dtype=tf.int32)}
\DoxyCodeLine{00933\ \ \ \ \ image\ =\ tf.image.resize\_images(}
\DoxyCodeLine{00934\ \ \ \ \ \ \ \ \ image,\ [image\_newysize,\ image\_newxsize],\ align\_corners=\textcolor{keyword}{True})}
\DoxyCodeLine{00935\ \ \ \ \ result.append(image)}
\DoxyCodeLine{00936\ \ \ \ \ \textcolor{keywordflow}{if}\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00937\ \ \ \ \ \ \ masks\ =\ tf.image.resize\_images(}
\DoxyCodeLine{00938\ \ \ \ \ \ \ \ \ \ \ masks,\ [image\_newysize,\ image\_newxsize],}
\DoxyCodeLine{00939\ \ \ \ \ \ \ \ \ \ \ method=tf.image.ResizeMethod.NEAREST\_NEIGHBOR,}
\DoxyCodeLine{00940\ \ \ \ \ \ \ \ \ \ \ align\_corners=\textcolor{keyword}{True})}
\DoxyCodeLine{00941\ \ \ \ \ \ \ result.append(masks)}
\DoxyCodeLine{00942\ \ \ \ \ \textcolor{keywordflow}{return}\ tuple(result)}
\DoxyCodeLine{00943\ }
\DoxyCodeLine{00944\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_adc0c8803b353e7a6795ba372e1a1640a_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a882986d9b1f998bc17947fce90f1af4d}\label{namespacedetection__utils_1_1core_1_1preprocessor_a882986d9b1f998bc17947fce90f1af4d} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_jitter\_boxes@{random\_jitter\_boxes}}
\index{random\_jitter\_boxes@{random\_jitter\_boxes}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_jitter\_boxes()}{random\_jitter\_boxes()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+jitter\+\_\+boxes (\begin{DoxyParamCaption}\item[{}]{boxes,  }\item[{}]{ratio = {\ttfamily 0.05},  }\item[{}]{seed = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Randomly jitter boxes in image.

Args:
  boxes: rank 2 float32 tensor containing the bounding boxes -> [N, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].
  ratio: The ratio of the box width and height that the corners can jitter.
         For example if the width is 100 pixels and ratio is 0.05,
         the corners can jitter up to 5 pixels in the x direction.
  seed: random seed.

Returns:
  boxes: boxes which is the same shape as input boxes.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l01201}{1201}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01201\ \textcolor{keyword}{def\ }random\_jitter\_boxes(boxes,\ ratio=0.05,\ seed=None):}
\DoxyCodeLine{01202\ \ \ \textcolor{stringliteral}{"{}"{}"{}Randomly\ jitter\ boxes\ in\ image.}}
\DoxyCodeLine{01203\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01204\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{01205\ \textcolor{stringliteral}{\ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ -\/>\ [N,\ 4].}}
\DoxyCodeLine{01206\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ }\textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{01207\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{01208\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{01209\ \ \ \ \ ratio:\ The\ ratio\ of\ the\ box\ width\ \textcolor{keywordflow}{and}\ height\ that\ the\ corners\ can\ jitter.}
\DoxyCodeLine{01210\ \ \ \ \ \ \ \ \ \ \ \ For\ example\ \textcolor{keywordflow}{if}\ the\ width\ \textcolor{keywordflow}{is}\ 100\ pixels\ \textcolor{keywordflow}{and}\ ratio\ \textcolor{keywordflow}{is}\ 0.05,}
\DoxyCodeLine{01211\ \ \ \ \ \ \ \ \ \ \ \ the\ corners\ can\ jitter\ up\ to\ 5\ pixels\ \textcolor{keywordflow}{in}\ the\ x\ direction.}
\DoxyCodeLine{01212\ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{01213\ }
\DoxyCodeLine{01214\ \ \ Returns:}
\DoxyCodeLine{01215\ \ \ \ \ boxes:\ boxes\ which\ \textcolor{keywordflow}{is}\ the\ same\ shape\ \textcolor{keyword}{as}\ input\ boxes.}
\DoxyCodeLine{01216\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{01217\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{def\ }random\_jitter\_box(box,\ ratio,\ seed):}
\DoxyCodeLine{01218\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Randomly\ jitter\ box.}}
\DoxyCodeLine{01219\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01220\ \textcolor{stringliteral}{\ \ \ \ Args:}}
\DoxyCodeLine{01221\ \textcolor{stringliteral}{\ \ \ \ \ \ box:\ bounding\ box\ [1,\ 1,\ 4].}}
\DoxyCodeLine{01222\ \textcolor{stringliteral}{\ \ \ \ \ \ ratio:\ max\ ratio\ between\ jittered\ box\ }\textcolor{keywordflow}{and}\ original\ box,}
\DoxyCodeLine{01223\ \ \ \ \ \ \ a\ number\ between\ [0,\ 0.5].}
\DoxyCodeLine{01224\ \ \ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{01225\ }
\DoxyCodeLine{01226\ \ \ \ \ Returns:}
\DoxyCodeLine{01227\ \ \ \ \ \ \ jittered\_box:\ jittered\ box.}
\DoxyCodeLine{01228\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{01229\ \textcolor{stringliteral}{\ \ \ \ rand\_numbers\ =\ tf.random\_uniform(}}
\DoxyCodeLine{01230\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ [1,\ 1,\ 4],\ minval=-\/ratio,\ maxval=ratio,\ dtype=tf.float32,\ seed=seed)}}
\DoxyCodeLine{01231\ \textcolor{stringliteral}{\ \ \ \ box\_width\ =\ tf.subtract(box[0,\ 0,\ 3],\ box[0,\ 0,\ 1])}}
\DoxyCodeLine{01232\ \textcolor{stringliteral}{\ \ \ \ box\_height\ =\ tf.subtract(box[0,\ 0,\ 2],\ box[0,\ 0,\ 0])}}
\DoxyCodeLine{01233\ \textcolor{stringliteral}{\ \ \ \ hw\_coefs\ =\ tf.stack([box\_height,\ box\_width,\ box\_height,\ box\_width])}}
\DoxyCodeLine{01234\ \textcolor{stringliteral}{\ \ \ \ hw\_rand\_coefs\ =\ tf.multiply(hw\_coefs,\ rand\_numbers)}}
\DoxyCodeLine{01235\ \textcolor{stringliteral}{\ \ \ \ jittered\_box\ =\ tf.add(box,\ hw\_rand\_coefs)}}
\DoxyCodeLine{01236\ \textcolor{stringliteral}{\ \ \ \ jittered\_box\ =\ tf.clip\_by\_value(jittered\_box,\ 0.0,\ 1.0)}}
\DoxyCodeLine{01237\ \textcolor{stringliteral}{\ \ \ \ }\textcolor{keywordflow}{return}\ jittered\_box}
\DoxyCodeLine{01238\ }
\DoxyCodeLine{01239\ \ \ \textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'RandomJitterBoxes'},\ values=[boxes]):}
\DoxyCodeLine{01240\ \ \ \ \ \textcolor{comment}{\#\ boxes\ are\ [N,\ 4].\ Lets\ first\ make\ them\ [N,\ 1,\ 1,\ 4]}}
\DoxyCodeLine{01241\ \ \ \ \ boxes\_shape\ =\ tf.shape(boxes)}
\DoxyCodeLine{01242\ \ \ \ \ boxes\ =\ tf.expand\_dims(boxes,\ 1)}
\DoxyCodeLine{01243\ \ \ \ \ boxes\ =\ tf.expand\_dims(boxes,\ 2)}
\DoxyCodeLine{01244\ }
\DoxyCodeLine{01245\ \ \ \ \ distorted\_boxes\ =\ tf.map\_fn(}
\DoxyCodeLine{01246\ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}\ x:\ random\_jitter\_box(x,\ ratio,\ seed),\ boxes,\ dtype=tf.float32)}
\DoxyCodeLine{01247\ }
\DoxyCodeLine{01248\ \ \ \ \ distorted\_boxes\ =\ tf.reshape(distorted\_boxes,\ boxes\_shape)}
\DoxyCodeLine{01249\ }
\DoxyCodeLine{01250\ \ \ \ \ \textcolor{keywordflow}{return}\ distorted\_boxes}
\DoxyCodeLine{01251\ }
\DoxyCodeLine{01252\ }

\end{DoxyCode}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a052201bdd4a37a3579ad79d129b0f4dc}\label{namespacedetection__utils_1_1core_1_1preprocessor_a052201bdd4a37a3579ad79d129b0f4dc} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_pad\_image@{random\_pad\_image}}
\index{random\_pad\_image@{random\_pad\_image}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_pad\_image()}{random\_pad\_image()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+pad\+\_\+image (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{boxes,  }\item[{}]{keypoints = {\ttfamily None},  }\item[{}]{min\+\_\+image\+\_\+size = {\ttfamily None},  }\item[{}]{max\+\_\+image\+\_\+size = {\ttfamily None},  }\item[{}]{pad\+\_\+color = {\ttfamily None},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Randomly pads the image.

This function randomly pads the image with zeros. The final size of the
padded image will be between min_image_size and max_image_size.
if min_image_size is smaller than the input image size, min_image_size will
be set to the input image size. The same for max_image_size. The input image
will be located at a uniformly random location inside the padded image.
The relative location of the boxes to the original image will remain the same.

Args:
  image: rank 3 float32 tensor containing 1 image -> [height, width, channels]
         with pixel values varying between [0, 1].
  boxes: rank 2 float32 tensor containing the bounding boxes -> [N, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].
  keypoints: (optional) rank 3 float32 tensor with shape
             [N, num_keypoints, 2]. The keypoints are in y-x normalized
             coordinates.
  min_image_size: a tensor of size [min_height, min_width], type tf.int32.
                  If passed as None, will be set to image size
                  [height, width].
  max_image_size: a tensor of size [max_height, max_width], type tf.int32.
                  If passed as None, will be set to twice the
                  image [height * 2, width * 2].
  pad_color: padding color. A rank 1 tensor of [channels] with dtype=
             tf.float32. if set as None, it will be set to average color of
             the input image.
  seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: Image shape will be [new_height, new_width, channels].
  boxes: boxes which is the same rank as input boxes. Boxes are in normalized
         form.

  if keypoints is not None, the function also returns:
  keypoints: rank 3 float32 tensor with shape [N, num_keypoints, 2]
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l01562}{1562}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{01569\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{01570\ \ \ \textcolor{stringliteral}{"{}"{}"{}Randomly\ pads\ the\ image.}}
\DoxyCodeLine{01571\ \textcolor{stringliteral}{}}
\DoxyCodeLine{01572\ \textcolor{stringliteral}{\ \ This\ function\ randomly\ pads\ the\ image\ }\textcolor{keyword}{with}\ zeros.\ The\ final\ size\ of\ the}
\DoxyCodeLine{01573\ \ \ padded\ image\ will\ be\ between\ min\_image\_size\ \textcolor{keywordflow}{and}\ max\_image\_size.}
\DoxyCodeLine{01574\ \ \ \textcolor{keywordflow}{if}\ min\_image\_size\ \textcolor{keywordflow}{is}\ smaller\ than\ the\ input\ image\ size,\ min\_image\_size\ will}
\DoxyCodeLine{01575\ \ \ be\ set\ to\ the\ input\ image\ size.\ The\ same\ \textcolor{keywordflow}{for}\ max\_image\_size.\ The\ input\ image}
\DoxyCodeLine{01576\ \ \ will\ be\ located\ at\ a\ uniformly\ random\ location\ inside\ the\ padded\ image.}
\DoxyCodeLine{01577\ \ \ The\ relative\ location\ of\ the\ boxes\ to\ the\ original\ image\ will\ remain\ the\ same.}
\DoxyCodeLine{01578\ }
\DoxyCodeLine{01579\ \ \ Args:}
\DoxyCodeLine{01580\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ containing\ 1\ image\ -\/>\ [height,\ width,\ channels]}
\DoxyCodeLine{01581\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 1].}
\DoxyCodeLine{01582\ \ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ -\/>\ [N,\ 4].}
\DoxyCodeLine{01583\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{01584\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{01585\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{01586\ \ \ \ \ keypoints:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{01587\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [N,\ num\_keypoints,\ 2].\ The\ keypoints\ are\ \textcolor{keywordflow}{in}\ y-\/x\ normalized}
\DoxyCodeLine{01588\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ coordinates.}
\DoxyCodeLine{01589\ \ \ \ \ min\_image\_size:\ a\ tensor\ of\ size\ [min\_height,\ min\_width],\ type\ tf.int32.}
\DoxyCodeLine{01590\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ If\ passed\ \textcolor{keyword}{as}\ \textcolor{keywordtype}{None},\ will\ be\ set\ to\ image\ size}
\DoxyCodeLine{01591\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [height,\ width].}
\DoxyCodeLine{01592\ \ \ \ \ max\_image\_size:\ a\ tensor\ of\ size\ [max\_height,\ max\_width],\ type\ tf.int32.}
\DoxyCodeLine{01593\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ If\ passed\ \textcolor{keyword}{as}\ \textcolor{keywordtype}{None},\ will\ be\ set\ to\ twice\ the}
\DoxyCodeLine{01594\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ image\ [height\ *\ 2,\ width\ *\ 2].}
\DoxyCodeLine{01595\ \ \ \ \ pad\_color:\ padding\ color.\ A\ rank\ 1\ tensor\ of\ [channels]\ \textcolor{keyword}{with}\ dtype=}
\DoxyCodeLine{01596\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tf.float32.\ \textcolor{keywordflow}{if}\ set\ \textcolor{keyword}{as}\ \textcolor{keywordtype}{None},\ it\ will\ be\ set\ to\ average\ color\ of}
\DoxyCodeLine{01597\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ the\ input\ image.}
\DoxyCodeLine{01598\ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{01599\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{01600\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{01601\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{01602\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{01603\ }
\DoxyCodeLine{01604\ \ \ Returns:}
\DoxyCodeLine{01605\ \ \ \ \ image:\ Image\ shape\ will\ be\ [new\_height,\ new\_width,\ channels].}
\DoxyCodeLine{01606\ \ \ \ \ boxes:\ boxes\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ boxes.\ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized}
\DoxyCodeLine{01607\ \ \ \ \ \ \ \ \ \ \ \ form.}
\DoxyCodeLine{01608\ }
\DoxyCodeLine{01609\ \ \ \ \ \textcolor{keywordflow}{if}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},\ the\ function\ also\ returns:}
\DoxyCodeLine{01610\ \ \ \ \ keypoints:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [N,\ num\_keypoints,\ 2]}
\DoxyCodeLine{01611\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{01612\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{if}\ pad\_color\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01613\ \ \ \ \ pad\_color\ =\ tf.reduce\_mean(image,\ axis=[0,\ 1])}
\DoxyCodeLine{01614\ }
\DoxyCodeLine{01615\ \ \ image\_shape\ =\ tf.shape(image)}
\DoxyCodeLine{01616\ \ \ image\_height\ =\ image\_shape[0]}
\DoxyCodeLine{01617\ \ \ image\_width\ =\ image\_shape[1]}
\DoxyCodeLine{01618\ }
\DoxyCodeLine{01619\ \ \ \textcolor{keywordflow}{if}\ max\_image\_size\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01620\ \ \ \ \ max\_image\_size\ =\ tf.stack([image\_height\ *\ 2,\ image\_width\ *\ 2])}
\DoxyCodeLine{01621\ \ \ max\_image\_size\ =\ tf.maximum(max\_image\_size,}
\DoxyCodeLine{01622\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tf.stack([image\_height,\ image\_width]))}
\DoxyCodeLine{01623\ }
\DoxyCodeLine{01624\ \ \ \textcolor{keywordflow}{if}\ min\_image\_size\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01625\ \ \ \ \ min\_image\_size\ =\ tf.stack([image\_height,\ image\_width])}
\DoxyCodeLine{01626\ \ \ min\_image\_size\ =\ tf.maximum(min\_image\_size,}
\DoxyCodeLine{01627\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tf.stack([image\_height,\ image\_width]))}
\DoxyCodeLine{01628\ }
\DoxyCodeLine{01629\ \ \ target\_height\ =\ tf.cond(}
\DoxyCodeLine{01630\ \ \ \ \ \ \ max\_image\_size[0]\ >\ min\_image\_size[0],}
\DoxyCodeLine{01631\ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ \_random\_integer(min\_image\_size[0],\ max\_image\_size[0],\ seed),}
\DoxyCodeLine{01632\ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ max\_image\_size[0])}
\DoxyCodeLine{01633\ }
\DoxyCodeLine{01634\ \ \ target\_width\ =\ tf.cond(}
\DoxyCodeLine{01635\ \ \ \ \ \ \ max\_image\_size[1]\ >\ min\_image\_size[1],}
\DoxyCodeLine{01636\ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ \_random\_integer(min\_image\_size[1],\ max\_image\_size[1],\ seed),}
\DoxyCodeLine{01637\ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ max\_image\_size[1])}
\DoxyCodeLine{01638\ }
\DoxyCodeLine{01639\ \ \ offset\_height\ =\ tf.cond(}
\DoxyCodeLine{01640\ \ \ \ \ \ \ target\_height\ >\ image\_height,}
\DoxyCodeLine{01641\ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ \_random\_integer(0,\ target\_height\ -\/\ image\_height,\ seed),}
\DoxyCodeLine{01642\ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ tf.constant(0,\ dtype=tf.int32))}
\DoxyCodeLine{01643\ }
\DoxyCodeLine{01644\ \ \ offset\_width\ =\ tf.cond(}
\DoxyCodeLine{01645\ \ \ \ \ \ \ target\_width\ >\ image\_width,}
\DoxyCodeLine{01646\ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ \_random\_integer(0,\ target\_width\ -\/\ image\_width,\ seed),}
\DoxyCodeLine{01647\ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ tf.constant(0,\ dtype=tf.int32))}
\DoxyCodeLine{01648\ }
\DoxyCodeLine{01649\ \ \ gen\_func\ =\ \textcolor{keyword}{lambda}:\ (target\_height,\ target\_width,\ offset\_height,\ offset\_width)}
\DoxyCodeLine{01650\ \ \ params\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}
\DoxyCodeLine{01651\ \ \ \ \ \ \ gen\_func,\ preprocessor\_cache.PreprocessorCache.PAD\_IMAGE,}
\DoxyCodeLine{01652\ \ \ \ \ \ \ preprocess\_vars\_cache)}
\DoxyCodeLine{01653\ \ \ target\_height,\ target\_width,\ offset\_height,\ offset\_width\ =\ params}
\DoxyCodeLine{01654\ }
\DoxyCodeLine{01655\ \ \ new\_image\ =\ tf.image.pad\_to\_bounding\_box(}
\DoxyCodeLine{01656\ \ \ \ \ \ \ image,}
\DoxyCodeLine{01657\ \ \ \ \ \ \ offset\_height=offset\_height,}
\DoxyCodeLine{01658\ \ \ \ \ \ \ offset\_width=offset\_width,}
\DoxyCodeLine{01659\ \ \ \ \ \ \ target\_height=target\_height,}
\DoxyCodeLine{01660\ \ \ \ \ \ \ target\_width=target\_width)}
\DoxyCodeLine{01661\ }
\DoxyCodeLine{01662\ \ \ \textcolor{comment}{\#\ Setting\ color\ of\ the\ padded\ pixels}}
\DoxyCodeLine{01663\ \ \ image\_ones\ =\ tf.ones\_like(image)}
\DoxyCodeLine{01664\ \ \ image\_ones\_padded\ =\ tf.image.pad\_to\_bounding\_box(}
\DoxyCodeLine{01665\ \ \ \ \ \ \ image\_ones,}
\DoxyCodeLine{01666\ \ \ \ \ \ \ offset\_height=offset\_height,}
\DoxyCodeLine{01667\ \ \ \ \ \ \ offset\_width=offset\_width,}
\DoxyCodeLine{01668\ \ \ \ \ \ \ target\_height=target\_height,}
\DoxyCodeLine{01669\ \ \ \ \ \ \ target\_width=target\_width)}
\DoxyCodeLine{01670\ \ \ image\_color\_padded\ =\ (1.0\ -\/\ image\_ones\_padded)\ *\ pad\_color}
\DoxyCodeLine{01671\ \ \ new\_image\ +=\ image\_color\_padded}
\DoxyCodeLine{01672\ }
\DoxyCodeLine{01673\ \ \ \textcolor{comment}{\#\ setting\ boxes}}
\DoxyCodeLine{01674\ \ \ new\_window\ =\ tf.cast(}
\DoxyCodeLine{01675\ \ \ \ \ \ \ tf.stack([}
\DoxyCodeLine{01676\ \ \ \ \ \ \ \ \ \ \ -\/offset\_height,\ -\/offset\_width,\ target\_height\ -\/\ offset\_height,}
\DoxyCodeLine{01677\ \ \ \ \ \ \ \ \ \ \ target\_width\ -\/\ offset\_width}
\DoxyCodeLine{01678\ \ \ \ \ \ \ ]),}
\DoxyCodeLine{01679\ \ \ \ \ \ \ dtype=tf.float32)}
\DoxyCodeLine{01680\ \ \ new\_window\ /=\ tf.cast(}
\DoxyCodeLine{01681\ \ \ \ \ \ \ tf.stack([image\_height,\ image\_width,\ image\_height,\ image\_width]),}
\DoxyCodeLine{01682\ \ \ \ \ \ \ dtype=tf.float32)}
\DoxyCodeLine{01683\ \ \ boxlist\ =\ box\_list.BoxList(boxes)}
\DoxyCodeLine{01684\ \ \ new\_boxlist\ =\ box\_list\_ops.change\_coordinate\_frame(boxlist,\ new\_window)}
\DoxyCodeLine{01685\ \ \ new\_boxes\ =\ new\_boxlist.get()}
\DoxyCodeLine{01686\ }
\DoxyCodeLine{01687\ \ \ result\ =\ [new\_image,\ new\_boxes]}
\DoxyCodeLine{01688\ }
\DoxyCodeLine{01689\ \ \ \textcolor{keywordflow}{if}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{01690\ \ \ \ \ new\_keypoints\ =\ keypoint\_ops.change\_coordinate\_frame(keypoints,\ new\_window)}
\DoxyCodeLine{01691\ \ \ \ \ result.append(new\_keypoints)}
\DoxyCodeLine{01692\ }
\DoxyCodeLine{01693\ \ \ \textcolor{keywordflow}{return}\ tuple(result)}
\DoxyCodeLine{01694\ }
\DoxyCodeLine{01695\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a052201bdd4a37a3579ad79d129b0f4dc_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a052201bdd4a37a3579ad79d129b0f4dc_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_ab0a1f9342a5127f9b80e0ffdfe94fc59}\label{namespacedetection__utils_1_1core_1_1preprocessor_ab0a1f9342a5127f9b80e0ffdfe94fc59} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_pad\_to\_aspect\_ratio@{random\_pad\_to\_aspect\_ratio}}
\index{random\_pad\_to\_aspect\_ratio@{random\_pad\_to\_aspect\_ratio}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_pad\_to\_aspect\_ratio()}{random\_pad\_to\_aspect\_ratio()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+pad\+\_\+to\+\_\+aspect\+\_\+ratio (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{boxes,  }\item[{}]{masks = {\ttfamily None},  }\item[{}]{keypoints = {\ttfamily None},  }\item[{}]{aspect\+\_\+ratio = {\ttfamily 1.0},  }\item[{}]{min\+\_\+padded\+\_\+size\+\_\+ratio = {\ttfamily (1.0,~1.0)},  }\item[{}]{max\+\_\+padded\+\_\+size\+\_\+ratio = {\ttfamily (2.0,~2.0)},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Randomly zero pads an image to the specified aspect ratio.

Pads the image so that the resulting image will have the specified aspect
ratio without scaling less than the min_padded_size_ratio or more than the
max_padded_size_ratio. If the min_padded_size_ratio or max_padded_size_ratio
is lower than what is possible to maintain the aspect ratio, then this method
will use the least padding to achieve the specified aspect ratio.

Args:
  image: rank 3 float32 tensor contains 1 image -> [height, width, channels]
         with pixel values varying between [0, 1].
  boxes: rank 2 float32 tensor containing the bounding boxes -> [N, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].
  masks: (optional) rank 3 float32 tensor with shape
         [num_instances, height, width] containing instance masks. The masks
         are of the same height, width as the input `image`.
  keypoints: (optional) rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]. The keypoints are in y-x
             normalized coordinates.
  aspect_ratio: aspect ratio of the final image.
  min_padded_size_ratio: min ratio of padded image height and width to the
                         input image's height and width.
  max_padded_size_ratio: max ratio of padded image height and width to the
                         input image's height and width.
  seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: image which is the same rank as input image.
  boxes: boxes which is the same rank as input boxes.
         Boxes are in normalized form.
  labels: new labels.

  If masks, or keypoints is not None, the function also returns:
  masks: rank 3 float32 tensor with shape [num_instances, height, width]
         containing instance masks.
  keypoints: rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]

Raises:
  ValueError: If image is not a 3D tensor.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l02069}{2069}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{02078\ \ \ \textcolor{stringliteral}{"{}"{}"{}Randomly\ zero\ pads\ an\ image\ to\ the\ specified\ aspect\ ratio.}}
\DoxyCodeLine{02079\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02080\ \textcolor{stringliteral}{\ \ Pads\ the\ image\ so\ that\ the\ resulting\ image\ will\ have\ the\ specified\ aspect}}
\DoxyCodeLine{02081\ \textcolor{stringliteral}{\ \ ratio\ without\ scaling\ less\ than\ the\ min\_padded\_size\_ratio\ }\textcolor{keywordflow}{or}\ more\ than\ the}
\DoxyCodeLine{02082\ \ \ max\_padded\_size\_ratio.\ If\ the\ min\_padded\_size\_ratio\ \textcolor{keywordflow}{or}\ max\_padded\_size\_ratio}
\DoxyCodeLine{02083\ \ \ \textcolor{keywordflow}{is}\ lower\ than\ what\ \textcolor{keywordflow}{is}\ possible\ to\ maintain\ the\ aspect\ ratio,\ then\ this\ method}
\DoxyCodeLine{02084\ \ \ will\ use\ the\ least\ padding\ to\ achieve\ the\ specified\ aspect\ ratio.}
\DoxyCodeLine{02085\ }
\DoxyCodeLine{02086\ \ \ Args:}
\DoxyCodeLine{02087\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ contains\ 1\ image\ -\/>\ [height,\ width,\ channels]}
\DoxyCodeLine{02088\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 1].}
\DoxyCodeLine{02089\ \ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ -\/>\ [N,\ 4].}
\DoxyCodeLine{02090\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{02091\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{02092\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{02093\ \ \ \ \ masks:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{02094\ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ containing\ instance\ masks.\ The\ masks}
\DoxyCodeLine{02095\ \ \ \ \ \ \ \ \ \ \ \ are\ of\ the\ same\ height,\ width\ \textcolor{keyword}{as}\ the\ input\ \`{}image\`{}.}
\DoxyCodeLine{02096\ \ \ \ \ keypoints:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{02097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2].\ The\ keypoints\ are\ \textcolor{keywordflow}{in}\ y-\/x}
\DoxyCodeLine{02098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ normalized\ coordinates.}
\DoxyCodeLine{02099\ \ \ \ \ aspect\_ratio:\ aspect\ ratio\ of\ the\ final\ image.}
\DoxyCodeLine{02100\ \ \ \ \ min\_padded\_size\_ratio:\ min\ ratio\ of\ padded\ image\ height\ \textcolor{keywordflow}{and}\ width\ to\ the}
\DoxyCodeLine{02101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ input\ image\textcolor{stringliteral}{'s\ height\ and\ width.}}
\DoxyCodeLine{02102\ \textcolor{stringliteral}{\ \ \ \ max\_padded\_size\_ratio:\ max\ ratio\ of\ padded\ image\ height\ }\textcolor{keywordflow}{and}\ width\ to\ the}
\DoxyCodeLine{02103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ input\ image\textcolor{stringliteral}{'s\ height\ and\ width.}}
\DoxyCodeLine{02104\ \textcolor{stringliteral}{\ \ \ \ seed:\ random\ seed.}}
\DoxyCodeLine{02105\ \textcolor{stringliteral}{\ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}}
\DoxyCodeLine{02106\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ }\textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{02107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{02108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{02109\ }
\DoxyCodeLine{02110\ \ \ Returns:}
\DoxyCodeLine{02111\ \ \ \ \ image:\ image\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ image.}
\DoxyCodeLine{02112\ \ \ \ \ boxes:\ boxes\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ boxes.}
\DoxyCodeLine{02113\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form.}
\DoxyCodeLine{02114\ \ \ \ \ labels:\ new\ labels.}
\DoxyCodeLine{02115\ }
\DoxyCodeLine{02116\ \ \ \ \ If\ masks,\ \textcolor{keywordflow}{or}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},\ the\ function\ also\ returns:}
\DoxyCodeLine{02117\ \ \ \ \ masks:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [num\_instances,\ height,\ width]}
\DoxyCodeLine{02118\ \ \ \ \ \ \ \ \ \ \ \ containing\ instance\ masks.}
\DoxyCodeLine{02119\ \ \ \ \ keypoints:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{02120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2]}
\DoxyCodeLine{02121\ }
\DoxyCodeLine{02122\ \ \ Raises:}
\DoxyCodeLine{02123\ \ \ \ \ ValueError:\ If\ image\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ a\ 3D\ tensor.}
\DoxyCodeLine{02124\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{02125\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{if}\ len(image.get\_shape())\ !=\ 3:}
\DoxyCodeLine{02126\ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'Image\ should\ be\ 3D\ tensor'})}
\DoxyCodeLine{02127\ }
\DoxyCodeLine{02128\ \ \ \textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'RandomPadToAspectRatio'},\ values=[image]):}
\DoxyCodeLine{02129\ \ \ \ \ image\_shape\ =\ tf.shape(image)}
\DoxyCodeLine{02130\ \ \ \ \ image\_height\ =\ tf.cast(image\_shape[0],\ dtype=tf.float32)}
\DoxyCodeLine{02131\ \ \ \ \ image\_width\ =\ tf.cast(image\_shape[1],\ dtype=tf.float32)}
\DoxyCodeLine{02132\ \ \ \ \ image\_aspect\_ratio\ =\ image\_width\ /\ image\_height}
\DoxyCodeLine{02133\ \ \ \ \ new\_aspect\_ratio\ =\ tf.constant(aspect\_ratio,\ dtype=tf.float32)}
\DoxyCodeLine{02134\ \ \ \ \ target\_height\ =\ tf.cond(}
\DoxyCodeLine{02135\ \ \ \ \ \ \ \ \ image\_aspect\_ratio\ <=\ new\_aspect\_ratio,}
\DoxyCodeLine{02136\ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ image\_height,}
\DoxyCodeLine{02137\ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ image\_width\ /\ new\_aspect\_ratio)}
\DoxyCodeLine{02138\ \ \ \ \ target\_width\ =\ tf.cond(}
\DoxyCodeLine{02139\ \ \ \ \ \ \ \ \ image\_aspect\_ratio\ >=\ new\_aspect\_ratio,}
\DoxyCodeLine{02140\ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ image\_width,}
\DoxyCodeLine{02141\ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ image\_height\ *\ new\_aspect\_ratio)}
\DoxyCodeLine{02142\ }
\DoxyCodeLine{02143\ \ \ \ \ min\_height\ =\ tf.maximum(}
\DoxyCodeLine{02144\ \ \ \ \ \ \ \ \ min\_padded\_size\_ratio[0]\ *\ image\_height,\ target\_height)}
\DoxyCodeLine{02145\ \ \ \ \ min\_width\ =\ tf.maximum(}
\DoxyCodeLine{02146\ \ \ \ \ \ \ \ \ min\_padded\_size\_ratio[1]\ *\ image\_width,\ target\_width)}
\DoxyCodeLine{02147\ \ \ \ \ max\_height\ =\ tf.maximum(}
\DoxyCodeLine{02148\ \ \ \ \ \ \ \ \ max\_padded\_size\_ratio[0]\ *\ image\_height,\ target\_height)}
\DoxyCodeLine{02149\ \ \ \ \ max\_width\ =\ tf.maximum(}
\DoxyCodeLine{02150\ \ \ \ \ \ \ \ \ max\_padded\_size\_ratio[1]\ *\ image\_width,\ target\_width)}
\DoxyCodeLine{02151\ }
\DoxyCodeLine{02152\ \ \ \ \ max\_scale\ =\ tf.minimum(max\_height\ /\ target\_height,\ max\_width\ /\ target\_width)}
\DoxyCodeLine{02153\ \ \ \ \ min\_scale\ =\ tf.minimum(}
\DoxyCodeLine{02154\ \ \ \ \ \ \ \ \ max\_scale,}
\DoxyCodeLine{02155\ \ \ \ \ \ \ \ \ tf.maximum(min\_height\ /\ target\_height,\ min\_width\ /\ target\_width))}
\DoxyCodeLine{02156\ }
\DoxyCodeLine{02157\ \ \ \ \ generator\_func\ =\ functools.partial(tf.random\_uniform,\ [],}
\DoxyCodeLine{02158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ min\_scale,\ max\_scale,\ seed=seed)}
\DoxyCodeLine{02159\ \ \ \ \ scale\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}
\DoxyCodeLine{02160\ \ \ \ \ \ \ \ \ generator\_func,}
\DoxyCodeLine{02161\ \ \ \ \ \ \ \ \ preprocessor\_cache.PreprocessorCache.PAD\_TO\_ASPECT\_RATIO,}
\DoxyCodeLine{02162\ \ \ \ \ \ \ \ \ preprocess\_vars\_cache)}
\DoxyCodeLine{02163\ }
\DoxyCodeLine{02164\ \ \ \ \ target\_height\ =\ tf.round(scale\ *\ target\_height)}
\DoxyCodeLine{02165\ \ \ \ \ target\_width\ =\ tf.round(scale\ *\ target\_width)}
\DoxyCodeLine{02166\ }
\DoxyCodeLine{02167\ \ \ \ \ new\_image\ =\ tf.image.pad\_to\_bounding\_box(}
\DoxyCodeLine{02168\ \ \ \ \ \ \ \ \ image,\ 0,\ 0,\ tf.cast(target\_height,\ dtype=tf.int32),}
\DoxyCodeLine{02169\ \ \ \ \ \ \ \ \ tf.cast(target\_width,\ dtype=tf.int32))}
\DoxyCodeLine{02170\ }
\DoxyCodeLine{02171\ \ \ \ \ im\_box\ =\ tf.stack([}
\DoxyCodeLine{02172\ \ \ \ \ \ \ \ \ 0.0,}
\DoxyCodeLine{02173\ \ \ \ \ \ \ \ \ 0.0,}
\DoxyCodeLine{02174\ \ \ \ \ \ \ \ \ target\_height\ /\ image\_height,}
\DoxyCodeLine{02175\ \ \ \ \ \ \ \ \ target\_width\ /\ image\_width}
\DoxyCodeLine{02176\ \ \ \ \ ])}
\DoxyCodeLine{02177\ \ \ \ \ boxlist\ =\ box\_list.BoxList(boxes)}
\DoxyCodeLine{02178\ \ \ \ \ new\_boxlist\ =\ box\_list\_ops.change\_coordinate\_frame(boxlist,\ im\_box)}
\DoxyCodeLine{02179\ \ \ \ \ new\_boxes\ =\ new\_boxlist.get()}
\DoxyCodeLine{02180\ }
\DoxyCodeLine{02181\ \ \ \ \ result\ =\ [new\_image,\ new\_boxes]}
\DoxyCodeLine{02182\ }
\DoxyCodeLine{02183\ \ \ \ \ \textcolor{keywordflow}{if}\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02184\ \ \ \ \ \ \ new\_masks\ =\ tf.expand\_dims(masks,\ -\/1)}
\DoxyCodeLine{02185\ \ \ \ \ \ \ new\_masks\ =\ tf.image.pad\_to\_bounding\_box(}
\DoxyCodeLine{02186\ \ \ \ \ \ \ \ \ \ \ new\_masks,\ 0,\ 0,\ tf.cast(target\_height,\ dtype=tf.int32),}
\DoxyCodeLine{02187\ \ \ \ \ \ \ \ \ \ \ tf.cast(target\_width,\ dtype=tf.int32))}
\DoxyCodeLine{02188\ \ \ \ \ \ \ new\_masks\ =\ tf.squeeze(new\_masks,\ [-\/1])}
\DoxyCodeLine{02189\ \ \ \ \ \ \ result.append(new\_masks)}
\DoxyCodeLine{02190\ }
\DoxyCodeLine{02191\ \ \ \ \ \textcolor{keywordflow}{if}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02192\ \ \ \ \ \ \ new\_keypoints\ =\ keypoint\_ops.change\_coordinate\_frame(keypoints,\ im\_box)}
\DoxyCodeLine{02193\ \ \ \ \ \ \ result.append(new\_keypoints)}
\DoxyCodeLine{02194\ }
\DoxyCodeLine{02195\ \ \ \ \ \textcolor{keywordflow}{return}\ tuple(result)}
\DoxyCodeLine{02196\ }
\DoxyCodeLine{02197\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_ab0a1f9342a5127f9b80e0ffdfe94fc59_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_ab0a1f9342a5127f9b80e0ffdfe94fc59_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a8d0c42728a0663d83a70ed01f309c393}\label{namespacedetection__utils_1_1core_1_1preprocessor_a8d0c42728a0663d83a70ed01f309c393} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_pixel\_value\_scale@{random\_pixel\_value\_scale}}
\index{random\_pixel\_value\_scale@{random\_pixel\_value\_scale}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_pixel\_value\_scale()}{random\_pixel\_value\_scale()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+pixel\+\_\+value\+\_\+scale (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{minval = {\ttfamily 0.9},  }\item[{}]{maxval = {\ttfamily 1.1},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Scales each value in the pixels of the image.

   This function scales each pixel independent of the other ones.
   For each value in image tensor, draws a random number between
   minval and maxval and multiples the values with them.

Args:
  image: rank 3 float32 tensor contains 1 image -> [height, width, channels]
         with pixel values varying between [0, 255].
  minval: lower ratio of scaling pixel values.
  maxval: upper ratio of scaling pixel values.
  seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: image which is the same shape as input image.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00847}{847}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00851\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{00852\ \ \ \textcolor{stringliteral}{"{}"{}"{}Scales\ each\ value\ in\ the\ pixels\ of\ the\ image.}}
\DoxyCodeLine{00853\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00854\ \textcolor{stringliteral}{\ \ \ \ \ This\ function\ scales\ each\ pixel\ independent\ of\ the\ other\ ones.}}
\DoxyCodeLine{00855\ \textcolor{stringliteral}{\ \ \ \ \ For\ each\ value\ }\textcolor{keywordflow}{in}\ image\ tensor,\ draws\ a\ random\ number\ between}
\DoxyCodeLine{00856\ \ \ \ \ \ minval\ \textcolor{keywordflow}{and}\ maxval\ \textcolor{keywordflow}{and}\ multiples\ the\ values\ \textcolor{keyword}{with}\ them.}
\DoxyCodeLine{00857\ }
\DoxyCodeLine{00858\ \ \ Args:}
\DoxyCodeLine{00859\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ contains\ 1\ image\ -\/>\ [height,\ width,\ channels]}
\DoxyCodeLine{00860\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 255].}
\DoxyCodeLine{00861\ \ \ \ \ minval:\ lower\ ratio\ of\ scaling\ pixel\ values.}
\DoxyCodeLine{00862\ \ \ \ \ maxval:\ upper\ ratio\ of\ scaling\ pixel\ values.}
\DoxyCodeLine{00863\ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{00864\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{00865\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{00866\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{00867\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{00868\ }
\DoxyCodeLine{00869\ \ \ Returns:}
\DoxyCodeLine{00870\ \ \ \ \ image:\ image\ which\ \textcolor{keywordflow}{is}\ the\ same\ shape\ \textcolor{keyword}{as}\ input\ image.}
\DoxyCodeLine{00871\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00872\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'RandomPixelValueScale'},\ values=[image]):}
\DoxyCodeLine{00873\ \ \ \ \ generator\_func\ =\ functools.partial(}
\DoxyCodeLine{00874\ \ \ \ \ \ \ \ \ tf.random\_uniform,\ tf.shape(image),}
\DoxyCodeLine{00875\ \ \ \ \ \ \ \ \ minval=minval,\ maxval=maxval,}
\DoxyCodeLine{00876\ \ \ \ \ \ \ \ \ dtype=tf.float32,\ seed=seed)}
\DoxyCodeLine{00877\ \ \ \ \ color\_coef\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}
\DoxyCodeLine{00878\ \ \ \ \ \ \ \ \ generator\_func,}
\DoxyCodeLine{00879\ \ \ \ \ \ \ \ \ preprocessor\_cache.PreprocessorCache.PIXEL\_VALUE\_SCALE,}
\DoxyCodeLine{00880\ \ \ \ \ \ \ \ \ preprocess\_vars\_cache)}
\DoxyCodeLine{00881\ }
\DoxyCodeLine{00882\ \ \ \ \ image\ =\ tf.multiply(image,\ color\_coef)}
\DoxyCodeLine{00883\ \ \ \ \ image\ =\ tf.clip\_by\_value(image,\ 0.0,\ 255.0)}
\DoxyCodeLine{00884\ }
\DoxyCodeLine{00885\ \ \ \textcolor{keywordflow}{return}\ image}
\DoxyCodeLine{00886\ }
\DoxyCodeLine{00887\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a8d0c42728a0663d83a70ed01f309c393_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a06cc1c1f5cce3566bc6f1a4a865b613e}\label{namespacedetection__utils_1_1core_1_1preprocessor_a06cc1c1f5cce3566bc6f1a4a865b613e} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_resize\_method@{random\_resize\_method}}
\index{random\_resize\_method@{random\_resize\_method}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_resize\_method()}{random\_resize\_method()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+resize\+\_\+method (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{target\+\_\+size,  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Uses a random resize method to resize the image to target size.

Args:
  image: a rank 3 tensor.
  target_size: a list of [target_height, target_width]
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  resized image.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l02332}{2332}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02332\ \textcolor{keyword}{def\ }random\_resize\_method(image,\ target\_size,\ preprocess\_vars\_cache=None):}
\DoxyCodeLine{02333\ \ \ \textcolor{stringliteral}{"{}"{}"{}Uses\ a\ random\ resize\ method\ to\ resize\ the\ image\ to\ target\ size.}}
\DoxyCodeLine{02334\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02335\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{02336\ \textcolor{stringliteral}{\ \ \ \ image:\ a\ rank\ 3\ tensor.}}
\DoxyCodeLine{02337\ \textcolor{stringliteral}{\ \ \ \ target\_size:\ a\ list\ of\ [target\_height,\ target\_width]}}
\DoxyCodeLine{02338\ \textcolor{stringliteral}{\ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}}
\DoxyCodeLine{02339\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ }\textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{02340\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{02341\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{02342\ }
\DoxyCodeLine{02343\ \ \ Returns:}
\DoxyCodeLine{02344\ \ \ \ \ resized\ image.}
\DoxyCodeLine{02345\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{02346\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02347\ \textcolor{stringliteral}{\ \ resized\_image\ =\ \_apply\_with\_random\_selector(}}
\DoxyCodeLine{02348\ \textcolor{stringliteral}{\ \ \ \ \ \ image,}}
\DoxyCodeLine{02349\ \textcolor{stringliteral}{\ \ \ \ \ \ }\textcolor{keyword}{lambda}\ x,\ method:\ tf.image.resize\_images(x,\ target\_size,\ method),}
\DoxyCodeLine{02350\ \ \ \ \ \ \ num\_cases=4,}
\DoxyCodeLine{02351\ \ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache,}
\DoxyCodeLine{02352\ \ \ \ \ \ \ key=preprocessor\_cache.PreprocessorCache.RESIZE\_METHOD)}
\DoxyCodeLine{02353\ }
\DoxyCodeLine{02354\ \ \ \textcolor{keywordflow}{return}\ resized\_image}
\DoxyCodeLine{02355\ }
\DoxyCodeLine{02356\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a06cc1c1f5cce3566bc6f1a4a865b613e_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a643bc2872b76f353d6f342b56070c112}\label{namespacedetection__utils_1_1core_1_1preprocessor_a643bc2872b76f353d6f342b56070c112} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_rgb\_to\_gray@{random\_rgb\_to\_gray}}
\index{random\_rgb\_to\_gray@{random\_rgb\_to\_gray}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_rgb\_to\_gray()}{random\_rgb\_to\_gray()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+rgb\+\_\+to\+\_\+gray (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{probability = {\ttfamily 0.1},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Changes the image from RGB to Grayscale with the given probability.

Args:
  image: rank 3 float32 tensor contains 1 image -> [height, width, channels]
         with pixel values varying between [0, 255].
  probability: the probability of returning a grayscale image.
          The probability should be a number between [0, 1].
  seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: image which is the same shape as input image.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00953}{953}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00956\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{00957\ \ \ \textcolor{stringliteral}{"{}"{}"{}Changes\ the\ image\ from\ RGB\ to\ Grayscale\ with\ the\ given\ probability.}}
\DoxyCodeLine{00958\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00959\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{00960\ \textcolor{stringliteral}{\ \ \ \ image:\ rank\ 3\ float32\ tensor\ contains\ 1\ image\ -\/>\ [height,\ width,\ channels]}}
\DoxyCodeLine{00961\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ }\textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 255].}
\DoxyCodeLine{00962\ \ \ \ \ probability:\ the\ probability\ of\ returning\ a\ grayscale\ image.}
\DoxyCodeLine{00963\ \ \ \ \ \ \ \ \ \ \ \ \ The\ probability\ should\ be\ a\ number\ between\ [0,\ 1].}
\DoxyCodeLine{00964\ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{00965\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{00966\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{00967\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{00968\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{00969\ }
\DoxyCodeLine{00970\ \ \ Returns:}
\DoxyCodeLine{00971\ \ \ \ \ image:\ image\ which\ \textcolor{keywordflow}{is}\ the\ same\ shape\ \textcolor{keyword}{as}\ input\ image.}
\DoxyCodeLine{00972\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00973\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{def\ }\_image\_to\_gray(image):}
\DoxyCodeLine{00974\ \ \ \ \ image\_gray1\ =\ \_rgb\_to\_grayscale(image)}
\DoxyCodeLine{00975\ \ \ \ \ image\_gray3\ =\ tf.image.grayscale\_to\_rgb(image\_gray1)}
\DoxyCodeLine{00976\ \ \ \ \ \textcolor{keywordflow}{return}\ image\_gray3}
\DoxyCodeLine{00977\ }
\DoxyCodeLine{00978\ \ \ \textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'RandomRGBtoGray'},\ values=[image]):}
\DoxyCodeLine{00979\ \ \ \ \ \textcolor{comment}{\#\ random\ variable\ defining\ whether\ to\ change\ to\ grayscale\ or\ not}}
\DoxyCodeLine{00980\ \ \ \ \ generator\_func\ =\ functools.partial(tf.random\_uniform,\ [],\ seed=seed)}
\DoxyCodeLine{00981\ \ \ \ \ do\_gray\_random\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}
\DoxyCodeLine{00982\ \ \ \ \ \ \ \ \ generator\_func,\ preprocessor\_cache.PreprocessorCache.RGB\_TO\_GRAY,}
\DoxyCodeLine{00983\ \ \ \ \ \ \ \ \ preprocess\_vars\_cache)}
\DoxyCodeLine{00984\ }
\DoxyCodeLine{00985\ \ \ \ \ image\ =\ tf.cond(}
\DoxyCodeLine{00986\ \ \ \ \ \ \ \ \ tf.greater(do\_gray\_random,\ probability),\ \textcolor{keyword}{lambda}:\ image,}
\DoxyCodeLine{00987\ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ \_augment\_only\_rgb\_channels(image,\ \_image\_to\_gray))}
\DoxyCodeLine{00988\ }
\DoxyCodeLine{00989\ \ \ \textcolor{keywordflow}{return}\ image}
\DoxyCodeLine{00990\ }
\DoxyCodeLine{00991\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a643bc2872b76f353d6f342b56070c112_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a29eea225a5c9bad4c280532e7e51d401}\label{namespacedetection__utils_1_1core_1_1preprocessor_a29eea225a5c9bad4c280532e7e51d401} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_rotation90@{random\_rotation90}}
\index{random\_rotation90@{random\_rotation90}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_rotation90()}{random\_rotation90()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+rotation90 (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{boxes = {\ttfamily None},  }\item[{}]{masks = {\ttfamily None},  }\item[{}]{keypoints = {\ttfamily None},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Randomly rotates the image and detections 90 degrees counter-clockwise.

The probability of rotating the image is 50%. This can be combined with
random_horizontal_flip and random_vertical_flip to produce an output with a
uniform distribution of the eight possible 90 degree rotation / reflection
combinations.

Args:
  image: rank 3 float32 tensor with shape [height, width, channels].
  boxes: (optional) rank 2 float32 tensor with shape [N, 4]
         containing the bounding boxes.
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].
  masks: (optional) rank 3 float32 tensor with shape
         [num_instances, height, width] containing instance masks. The masks
         are of the same height, width as the input `image`.
  keypoints: (optional) rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]. The keypoints are in y-x
             normalized coordinates.
  seed: random seed
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: image which is the same shape as input image.

  If boxes, masks, and keypoints, are not None,
  the function also returns the following tensors.

  boxes: rank 2 float32 tensor containing the bounding boxes -> [N, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
  masks: rank 3 float32 tensor with shape [num_instances, height, width]
         containing instance masks.
  keypoints: rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00757}{757}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00762\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{00763\ \ \ \textcolor{stringliteral}{"{}"{}"{}Randomly\ rotates\ the\ image\ and\ detections\ 90\ degrees\ counter-\/clockwise.}}
\DoxyCodeLine{00764\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00765\ \textcolor{stringliteral}{\ \ The\ probability\ of\ rotating\ the\ image\ }\textcolor{keywordflow}{is}\ 50\%.\ This\ can\ be\ combined\ \textcolor{keyword}{with}}
\DoxyCodeLine{00766\ \ \ random\_horizontal\_flip\ \textcolor{keywordflow}{and}\ random\_vertical\_flip\ to\ produce\ an\ output\ \textcolor{keyword}{with}\ a}
\DoxyCodeLine{00767\ \ \ uniform\ distribution\ of\ the\ eight\ possible\ 90\ degree\ rotation\ /\ reflection}
\DoxyCodeLine{00768\ \ \ combinations.}
\DoxyCodeLine{00769\ }
\DoxyCodeLine{00770\ \ \ Args:}
\DoxyCodeLine{00771\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [height,\ width,\ channels].}
\DoxyCodeLine{00772\ \ \ \ \ boxes:\ (optional)\ rank\ 2\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [N,\ 4]}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \ \ \ \ \ containing\ the\ bounding\ boxes.}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{00776\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{00777\ \ \ \ \ masks:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00778\ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ containing\ instance\ masks.\ The\ masks}
\DoxyCodeLine{00779\ \ \ \ \ \ \ \ \ \ \ \ are\ of\ the\ same\ height,\ width\ \textcolor{keyword}{as}\ the\ input\ \`{}image\`{}.}
\DoxyCodeLine{00780\ \ \ \ \ keypoints:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00781\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2].\ The\ keypoints\ are\ \textcolor{keywordflow}{in}\ y-\/x}
\DoxyCodeLine{00782\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ normalized\ coordinates.}
\DoxyCodeLine{00783\ \ \ \ \ seed:\ random\ seed}
\DoxyCodeLine{00784\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{00785\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{00786\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{00787\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{00788\ }
\DoxyCodeLine{00789\ \ \ Returns:}
\DoxyCodeLine{00790\ \ \ \ \ image:\ image\ which\ \textcolor{keywordflow}{is}\ the\ same\ shape\ \textcolor{keyword}{as}\ input\ image.}
\DoxyCodeLine{00791\ }
\DoxyCodeLine{00792\ \ \ \ \ If\ boxes,\ masks,\ \textcolor{keywordflow}{and}\ keypoints,\ are\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},}
\DoxyCodeLine{00793\ \ \ \ \ the\ function\ also\ returns\ the\ following\ tensors.}
\DoxyCodeLine{00794\ }
\DoxyCodeLine{00795\ \ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ -\/>\ [N,\ 4].}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{00798\ \ \ \ \ masks:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [num\_instances,\ height,\ width]}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ \ \ \ containing\ instance\ masks.}
\DoxyCodeLine{00800\ \ \ \ \ keypoints:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2]}
\DoxyCodeLine{00802\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00803\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00804\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{def\ }\_rot90\_image(image):}
\DoxyCodeLine{00805\ \ \ \ \ \textcolor{comment}{\#\ flip\ image}}
\DoxyCodeLine{00806\ \ \ \ \ image\_rotated\ =\ tf.image.rot90(image)}
\DoxyCodeLine{00807\ \ \ \ \ \textcolor{keywordflow}{return}\ image\_rotated}
\DoxyCodeLine{00808\ }
\DoxyCodeLine{00809\ \ \ \textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'RandomRotation90'},\ values=[image,\ boxes]):}
\DoxyCodeLine{00810\ \ \ \ \ result\ =\ []}
\DoxyCodeLine{00811\ }
\DoxyCodeLine{00812\ \ \ \ \ \textcolor{comment}{\#\ random\ variable\ defining\ whether\ to\ rotate\ by\ 90\ degrees\ or\ not}}
\DoxyCodeLine{00813\ \ \ \ \ generator\_func\ =\ functools.partial(tf.random\_uniform,\ [],\ seed=seed)}
\DoxyCodeLine{00814\ \ \ \ \ do\_a\_rot90\_random\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}
\DoxyCodeLine{00815\ \ \ \ \ \ \ \ \ generator\_func,\ preprocessor\_cache.PreprocessorCache.ROTATION90,}
\DoxyCodeLine{00816\ \ \ \ \ \ \ \ \ preprocess\_vars\_cache)}
\DoxyCodeLine{00817\ \ \ \ \ do\_a\_rot90\_random\ =\ tf.greater(do\_a\_rot90\_random,\ 0.5)}
\DoxyCodeLine{00818\ }
\DoxyCodeLine{00819\ \ \ \ \ \textcolor{comment}{\#\ flip\ image}}
\DoxyCodeLine{00820\ \ \ \ \ image\ =\ tf.cond(do\_a\_rot90\_random,\ \textcolor{keyword}{lambda}:\ \_rot90\_image(image),}
\DoxyCodeLine{00821\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ image)}
\DoxyCodeLine{00822\ \ \ \ \ result.append(image)}
\DoxyCodeLine{00823\ }
\DoxyCodeLine{00824\ \ \ \ \ \textcolor{comment}{\#\ flip\ boxes}}
\DoxyCodeLine{00825\ \ \ \ \ \textcolor{keywordflow}{if}\ boxes\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00826\ \ \ \ \ \ \ boxes\ =\ tf.cond(do\_a\_rot90\_random,\ \textcolor{keyword}{lambda}:\ \_rot90\_boxes(boxes),}
\DoxyCodeLine{00827\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ boxes)}
\DoxyCodeLine{00828\ \ \ \ \ \ \ result.append(boxes)}
\DoxyCodeLine{00829\ }
\DoxyCodeLine{00830\ \ \ \ \ \textcolor{comment}{\#\ flip\ masks}}
\DoxyCodeLine{00831\ \ \ \ \ \textcolor{keywordflow}{if}\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00832\ \ \ \ \ \ \ masks\ =\ tf.cond(do\_a\_rot90\_random,\ \textcolor{keyword}{lambda}:\ \_rot90\_masks(masks),}
\DoxyCodeLine{00833\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ masks)}
\DoxyCodeLine{00834\ \ \ \ \ \ \ result.append(masks)}
\DoxyCodeLine{00835\ }
\DoxyCodeLine{00836\ \ \ \ \ \textcolor{comment}{\#\ flip\ keypoints}}
\DoxyCodeLine{00837\ \ \ \ \ \textcolor{keywordflow}{if}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00838\ \ \ \ \ \ \ keypoints\ =\ tf.cond(}
\DoxyCodeLine{00839\ \ \ \ \ \ \ \ \ \ \ do\_a\_rot90\_random,}
\DoxyCodeLine{00840\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ keypoint\_ops.rot90(keypoints),}
\DoxyCodeLine{00841\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ keypoints)}
\DoxyCodeLine{00842\ \ \ \ \ \ \ result.append(keypoints)}
\DoxyCodeLine{00843\ }
\DoxyCodeLine{00844\ \ \ \ \ \textcolor{keywordflow}{return}\ tuple(result)}
\DoxyCodeLine{00845\ }
\DoxyCodeLine{00846\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a29eea225a5c9bad4c280532e7e51d401_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a28ed9f2cfed49a54b767a131fb3e7cde}\label{namespacedetection__utils_1_1core_1_1preprocessor_a28ed9f2cfed49a54b767a131fb3e7cde} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_self\_concat\_image@{random\_self\_concat\_image}}
\index{random\_self\_concat\_image@{random\_self\_concat\_image}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_self\_concat\_image()}{random\_self\_concat\_image()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+self\+\_\+concat\+\_\+image (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{boxes,  }\item[{}]{labels,  }\item[{}]{label\+\_\+weights,  }\item[{}]{label\+\_\+confidences = {\ttfamily None},  }\item[{}]{multiclass\+\_\+scores = {\ttfamily None},  }\item[{}]{concat\+\_\+vertical\+\_\+probability = {\ttfamily 0.1},  }\item[{}]{concat\+\_\+horizontal\+\_\+probability = {\ttfamily 0.1},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Randomly concatenates the image with itself.

This function randomly concatenates the image with itself; the random
variables for vertical and horizontal concatenation are independent.
Afterwards, we adjust the old bounding boxes, and add new bounding boxes
for the new objects.

Args:
  image: rank 3 float32 tensor containing 1 image -> [height, width, channels]
         with pixel values varying between [0, 1].
  boxes: rank 2 float32 tensor containing the bounding boxes -> [N, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].
  labels: rank 1 int32 tensor containing the object classes.
  label_weights: rank 1 float32 containing the label weights.
  label_confidences: (optional) rank 1 float32 containing the label
                     confidences.
  multiclass_scores: (optional) float32 tensor of shape
                     [num_instances, num_classes] representing the score for
                     each box for each class.
  concat_vertical_probability: (optional) a tf.float32 scalar denoting the
                               probability of a vertical concatenation.
  concat_horizontal_probability: (optional) a tf.float32 scalar denoting the
                                 probability of a horizontal concatenation.
  seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: Image shape will be [new_height, new_width, channels].
  boxes: boxes which is the same rank as input boxes. Boxes are in normalized
         form.
  if label_confidences is not None also returns:
  maybe_concat_label_confidences: cropped label weights.
  if multiclass_scores is not None also returns:
  maybe_concat_multiclass_scores: cropped_multiclass_scores.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l02750}{2750}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02754\ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{02755\ \ \ \textcolor{stringliteral}{"{}"{}"{}Randomly\ concatenates\ the\ image\ with\ itself.}}
\DoxyCodeLine{02756\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02757\ \textcolor{stringliteral}{\ \ This\ function\ randomly\ concatenates\ the\ image\ }\textcolor{keyword}{with}\ itself;\ the\ random}
\DoxyCodeLine{02758\ \ \ variables\ \textcolor{keywordflow}{for}\ vertical\ \textcolor{keywordflow}{and}\ horizontal\ concatenation\ are\ independent.}
\DoxyCodeLine{02759\ \ \ Afterwards,\ we\ adjust\ the\ old\ bounding\ boxes,\ \textcolor{keywordflow}{and}\ add\ new\ bounding\ boxes}
\DoxyCodeLine{02760\ \ \ \textcolor{keywordflow}{for}\ the\ new\ objects.}
\DoxyCodeLine{02761\ }
\DoxyCodeLine{02762\ \ \ Args:}
\DoxyCodeLine{02763\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ containing\ 1\ image\ -\/>\ [height,\ width,\ channels]}
\DoxyCodeLine{02764\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 1].}
\DoxyCodeLine{02765\ \ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ -\/>\ [N,\ 4].}
\DoxyCodeLine{02766\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{02767\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{02768\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{02769\ \ \ \ \ labels:\ rank\ 1\ int32\ tensor\ containing\ the\ object\ classes.}
\DoxyCodeLine{02770\ \ \ \ \ label\_weights:\ rank\ 1\ float32\ containing\ the\ label\ weights.}
\DoxyCodeLine{02771\ \ \ \ \ label\_confidences:\ (optional)\ rank\ 1\ float32\ containing\ the\ label}
\DoxyCodeLine{02772\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ confidences.}
\DoxyCodeLine{02773\ \ \ \ \ multiclass\_scores:\ (optional)\ float32\ tensor\ of\ shape}
\DoxyCodeLine{02774\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_classes]\ representing\ the\ score\ \textcolor{keywordflow}{for}}
\DoxyCodeLine{02775\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ each\ box\ \textcolor{keywordflow}{for}\ each\ \textcolor{keyword}{class}.}
\DoxyCodeLine{02776\ \ \ \ \ concat\_vertical\_probability:\ (optional)\ a\ tf.float32\ scalar\ denoting\ the}
\DoxyCodeLine{02777\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ probability\ of\ a\ vertical\ concatenation.}
\DoxyCodeLine{02778\ \ \ \ \ concat\_horizontal\_probability:\ (optional)\ a\ tf.float32\ scalar\ denoting\ the}
\DoxyCodeLine{02779\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ probability\ of\ a\ horizontal\ concatenation.}
\DoxyCodeLine{02780\ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{02781\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{02782\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{02783\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{02784\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{02785\ }
\DoxyCodeLine{02786\ \ \ Returns:}
\DoxyCodeLine{02787\ \ \ \ \ image:\ Image\ shape\ will\ be\ [new\_height,\ new\_width,\ channels].}
\DoxyCodeLine{02788\ \ \ \ \ boxes:\ boxes\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ boxes.\ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized}
\DoxyCodeLine{02789\ \ \ \ \ \ \ \ \ \ \ \ form.}
\DoxyCodeLine{02790\ \ \ \ \ \textcolor{keywordflow}{if}\ label\_confidences\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}\ also\ returns:}
\DoxyCodeLine{02791\ \ \ \ \ maybe\_concat\_label\_confidences:\ cropped\ label\ weights.}
\DoxyCodeLine{02792\ \ \ \ \ \textcolor{keywordflow}{if}\ multiclass\_scores\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}\ also\ returns:}
\DoxyCodeLine{02793\ \ \ \ \ maybe\_concat\_multiclass\_scores:\ cropped\_multiclass\_scores.}
\DoxyCodeLine{02794\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{02795\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02796\ \textcolor{stringliteral}{\ \ concat\_vertical\ =\ (tf.random\_uniform([],\ seed=seed)\ <}}
\DoxyCodeLine{02797\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ concat\_vertical\_probability)}}
\DoxyCodeLine{02798\ \textcolor{stringliteral}{\ \ }\textcolor{comment}{\#\ Note\ the\ seed\ +\ 1\ so\ we\ get\ some\ semblance\ of\ independence\ even\ with}}
\DoxyCodeLine{02799\ \ \ \textcolor{comment}{\#\ fixed\ seeds.}}
\DoxyCodeLine{02800\ \ \ concat\_horizontal\ =\ (tf.random\_uniform([],\ seed=seed\ +\ 1\ \textcolor{keywordflow}{if}\ seed\ \textcolor{keywordflow}{else}\ \textcolor{keywordtype}{None})}
\DoxyCodeLine{02801\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <\ concat\_horizontal\_probability)}
\DoxyCodeLine{02802\ }
\DoxyCodeLine{02803\ \ \ gen\_func\ =\ \textcolor{keyword}{lambda}:\ (concat\_vertical,\ concat\_horizontal)}
\DoxyCodeLine{02804\ \ \ params\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}
\DoxyCodeLine{02805\ \ \ \ \ \ \ gen\_func,\ preprocessor\_cache.PreprocessorCache.SELF\_CONCAT\_IMAGE,}
\DoxyCodeLine{02806\ \ \ \ \ \ \ preprocess\_vars\_cache)}
\DoxyCodeLine{02807\ \ \ concat\_vertical,\ concat\_horizontal\ =\ params}
\DoxyCodeLine{02808\ }
\DoxyCodeLine{02809\ \ \ \textcolor{keyword}{def\ }\_concat\_image(image,\ boxes,\ labels,\ label\_weights,\ axis):}
\DoxyCodeLine{02810\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Concats\ the\ image\ to\ itself\ on\ \`{}axis\`{}."{}"{}"{}}}
\DoxyCodeLine{02811\ \ \ \ \ output\_images\ =\ tf.concat([image,\ image],\ axis=axis)}
\DoxyCodeLine{02812\ }
\DoxyCodeLine{02813\ \ \ \ \ \textcolor{keywordflow}{if}\ axis\ ==\ 0:}
\DoxyCodeLine{02814\ \ \ \ \ \ \ \textcolor{comment}{\#\ Concat\ vertically,\ so\ need\ to\ reduce\ the\ y\ coordinates.}}
\DoxyCodeLine{02815\ \ \ \ \ \ \ old\_scaling\ =\ tf.constant([0.5,\ 1.0,\ 0.5,\ 1.0])}
\DoxyCodeLine{02816\ \ \ \ \ \ \ new\_translation\ =\ tf.constant([0.5,\ 0.0,\ 0.5,\ 0.0])}
\DoxyCodeLine{02817\ \ \ \ \ \textcolor{keywordflow}{elif}\ axis\ ==\ 1:}
\DoxyCodeLine{02818\ \ \ \ \ \ \ old\_scaling\ =\ tf.constant([1.0,\ 0.5,\ 1.0,\ 0.5])}
\DoxyCodeLine{02819\ \ \ \ \ \ \ new\_translation\ =\ tf.constant([0.0,\ 0.5,\ 0.0,\ 0.5])}
\DoxyCodeLine{02820\ }
\DoxyCodeLine{02821\ \ \ \ \ old\_boxes\ =\ old\_scaling\ *\ boxes}
\DoxyCodeLine{02822\ \ \ \ \ new\_boxes\ =\ old\_boxes\ +\ new\_translation}
\DoxyCodeLine{02823\ \ \ \ \ all\_boxes\ =\ tf.concat([old\_boxes,\ new\_boxes],\ axis=0)}
\DoxyCodeLine{02824\ }
\DoxyCodeLine{02825\ \ \ \ \ \textcolor{keywordflow}{return}\ [output\_images,\ all\_boxes,\ tf.tile(labels,\ [2]),\ tf.tile(}
\DoxyCodeLine{02826\ \ \ \ \ \ \ \ \ label\_weights,\ [2])]}
\DoxyCodeLine{02827\ }
\DoxyCodeLine{02828\ \ \ image,\ boxes,\ labels,\ label\_weights\ =\ tf.cond(}
\DoxyCodeLine{02829\ \ \ \ \ \ \ concat\_vertical,}
\DoxyCodeLine{02830\ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ \_concat\_image(image,\ boxes,\ labels,\ label\_weights,\ axis=0),}
\DoxyCodeLine{02831\ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ [image,\ boxes,\ labels,\ label\_weights],}
\DoxyCodeLine{02832\ \ \ \ \ \ \ strict=\textcolor{keyword}{True})}
\DoxyCodeLine{02833\ }
\DoxyCodeLine{02834\ \ \ outputs\ =\ tf.cond(}
\DoxyCodeLine{02835\ \ \ \ \ \ \ concat\_horizontal,}
\DoxyCodeLine{02836\ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ \_concat\_image(image,\ boxes,\ labels,\ label\_weights,\ axis=1),}
\DoxyCodeLine{02837\ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ [image,\ boxes,\ labels,\ label\_weights],}
\DoxyCodeLine{02838\ \ \ \ \ \ \ strict=\textcolor{keyword}{True})}
\DoxyCodeLine{02839\ }
\DoxyCodeLine{02840\ \ \ \textcolor{keywordflow}{if}\ label\_confidences\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02841\ \ \ \ \ label\_confidences\ =\ tf.cond(concat\_vertical,}
\DoxyCodeLine{02842\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ tf.tile(label\_confidences,\ [2]),}
\DoxyCodeLine{02843\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ label\_confidences)}
\DoxyCodeLine{02844\ \ \ \ \ outputs.append(tf.cond(concat\_horizontal,}
\DoxyCodeLine{02845\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ tf.tile(label\_confidences,\ [2]),}
\DoxyCodeLine{02846\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ label\_confidences))}
\DoxyCodeLine{02847\ }
\DoxyCodeLine{02848\ \ \ \textcolor{keywordflow}{if}\ multiclass\_scores\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02849\ \ \ \ \ multiclass\_scores\ =\ tf.cond(concat\_vertical,}
\DoxyCodeLine{02850\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ tf.tile(multiclass\_scores,\ [2,\ 1]),}
\DoxyCodeLine{02851\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ multiclass\_scores)}
\DoxyCodeLine{02852\ \ \ \ \ outputs.append(tf.cond(concat\_horizontal,}
\DoxyCodeLine{02853\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ tf.tile(multiclass\_scores,\ [2,\ 1]),}
\DoxyCodeLine{02854\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ multiclass\_scores))}
\DoxyCodeLine{02855\ }
\DoxyCodeLine{02856\ \ \ \textcolor{keywordflow}{return}\ outputs}
\DoxyCodeLine{02857\ }
\DoxyCodeLine{02858\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a28ed9f2cfed49a54b767a131fb3e7cde_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_ae3b102c4ba64515724d250cb08523bf3}\label{namespacedetection__utils_1_1core_1_1preprocessor_ae3b102c4ba64515724d250cb08523bf3} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!random\_vertical\_flip@{random\_vertical\_flip}}
\index{random\_vertical\_flip@{random\_vertical\_flip}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{random\_vertical\_flip()}{random\_vertical\_flip()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+random\+\_\+vertical\+\_\+flip (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{boxes = {\ttfamily None},  }\item[{}]{masks = {\ttfamily None},  }\item[{}]{keypoints = {\ttfamily None},  }\item[{}]{keypoint\+\_\+flip\+\_\+permutation = {\ttfamily None},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Randomly flips the image and detections vertically.

The probability of flipping the image is 50%.

Args:
  image: rank 3 float32 tensor with shape [height, width, channels].
  boxes: (optional) rank 2 float32 tensor with shape [N, 4]
         containing the bounding boxes.
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].
  masks: (optional) rank 3 float32 tensor with shape
         [num_instances, height, width] containing instance masks. The masks
         are of the same height, width as the input `image`.
  keypoints: (optional) rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]. The keypoints are in y-x
             normalized coordinates.
  keypoint_flip_permutation: rank 1 int32 tensor containing the keypoint flip
                             permutation.
  seed: random seed
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: image which is the same shape as input image.

  If boxes, masks, keypoints, and keypoint_flip_permutation are not None,
  the function also returns the following tensors.

  boxes: rank 2 float32 tensor containing the bounding boxes -> [N, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
  masks: rank 3 float32 tensor with shape [num_instances, height, width]
         containing instance masks.
  keypoints: rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]

Raises:
  ValueError: if keypoints are provided but keypoint_flip_permutation is not.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00661}{661}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{00668\ \ \ \textcolor{stringliteral}{"{}"{}"{}Randomly\ flips\ the\ image\ and\ detections\ vertically.}}
\DoxyCodeLine{00669\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00670\ \textcolor{stringliteral}{\ \ The\ probability\ of\ flipping\ the\ image\ }\textcolor{keywordflow}{is}\ 50\%.}
\DoxyCodeLine{00671\ }
\DoxyCodeLine{00672\ \ \ Args:}
\DoxyCodeLine{00673\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [height,\ width,\ channels].}
\DoxyCodeLine{00674\ \ \ \ \ boxes:\ (optional)\ rank\ 2\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [N,\ 4]}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ \ \ \ containing\ the\ bounding\ boxes.}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{00678\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{00679\ \ \ \ \ masks:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00680\ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ containing\ instance\ masks.\ The\ masks}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \ \ \ \ \ are\ of\ the\ same\ height,\ width\ \textcolor{keyword}{as}\ the\ input\ \`{}image\`{}.}
\DoxyCodeLine{00682\ \ \ \ \ keypoints:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2].\ The\ keypoints\ are\ \textcolor{keywordflow}{in}\ y-\/x}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ normalized\ coordinates.}
\DoxyCodeLine{00685\ \ \ \ \ keypoint\_flip\_permutation:\ rank\ 1\ int32\ tensor\ containing\ the\ keypoint\ flip}
\DoxyCodeLine{00686\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ permutation.}
\DoxyCodeLine{00687\ \ \ \ \ seed:\ random\ seed}
\DoxyCodeLine{00688\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{00690\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{00691\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{00692\ }
\DoxyCodeLine{00693\ \ \ Returns:}
\DoxyCodeLine{00694\ \ \ \ \ image:\ image\ which\ \textcolor{keywordflow}{is}\ the\ same\ shape\ \textcolor{keyword}{as}\ input\ image.}
\DoxyCodeLine{00695\ }
\DoxyCodeLine{00696\ \ \ \ \ If\ boxes,\ masks,\ keypoints,\ \textcolor{keywordflow}{and}\ keypoint\_flip\_permutation\ are\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},}
\DoxyCodeLine{00697\ \ \ \ \ the\ function\ also\ returns\ the\ following\ tensors.}
\DoxyCodeLine{00698\ }
\DoxyCodeLine{00699\ \ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ -\/>\ [N,\ 4].}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{00702\ \ \ \ \ masks:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [num\_instances,\ height,\ width]}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \ containing\ instance\ masks.}
\DoxyCodeLine{00704\ \ \ \ \ keypoints:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2]}
\DoxyCodeLine{00706\ }
\DoxyCodeLine{00707\ \ \ Raises:}
\DoxyCodeLine{00708\ \ \ \ \ ValueError:\ \textcolor{keywordflow}{if}\ keypoints\ are\ provided\ but\ keypoint\_flip\_permutation\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}.}
\DoxyCodeLine{00709\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00710\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00711\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{def\ }\_flip\_image(image):}
\DoxyCodeLine{00712\ \ \ \ \ \textcolor{comment}{\#\ flip\ image}}
\DoxyCodeLine{00713\ \ \ \ \ image\_flipped\ =\ tf.image.flip\_up\_down(image)}
\DoxyCodeLine{00714\ \ \ \ \ \textcolor{keywordflow}{return}\ image\_flipped}
\DoxyCodeLine{00715\ }
\DoxyCodeLine{00716\ \ \ \textcolor{keywordflow}{if}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{and}\ keypoint\_flip\_permutation\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00717\ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'keypoints\ are\ provided\ but\ keypoints\_flip\_permutation\ is\ not\ provided'})}
\DoxyCodeLine{00719\ }
\DoxyCodeLine{00720\ \ \ \textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'RandomVerticalFlip'},\ values=[image,\ boxes]):}
\DoxyCodeLine{00721\ \ \ \ \ result\ =\ []}
\DoxyCodeLine{00722\ \ \ \ \ \textcolor{comment}{\#\ random\ variable\ defining\ whether\ to\ do\ flip\ or\ not}}
\DoxyCodeLine{00723\ \ \ \ \ generator\_func\ =\ functools.partial(tf.random\_uniform,\ [],\ seed=seed)}
\DoxyCodeLine{00724\ \ \ \ \ do\_a\_flip\_random\ =\ \_get\_or\_create\_preprocess\_rand\_vars(}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ generator\_func,\ preprocessor\_cache.PreprocessorCache.VERTICAL\_FLIP,}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ preprocess\_vars\_cache)}
\DoxyCodeLine{00727\ \ \ \ \ do\_a\_flip\_random\ =\ tf.greater(do\_a\_flip\_random,\ 0.5)}
\DoxyCodeLine{00728\ }
\DoxyCodeLine{00729\ \ \ \ \ \textcolor{comment}{\#\ flip\ image}}
\DoxyCodeLine{00730\ \ \ \ \ image\ =\ tf.cond(do\_a\_flip\_random,\ \textcolor{keyword}{lambda}:\ \_flip\_image(image),\ \textcolor{keyword}{lambda}:\ image)}
\DoxyCodeLine{00731\ \ \ \ \ result.append(image)}
\DoxyCodeLine{00732\ }
\DoxyCodeLine{00733\ \ \ \ \ \textcolor{comment}{\#\ flip\ boxes}}
\DoxyCodeLine{00734\ \ \ \ \ \textcolor{keywordflow}{if}\ boxes\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00735\ \ \ \ \ \ \ boxes\ =\ tf.cond(do\_a\_flip\_random,\ \textcolor{keyword}{lambda}:\ \_flip\_boxes\_up\_down(boxes),}
\DoxyCodeLine{00736\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ boxes)}
\DoxyCodeLine{00737\ \ \ \ \ \ \ result.append(boxes)}
\DoxyCodeLine{00738\ }
\DoxyCodeLine{00739\ \ \ \ \ \textcolor{comment}{\#\ flip\ masks}}
\DoxyCodeLine{00740\ \ \ \ \ \textcolor{keywordflow}{if}\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00741\ \ \ \ \ \ \ masks\ =\ tf.cond(do\_a\_flip\_random,\ \textcolor{keyword}{lambda}:\ \_flip\_masks\_up\_down(masks),}
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ masks)}
\DoxyCodeLine{00743\ \ \ \ \ \ \ result.append(masks)}
\DoxyCodeLine{00744\ }
\DoxyCodeLine{00745\ \ \ \ \ \textcolor{comment}{\#\ flip\ keypoints}}
\DoxyCodeLine{00746\ \ \ \ \ \textcolor{keywordflow}{if}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{and}\ keypoint\_flip\_permutation\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00747\ \ \ \ \ \ \ permutation\ =\ keypoint\_flip\_permutation}
\DoxyCodeLine{00748\ \ \ \ \ \ \ keypoints\ =\ tf.cond(}
\DoxyCodeLine{00749\ \ \ \ \ \ \ \ \ \ \ do\_a\_flip\_random,}
\DoxyCodeLine{00750\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ keypoint\_ops.flip\_vertical(keypoints,\ 0.5,\ permutation),}
\DoxyCodeLine{00751\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ keypoints)}
\DoxyCodeLine{00752\ \ \ \ \ \ \ result.append(keypoints)}
\DoxyCodeLine{00753\ }
\DoxyCodeLine{00754\ \ \ \ \ \textcolor{keywordflow}{return}\ tuple(result)}
\DoxyCodeLine{00755\ }
\DoxyCodeLine{00756\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_ae3b102c4ba64515724d250cb08523bf3_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_aedfac18f6ff4fa9921ab6862cf931b37}\label{namespacedetection__utils_1_1core_1_1preprocessor_aedfac18f6ff4fa9921ab6862cf931b37} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!remap\_labels@{remap\_labels}}
\index{remap\_labels@{remap\_labels}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{remap\_labels()}{remap\_labels()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+remap\+\_\+labels (\begin{DoxyParamCaption}\item[{}]{labels,  }\item[{}]{original\+\_\+labels = {\ttfamily None},  }\item[{}]{new\+\_\+label = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Remaps labels that have an id in original_labels to new_label.

Args:
  labels: rank 1 int32 tensor of shape [num_instance] containing the object
    classes.
    original_labels: int list of original labels that should be mapped from.
    new_label: int label to map to
Returns:
  Remapped labels
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00435}{435}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ new\_label=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{00438\ \ \ \textcolor{stringliteral}{"{}"{}"{}Remaps\ labels\ that\ have\ an\ id\ in\ original\_labels\ to\ new\_label.}}
\DoxyCodeLine{00439\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00440\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{00441\ \textcolor{stringliteral}{\ \ \ \ labels:\ rank\ 1\ int32\ tensor\ of\ shape\ [num\_instance]\ containing\ the\ object}}
\DoxyCodeLine{00442\ \textcolor{stringliteral}{\ \ \ \ \ \ classes.}}
\DoxyCodeLine{00443\ \textcolor{stringliteral}{\ \ \ \ \ \ original\_labels:\ int\ list\ of\ original\ labels\ that\ should\ be\ mapped\ }\textcolor{keyword}{from}.}
\DoxyCodeLine{00444\ \ \ \ \ \ \ new\_label:\ int\ label\ to\ map\ to}
\DoxyCodeLine{00445\ \ \ Returns:}
\DoxyCodeLine{00446\ \ \ \ \ Remapped\ labels}
\DoxyCodeLine{00447\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00448\ \textcolor{stringliteral}{\ \ new\_labels\ =\ labels}}
\DoxyCodeLine{00449\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{for}\ original\_label\ \textcolor{keywordflow}{in}\ original\_labels:}
\DoxyCodeLine{00450\ \ \ \ \ change\ =\ tf.where(}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ tf.equal(new\_labels,\ original\_label),}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ tf.add(tf.zeros\_like(new\_labels),\ new\_label\ -\/\ original\_label),}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ tf.zeros\_like(new\_labels))}
\DoxyCodeLine{00454\ \ \ \ \ new\_labels\ =\ tf.add(}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ new\_labels,}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ change)}
\DoxyCodeLine{00457\ \ \ new\_labels\ =\ tf.reshape(new\_labels,\ tf.shape(labels))}
\DoxyCodeLine{00458\ \ \ \textcolor{keywordflow}{return}\ new\_labels}
\DoxyCodeLine{00459\ }
\DoxyCodeLine{00460\ }

\end{DoxyCode}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a594f3c0e2cdc3464ad0cf5c85359293b}\label{namespacedetection__utils_1_1core_1_1preprocessor_a594f3c0e2cdc3464ad0cf5c85359293b} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!resize\_image@{resize\_image}}
\index{resize\_image@{resize\_image}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{resize\_image()}{resize\_image()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+resize\+\_\+image (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{masks = {\ttfamily None},  }\item[{}]{new\+\_\+height = {\ttfamily 600},  }\item[{}]{new\+\_\+width = {\ttfamily 1024},  }\item[{}]{method = {\ttfamily tf.image.ResizeMethod.BILINEAR},  }\item[{}]{align\+\_\+corners = {\ttfamily False} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Resizes images to the given height and width.

Args:
  image: A 3D tensor of shape [height, width, channels]
  masks: (optional) rank 3 float32 tensor with shape
         [num_instances, height, width] containing instance masks.
  new_height: (optional) (scalar) desired height of the image.
  new_width: (optional) (scalar) desired width of the image.
  method: (optional) interpolation method used in resizing. Defaults to
          BILINEAR.
  align_corners: bool. If true, exactly align all 4 corners of the input
                 and output. Defaults to False.

Returns:
  Note that the position of the resized_image_shape changes based on whether
  masks are present.
  resized_image: A tensor of size [new_height, new_width, channels].
  resized_masks: If masks is not None, also outputs masks. A 3D tensor of
    shape [num_instances, new_height, new_width]
  resized_image_shape: A 1D tensor of shape [3] containing the shape of the
    resized image.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l02629}{2629}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02634\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ align\_corners=\textcolor{keyword}{False}):}
\DoxyCodeLine{02635\ \ \ \textcolor{stringliteral}{"{}"{}"{}Resizes\ images\ to\ the\ given\ height\ and\ width.}}
\DoxyCodeLine{02636\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02637\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{02638\ \textcolor{stringliteral}{\ \ \ \ image:\ A\ 3D\ tensor\ of\ shape\ [height,\ width,\ channels]}}
\DoxyCodeLine{02639\ \textcolor{stringliteral}{\ \ \ \ masks:\ (optional)\ rank\ 3\ float32\ tensor\ }\textcolor{keyword}{with}\ shape}
\DoxyCodeLine{02640\ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ containing\ instance\ masks.}
\DoxyCodeLine{02641\ \ \ \ \ new\_height:\ (optional)\ (scalar)\ desired\ height\ of\ the\ image.}
\DoxyCodeLine{02642\ \ \ \ \ new\_width:\ (optional)\ (scalar)\ desired\ width\ of\ the\ image.}
\DoxyCodeLine{02643\ \ \ \ \ method:\ (optional)\ interpolation\ method\ used\ \textcolor{keywordflow}{in}\ resizing.\ Defaults\ to}
\DoxyCodeLine{02644\ \ \ \ \ \ \ \ \ \ \ \ \ BILINEAR.}
\DoxyCodeLine{02645\ \ \ \ \ align\_corners:\ bool.\ If\ true,\ exactly\ align\ all\ 4\ corners\ of\ the\ input}
\DoxyCodeLine{02646\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{and}\ output.\ Defaults\ to\ \textcolor{keyword}{False}.}
\DoxyCodeLine{02647\ }
\DoxyCodeLine{02648\ \ \ Returns:}
\DoxyCodeLine{02649\ \ \ \ \ Note\ that\ the\ position\ of\ the\ resized\_image\_shape\ changes\ based\ on\ whether}
\DoxyCodeLine{02650\ \ \ \ \ masks\ are\ present.}
\DoxyCodeLine{02651\ \ \ \ \ resized\_image:\ A\ tensor\ of\ size\ [new\_height,\ new\_width,\ channels].}
\DoxyCodeLine{02652\ \ \ \ \ resized\_masks:\ If\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},\ also\ outputs\ masks.\ A\ 3D\ tensor\ of}
\DoxyCodeLine{02653\ \ \ \ \ \ \ shape\ [num\_instances,\ new\_height,\ new\_width]}
\DoxyCodeLine{02654\ \ \ \ \ resized\_image\_shape:\ A\ 1D\ tensor\ of\ shape\ [3]\ containing\ the\ shape\ of\ the}
\DoxyCodeLine{02655\ \ \ \ \ \ \ resized\ image.}
\DoxyCodeLine{02656\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{02657\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{with}\ tf.name\_scope(}
\DoxyCodeLine{02658\ \ \ \ \ \ \ \textcolor{stringliteral}{'ResizeImage'},}
\DoxyCodeLine{02659\ \ \ \ \ \ \ values=[image,\ new\_height,\ new\_width,\ method,\ align\_corners]):}
\DoxyCodeLine{02660\ \ \ \ \ new\_image\ =\ tf.image.resize\_images(}
\DoxyCodeLine{02661\ \ \ \ \ \ \ \ \ image,\ tf.stack([new\_height,\ new\_width]),}
\DoxyCodeLine{02662\ \ \ \ \ \ \ \ \ method=method,}
\DoxyCodeLine{02663\ \ \ \ \ \ \ \ \ align\_corners=align\_corners)}
\DoxyCodeLine{02664\ \ \ \ \ image\_shape\ =\ shape\_utils.combined\_static\_and\_dynamic\_shape(image)}
\DoxyCodeLine{02665\ \ \ \ \ result\ =\ [new\_image]}
\DoxyCodeLine{02666\ \ \ \ \ \textcolor{keywordflow}{if}\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02667\ \ \ \ \ \ \ num\_instances\ =\ tf.shape(masks)[0]}
\DoxyCodeLine{02668\ \ \ \ \ \ \ new\_size\ =\ tf.stack([new\_height,\ new\_width])}
\DoxyCodeLine{02669\ \ \ \ \ \ \ \textcolor{keyword}{def\ }resize\_masks\_branch():}
\DoxyCodeLine{02670\ \ \ \ \ \ \ \ \ new\_masks\ =\ tf.expand\_dims(masks,\ 3)}
\DoxyCodeLine{02671\ \ \ \ \ \ \ \ \ new\_masks\ =\ tf.image.resize\_nearest\_neighbor(}
\DoxyCodeLine{02672\ \ \ \ \ \ \ \ \ \ \ \ \ new\_masks,\ new\_size,\ align\_corners=align\_corners)}
\DoxyCodeLine{02673\ \ \ \ \ \ \ \ \ new\_masks\ =\ tf.squeeze(new\_masks,\ axis=3)}
\DoxyCodeLine{02674\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ new\_masks}
\DoxyCodeLine{02675\ }
\DoxyCodeLine{02676\ \ \ \ \ \ \ \textcolor{keyword}{def\ }reshape\_masks\_branch():}
\DoxyCodeLine{02677\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ The\ shape\ function\ will\ be\ computed\ for\ both\ branches\ of\ the}}
\DoxyCodeLine{02678\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ condition,\ regardless\ of\ which\ branch\ is\ actually\ taken.\ Make\ sure}}
\DoxyCodeLine{02679\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ that\ we\ don't\ trigger\ an\ assertion\ in\ the\ shape\ function\ when\ trying}}
\DoxyCodeLine{02680\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ to\ reshape\ a\ non\ empty\ tensor\ into\ an\ empty\ one.}}
\DoxyCodeLine{02681\ \ \ \ \ \ \ \ \ new\_masks\ =\ tf.reshape(masks,\ [-\/1,\ new\_size[0],\ new\_size[1]])}
\DoxyCodeLine{02682\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ new\_masks}
\DoxyCodeLine{02683\ }
\DoxyCodeLine{02684\ \ \ \ \ \ \ masks\ =\ tf.cond(num\_instances\ >\ 0,\ resize\_masks\_branch,}
\DoxyCodeLine{02685\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ reshape\_masks\_branch)}
\DoxyCodeLine{02686\ \ \ \ \ \ \ result.append(masks)}
\DoxyCodeLine{02687\ }
\DoxyCodeLine{02688\ \ \ \ \ result.append(tf.stack([new\_height,\ new\_width,\ image\_shape[2]]))}
\DoxyCodeLine{02689\ \ \ \ \ \textcolor{keywordflow}{return}\ result}
\DoxyCodeLine{02690\ }
\DoxyCodeLine{02691\ }

\end{DoxyCode}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a0ad8ce6e9aabff130be4839677d2ece3}\label{namespacedetection__utils_1_1core_1_1preprocessor_a0ad8ce6e9aabff130be4839677d2ece3} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!resize\_to\_max\_dimension@{resize\_to\_max\_dimension}}
\index{resize\_to\_max\_dimension@{resize\_to\_max\_dimension}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{resize\_to\_max\_dimension()}{resize\_to\_max\_dimension()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+resize\+\_\+to\+\_\+max\+\_\+dimension (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{masks = {\ttfamily None},  }\item[{}]{max\+\_\+dimension = {\ttfamily 600},  }\item[{}]{method = {\ttfamily tf.image.ResizeMethod.BILINEAR} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Resizes image and masks given the max size maintaining the aspect ratio.

If one of the image dimensions is greater than max_dimension, it will scale
the image such that its largest dimension is equal to max_dimension.
Otherwise, will keep the image size as is.

Args:
  image: a tensor of size [height, width, channels].
  masks: (optional) a tensors of size [num_instances, height, width].
  max_dimension: maximum image dimension.
  method: (optional) interpolation method used in resizing. Defaults to
  BILINEAR.

Returns:
  An array containing resized_image, resized_masks, and resized_image_shape.
  Note that the position of the resized_image_shape changes based on whether
  masks are present.
  resized_image: A tensor of size [new_height, new_width, channels].
  resized_masks: If masks is not None, also outputs masks. A 3D tensor of
    shape [num_instances, new_height, new_width]
  resized_image_shape: A 1D tensor of shape [3] containing the shape of the
    resized image.

Raises:
  ValueError: if the image is not a 3D tensor.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l02537}{2537}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02538\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ method=tf.image.ResizeMethod.BILINEAR):}
\DoxyCodeLine{02539\ \ \ \textcolor{stringliteral}{"{}"{}"{}Resizes\ image\ and\ masks\ given\ the\ max\ size\ maintaining\ the\ aspect\ ratio.}}
\DoxyCodeLine{02540\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02541\ \textcolor{stringliteral}{\ \ If\ one\ of\ the\ image\ dimensions\ }\textcolor{keywordflow}{is}\ greater\ than\ max\_dimension,\ it\ will\ scale}
\DoxyCodeLine{02542\ \ \ the\ image\ such\ that\ its\ largest\ dimension\ \textcolor{keywordflow}{is}\ equal\ to\ max\_dimension.}
\DoxyCodeLine{02543\ \ \ Otherwise,\ will\ keep\ the\ image\ size\ \textcolor{keyword}{as}\ \textcolor{keywordflow}{is}.}
\DoxyCodeLine{02544\ }
\DoxyCodeLine{02545\ \ \ Args:}
\DoxyCodeLine{02546\ \ \ \ \ image:\ a\ tensor\ of\ size\ [height,\ width,\ channels].}
\DoxyCodeLine{02547\ \ \ \ \ masks:\ (optional)\ a\ tensors\ of\ size\ [num\_instances,\ height,\ width].}
\DoxyCodeLine{02548\ \ \ \ \ max\_dimension:\ maximum\ image\ dimension.}
\DoxyCodeLine{02549\ \ \ \ \ method:\ (optional)\ interpolation\ method\ used\ \textcolor{keywordflow}{in}\ resizing.\ Defaults\ to}
\DoxyCodeLine{02550\ \ \ \ \ BILINEAR.}
\DoxyCodeLine{02551\ }
\DoxyCodeLine{02552\ \ \ Returns:}
\DoxyCodeLine{02553\ \ \ \ \ An\ array\ containing\ resized\_image,\ resized\_masks,\ \textcolor{keywordflow}{and}\ resized\_image\_shape.}
\DoxyCodeLine{02554\ \ \ \ \ Note\ that\ the\ position\ of\ the\ resized\_image\_shape\ changes\ based\ on\ whether}
\DoxyCodeLine{02555\ \ \ \ \ masks\ are\ present.}
\DoxyCodeLine{02556\ \ \ \ \ resized\_image:\ A\ tensor\ of\ size\ [new\_height,\ new\_width,\ channels].}
\DoxyCodeLine{02557\ \ \ \ \ resized\_masks:\ If\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},\ also\ outputs\ masks.\ A\ 3D\ tensor\ of}
\DoxyCodeLine{02558\ \ \ \ \ \ \ shape\ [num\_instances,\ new\_height,\ new\_width]}
\DoxyCodeLine{02559\ \ \ \ \ resized\_image\_shape:\ A\ 1D\ tensor\ of\ shape\ [3]\ containing\ the\ shape\ of\ the}
\DoxyCodeLine{02560\ \ \ \ \ \ \ resized\ image.}
\DoxyCodeLine{02561\ }
\DoxyCodeLine{02562\ \ \ Raises:}
\DoxyCodeLine{02563\ \ \ \ \ ValueError:\ \textcolor{keywordflow}{if}\ the\ image\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ a\ 3D\ tensor.}
\DoxyCodeLine{02564\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{02565\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{if}\ len(image.get\_shape())\ !=\ 3:}
\DoxyCodeLine{02566\ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'Image\ should\ be\ 3D\ tensor'})}
\DoxyCodeLine{02567\ }
\DoxyCodeLine{02568\ \ \ \textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'ResizeGivenMaxDimension'},\ values=[image,\ max\_dimension]):}
\DoxyCodeLine{02569\ \ \ \ \ (image\_height,\ image\_width,\ num\_channels)\ =\ \_get\_image\_info(image)}
\DoxyCodeLine{02570\ \ \ \ \ max\_image\_dimension\ =\ tf.maximum(image\_height,\ image\_width)}
\DoxyCodeLine{02571\ \ \ \ \ max\_target\_dimension\ =\ tf.minimum(max\_image\_dimension,\ max\_dimension)}
\DoxyCodeLine{02572\ \ \ \ \ target\_ratio\ =\ tf.cast(max\_target\_dimension,\ dtype=tf.float32)\ /\ tf.cast(}
\DoxyCodeLine{02573\ \ \ \ \ \ \ \ \ max\_image\_dimension,\ dtype=tf.float32)}
\DoxyCodeLine{02574\ \ \ \ \ target\_height\ =\ tf.cast(}
\DoxyCodeLine{02575\ \ \ \ \ \ \ \ \ tf.cast(image\_height,\ dtype=tf.float32)\ *\ target\_ratio,\ dtype=tf.int32)}
\DoxyCodeLine{02576\ \ \ \ \ target\_width\ =\ tf.cast(}
\DoxyCodeLine{02577\ \ \ \ \ \ \ \ \ tf.cast(image\_width,\ dtype=tf.float32)\ *\ target\_ratio,\ dtype=tf.int32)}
\DoxyCodeLine{02578\ \ \ \ \ image\ =\ tf.image.resize\_images(}
\DoxyCodeLine{02579\ \ \ \ \ \ \ \ \ tf.expand\_dims(image,\ axis=0),\ size=[target\_height,\ target\_width],}
\DoxyCodeLine{02580\ \ \ \ \ \ \ \ \ method=method,}
\DoxyCodeLine{02581\ \ \ \ \ \ \ \ \ align\_corners=\textcolor{keyword}{True})}
\DoxyCodeLine{02582\ \ \ \ \ result\ =\ [tf.squeeze(image,\ axis=0)]}
\DoxyCodeLine{02583\ }
\DoxyCodeLine{02584\ \ \ \ \ \textcolor{keywordflow}{if}\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02585\ \ \ \ \ \ \ masks\ =\ tf.image.resize\_nearest\_neighbor(}
\DoxyCodeLine{02586\ \ \ \ \ \ \ \ \ \ \ tf.expand\_dims(masks,\ axis=3),}
\DoxyCodeLine{02587\ \ \ \ \ \ \ \ \ \ \ size=[target\_height,\ target\_width],}
\DoxyCodeLine{02588\ \ \ \ \ \ \ \ \ \ \ align\_corners=\textcolor{keyword}{True})}
\DoxyCodeLine{02589\ \ \ \ \ \ \ result.append(tf.squeeze(masks,\ axis=3))}
\DoxyCodeLine{02590\ }
\DoxyCodeLine{02591\ \ \ \ \ result.append(tf.stack([target\_height,\ target\_width,\ num\_channels]))}
\DoxyCodeLine{02592\ \ \ \ \ \textcolor{keywordflow}{return}\ result}
\DoxyCodeLine{02593\ }
\DoxyCodeLine{02594\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a0ad8ce6e9aabff130be4839677d2ece3_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_ae31da8a2456c9fd96e951ec2564a04ef}\label{namespacedetection__utils_1_1core_1_1preprocessor_ae31da8a2456c9fd96e951ec2564a04ef} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!resize\_to\_min\_dimension@{resize\_to\_min\_dimension}}
\index{resize\_to\_min\_dimension@{resize\_to\_min\_dimension}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{resize\_to\_min\_dimension()}{resize\_to\_min\_dimension()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+resize\+\_\+to\+\_\+min\+\_\+dimension (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{masks = {\ttfamily None},  }\item[{}]{min\+\_\+dimension = {\ttfamily 600},  }\item[{}]{method = {\ttfamily tf.image.ResizeMethod.BILINEAR} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Resizes image and masks given the min size maintaining the aspect ratio.

If one of the image dimensions is smaller than min_dimension, it will scale
the image such that its smallest dimension is equal to min_dimension.
Otherwise, will keep the image size as is.

Args:
  image: a tensor of size [height, width, channels].
  masks: (optional) a tensors of size [num_instances, height, width].
  min_dimension: minimum image dimension.
  method: (optional) interpolation method used in resizing. Defaults to
  BILINEAR.

Returns:
  An array containing resized_image, resized_masks, and resized_image_shape.
  Note that the position of the resized_image_shape changes based on whether
  masks are present.
  resized_image: A tensor of size [new_height, new_width, channels].
  resized_masks: If masks is not None, also outputs masks. A 3D tensor of
    shape [num_instances, new_height, new_width]
  resized_image_shape: A 1D tensor of shape [3] containing the shape of the
    resized image.

Raises:
  ValueError: if the image is not a 3D tensor.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l02479}{2479}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02480\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ method=tf.image.ResizeMethod.BILINEAR):}
\DoxyCodeLine{02481\ \ \ \textcolor{stringliteral}{"{}"{}"{}Resizes\ image\ and\ masks\ given\ the\ min\ size\ maintaining\ the\ aspect\ ratio.}}
\DoxyCodeLine{02482\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02483\ \textcolor{stringliteral}{\ \ If\ one\ of\ the\ image\ dimensions\ }\textcolor{keywordflow}{is}\ smaller\ than\ min\_dimension,\ it\ will\ scale}
\DoxyCodeLine{02484\ \ \ the\ image\ such\ that\ its\ smallest\ dimension\ \textcolor{keywordflow}{is}\ equal\ to\ min\_dimension.}
\DoxyCodeLine{02485\ \ \ Otherwise,\ will\ keep\ the\ image\ size\ \textcolor{keyword}{as}\ \textcolor{keywordflow}{is}.}
\DoxyCodeLine{02486\ }
\DoxyCodeLine{02487\ \ \ Args:}
\DoxyCodeLine{02488\ \ \ \ \ image:\ a\ tensor\ of\ size\ [height,\ width,\ channels].}
\DoxyCodeLine{02489\ \ \ \ \ masks:\ (optional)\ a\ tensors\ of\ size\ [num\_instances,\ height,\ width].}
\DoxyCodeLine{02490\ \ \ \ \ min\_dimension:\ minimum\ image\ dimension.}
\DoxyCodeLine{02491\ \ \ \ \ method:\ (optional)\ interpolation\ method\ used\ \textcolor{keywordflow}{in}\ resizing.\ Defaults\ to}
\DoxyCodeLine{02492\ \ \ \ \ BILINEAR.}
\DoxyCodeLine{02493\ }
\DoxyCodeLine{02494\ \ \ Returns:}
\DoxyCodeLine{02495\ \ \ \ \ An\ array\ containing\ resized\_image,\ resized\_masks,\ \textcolor{keywordflow}{and}\ resized\_image\_shape.}
\DoxyCodeLine{02496\ \ \ \ \ Note\ that\ the\ position\ of\ the\ resized\_image\_shape\ changes\ based\ on\ whether}
\DoxyCodeLine{02497\ \ \ \ \ masks\ are\ present.}
\DoxyCodeLine{02498\ \ \ \ \ resized\_image:\ A\ tensor\ of\ size\ [new\_height,\ new\_width,\ channels].}
\DoxyCodeLine{02499\ \ \ \ \ resized\_masks:\ If\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},\ also\ outputs\ masks.\ A\ 3D\ tensor\ of}
\DoxyCodeLine{02500\ \ \ \ \ \ \ shape\ [num\_instances,\ new\_height,\ new\_width]}
\DoxyCodeLine{02501\ \ \ \ \ resized\_image\_shape:\ A\ 1D\ tensor\ of\ shape\ [3]\ containing\ the\ shape\ of\ the}
\DoxyCodeLine{02502\ \ \ \ \ \ \ resized\ image.}
\DoxyCodeLine{02503\ }
\DoxyCodeLine{02504\ \ \ Raises:}
\DoxyCodeLine{02505\ \ \ \ \ ValueError:\ \textcolor{keywordflow}{if}\ the\ image\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ a\ 3D\ tensor.}
\DoxyCodeLine{02506\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{02507\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{if}\ len(image.get\_shape())\ !=\ 3:}
\DoxyCodeLine{02508\ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'Image\ should\ be\ 3D\ tensor'})}
\DoxyCodeLine{02509\ }
\DoxyCodeLine{02510\ \ \ \textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'ResizeGivenMinDimension'},\ values=[image,\ min\_dimension]):}
\DoxyCodeLine{02511\ \ \ \ \ (image\_height,\ image\_width,\ num\_channels)\ =\ \_get\_image\_info(image)}
\DoxyCodeLine{02512\ \ \ \ \ min\_image\_dimension\ =\ tf.minimum(image\_height,\ image\_width)}
\DoxyCodeLine{02513\ \ \ \ \ min\_target\_dimension\ =\ tf.maximum(min\_image\_dimension,\ min\_dimension)}
\DoxyCodeLine{02514\ \ \ \ \ target\_ratio\ =\ tf.cast(min\_target\_dimension,\ dtype=tf.float32)\ /\ tf.cast(}
\DoxyCodeLine{02515\ \ \ \ \ \ \ \ \ min\_image\_dimension,\ dtype=tf.float32)}
\DoxyCodeLine{02516\ \ \ \ \ target\_height\ =\ tf.cast(}
\DoxyCodeLine{02517\ \ \ \ \ \ \ \ \ tf.cast(image\_height,\ dtype=tf.float32)\ *\ target\_ratio,\ dtype=tf.int32)}
\DoxyCodeLine{02518\ \ \ \ \ target\_width\ =\ tf.cast(}
\DoxyCodeLine{02519\ \ \ \ \ \ \ \ \ tf.cast(image\_width,\ dtype=tf.float32)\ *\ target\_ratio,\ dtype=tf.int32)}
\DoxyCodeLine{02520\ \ \ \ \ image\ =\ tf.image.resize\_images(}
\DoxyCodeLine{02521\ \ \ \ \ \ \ \ \ tf.expand\_dims(image,\ axis=0),\ size=[target\_height,\ target\_width],}
\DoxyCodeLine{02522\ \ \ \ \ \ \ \ \ method=method,}
\DoxyCodeLine{02523\ \ \ \ \ \ \ \ \ align\_corners=\textcolor{keyword}{True})}
\DoxyCodeLine{02524\ \ \ \ \ result\ =\ [tf.squeeze(image,\ axis=0)]}
\DoxyCodeLine{02525\ }
\DoxyCodeLine{02526\ \ \ \ \ \textcolor{keywordflow}{if}\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02527\ \ \ \ \ \ \ masks\ =\ tf.image.resize\_nearest\_neighbor(}
\DoxyCodeLine{02528\ \ \ \ \ \ \ \ \ \ \ tf.expand\_dims(masks,\ axis=3),}
\DoxyCodeLine{02529\ \ \ \ \ \ \ \ \ \ \ size=[target\_height,\ target\_width],}
\DoxyCodeLine{02530\ \ \ \ \ \ \ \ \ \ \ align\_corners=\textcolor{keyword}{True})}
\DoxyCodeLine{02531\ \ \ \ \ \ \ result.append(tf.squeeze(masks,\ axis=3))}
\DoxyCodeLine{02532\ }
\DoxyCodeLine{02533\ \ \ \ \ result.append(tf.stack([target\_height,\ target\_width,\ num\_channels]))}
\DoxyCodeLine{02534\ \ \ \ \ \textcolor{keywordflow}{return}\ result}
\DoxyCodeLine{02535\ }
\DoxyCodeLine{02536\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_ae31da8a2456c9fd96e951ec2564a04ef_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_aa16c94ed6a6e3e2ee8e39a4a5d0212ba}\label{namespacedetection__utils_1_1core_1_1preprocessor_aa16c94ed6a6e3e2ee8e39a4a5d0212ba} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!resize\_to\_range@{resize\_to\_range}}
\index{resize\_to\_range@{resize\_to\_range}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{resize\_to\_range()}{resize\_to\_range()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+resize\+\_\+to\+\_\+range (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{masks = {\ttfamily None},  }\item[{}]{min\+\_\+dimension = {\ttfamily None},  }\item[{}]{max\+\_\+dimension = {\ttfamily None},  }\item[{}]{method = {\ttfamily tf.image.ResizeMethod.BILINEAR},  }\item[{}]{align\+\_\+corners = {\ttfamily False},  }\item[{}]{pad\+\_\+to\+\_\+max\+\_\+dimension = {\ttfamily False},  }\item[{}]{per\+\_\+channel\+\_\+pad\+\_\+value = {\ttfamily (0,~0,~0)} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Resizes an image so its dimensions are within the provided value.

The output size can be described by two cases:
1. If the image can be rescaled so its minimum dimension is equal to the
   provided value without the other dimension exceeding max_dimension,
   then do so.
2. Otherwise, resize so the largest dimension is equal to max_dimension.

Args:
  image: A 3D tensor of shape [height, width, channels]
  masks: (optional) rank 3 float32 tensor with shape
         [num_instances, height, width] containing instance masks.
  min_dimension: (optional) (scalar) desired size of the smaller image
                 dimension.
  max_dimension: (optional) (scalar) maximum allowed size
                 of the larger image dimension.
  method: (optional) interpolation method used in resizing. Defaults to
          BILINEAR.
  align_corners: bool. If true, exactly align all 4 corners of the input
                 and output. Defaults to False.
  pad_to_max_dimension: Whether to resize the image and pad it with zeros
    so the resulting image is of the spatial size
    [max_dimension, max_dimension]. If masks are included they are padded
    similarly.
  per_channel_pad_value: A tuple of per-channel scalar value to use for
    padding. By default pads zeros.

Returns:
  Note that the position of the resized_image_shape changes based on whether
  masks are present.
  resized_image: A 3D tensor of shape [new_height, new_width, channels],
    where the image has been resized (with bilinear interpolation) so that
    min(new_height, new_width) == min_dimension or
    max(new_height, new_width) == max_dimension.
  resized_masks: If masks is not None, also outputs masks. A 3D tensor of
    shape [num_instances, new_height, new_width].
  resized_image_shape: A 1D tensor of shape [3] containing shape of the
    resized image.

Raises:
  ValueError: if the image is not a 3D tensor.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l02357}{2357}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02364\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ per\_channel\_pad\_value=(0,\ 0,\ 0)):}
\DoxyCodeLine{02365\ \ \ \textcolor{stringliteral}{"{}"{}"{}Resizes\ an\ image\ so\ its\ dimensions\ are\ within\ the\ provided\ value.}}
\DoxyCodeLine{02366\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02367\ \textcolor{stringliteral}{\ \ The\ output\ size\ can\ be\ described\ by\ two\ cases:}}
\DoxyCodeLine{02368\ \textcolor{stringliteral}{\ \ 1.\ If\ the\ image\ can\ be\ rescaled\ so\ its\ minimum\ dimension\ }\textcolor{keywordflow}{is}\ equal\ to\ the}
\DoxyCodeLine{02369\ \ \ \ \ \ provided\ value\ without\ the\ other\ dimension\ exceeding\ max\_dimension,}
\DoxyCodeLine{02370\ \ \ \ \ \ then\ do\ so.}
\DoxyCodeLine{02371\ \ \ 2.\ Otherwise,\ resize\ so\ the\ largest\ dimension\ \textcolor{keywordflow}{is}\ equal\ to\ max\_dimension.}
\DoxyCodeLine{02372\ }
\DoxyCodeLine{02373\ \ \ Args:}
\DoxyCodeLine{02374\ \ \ \ \ image:\ A\ 3D\ tensor\ of\ shape\ [height,\ width,\ channels]}
\DoxyCodeLine{02375\ \ \ \ \ masks:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{02376\ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ containing\ instance\ masks.}
\DoxyCodeLine{02377\ \ \ \ \ min\_dimension:\ (optional)\ (scalar)\ desired\ size\ of\ the\ smaller\ image}
\DoxyCodeLine{02378\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dimension.}
\DoxyCodeLine{02379\ \ \ \ \ max\_dimension:\ (optional)\ (scalar)\ maximum\ allowed\ size}
\DoxyCodeLine{02380\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ of\ the\ larger\ image\ dimension.}
\DoxyCodeLine{02381\ \ \ \ \ method:\ (optional)\ interpolation\ method\ used\ \textcolor{keywordflow}{in}\ resizing.\ Defaults\ to}
\DoxyCodeLine{02382\ \ \ \ \ \ \ \ \ \ \ \ \ BILINEAR.}
\DoxyCodeLine{02383\ \ \ \ \ align\_corners:\ bool.\ If\ true,\ exactly\ align\ all\ 4\ corners\ of\ the\ input}
\DoxyCodeLine{02384\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{and}\ output.\ Defaults\ to\ \textcolor{keyword}{False}.}
\DoxyCodeLine{02385\ \ \ \ \ pad\_to\_max\_dimension:\ Whether\ to\ resize\ the\ image\ \textcolor{keywordflow}{and}\ pad\ it\ \textcolor{keyword}{with}\ zeros}
\DoxyCodeLine{02386\ \ \ \ \ \ \ so\ the\ resulting\ image\ \textcolor{keywordflow}{is}\ of\ the\ spatial\ size}
\DoxyCodeLine{02387\ \ \ \ \ \ \ [max\_dimension,\ max\_dimension].\ If\ masks\ are\ included\ they\ are\ padded}
\DoxyCodeLine{02388\ \ \ \ \ \ \ similarly.}
\DoxyCodeLine{02389\ \ \ \ \ per\_channel\_pad\_value:\ A\ tuple\ of\ per-\/channel\ scalar\ value\ to\ use\ \textcolor{keywordflow}{for}}
\DoxyCodeLine{02390\ \ \ \ \ \ \ padding.\ By\ default\ pads\ zeros.}
\DoxyCodeLine{02391\ }
\DoxyCodeLine{02392\ \ \ Returns:}
\DoxyCodeLine{02393\ \ \ \ \ Note\ that\ the\ position\ of\ the\ resized\_image\_shape\ changes\ based\ on\ whether}
\DoxyCodeLine{02394\ \ \ \ \ masks\ are\ present.}
\DoxyCodeLine{02395\ \ \ \ \ resized\_image:\ A\ 3D\ tensor\ of\ shape\ [new\_height,\ new\_width,\ channels],}
\DoxyCodeLine{02396\ \ \ \ \ \ \ where\ the\ image\ has\ been\ resized\ (\textcolor{keyword}{with}\ bilinear\ interpolation)\ so\ that}
\DoxyCodeLine{02397\ \ \ \ \ \ \ min(new\_height,\ new\_width)\ ==\ min\_dimension\ \textcolor{keywordflow}{or}}
\DoxyCodeLine{02398\ \ \ \ \ \ \ max(new\_height,\ new\_width)\ ==\ max\_dimension.}
\DoxyCodeLine{02399\ \ \ \ \ resized\_masks:\ If\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},\ also\ outputs\ masks.\ A\ 3D\ tensor\ of}
\DoxyCodeLine{02400\ \ \ \ \ \ \ shape\ [num\_instances,\ new\_height,\ new\_width].}
\DoxyCodeLine{02401\ \ \ \ \ resized\_image\_shape:\ A\ 1D\ tensor\ of\ shape\ [3]\ containing\ shape\ of\ the}
\DoxyCodeLine{02402\ \ \ \ \ \ \ resized\ image.}
\DoxyCodeLine{02403\ }
\DoxyCodeLine{02404\ \ \ Raises:}
\DoxyCodeLine{02405\ \ \ \ \ ValueError:\ \textcolor{keywordflow}{if}\ the\ image\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ a\ 3D\ tensor.}
\DoxyCodeLine{02406\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{02407\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{if}\ len(image.get\_shape())\ !=\ 3:}
\DoxyCodeLine{02408\ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'Image\ should\ be\ 3D\ tensor'})}
\DoxyCodeLine{02409\ }
\DoxyCodeLine{02410\ \ \ \textcolor{keyword}{def\ }\_resize\_landscape\_image(image):}
\DoxyCodeLine{02411\ \ \ \ \ \textcolor{comment}{\#\ resize\ a\ landscape\ image}}
\DoxyCodeLine{02412\ \ \ \ \ \textcolor{keywordflow}{return}\ tf.image.resize\_images(}
\DoxyCodeLine{02413\ \ \ \ \ \ \ \ \ image,\ tf.stack([min\_dimension,\ max\_dimension]),\ method=method,}
\DoxyCodeLine{02414\ \ \ \ \ \ \ \ \ align\_corners=align\_corners,\ preserve\_aspect\_ratio=\textcolor{keyword}{True})}
\DoxyCodeLine{02415\ }
\DoxyCodeLine{02416\ \ \ \textcolor{keyword}{def\ }\_resize\_portrait\_image(image):}
\DoxyCodeLine{02417\ \ \ \ \ \textcolor{comment}{\#\ resize\ a\ portrait\ image}}
\DoxyCodeLine{02418\ \ \ \ \ \textcolor{keywordflow}{return}\ tf.image.resize\_images(}
\DoxyCodeLine{02419\ \ \ \ \ \ \ \ \ image,\ tf.stack([max\_dimension,\ min\_dimension]),\ method=method,}
\DoxyCodeLine{02420\ \ \ \ \ \ \ \ \ align\_corners=align\_corners,\ preserve\_aspect\_ratio=\textcolor{keyword}{True})}
\DoxyCodeLine{02421\ }
\DoxyCodeLine{02422\ \ \ \textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'ResizeToRange'},\ values=[image,\ min\_dimension]):}
\DoxyCodeLine{02423\ \ \ \ \ \textcolor{keywordflow}{if}\ image.get\_shape().is\_fully\_defined():}
\DoxyCodeLine{02424\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ image.get\_shape()[0]\ <\ image.get\_shape()[1]:}
\DoxyCodeLine{02425\ \ \ \ \ \ \ \ \ new\_image\ =\ \_resize\_landscape\_image(image)}
\DoxyCodeLine{02426\ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{02427\ \ \ \ \ \ \ \ \ new\_image\ =\ \_resize\_portrait\_image(image)}
\DoxyCodeLine{02428\ \ \ \ \ \ \ new\_size\ =\ tf.constant(new\_image.get\_shape().as\_list())}
\DoxyCodeLine{02429\ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{02430\ \ \ \ \ \ \ new\_image\ =\ tf.cond(}
\DoxyCodeLine{02431\ \ \ \ \ \ \ \ \ \ \ tf.less(tf.shape(image)[0],\ tf.shape(image)[1]),}
\DoxyCodeLine{02432\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ \_resize\_landscape\_image(image),}
\DoxyCodeLine{02433\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{lambda}:\ \_resize\_portrait\_image(image))}
\DoxyCodeLine{02434\ \ \ \ \ \ \ new\_size\ =\ tf.shape(new\_image)}
\DoxyCodeLine{02435\ }
\DoxyCodeLine{02436\ \ \ \ \ \textcolor{keywordflow}{if}\ pad\_to\_max\_dimension:}
\DoxyCodeLine{02437\ \ \ \ \ \ \ channels\ =\ tf.unstack(new\_image,\ axis=2)}
\DoxyCodeLine{02438\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ len(channels)\ !=\ len(per\_channel\_pad\_value):}
\DoxyCodeLine{02439\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'Number\ of\ channels\ must\ be\ equal\ to\ the\ length\ of\ '}}
\DoxyCodeLine{02440\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'per-\/channel\ pad\ value.'})}
\DoxyCodeLine{02441\ \ \ \ \ \ \ new\_image\ =\ tf.stack(}
\DoxyCodeLine{02442\ \ \ \ \ \ \ \ \ \ \ [}
\DoxyCodeLine{02443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tf.pad(}
\DoxyCodeLine{02444\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ channels[i],\ [[0,\ max\_dimension\ -\/\ new\_size[0]],}
\DoxyCodeLine{02445\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [0,\ max\_dimension\ -\/\ new\_size[1]]],}
\DoxyCodeLine{02446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ constant\_values=per\_channel\_pad\_value[i])}
\DoxyCodeLine{02447\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ i\ \textcolor{keywordflow}{in}\ range(len(channels))}
\DoxyCodeLine{02448\ \ \ \ \ \ \ \ \ \ \ ],}
\DoxyCodeLine{02449\ \ \ \ \ \ \ \ \ \ \ axis=2)}
\DoxyCodeLine{02450\ \ \ \ \ \ \ new\_image.set\_shape([max\_dimension,\ max\_dimension,\ 3])}
\DoxyCodeLine{02451\ }
\DoxyCodeLine{02452\ \ \ \ \ result\ =\ [new\_image]}
\DoxyCodeLine{02453\ \ \ \ \ \textcolor{keywordflow}{if}\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02454\ \ \ \ \ \ \ new\_masks\ =\ tf.expand\_dims(masks,\ 3)}
\DoxyCodeLine{02455\ \ \ \ \ \ \ new\_masks\ =\ tf.image.resize\_images(}
\DoxyCodeLine{02456\ \ \ \ \ \ \ \ \ \ \ new\_masks,}
\DoxyCodeLine{02457\ \ \ \ \ \ \ \ \ \ \ new\_size[:-\/1],}
\DoxyCodeLine{02458\ \ \ \ \ \ \ \ \ \ \ method=tf.image.ResizeMethod.NEAREST\_NEIGHBOR,}
\DoxyCodeLine{02459\ \ \ \ \ \ \ \ \ \ \ align\_corners=align\_corners)}
\DoxyCodeLine{02460\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ pad\_to\_max\_dimension:}
\DoxyCodeLine{02461\ \ \ \ \ \ \ \ \ new\_masks\ =\ tf.image.pad\_to\_bounding\_box(}
\DoxyCodeLine{02462\ \ \ \ \ \ \ \ \ \ \ \ \ new\_masks,\ 0,\ 0,\ max\_dimension,\ max\_dimension)}
\DoxyCodeLine{02463\ \ \ \ \ \ \ new\_masks\ =\ tf.squeeze(new\_masks,\ 3)}
\DoxyCodeLine{02464\ \ \ \ \ \ \ result.append(new\_masks)}
\DoxyCodeLine{02465\ }
\DoxyCodeLine{02466\ \ \ \ \ result.append(new\_size)}
\DoxyCodeLine{02467\ \ \ \ \ \textcolor{keywordflow}{return}\ result}
\DoxyCodeLine{02468\ }
\DoxyCodeLine{02469\ }

\end{DoxyCode}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a201500daba3cc396f12a14daa7c3e782}\label{namespacedetection__utils_1_1core_1_1preprocessor_a201500daba3cc396f12a14daa7c3e782} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!retain\_boxes\_above\_threshold@{retain\_boxes\_above\_threshold}}
\index{retain\_boxes\_above\_threshold@{retain\_boxes\_above\_threshold}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{retain\_boxes\_above\_threshold()}{retain\_boxes\_above\_threshold()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+retain\+\_\+boxes\+\_\+above\+\_\+threshold (\begin{DoxyParamCaption}\item[{}]{boxes,  }\item[{}]{labels,  }\item[{}]{label\+\_\+weights,  }\item[{}]{label\+\_\+confidences = {\ttfamily None},  }\item[{}]{multiclass\+\_\+scores = {\ttfamily None},  }\item[{}]{masks = {\ttfamily None},  }\item[{}]{keypoints = {\ttfamily None},  }\item[{}]{threshold = {\ttfamily 0.0} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Retains boxes whose label weight is above a given threshold.

If the label weight for a box is missing (represented by NaN), the box is
retained. The boxes that don't pass the threshold will not appear in the
returned tensor.

Args:
  boxes: float32 tensor of shape [num_instance, 4] representing boxes
    location in normalized coordinates.
  labels: rank 1 int32 tensor of shape [num_instance] containing the object
    classes.
  label_weights: float32 tensor of shape [num_instance] representing the
    weight for each box.
  label_confidences: float32 tensor of shape [num_instance] representing the
    confidence for each box.
  multiclass_scores: (optional) float32 tensor of shape
    [num_instances, num_classes] representing the score for each box for each
    class.
  masks: (optional) rank 3 float32 tensor with shape
    [num_instances, height, width] containing instance masks. The masks are of
    the same height, width as the input `image`.
  keypoints: (optional) rank 3 float32 tensor with shape
    [num_instances, num_keypoints, 2]. The keypoints are in y-x normalized
    coordinates.
  threshold: scalar python float.

Returns:
  retained_boxes: [num_retained_instance, 4]
  retianed_labels: [num_retained_instance]
  retained_label_weights: [num_retained_instance]

  If multiclass_scores, masks, or keypoints are not None, the function also
    returns:

  retained_multiclass_scores: [num_retained_instance, num_classes]
  retained_masks: [num_retained_instance, height, width]
  retained_keypoints: [num_retained_instance, num_keypoints, 2]
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l00280}{280}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ threshold=0.0):}
\DoxyCodeLine{00288\ \ \ \textcolor{stringliteral}{"{}"{}"{}Retains\ boxes\ whose\ label\ weight\ is\ above\ a\ given\ threshold.}}
\DoxyCodeLine{00289\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00290\ \textcolor{stringliteral}{\ \ If\ the\ label\ weight\ }\textcolor{keywordflow}{for}\ a\ box\ \textcolor{keywordflow}{is}\ missing\ (represented\ by\ NaN),\ the\ box\ \textcolor{keywordflow}{is}}
\DoxyCodeLine{00291\ \ \ retained.\ The\ boxes\ that\ don\textcolor{stringliteral}{'t\ pass\ the\ threshold\ will\ not\ appear\ in\ the}}
\DoxyCodeLine{00292\ \textcolor{stringliteral}{\ \ returned\ tensor.}}
\DoxyCodeLine{00293\ \textcolor{stringliteral}{}}
\DoxyCodeLine{00294\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{00295\ \textcolor{stringliteral}{\ \ \ \ boxes:\ float32\ tensor\ of\ shape\ [num\_instance,\ 4]\ representing\ boxes}}
\DoxyCodeLine{00296\ \textcolor{stringliteral}{\ \ \ \ \ \ location\ }\textcolor{keywordflow}{in}\ normalized\ coordinates.}
\DoxyCodeLine{00297\ \ \ \ \ labels:\ rank\ 1\ int32\ tensor\ of\ shape\ [num\_instance]\ containing\ the\ object}
\DoxyCodeLine{00298\ \ \ \ \ \ \ classes.}
\DoxyCodeLine{00299\ \ \ \ \ label\_weights:\ float32\ tensor\ of\ shape\ [num\_instance]\ representing\ the}
\DoxyCodeLine{00300\ \ \ \ \ \ \ weight\ \textcolor{keywordflow}{for}\ each\ box.}
\DoxyCodeLine{00301\ \ \ \ \ label\_confidences:\ float32\ tensor\ of\ shape\ [num\_instance]\ representing\ the}
\DoxyCodeLine{00302\ \ \ \ \ \ \ confidence\ \textcolor{keywordflow}{for}\ each\ box.}
\DoxyCodeLine{00303\ \ \ \ \ multiclass\_scores:\ (optional)\ float32\ tensor\ of\ shape}
\DoxyCodeLine{00304\ \ \ \ \ \ \ [num\_instances,\ num\_classes]\ representing\ the\ score\ \textcolor{keywordflow}{for}\ each\ box\ \textcolor{keywordflow}{for}\ each}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \textcolor{keyword}{class}.}
\DoxyCodeLine{00306\ \ \ \ \ masks:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00307\ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ containing\ instance\ masks.\ The\ masks\ are\ of}
\DoxyCodeLine{00308\ \ \ \ \ \ \ the\ same\ height,\ width\ \textcolor{keyword}{as}\ the\ input\ \`{}image\`{}.}
\DoxyCodeLine{00309\ \ \ \ \ keypoints:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{00310\ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2].\ The\ keypoints\ are\ \textcolor{keywordflow}{in}\ y-\/x\ normalized}
\DoxyCodeLine{00311\ \ \ \ \ \ \ coordinates.}
\DoxyCodeLine{00312\ \ \ \ \ threshold:\ scalar\ python\ float.}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ Returns:}
\DoxyCodeLine{00315\ \ \ \ \ retained\_boxes:\ [num\_retained\_instance,\ 4]}
\DoxyCodeLine{00316\ \ \ \ \ retianed\_labels:\ [num\_retained\_instance]}
\DoxyCodeLine{00317\ \ \ \ \ retained\_label\_weights:\ [num\_retained\_instance]}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00319\ \ \ \ \ If\ multiclass\_scores,\ masks,\ \textcolor{keywordflow}{or}\ keypoints\ are\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},\ the\ function\ also}
\DoxyCodeLine{00320\ \ \ \ \ \ \ returns:}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \ \ \ \ retained\_multiclass\_scores:\ [num\_retained\_instance,\ num\_classes]}
\DoxyCodeLine{00323\ \ \ \ \ retained\_masks:\ [num\_retained\_instance,\ height,\ width]}
\DoxyCodeLine{00324\ \ \ \ \ retained\_keypoints:\ [num\_retained\_instance,\ num\_keypoints,\ 2]}
\DoxyCodeLine{00325\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{00326\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'RetainBoxesAboveThreshold'},}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ values=[boxes,\ labels,\ label\_weights]):}
\DoxyCodeLine{00328\ \ \ \ \ indices\ =\ tf.where(}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ tf.logical\_or(label\_weights\ >\ threshold,\ tf.is\_nan(label\_weights)))}
\DoxyCodeLine{00330\ \ \ \ \ indices\ =\ tf.squeeze(indices,\ axis=1)}
\DoxyCodeLine{00331\ \ \ \ \ retained\_boxes\ =\ tf.gather(boxes,\ indices)}
\DoxyCodeLine{00332\ \ \ \ \ retained\_labels\ =\ tf.gather(labels,\ indices)}
\DoxyCodeLine{00333\ \ \ \ \ retained\_label\_weights\ =\ tf.gather(label\_weights,\ indices)}
\DoxyCodeLine{00334\ \ \ \ \ result\ =\ [retained\_boxes,\ retained\_labels,\ retained\_label\_weights]}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00336\ \ \ \ \ \textcolor{keywordflow}{if}\ label\_confidences\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00337\ \ \ \ \ \ \ retained\_label\_confidences\ =\ tf.gather(label\_confidences,\ indices)}
\DoxyCodeLine{00338\ \ \ \ \ \ \ result.append(retained\_label\_confidences)}
\DoxyCodeLine{00339\ }
\DoxyCodeLine{00340\ \ \ \ \ \textcolor{keywordflow}{if}\ multiclass\_scores\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00341\ \ \ \ \ \ \ retained\_multiclass\_scores\ =\ tf.gather(multiclass\_scores,\ indices)}
\DoxyCodeLine{00342\ \ \ \ \ \ \ result.append(retained\_multiclass\_scores)}
\DoxyCodeLine{00343\ }
\DoxyCodeLine{00344\ \ \ \ \ \textcolor{keywordflow}{if}\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00345\ \ \ \ \ \ \ retained\_masks\ =\ tf.gather(masks,\ indices)}
\DoxyCodeLine{00346\ \ \ \ \ \ \ result.append(retained\_masks)}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ \ \ \textcolor{keywordflow}{if}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00349\ \ \ \ \ \ \ retained\_keypoints\ =\ tf.gather(keypoints,\ indices)}
\DoxyCodeLine{00350\ \ \ \ \ \ \ result.append(retained\_keypoints)}
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00352\ \ \ \ \ \textcolor{keywordflow}{return}\ result}
\DoxyCodeLine{00353\ }
\DoxyCodeLine{00354\ }

\end{DoxyCode}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_aa1129985bff113d599809697210e2628}\label{namespacedetection__utils_1_1core_1_1preprocessor_aa1129985bff113d599809697210e2628} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!rgb\_to\_gray@{rgb\_to\_gray}}
\index{rgb\_to\_gray@{rgb\_to\_gray}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{rgb\_to\_gray()}{rgb\_to\_gray()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+rgb\+\_\+to\+\_\+gray (\begin{DoxyParamCaption}\item[{}]{image }\end{DoxyParamCaption})}

\begin{DoxyVerb}Converts a 3 channel RGB image to a 1 channel grayscale image.

Args:
  image: Rank 3 float32 tensor containing 1 image -> [height, width, 3]
         with pixel values varying between [0, 1].

Returns:
  image: A single channel grayscale image -> [image, height, 1].
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l02737}{2737}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02737\ \textcolor{keyword}{def\ }rgb\_to\_gray(image):}
\DoxyCodeLine{02738\ \ \ \textcolor{stringliteral}{"{}"{}"{}Converts\ a\ 3\ channel\ RGB\ image\ to\ a\ 1\ channel\ grayscale\ image.}}
\DoxyCodeLine{02739\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02740\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{02741\ \textcolor{stringliteral}{\ \ \ \ image:\ Rank\ 3\ float32\ tensor\ containing\ 1\ image\ -\/>\ [height,\ width,\ 3]}}
\DoxyCodeLine{02742\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ }\textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 1].}
\DoxyCodeLine{02743\ }
\DoxyCodeLine{02744\ \ \ Returns:}
\DoxyCodeLine{02745\ \ \ \ \ image:\ A\ single\ channel\ grayscale\ image\ -\/>\ [image,\ height,\ 1].}
\DoxyCodeLine{02746\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{02747\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{return}\ \_rgb\_to\_grayscale(image)}
\DoxyCodeLine{02748\ }
\DoxyCodeLine{02749\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_aa1129985bff113d599809697210e2628_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a0b0e9e173acdfd6bdc495be778c346e3}\label{namespacedetection__utils_1_1core_1_1preprocessor_a0b0e9e173acdfd6bdc495be778c346e3} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!scale\_boxes\_to\_pixel\_coordinates@{scale\_boxes\_to\_pixel\_coordinates}}
\index{scale\_boxes\_to\_pixel\_coordinates@{scale\_boxes\_to\_pixel\_coordinates}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{scale\_boxes\_to\_pixel\_coordinates()}{scale\_boxes\_to\_pixel\_coordinates()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+scale\+\_\+boxes\+\_\+to\+\_\+pixel\+\_\+coordinates (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{boxes,  }\item[{}]{keypoints = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Scales boxes from normalized to pixel coordinates.

Args:
  image: A 3D float32 tensor of shape [height, width, channels].
  boxes: A 2D float32 tensor of shape [num_boxes, 4] containing the bounding
    boxes in normalized coordinates. Each row is of the form
    [ymin, xmin, ymax, xmax].
  keypoints: (optional) rank 3 float32 tensor with shape
    [num_instances, num_keypoints, 2]. The keypoints are in y-x normalized
    coordinates.

Returns:
  image: unchanged input image.
  scaled_boxes: a 2D float32 tensor of shape [num_boxes, 4] containing the
    bounding boxes in pixel coordinates.
  scaled_keypoints: a 3D float32 tensor with shape
    [num_instances, num_keypoints, 2] containing the keypoints in pixel
    coordinates.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l02595}{2595}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02595\ \textcolor{keyword}{def\ }scale\_boxes\_to\_pixel\_coordinates(image,\ boxes,\ keypoints=None):}
\DoxyCodeLine{02596\ \ \ \textcolor{stringliteral}{"{}"{}"{}Scales\ boxes\ from\ normalized\ to\ pixel\ coordinates.}}
\DoxyCodeLine{02597\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02598\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{02599\ \textcolor{stringliteral}{\ \ \ \ image:\ A\ 3D\ float32\ tensor\ of\ shape\ [height,\ width,\ channels].}}
\DoxyCodeLine{02600\ \textcolor{stringliteral}{\ \ \ \ boxes:\ A\ 2D\ float32\ tensor\ of\ shape\ [num\_boxes,\ 4]\ containing\ the\ bounding}}
\DoxyCodeLine{02601\ \textcolor{stringliteral}{\ \ \ \ \ \ boxes\ }\textcolor{keywordflow}{in}\ normalized\ coordinates.\ Each\ row\ \textcolor{keywordflow}{is}\ of\ the\ form}
\DoxyCodeLine{02602\ \ \ \ \ \ \ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{02603\ \ \ \ \ keypoints:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{02604\ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2].\ The\ keypoints\ are\ \textcolor{keywordflow}{in}\ y-\/x\ normalized}
\DoxyCodeLine{02605\ \ \ \ \ \ \ coordinates.}
\DoxyCodeLine{02606\ }
\DoxyCodeLine{02607\ \ \ Returns:}
\DoxyCodeLine{02608\ \ \ \ \ image:\ unchanged\ input\ image.}
\DoxyCodeLine{02609\ \ \ \ \ scaled\_boxes:\ a\ 2D\ float32\ tensor\ of\ shape\ [num\_boxes,\ 4]\ containing\ the}
\DoxyCodeLine{02610\ \ \ \ \ \ \ bounding\ boxes\ \textcolor{keywordflow}{in}\ pixel\ coordinates.}
\DoxyCodeLine{02611\ \ \ \ \ scaled\_keypoints:\ a\ 3D\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{02612\ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2]\ containing\ the\ keypoints\ \textcolor{keywordflow}{in}\ pixel}
\DoxyCodeLine{02613\ \ \ \ \ \ \ coordinates.}
\DoxyCodeLine{02614\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{02615\ \textcolor{stringliteral}{\ \ boxlist\ =\ box\_list.BoxList(boxes)}}
\DoxyCodeLine{02616\ \textcolor{stringliteral}{\ \ image\_height\ =\ tf.shape(image)[0]}}
\DoxyCodeLine{02617\ \textcolor{stringliteral}{\ \ image\_width\ =\ tf.shape(image)[1]}}
\DoxyCodeLine{02618\ \textcolor{stringliteral}{\ \ scaled\_boxes\ =\ box\_list\_ops.scale(boxlist,\ image\_height,\ image\_width).get()}}
\DoxyCodeLine{02619\ \textcolor{stringliteral}{\ \ result\ =\ [image,\ scaled\_boxes]}}
\DoxyCodeLine{02620\ \textcolor{stringliteral}{\ \ }\textcolor{keywordflow}{if}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02621\ \ \ \ \ scaled\_keypoints\ =\ keypoint\_ops.scale(keypoints,\ image\_height,\ image\_width)}
\DoxyCodeLine{02622\ \ \ \ \ result.append(scaled\_keypoints)}
\DoxyCodeLine{02623\ \ \ \textcolor{keywordflow}{return}\ tuple(result)}
\DoxyCodeLine{02624\ }
\DoxyCodeLine{02625\ }
\DoxyCodeLine{02626\ \textcolor{comment}{\#\ TODO(alirezafathi):\ Investigate\ if\ instead\ the\ function\ should\ return\ None\ if}}
\DoxyCodeLine{02627\ \textcolor{comment}{\#\ masks\ is\ None.}}
\DoxyCodeLine{02628\ \textcolor{comment}{\#\ pylint:\ disable=g-\/doc-\/return-\/or-\/yield}}

\end{DoxyCode}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a91a2c48d4f04433025c2994248222729}\label{namespacedetection__utils_1_1core_1_1preprocessor_a91a2c48d4f04433025c2994248222729} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!ssd\_random\_crop@{ssd\_random\_crop}}
\index{ssd\_random\_crop@{ssd\_random\_crop}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{ssd\_random\_crop()}{ssd\_random\_crop()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+ssd\+\_\+random\+\_\+crop (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{boxes,  }\item[{}]{labels,  }\item[{}]{label\+\_\+weights,  }\item[{}]{label\+\_\+confidences = {\ttfamily None},  }\item[{}]{multiclass\+\_\+scores = {\ttfamily None},  }\item[{}]{masks = {\ttfamily None},  }\item[{}]{keypoints = {\ttfamily None},  }\item[{}]{min\+\_\+object\+\_\+covered = {\ttfamily (0.0,~0.1,~0.3,~0.5,~0.7,~0.9,~1.0)},  }\item[{}]{aspect\+\_\+ratio\+\_\+range = {\ttfamily ((0.5,~2.0),)~\texorpdfstring{$\ast$}{*}~7},  }\item[{}]{area\+\_\+range = {\ttfamily ((0.1,~1.0),)~\texorpdfstring{$\ast$}{*}~7},  }\item[{}]{overlap\+\_\+thresh = {\ttfamily (0.0,~0.1,~0.3,~0.5,~0.7,~0.9,~1.0)},  }\item[{}]{clip\+\_\+boxes = {\ttfamily (True,)~\texorpdfstring{$\ast$}{*}~7},  }\item[{}]{random\+\_\+coef = {\ttfamily (0.15,)~\texorpdfstring{$\ast$}{*}~7},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Random crop preprocessing with default parameters as in SSD paper.

Liu et al., SSD: Single shot multibox detector.
For further information on random crop preprocessing refer to RandomCrop
function above.

Args:
  image: rank 3 float32 tensor contains 1 image -> [height, width, channels]
         with pixel values varying between [0, 1].
  boxes: rank 2 float32 tensor containing the bounding boxes -> [N, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].
  labels: rank 1 int32 tensor containing the object classes.
  label_weights: rank 1 float32 tensor containing the weights.
  label_confidences: rank 1 float32 tensor containing the confidences.
  multiclass_scores: (optional) float32 tensor of shape
    [num_instances, num_classes] representing the score for each box for each
    class.
  masks: (optional) rank 3 float32 tensor with shape
         [num_instances, height, width] containing instance masks. The masks
         are of the same height, width as the input `image`.
  keypoints: (optional) rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]. The keypoints are in y-x
             normalized coordinates.
  min_object_covered: the cropped image must cover at least this fraction of
                      at least one of the input bounding boxes.
  aspect_ratio_range: allowed range for aspect ratio of cropped image.
  area_range: allowed range for area ratio between cropped image and the
              original image.
  overlap_thresh: minimum overlap thresh with new cropped
                  image to keep the box.
  clip_boxes: whether to clip the boxes to the cropped image.
  random_coef: a random coefficient that defines the chance of getting the
               original image. If random_coef is 0, we will always get the
               cropped image, and if it is 1.0, we will always get the
               original image.
  seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: image which is the same rank as input image.
  boxes: boxes which is the same rank as input boxes.
         Boxes are in normalized form.
  labels: new labels.

  If label_weights, multiclass_scores, masks, or keypoints  is not None, the
  function also returns:
  label_weights: rank 1 float32 tensor with shape [num_instances].
  multiclass_scores: rank 2 float32 tensor with shape
                     [num_instances, num_classes]
  masks: rank 3 float32 tensor with shape [num_instances, height, width]
         containing instance masks.
  keypoints: rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l02859}{2859}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02874\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{02875\ \ \ \textcolor{stringliteral}{"{}"{}"{}Random\ crop\ preprocessing\ with\ default\ parameters\ as\ in\ SSD\ paper.}}
\DoxyCodeLine{02876\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02877\ \textcolor{stringliteral}{\ \ Liu\ et\ al.,\ SSD:\ Single\ shot\ multibox\ detector.}}
\DoxyCodeLine{02878\ \textcolor{stringliteral}{\ \ For\ further\ information\ on\ random\ crop\ preprocessing\ refer\ to\ RandomCrop}}
\DoxyCodeLine{02879\ \textcolor{stringliteral}{\ \ function\ above.}}
\DoxyCodeLine{02880\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02881\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{02882\ \textcolor{stringliteral}{\ \ \ \ image:\ rank\ 3\ float32\ tensor\ contains\ 1\ image\ -\/>\ [height,\ width,\ channels]}}
\DoxyCodeLine{02883\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ }\textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 1].}
\DoxyCodeLine{02884\ \ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ -\/>\ [N,\ 4].}
\DoxyCodeLine{02885\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{02886\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{02887\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{02888\ \ \ \ \ labels:\ rank\ 1\ int32\ tensor\ containing\ the\ object\ classes.}
\DoxyCodeLine{02889\ \ \ \ \ label\_weights:\ rank\ 1\ float32\ tensor\ containing\ the\ weights.}
\DoxyCodeLine{02890\ \ \ \ \ label\_confidences:\ rank\ 1\ float32\ tensor\ containing\ the\ confidences.}
\DoxyCodeLine{02891\ \ \ \ \ multiclass\_scores:\ (optional)\ float32\ tensor\ of\ shape}
\DoxyCodeLine{02892\ \ \ \ \ \ \ [num\_instances,\ num\_classes]\ representing\ the\ score\ \textcolor{keywordflow}{for}\ each\ box\ \textcolor{keywordflow}{for}\ each}
\DoxyCodeLine{02893\ \ \ \ \ \ \ \textcolor{keyword}{class}.}
\DoxyCodeLine{02894\ \ \ \ \ masks:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{02895\ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ containing\ instance\ masks.\ The\ masks}
\DoxyCodeLine{02896\ \ \ \ \ \ \ \ \ \ \ \ are\ of\ the\ same\ height,\ width\ \textcolor{keyword}{as}\ the\ input\ \`{}image\`{}.}
\DoxyCodeLine{02897\ \ \ \ \ keypoints:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{02898\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2].\ The\ keypoints\ are\ \textcolor{keywordflow}{in}\ y-\/x}
\DoxyCodeLine{02899\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ normalized\ coordinates.}
\DoxyCodeLine{02900\ \ \ \ \ min\_object\_covered:\ the\ cropped\ image\ must\ cover\ at\ least\ this\ fraction\ of}
\DoxyCodeLine{02901\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ at\ least\ one\ of\ the\ input\ bounding\ boxes.}
\DoxyCodeLine{02902\ \ \ \ \ aspect\_ratio\_range:\ allowed\ range\ \textcolor{keywordflow}{for}\ aspect\ ratio\ of\ cropped\ image.}
\DoxyCodeLine{02903\ \ \ \ \ area\_range:\ allowed\ range\ \textcolor{keywordflow}{for}\ area\ ratio\ between\ cropped\ image\ \textcolor{keywordflow}{and}\ the}
\DoxyCodeLine{02904\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.}
\DoxyCodeLine{02905\ \ \ \ \ overlap\_thresh:\ minimum\ overlap\ thresh\ \textcolor{keyword}{with}\ new\ cropped}
\DoxyCodeLine{02906\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ image\ to\ keep\ the\ box.}
\DoxyCodeLine{02907\ \ \ \ \ clip\_boxes:\ whether\ to\ clip\ the\ boxes\ to\ the\ cropped\ image.}
\DoxyCodeLine{02908\ \ \ \ \ random\_coef:\ a\ random\ coefficient\ that\ defines\ the\ chance\ of\ getting\ the}
\DoxyCodeLine{02909\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.\ If\ random\_coef\ \textcolor{keywordflow}{is}\ 0,\ we\ will\ always\ get\ the}
\DoxyCodeLine{02910\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cropped\ image,\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{if}\ it\ \textcolor{keywordflow}{is}\ 1.0,\ we\ will\ always\ get\ the}
\DoxyCodeLine{02911\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.}
\DoxyCodeLine{02912\ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{02913\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{02914\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{02915\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{02916\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{02917\ }
\DoxyCodeLine{02918\ \ \ Returns:}
\DoxyCodeLine{02919\ \ \ \ \ image:\ image\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ image.}
\DoxyCodeLine{02920\ \ \ \ \ boxes:\ boxes\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ boxes.}
\DoxyCodeLine{02921\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form.}
\DoxyCodeLine{02922\ \ \ \ \ labels:\ new\ labels.}
\DoxyCodeLine{02923\ }
\DoxyCodeLine{02924\ \ \ \ \ If\ label\_weights,\ multiclass\_scores,\ masks,\ \textcolor{keywordflow}{or}\ keypoints\ \ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},\ the}
\DoxyCodeLine{02925\ \ \ \ \ function\ also\ returns:}
\DoxyCodeLine{02926\ \ \ \ \ label\_weights:\ rank\ 1\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [num\_instances].}
\DoxyCodeLine{02927\ \ \ \ \ multiclass\_scores:\ rank\ 2\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{02928\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_classes]}
\DoxyCodeLine{02929\ \ \ \ \ masks:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [num\_instances,\ height,\ width]}
\DoxyCodeLine{02930\ \ \ \ \ \ \ \ \ \ \ \ containing\ instance\ masks.}
\DoxyCodeLine{02931\ \ \ \ \ keypoints:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{02932\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2]}
\DoxyCodeLine{02933\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{02934\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02935\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{def\ }random\_crop\_selector(selected\_result,\ index):}
\DoxyCodeLine{02936\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Applies\ random\_crop\_image\ to\ selected\ result.}}
\DoxyCodeLine{02937\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02938\ \textcolor{stringliteral}{\ \ \ \ Args:}}
\DoxyCodeLine{02939\ \textcolor{stringliteral}{\ \ \ \ \ \ selected\_result:\ A\ tuple\ containing\ image,\ boxes,\ labels,\ keypoints\ (}\textcolor{keywordflow}{if}}
\DoxyCodeLine{02940\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}),\ \textcolor{keywordflow}{and}\ masks\ (\textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}).}
\DoxyCodeLine{02941\ \ \ \ \ \ \ index:\ The\ index\ that\ was\ randomly\ selected.}
\DoxyCodeLine{02942\ }
\DoxyCodeLine{02943\ \ \ \ \ Returns:\ A\ tuple\ containing\ image,\ boxes,\ labels,\ keypoints\ (\textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}),}
\DoxyCodeLine{02944\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{and}\ masks\ (\textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}).}
\DoxyCodeLine{02945\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{02946\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02947\ \textcolor{stringliteral}{\ \ \ \ i\ =\ 3}}
\DoxyCodeLine{02948\ \textcolor{stringliteral}{\ \ \ \ image,\ boxes,\ labels\ =\ selected\_result[:i]}}
\DoxyCodeLine{02949\ \textcolor{stringliteral}{\ \ \ \ selected\_label\_weights\ =\ }\textcolor{keywordtype}{None}}
\DoxyCodeLine{02950\ \ \ \ \ selected\_label\_confidences\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{02951\ \ \ \ \ selected\_multiclass\_scores\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{02952\ \ \ \ \ selected\_masks\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{02953\ \ \ \ \ selected\_keypoints\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{02954\ \ \ \ \ \textcolor{keywordflow}{if}\ label\_weights\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02955\ \ \ \ \ \ \ selected\_label\_weights\ =\ selected\_result[i]}
\DoxyCodeLine{02956\ \ \ \ \ \ \ i\ +=\ 1}
\DoxyCodeLine{02957\ \ \ \ \ \textcolor{keywordflow}{if}\ label\_confidences\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02958\ \ \ \ \ \ \ selected\_label\_confidences\ =\ selected\_result[i]}
\DoxyCodeLine{02959\ \ \ \ \ \ \ i\ +=\ 1}
\DoxyCodeLine{02960\ \ \ \ \ \textcolor{keywordflow}{if}\ multiclass\_scores\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02961\ \ \ \ \ \ \ selected\_multiclass\_scores\ =\ selected\_result[i]}
\DoxyCodeLine{02962\ \ \ \ \ \ \ i\ +=\ 1}
\DoxyCodeLine{02963\ \ \ \ \ \textcolor{keywordflow}{if}\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02964\ \ \ \ \ \ \ selected\_masks\ =\ selected\_result[i]}
\DoxyCodeLine{02965\ \ \ \ \ \ \ i\ +=\ 1}
\DoxyCodeLine{02966\ \ \ \ \ \textcolor{keywordflow}{if}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{02967\ \ \ \ \ \ \ selected\_keypoints\ =\ selected\_result[i]}
\DoxyCodeLine{02968\ }
\DoxyCodeLine{02969\ \ \ \ \ \textcolor{keywordflow}{return}\ random\_crop\_image(}
\DoxyCodeLine{02970\ \ \ \ \ \ \ \ \ image=image,}
\DoxyCodeLine{02971\ \ \ \ \ \ \ \ \ boxes=boxes,}
\DoxyCodeLine{02972\ \ \ \ \ \ \ \ \ labels=labels,}
\DoxyCodeLine{02973\ \ \ \ \ \ \ \ \ label\_weights=selected\_label\_weights,}
\DoxyCodeLine{02974\ \ \ \ \ \ \ \ \ label\_confidences=selected\_label\_confidences,}
\DoxyCodeLine{02975\ \ \ \ \ \ \ \ \ multiclass\_scores=selected\_multiclass\_scores,}
\DoxyCodeLine{02976\ \ \ \ \ \ \ \ \ masks=selected\_masks,}
\DoxyCodeLine{02977\ \ \ \ \ \ \ \ \ keypoints=selected\_keypoints,}
\DoxyCodeLine{02978\ \ \ \ \ \ \ \ \ min\_object\_covered=min\_object\_covered[index],}
\DoxyCodeLine{02979\ \ \ \ \ \ \ \ \ aspect\_ratio\_range=aspect\_ratio\_range[index],}
\DoxyCodeLine{02980\ \ \ \ \ \ \ \ \ area\_range=area\_range[index],}
\DoxyCodeLine{02981\ \ \ \ \ \ \ \ \ overlap\_thresh=overlap\_thresh[index],}
\DoxyCodeLine{02982\ \ \ \ \ \ \ \ \ clip\_boxes=clip\_boxes[index],}
\DoxyCodeLine{02983\ \ \ \ \ \ \ \ \ random\_coef=random\_coef[index],}
\DoxyCodeLine{02984\ \ \ \ \ \ \ \ \ seed=seed,}
\DoxyCodeLine{02985\ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache)}
\DoxyCodeLine{02986\ }
\DoxyCodeLine{02987\ \ \ result\ =\ \_apply\_with\_random\_selector\_tuples(}
\DoxyCodeLine{02988\ \ \ \ \ \ \ tuple(}
\DoxyCodeLine{02989\ \ \ \ \ \ \ \ \ \ \ t\ \textcolor{keywordflow}{for}\ t\ \textcolor{keywordflow}{in}\ (image,\ boxes,\ labels,\ label\_weights,\ label\_confidences,}
\DoxyCodeLine{02990\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ multiclass\_scores,\ masks,\ keypoints)\ \textcolor{keywordflow}{if}\ t\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}),}
\DoxyCodeLine{02991\ \ \ \ \ \ \ random\_crop\_selector,}
\DoxyCodeLine{02992\ \ \ \ \ \ \ num\_cases=len(min\_object\_covered),}
\DoxyCodeLine{02993\ \ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache,}
\DoxyCodeLine{02994\ \ \ \ \ \ \ key=preprocessor\_cache.PreprocessorCache.SSD\_CROP\_SELECTOR\_ID)}
\DoxyCodeLine{02995\ \ \ \textcolor{keywordflow}{return}\ result}
\DoxyCodeLine{02996\ }
\DoxyCodeLine{02997\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a91a2c48d4f04433025c2994248222729_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a91a2c48d4f04433025c2994248222729_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_ae771c28299fc187bd974238ae577fb02}\label{namespacedetection__utils_1_1core_1_1preprocessor_ae771c28299fc187bd974238ae577fb02} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!ssd\_random\_crop\_fixed\_aspect\_ratio@{ssd\_random\_crop\_fixed\_aspect\_ratio}}
\index{ssd\_random\_crop\_fixed\_aspect\_ratio@{ssd\_random\_crop\_fixed\_aspect\_ratio}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{ssd\_random\_crop\_fixed\_aspect\_ratio()}{ssd\_random\_crop\_fixed\_aspect\_ratio()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+ssd\+\_\+random\+\_\+crop\+\_\+fixed\+\_\+aspect\+\_\+ratio (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{boxes,  }\item[{}]{labels,  }\item[{}]{label\+\_\+weights,  }\item[{}]{label\+\_\+confidences = {\ttfamily None},  }\item[{}]{multiclass\+\_\+scores = {\ttfamily None},  }\item[{}]{masks = {\ttfamily None},  }\item[{}]{keypoints = {\ttfamily None},  }\item[{}]{min\+\_\+object\+\_\+covered = {\ttfamily (0.0,~0.1,~0.3,~0.5,~0.7,~0.9,~1.0)},  }\item[{}]{aspect\+\_\+ratio = {\ttfamily 1.0},  }\item[{}]{area\+\_\+range = {\ttfamily ((0.1,~1.0),)~\texorpdfstring{$\ast$}{*}~7},  }\item[{}]{overlap\+\_\+thresh = {\ttfamily (0.0,~0.1,~0.3,~0.5,~0.7,~0.9,~1.0)},  }\item[{}]{clip\+\_\+boxes = {\ttfamily (True,)~\texorpdfstring{$\ast$}{*}~7},  }\item[{}]{random\+\_\+coef = {\ttfamily (0.15,)~\texorpdfstring{$\ast$}{*}~7},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Random crop preprocessing with default parameters as in SSD paper.

Liu et al., SSD: Single shot multibox detector.
For further information on random crop preprocessing refer to RandomCrop
function above.

The only difference is that the aspect ratio of the crops are fixed.

Args:
  image: rank 3 float32 tensor contains 1 image -> [height, width, channels]
         with pixel values varying between [0, 1].
  boxes: rank 2 float32 tensor containing the bounding boxes -> [N, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].
  labels: rank 1 int32 tensor containing the object classes.
  label_weights: float32 tensor of shape [num_instances] representing the
    weight for each box.
  label_confidences: (optional) float32 tensor of shape [num_instances]
    representing the confidences for each box.
  multiclass_scores: (optional) float32 tensor of shape
    [num_instances, num_classes] representing the score for each box for each
    class.
  masks: (optional) rank 3 float32 tensor with shape
         [num_instances, height, width] containing instance masks. The masks
         are of the same height, width as the input `image`.
  keypoints: (optional) rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]. The keypoints are in y-x
             normalized coordinates.
  min_object_covered: the cropped image must cover at least this fraction of
                      at least one of the input bounding boxes.
  aspect_ratio: aspect ratio of the cropped image.
  area_range: allowed range for area ratio between cropped image and the
              original image.
  overlap_thresh: minimum overlap thresh with new cropped
                  image to keep the box.
  clip_boxes: whether to clip the boxes to the cropped image.
  random_coef: a random coefficient that defines the chance of getting the
               original image. If random_coef is 0, we will always get the
               cropped image, and if it is 1.0, we will always get the
               original image.
  seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: image which is the same rank as input image.
  boxes: boxes which is the same rank as input boxes.
         Boxes are in normalized form.
  labels: new labels.

  If multiclass_scores, masks, or keypoints is not None, the function also
    returns:

  multiclass_scores: rank 2 float32 tensor with shape
                     [num_instances, num_classes]
  masks: rank 3 float32 tensor with shape [num_instances, height, width]
         containing instance masks.
  keypoints: rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l03113}{3113}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03129\ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{03130\ \ \ \textcolor{stringliteral}{"{}"{}"{}Random\ crop\ preprocessing\ with\ default\ parameters\ as\ in\ SSD\ paper.}}
\DoxyCodeLine{03131\ \textcolor{stringliteral}{}}
\DoxyCodeLine{03132\ \textcolor{stringliteral}{\ \ Liu\ et\ al.,\ SSD:\ Single\ shot\ multibox\ detector.}}
\DoxyCodeLine{03133\ \textcolor{stringliteral}{\ \ For\ further\ information\ on\ random\ crop\ preprocessing\ refer\ to\ RandomCrop}}
\DoxyCodeLine{03134\ \textcolor{stringliteral}{\ \ function\ above.}}
\DoxyCodeLine{03135\ \textcolor{stringliteral}{}}
\DoxyCodeLine{03136\ \textcolor{stringliteral}{\ \ The\ only\ difference\ }\textcolor{keywordflow}{is}\ that\ the\ aspect\ ratio\ of\ the\ crops\ are\ fixed.}
\DoxyCodeLine{03137\ }
\DoxyCodeLine{03138\ \ \ Args:}
\DoxyCodeLine{03139\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ contains\ 1\ image\ -\/>\ [height,\ width,\ channels]}
\DoxyCodeLine{03140\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 1].}
\DoxyCodeLine{03141\ \ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ -\/>\ [N,\ 4].}
\DoxyCodeLine{03142\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{03143\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{03144\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{03145\ \ \ \ \ labels:\ rank\ 1\ int32\ tensor\ containing\ the\ object\ classes.}
\DoxyCodeLine{03146\ \ \ \ \ label\_weights:\ float32\ tensor\ of\ shape\ [num\_instances]\ representing\ the}
\DoxyCodeLine{03147\ \ \ \ \ \ \ weight\ \textcolor{keywordflow}{for}\ each\ box.}
\DoxyCodeLine{03148\ \ \ \ \ label\_confidences:\ (optional)\ float32\ tensor\ of\ shape\ [num\_instances]}
\DoxyCodeLine{03149\ \ \ \ \ \ \ representing\ the\ confidences\ \textcolor{keywordflow}{for}\ each\ box.}
\DoxyCodeLine{03150\ \ \ \ \ multiclass\_scores:\ (optional)\ float32\ tensor\ of\ shape}
\DoxyCodeLine{03151\ \ \ \ \ \ \ [num\_instances,\ num\_classes]\ representing\ the\ score\ \textcolor{keywordflow}{for}\ each\ box\ \textcolor{keywordflow}{for}\ each}
\DoxyCodeLine{03152\ \ \ \ \ \ \ \textcolor{keyword}{class}.}
\DoxyCodeLine{03153\ \ \ \ \ masks:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{03154\ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ containing\ instance\ masks.\ The\ masks}
\DoxyCodeLine{03155\ \ \ \ \ \ \ \ \ \ \ \ are\ of\ the\ same\ height,\ width\ \textcolor{keyword}{as}\ the\ input\ \`{}image\`{}.}
\DoxyCodeLine{03156\ \ \ \ \ keypoints:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{03157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2].\ The\ keypoints\ are\ \textcolor{keywordflow}{in}\ y-\/x}
\DoxyCodeLine{03158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ normalized\ coordinates.}
\DoxyCodeLine{03159\ \ \ \ \ min\_object\_covered:\ the\ cropped\ image\ must\ cover\ at\ least\ this\ fraction\ of}
\DoxyCodeLine{03160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ at\ least\ one\ of\ the\ input\ bounding\ boxes.}
\DoxyCodeLine{03161\ \ \ \ \ aspect\_ratio:\ aspect\ ratio\ of\ the\ cropped\ image.}
\DoxyCodeLine{03162\ \ \ \ \ area\_range:\ allowed\ range\ \textcolor{keywordflow}{for}\ area\ ratio\ between\ cropped\ image\ \textcolor{keywordflow}{and}\ the}
\DoxyCodeLine{03163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.}
\DoxyCodeLine{03164\ \ \ \ \ overlap\_thresh:\ minimum\ overlap\ thresh\ \textcolor{keyword}{with}\ new\ cropped}
\DoxyCodeLine{03165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ image\ to\ keep\ the\ box.}
\DoxyCodeLine{03166\ \ \ \ \ clip\_boxes:\ whether\ to\ clip\ the\ boxes\ to\ the\ cropped\ image.}
\DoxyCodeLine{03167\ \ \ \ \ random\_coef:\ a\ random\ coefficient\ that\ defines\ the\ chance\ of\ getting\ the}
\DoxyCodeLine{03168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.\ If\ random\_coef\ \textcolor{keywordflow}{is}\ 0,\ we\ will\ always\ get\ the}
\DoxyCodeLine{03169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cropped\ image,\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{if}\ it\ \textcolor{keywordflow}{is}\ 1.0,\ we\ will\ always\ get\ the}
\DoxyCodeLine{03170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.}
\DoxyCodeLine{03171\ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{03172\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{03173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{03174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{03175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{03176\ }
\DoxyCodeLine{03177\ \ \ Returns:}
\DoxyCodeLine{03178\ \ \ \ \ image:\ image\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ image.}
\DoxyCodeLine{03179\ \ \ \ \ boxes:\ boxes\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ boxes.}
\DoxyCodeLine{03180\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form.}
\DoxyCodeLine{03181\ \ \ \ \ labels:\ new\ labels.}
\DoxyCodeLine{03182\ }
\DoxyCodeLine{03183\ \ \ \ \ If\ multiclass\_scores,\ masks,\ \textcolor{keywordflow}{or}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},\ the\ function\ also}
\DoxyCodeLine{03184\ \ \ \ \ \ \ returns:}
\DoxyCodeLine{03185\ }
\DoxyCodeLine{03186\ \ \ \ \ multiclass\_scores:\ rank\ 2\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{03187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_classes]}
\DoxyCodeLine{03188\ \ \ \ \ masks:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [num\_instances,\ height,\ width]}
\DoxyCodeLine{03189\ \ \ \ \ \ \ \ \ \ \ \ containing\ instance\ masks.}
\DoxyCodeLine{03190\ \ \ \ \ keypoints:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{03191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2]}
\DoxyCodeLine{03192\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{03193\ \textcolor{stringliteral}{\ \ aspect\_ratio\_range\ =\ ((aspect\_ratio,\ aspect\_ratio),)\ *\ len(area\_range)}}
\DoxyCodeLine{03194\ \textcolor{stringliteral}{}}
\DoxyCodeLine{03195\ \textcolor{stringliteral}{\ \ crop\_result\ =\ ssd\_random\_crop(}}
\DoxyCodeLine{03196\ \textcolor{stringliteral}{\ \ \ \ \ \ image,}}
\DoxyCodeLine{03197\ \textcolor{stringliteral}{\ \ \ \ \ \ boxes,}}
\DoxyCodeLine{03198\ \textcolor{stringliteral}{\ \ \ \ \ \ labels,}}
\DoxyCodeLine{03199\ \textcolor{stringliteral}{\ \ \ \ \ \ label\_weights=label\_weights,}}
\DoxyCodeLine{03200\ \textcolor{stringliteral}{\ \ \ \ \ \ label\_confidences=label\_confidences,}}
\DoxyCodeLine{03201\ \textcolor{stringliteral}{\ \ \ \ \ \ multiclass\_scores=multiclass\_scores,}}
\DoxyCodeLine{03202\ \textcolor{stringliteral}{\ \ \ \ \ \ masks=masks,}}
\DoxyCodeLine{03203\ \textcolor{stringliteral}{\ \ \ \ \ \ keypoints=keypoints,}}
\DoxyCodeLine{03204\ \textcolor{stringliteral}{\ \ \ \ \ \ min\_object\_covered=min\_object\_covered,}}
\DoxyCodeLine{03205\ \textcolor{stringliteral}{\ \ \ \ \ \ aspect\_ratio\_range=aspect\_ratio\_range,}}
\DoxyCodeLine{03206\ \textcolor{stringliteral}{\ \ \ \ \ \ area\_range=area\_range,}}
\DoxyCodeLine{03207\ \textcolor{stringliteral}{\ \ \ \ \ \ overlap\_thresh=overlap\_thresh,}}
\DoxyCodeLine{03208\ \textcolor{stringliteral}{\ \ \ \ \ \ clip\_boxes=clip\_boxes,}}
\DoxyCodeLine{03209\ \textcolor{stringliteral}{\ \ \ \ \ \ random\_coef=random\_coef,}}
\DoxyCodeLine{03210\ \textcolor{stringliteral}{\ \ \ \ \ \ seed=seed,}}
\DoxyCodeLine{03211\ \textcolor{stringliteral}{\ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache)}}
\DoxyCodeLine{03212\ \textcolor{stringliteral}{\ \ i\ =\ 3}}
\DoxyCodeLine{03213\ \textcolor{stringliteral}{\ \ new\_image,\ new\_boxes,\ new\_labels\ =\ crop\_result[:i]}}
\DoxyCodeLine{03214\ \textcolor{stringliteral}{\ \ new\_label\_weights\ =\ }\textcolor{keywordtype}{None}}
\DoxyCodeLine{03215\ \ \ new\_label\_confidences\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{03216\ \ \ new\_multiclass\_scores\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{03217\ \ \ new\_masks\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{03218\ \ \ new\_keypoints\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{03219\ \ \ \textcolor{keywordflow}{if}\ label\_weights\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{03220\ \ \ \ \ new\_label\_weights\ =\ crop\_result[i]}
\DoxyCodeLine{03221\ \ \ \ \ i\ +=\ 1}
\DoxyCodeLine{03222\ \ \ \textcolor{keywordflow}{if}\ label\_confidences\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{03223\ \ \ \ \ new\_label\_confidences\ =\ crop\_result[i]}
\DoxyCodeLine{03224\ \ \ \ \ i\ +=\ 1}
\DoxyCodeLine{03225\ \ \ \textcolor{keywordflow}{if}\ multiclass\_scores\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{03226\ \ \ \ \ new\_multiclass\_scores\ =\ crop\_result[i]}
\DoxyCodeLine{03227\ \ \ \ \ i\ +=\ 1}
\DoxyCodeLine{03228\ \ \ \textcolor{keywordflow}{if}\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{03229\ \ \ \ \ new\_masks\ =\ crop\_result[i]}
\DoxyCodeLine{03230\ \ \ \ \ i\ +=\ 1}
\DoxyCodeLine{03231\ \ \ \textcolor{keywordflow}{if}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{03232\ \ \ \ \ new\_keypoints\ =\ crop\_result[i]}
\DoxyCodeLine{03233\ }
\DoxyCodeLine{03234\ \ \ result\ =\ random\_crop\_to\_aspect\_ratio(}
\DoxyCodeLine{03235\ \ \ \ \ \ \ new\_image,}
\DoxyCodeLine{03236\ \ \ \ \ \ \ new\_boxes,}
\DoxyCodeLine{03237\ \ \ \ \ \ \ new\_labels,}
\DoxyCodeLine{03238\ \ \ \ \ \ \ label\_weights=new\_label\_weights,}
\DoxyCodeLine{03239\ \ \ \ \ \ \ label\_confidences=new\_label\_confidences,}
\DoxyCodeLine{03240\ \ \ \ \ \ \ multiclass\_scores=new\_multiclass\_scores,}
\DoxyCodeLine{03241\ \ \ \ \ \ \ masks=new\_masks,}
\DoxyCodeLine{03242\ \ \ \ \ \ \ keypoints=new\_keypoints,}
\DoxyCodeLine{03243\ \ \ \ \ \ \ aspect\_ratio=aspect\_ratio,}
\DoxyCodeLine{03244\ \ \ \ \ \ \ clip\_boxes=clip\_boxes,}
\DoxyCodeLine{03245\ \ \ \ \ \ \ seed=seed,}
\DoxyCodeLine{03246\ \ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache)}
\DoxyCodeLine{03247\ }
\DoxyCodeLine{03248\ \ \ \textcolor{keywordflow}{return}\ result}
\DoxyCodeLine{03249\ }
\DoxyCodeLine{03250\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_ae771c28299fc187bd974238ae577fb02_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a6141ebcaa14a24e9903a50821b45b576}\label{namespacedetection__utils_1_1core_1_1preprocessor_a6141ebcaa14a24e9903a50821b45b576} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!ssd\_random\_crop\_pad@{ssd\_random\_crop\_pad}}
\index{ssd\_random\_crop\_pad@{ssd\_random\_crop\_pad}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{ssd\_random\_crop\_pad()}{ssd\_random\_crop\_pad()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+ssd\+\_\+random\+\_\+crop\+\_\+pad (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{boxes,  }\item[{}]{labels,  }\item[{}]{label\+\_\+weights,  }\item[{}]{label\+\_\+confidences = {\ttfamily None},  }\item[{}]{multiclass\+\_\+scores = {\ttfamily None},  }\item[{}]{min\+\_\+object\+\_\+covered = {\ttfamily (0.1,~0.3,~0.5,~0.7,~0.9,~1.0)},  }\item[{}]{aspect\+\_\+ratio\+\_\+range = {\ttfamily ((0.5,~2.0),)~\texorpdfstring{$\ast$}{*}~6},  }\item[{}]{area\+\_\+range = {\ttfamily ((0.1,~1.0),)~\texorpdfstring{$\ast$}{*}~6},  }\item[{}]{overlap\+\_\+thresh = {\ttfamily (0.1,~0.3,~0.5,~0.7,~0.9,~1.0)},  }\item[{}]{clip\+\_\+boxes = {\ttfamily (True,)~\texorpdfstring{$\ast$}{*}~6},  }\item[{}]{random\+\_\+coef = {\ttfamily (0.15,)~\texorpdfstring{$\ast$}{*}~6},  }\item[{}]{min\+\_\+padded\+\_\+size\+\_\+ratio = {\ttfamily ((1.0,~1.0),)~\texorpdfstring{$\ast$}{*}~6},  }\item[{}]{max\+\_\+padded\+\_\+size\+\_\+ratio = {\ttfamily ((2.0,~2.0),)~\texorpdfstring{$\ast$}{*}~6},  }\item[{}]{pad\+\_\+color = {\ttfamily (None,)~\texorpdfstring{$\ast$}{*}~6},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Random crop preprocessing with default parameters as in SSD paper.

Liu et al., SSD: Single shot multibox detector.
For further information on random crop preprocessing refer to RandomCrop
function above.

Args:
  image: rank 3 float32 tensor containing 1 image -> [height, width, channels]
         with pixel values varying between [0, 1].
  boxes: rank 2 float32 tensor containing the bounding boxes -> [N, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].
  labels: rank 1 int32 tensor containing the object classes.
  label_weights: float32 tensor of shape [num_instances] representing the
    weight for each box.
  label_confidences: float32 tensor of shape [num_instances] representing the
    confidences for each box.
  multiclass_scores: (optional) float32 tensor of shape
    [num_instances, num_classes] representing the score for each box for each
    class.
  min_object_covered: the cropped image must cover at least this fraction of
                      at least one of the input bounding boxes.
  aspect_ratio_range: allowed range for aspect ratio of cropped image.
  area_range: allowed range for area ratio between cropped image and the
              original image.
  overlap_thresh: minimum overlap thresh with new cropped
                  image to keep the box.
  clip_boxes: whether to clip the boxes to the cropped image.
  random_coef: a random coefficient that defines the chance of getting the
               original image. If random_coef is 0, we will always get the
               cropped image, and if it is 1.0, we will always get the
               original image.
  min_padded_size_ratio: min ratio of padded image height and width to the
                         input image's height and width.
  max_padded_size_ratio: max ratio of padded image height and width to the
                         input image's height and width.
  pad_color: padding color. A rank 1 tensor of [3] with dtype=tf.float32.
             if set as None, it will be set to average color of the randomly
             cropped image.
  seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: Image shape will be [new_height, new_width, channels].
  boxes: boxes which is the same rank as input boxes. Boxes are in normalized
         form.
  new_labels: new labels.
  new_label_weights: new label weights.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l02998}{2998}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03014\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{03015\ \ \ \textcolor{stringliteral}{"{}"{}"{}Random\ crop\ preprocessing\ with\ default\ parameters\ as\ in\ SSD\ paper.}}
\DoxyCodeLine{03016\ \textcolor{stringliteral}{}}
\DoxyCodeLine{03017\ \textcolor{stringliteral}{\ \ Liu\ et\ al.,\ SSD:\ Single\ shot\ multibox\ detector.}}
\DoxyCodeLine{03018\ \textcolor{stringliteral}{\ \ For\ further\ information\ on\ random\ crop\ preprocessing\ refer\ to\ RandomCrop}}
\DoxyCodeLine{03019\ \textcolor{stringliteral}{\ \ function\ above.}}
\DoxyCodeLine{03020\ \textcolor{stringliteral}{}}
\DoxyCodeLine{03021\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{03022\ \textcolor{stringliteral}{\ \ \ \ image:\ rank\ 3\ float32\ tensor\ containing\ 1\ image\ -\/>\ [height,\ width,\ channels]}}
\DoxyCodeLine{03023\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ }\textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 1].}
\DoxyCodeLine{03024\ \ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ -\/>\ [N,\ 4].}
\DoxyCodeLine{03025\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{03026\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{03027\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{03028\ \ \ \ \ labels:\ rank\ 1\ int32\ tensor\ containing\ the\ object\ classes.}
\DoxyCodeLine{03029\ \ \ \ \ label\_weights:\ float32\ tensor\ of\ shape\ [num\_instances]\ representing\ the}
\DoxyCodeLine{03030\ \ \ \ \ \ \ weight\ \textcolor{keywordflow}{for}\ each\ box.}
\DoxyCodeLine{03031\ \ \ \ \ label\_confidences:\ float32\ tensor\ of\ shape\ [num\_instances]\ representing\ the}
\DoxyCodeLine{03032\ \ \ \ \ \ \ confidences\ \textcolor{keywordflow}{for}\ each\ box.}
\DoxyCodeLine{03033\ \ \ \ \ multiclass\_scores:\ (optional)\ float32\ tensor\ of\ shape}
\DoxyCodeLine{03034\ \ \ \ \ \ \ [num\_instances,\ num\_classes]\ representing\ the\ score\ \textcolor{keywordflow}{for}\ each\ box\ \textcolor{keywordflow}{for}\ each}
\DoxyCodeLine{03035\ \ \ \ \ \ \ \textcolor{keyword}{class}.}
\DoxyCodeLine{03036\ \ \ \ \ min\_object\_covered:\ the\ cropped\ image\ must\ cover\ at\ least\ this\ fraction\ of}
\DoxyCodeLine{03037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ at\ least\ one\ of\ the\ input\ bounding\ boxes.}
\DoxyCodeLine{03038\ \ \ \ \ aspect\_ratio\_range:\ allowed\ range\ \textcolor{keywordflow}{for}\ aspect\ ratio\ of\ cropped\ image.}
\DoxyCodeLine{03039\ \ \ \ \ area\_range:\ allowed\ range\ \textcolor{keywordflow}{for}\ area\ ratio\ between\ cropped\ image\ \textcolor{keywordflow}{and}\ the}
\DoxyCodeLine{03040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.}
\DoxyCodeLine{03041\ \ \ \ \ overlap\_thresh:\ minimum\ overlap\ thresh\ \textcolor{keyword}{with}\ new\ cropped}
\DoxyCodeLine{03042\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ image\ to\ keep\ the\ box.}
\DoxyCodeLine{03043\ \ \ \ \ clip\_boxes:\ whether\ to\ clip\ the\ boxes\ to\ the\ cropped\ image.}
\DoxyCodeLine{03044\ \ \ \ \ random\_coef:\ a\ random\ coefficient\ that\ defines\ the\ chance\ of\ getting\ the}
\DoxyCodeLine{03045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.\ If\ random\_coef\ \textcolor{keywordflow}{is}\ 0,\ we\ will\ always\ get\ the}
\DoxyCodeLine{03046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cropped\ image,\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{if}\ it\ \textcolor{keywordflow}{is}\ 1.0,\ we\ will\ always\ get\ the}
\DoxyCodeLine{03047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.}
\DoxyCodeLine{03048\ \ \ \ \ min\_padded\_size\_ratio:\ min\ ratio\ of\ padded\ image\ height\ \textcolor{keywordflow}{and}\ width\ to\ the}
\DoxyCodeLine{03049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ input\ image\textcolor{stringliteral}{'s\ height\ and\ width.}}
\DoxyCodeLine{03050\ \textcolor{stringliteral}{\ \ \ \ max\_padded\_size\_ratio:\ max\ ratio\ of\ padded\ image\ height\ }\textcolor{keywordflow}{and}\ width\ to\ the}
\DoxyCodeLine{03051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ input\ image\textcolor{stringliteral}{'s\ height\ and\ width.}}
\DoxyCodeLine{03052\ \textcolor{stringliteral}{\ \ \ \ pad\_color:\ padding\ color.\ A\ rank\ 1\ tensor\ of\ [3]\ }\textcolor{keyword}{with}\ dtype=tf.float32.}
\DoxyCodeLine{03053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ set\ \textcolor{keyword}{as}\ \textcolor{keywordtype}{None},\ it\ will\ be\ set\ to\ average\ color\ of\ the\ randomly}
\DoxyCodeLine{03054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cropped\ image.}
\DoxyCodeLine{03055\ \ \ \ \ seed:\ random\ seed.}
\DoxyCodeLine{03056\ \ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}
\DoxyCodeLine{03057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ \textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{03058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{03059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{03060\ }
\DoxyCodeLine{03061\ \ \ Returns:}
\DoxyCodeLine{03062\ \ \ \ \ image:\ Image\ shape\ will\ be\ [new\_height,\ new\_width,\ channels].}
\DoxyCodeLine{03063\ \ \ \ \ boxes:\ boxes\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ boxes.\ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized}
\DoxyCodeLine{03064\ \ \ \ \ \ \ \ \ \ \ \ form.}
\DoxyCodeLine{03065\ \ \ \ \ new\_labels:\ new\ labels.}
\DoxyCodeLine{03066\ \ \ \ \ new\_label\_weights:\ new\ label\ weights.}
\DoxyCodeLine{03067\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{03068\ \textcolor{stringliteral}{}}
\DoxyCodeLine{03069\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{def\ }random\_crop\_pad\_selector(image\_boxes\_labels,\ index):}
\DoxyCodeLine{03070\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Random\ crop\ preprocessing\ helper."{}"{}"{}}}
\DoxyCodeLine{03071\ \ \ \ \ i\ =\ 3}
\DoxyCodeLine{03072\ \ \ \ \ image,\ boxes,\ labels\ =\ image\_boxes\_labels[:i]}
\DoxyCodeLine{03073\ \ \ \ \ selected\_label\_weights\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{03074\ \ \ \ \ selected\_label\_confidences\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{03075\ \ \ \ \ selected\_multiclass\_scores\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{03076\ \ \ \ \ \textcolor{keywordflow}{if}\ label\_weights\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{03077\ \ \ \ \ \ \ selected\_label\_weights\ =\ image\_boxes\_labels[i]}
\DoxyCodeLine{03078\ \ \ \ \ \ \ i\ +=\ 1}
\DoxyCodeLine{03079\ \ \ \ \ \textcolor{keywordflow}{if}\ label\_confidences\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{03080\ \ \ \ \ \ \ selected\_label\_confidences\ =\ image\_boxes\_labels[i]}
\DoxyCodeLine{03081\ \ \ \ \ \ \ i\ +=\ 1}
\DoxyCodeLine{03082\ \ \ \ \ \textcolor{keywordflow}{if}\ multiclass\_scores\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{03083\ \ \ \ \ \ \ selected\_multiclass\_scores\ =\ image\_boxes\_labels[i]}
\DoxyCodeLine{03084\ }
\DoxyCodeLine{03085\ \ \ \ \ \textcolor{keywordflow}{return}\ random\_crop\_pad\_image(}
\DoxyCodeLine{03086\ \ \ \ \ \ \ \ \ image,}
\DoxyCodeLine{03087\ \ \ \ \ \ \ \ \ boxes,}
\DoxyCodeLine{03088\ \ \ \ \ \ \ \ \ labels,}
\DoxyCodeLine{03089\ \ \ \ \ \ \ \ \ label\_weights=selected\_label\_weights,}
\DoxyCodeLine{03090\ \ \ \ \ \ \ \ \ label\_confidences=selected\_label\_confidences,}
\DoxyCodeLine{03091\ \ \ \ \ \ \ \ \ multiclass\_scores=selected\_multiclass\_scores,}
\DoxyCodeLine{03092\ \ \ \ \ \ \ \ \ min\_object\_covered=min\_object\_covered[index],}
\DoxyCodeLine{03093\ \ \ \ \ \ \ \ \ aspect\_ratio\_range=aspect\_ratio\_range[index],}
\DoxyCodeLine{03094\ \ \ \ \ \ \ \ \ area\_range=area\_range[index],}
\DoxyCodeLine{03095\ \ \ \ \ \ \ \ \ overlap\_thresh=overlap\_thresh[index],}
\DoxyCodeLine{03096\ \ \ \ \ \ \ \ \ clip\_boxes=clip\_boxes[index],}
\DoxyCodeLine{03097\ \ \ \ \ \ \ \ \ random\_coef=random\_coef[index],}
\DoxyCodeLine{03098\ \ \ \ \ \ \ \ \ min\_padded\_size\_ratio=min\_padded\_size\_ratio[index],}
\DoxyCodeLine{03099\ \ \ \ \ \ \ \ \ max\_padded\_size\_ratio=max\_padded\_size\_ratio[index],}
\DoxyCodeLine{03100\ \ \ \ \ \ \ \ \ pad\_color=pad\_color[index],}
\DoxyCodeLine{03101\ \ \ \ \ \ \ \ \ seed=seed,}
\DoxyCodeLine{03102\ \ \ \ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache)}
\DoxyCodeLine{03103\ }
\DoxyCodeLine{03104\ \ \ \textcolor{keywordflow}{return}\ \_apply\_with\_random\_selector\_tuples(}
\DoxyCodeLine{03105\ \ \ \ \ \ \ tuple(t\ \textcolor{keywordflow}{for}\ t\ \textcolor{keywordflow}{in}\ (image,\ boxes,\ labels,\ label\_weights,\ label\_confidences,}
\DoxyCodeLine{03106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ multiclass\_scores)\ \textcolor{keywordflow}{if}\ t\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}),}
\DoxyCodeLine{03107\ \ \ \ \ \ \ random\_crop\_pad\_selector,}
\DoxyCodeLine{03108\ \ \ \ \ \ \ num\_cases=len(min\_object\_covered),}
\DoxyCodeLine{03109\ \ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache,}
\DoxyCodeLine{03110\ \ \ \ \ \ \ key=preprocessor\_cache.PreprocessorCache.SSD\_CROP\_PAD\_SELECTOR\_ID)}
\DoxyCodeLine{03111\ }
\DoxyCodeLine{03112\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_a6141ebcaa14a24e9903a50821b45b576_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_ac4cb1ebd49aea7a953dff66c0b64cc19}\label{namespacedetection__utils_1_1core_1_1preprocessor_ac4cb1ebd49aea7a953dff66c0b64cc19} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!ssd\_random\_crop\_pad\_fixed\_aspect\_ratio@{ssd\_random\_crop\_pad\_fixed\_aspect\_ratio}}
\index{ssd\_random\_crop\_pad\_fixed\_aspect\_ratio@{ssd\_random\_crop\_pad\_fixed\_aspect\_ratio}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{ssd\_random\_crop\_pad\_fixed\_aspect\_ratio()}{ssd\_random\_crop\_pad\_fixed\_aspect\_ratio()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+ssd\+\_\+random\+\_\+crop\+\_\+pad\+\_\+fixed\+\_\+aspect\+\_\+ratio (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{boxes,  }\item[{}]{labels,  }\item[{}]{label\+\_\+weights,  }\item[{}]{label\+\_\+confidences = {\ttfamily None},  }\item[{}]{multiclass\+\_\+scores = {\ttfamily None},  }\item[{}]{masks = {\ttfamily None},  }\item[{}]{keypoints = {\ttfamily None},  }\item[{}]{min\+\_\+object\+\_\+covered = {\ttfamily (0.0,~0.1,~0.3,~0.5,~0.7,~0.9,~1.0)},  }\item[{}]{aspect\+\_\+ratio = {\ttfamily 1.0},  }\item[{}]{aspect\+\_\+ratio\+\_\+range = {\ttfamily ((0.5,~2.0),)~\texorpdfstring{$\ast$}{*}~7},  }\item[{}]{area\+\_\+range = {\ttfamily ((0.1,~1.0),)~\texorpdfstring{$\ast$}{*}~7},  }\item[{}]{overlap\+\_\+thresh = {\ttfamily (0.0,~0.1,~0.3,~0.5,~0.7,~0.9,~1.0)},  }\item[{}]{clip\+\_\+boxes = {\ttfamily (True,)~\texorpdfstring{$\ast$}{*}~7},  }\item[{}]{random\+\_\+coef = {\ttfamily (0.15,)~\texorpdfstring{$\ast$}{*}~7},  }\item[{}]{min\+\_\+padded\+\_\+size\+\_\+ratio = {\ttfamily (1.0,~1.0)},  }\item[{}]{max\+\_\+padded\+\_\+size\+\_\+ratio = {\ttfamily (2.0,~2.0)},  }\item[{}]{seed = {\ttfamily None},  }\item[{}]{preprocess\+\_\+vars\+\_\+cache = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Random crop and pad preprocessing with default parameters as in SSD paper.

Liu et al., SSD: Single shot multibox detector.
For further information on random crop preprocessing refer to RandomCrop
function above.

The only difference is that after the initial crop, images are zero-padded
to a fixed aspect ratio instead of being resized to that aspect ratio.

Args:
  image: rank 3 float32 tensor contains 1 image -> [height, width, channels]
         with pixel values varying between [0, 1].
  boxes: rank 2 float32 tensor containing the bounding boxes -> [N, 4].
         Boxes are in normalized form meaning their coordinates vary
         between [0, 1].
         Each row is in the form of [ymin, xmin, ymax, xmax].
  labels: rank 1 int32 tensor containing the object classes.
  label_weights: float32 tensor of shape [num_instances] representing the
    weight for each box.
  label_confidences: (optional) float32 tensor of shape [num_instances]
    representing the confidence for each box.
  multiclass_scores: (optional) float32 tensor of shape
    [num_instances, num_classes] representing the score for each box for each
    class.
  masks: (optional) rank 3 float32 tensor with shape
         [num_instances, height, width] containing instance masks. The masks
         are of the same height, width as the input `image`.
  keypoints: (optional) rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]. The keypoints are in y-x
             normalized coordinates.
  min_object_covered: the cropped image must cover at least this fraction of
                      at least one of the input bounding boxes.
  aspect_ratio: the final aspect ratio to pad to.
  aspect_ratio_range: allowed range for aspect ratio of cropped image.
  area_range: allowed range for area ratio between cropped image and the
              original image.
  overlap_thresh: minimum overlap thresh with new cropped
                  image to keep the box.
  clip_boxes: whether to clip the boxes to the cropped image.
  random_coef: a random coefficient that defines the chance of getting the
               original image. If random_coef is 0, we will always get the
               cropped image, and if it is 1.0, we will always get the
               original image.
  min_padded_size_ratio: min ratio of padded image height and width to the
                         input image's height and width.
  max_padded_size_ratio: max ratio of padded image height and width to the
                         input image's height and width.
  seed: random seed.
  preprocess_vars_cache: PreprocessorCache object that records previously
                         performed augmentations. Updated in-place. If this
                         function is called multiple times with the same
                         non-null cache, it will perform deterministically.

Returns:
  image: image which is the same rank as input image.
  boxes: boxes which is the same rank as input boxes.
         Boxes are in normalized form.
  labels: new labels.

  If multiclass_scores, masks, or keypoints is not None, the function also
  returns:

  multiclass_scores: rank 2 with shape [num_instances, num_classes]
  masks: rank 3 float32 tensor with shape [num_instances, height, width]
         containing instance masks.
  keypoints: rank 3 float32 tensor with shape
             [num_instances, num_keypoints, 2]
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l03251}{3251}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{03270\ \ \ \ \ preprocess\_vars\_cache=\textcolor{keywordtype}{None}):}
\DoxyCodeLine{03271\ \ \ \textcolor{stringliteral}{"{}"{}"{}Random\ crop\ and\ pad\ preprocessing\ with\ default\ parameters\ as\ in\ SSD\ paper.}}
\DoxyCodeLine{03272\ \textcolor{stringliteral}{}}
\DoxyCodeLine{03273\ \textcolor{stringliteral}{\ \ Liu\ et\ al.,\ SSD:\ Single\ shot\ multibox\ detector.}}
\DoxyCodeLine{03274\ \textcolor{stringliteral}{\ \ For\ further\ information\ on\ random\ crop\ preprocessing\ refer\ to\ RandomCrop}}
\DoxyCodeLine{03275\ \textcolor{stringliteral}{\ \ function\ above.}}
\DoxyCodeLine{03276\ \textcolor{stringliteral}{}}
\DoxyCodeLine{03277\ \textcolor{stringliteral}{\ \ The\ only\ difference\ }\textcolor{keywordflow}{is}\ that\ after\ the\ initial\ crop,\ images\ are\ zero-\/padded}
\DoxyCodeLine{03278\ \ \ to\ a\ fixed\ aspect\ ratio\ instead\ of\ being\ resized\ to\ that\ aspect\ ratio.}
\DoxyCodeLine{03279\ }
\DoxyCodeLine{03280\ \ \ Args:}
\DoxyCodeLine{03281\ \ \ \ \ image:\ rank\ 3\ float32\ tensor\ contains\ 1\ image\ -\/>\ [height,\ width,\ channels]}
\DoxyCodeLine{03282\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ pixel\ values\ varying\ between\ [0,\ 1].}
\DoxyCodeLine{03283\ \ \ \ \ boxes:\ rank\ 2\ float32\ tensor\ containing\ the\ bounding\ boxes\ -\/>\ [N,\ 4].}
\DoxyCodeLine{03284\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form\ meaning\ their\ coordinates\ vary}
\DoxyCodeLine{03285\ \ \ \ \ \ \ \ \ \ \ \ between\ [0,\ 1].}
\DoxyCodeLine{03286\ \ \ \ \ \ \ \ \ \ \ \ Each\ row\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{in}\ the\ form\ of\ [ymin,\ xmin,\ ymax,\ xmax].}
\DoxyCodeLine{03287\ \ \ \ \ labels:\ rank\ 1\ int32\ tensor\ containing\ the\ object\ classes.}
\DoxyCodeLine{03288\ \ \ \ \ label\_weights:\ float32\ tensor\ of\ shape\ [num\_instances]\ representing\ the}
\DoxyCodeLine{03289\ \ \ \ \ \ \ weight\ \textcolor{keywordflow}{for}\ each\ box.}
\DoxyCodeLine{03290\ \ \ \ \ label\_confidences:\ (optional)\ float32\ tensor\ of\ shape\ [num\_instances]}
\DoxyCodeLine{03291\ \ \ \ \ \ \ representing\ the\ confidence\ \textcolor{keywordflow}{for}\ each\ box.}
\DoxyCodeLine{03292\ \ \ \ \ multiclass\_scores:\ (optional)\ float32\ tensor\ of\ shape}
\DoxyCodeLine{03293\ \ \ \ \ \ \ [num\_instances,\ num\_classes]\ representing\ the\ score\ \textcolor{keywordflow}{for}\ each\ box\ \textcolor{keywordflow}{for}\ each}
\DoxyCodeLine{03294\ \ \ \ \ \ \ \textcolor{keyword}{class}.}
\DoxyCodeLine{03295\ \ \ \ \ masks:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{03296\ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ height,\ width]\ containing\ instance\ masks.\ The\ masks}
\DoxyCodeLine{03297\ \ \ \ \ \ \ \ \ \ \ \ are\ of\ the\ same\ height,\ width\ \textcolor{keyword}{as}\ the\ input\ \`{}image\`{}.}
\DoxyCodeLine{03298\ \ \ \ \ keypoints:\ (optional)\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{03299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2].\ The\ keypoints\ are\ \textcolor{keywordflow}{in}\ y-\/x}
\DoxyCodeLine{03300\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ normalized\ coordinates.}
\DoxyCodeLine{03301\ \ \ \ \ min\_object\_covered:\ the\ cropped\ image\ must\ cover\ at\ least\ this\ fraction\ of}
\DoxyCodeLine{03302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ at\ least\ one\ of\ the\ input\ bounding\ boxes.}
\DoxyCodeLine{03303\ \ \ \ \ aspect\_ratio:\ the\ final\ aspect\ ratio\ to\ pad\ to.}
\DoxyCodeLine{03304\ \ \ \ \ aspect\_ratio\_range:\ allowed\ range\ \textcolor{keywordflow}{for}\ aspect\ ratio\ of\ cropped\ image.}
\DoxyCodeLine{03305\ \ \ \ \ area\_range:\ allowed\ range\ \textcolor{keywordflow}{for}\ area\ ratio\ between\ cropped\ image\ \textcolor{keywordflow}{and}\ the}
\DoxyCodeLine{03306\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.}
\DoxyCodeLine{03307\ \ \ \ \ overlap\_thresh:\ minimum\ overlap\ thresh\ \textcolor{keyword}{with}\ new\ cropped}
\DoxyCodeLine{03308\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ image\ to\ keep\ the\ box.}
\DoxyCodeLine{03309\ \ \ \ \ clip\_boxes:\ whether\ to\ clip\ the\ boxes\ to\ the\ cropped\ image.}
\DoxyCodeLine{03310\ \ \ \ \ random\_coef:\ a\ random\ coefficient\ that\ defines\ the\ chance\ of\ getting\ the}
\DoxyCodeLine{03311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.\ If\ random\_coef\ \textcolor{keywordflow}{is}\ 0,\ we\ will\ always\ get\ the}
\DoxyCodeLine{03312\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cropped\ image,\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{if}\ it\ \textcolor{keywordflow}{is}\ 1.0,\ we\ will\ always\ get\ the}
\DoxyCodeLine{03313\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ original\ image.}
\DoxyCodeLine{03314\ \ \ \ \ min\_padded\_size\_ratio:\ min\ ratio\ of\ padded\ image\ height\ \textcolor{keywordflow}{and}\ width\ to\ the}
\DoxyCodeLine{03315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ input\ image\textcolor{stringliteral}{'s\ height\ and\ width.}}
\DoxyCodeLine{03316\ \textcolor{stringliteral}{\ \ \ \ max\_padded\_size\_ratio:\ max\ ratio\ of\ padded\ image\ height\ }\textcolor{keywordflow}{and}\ width\ to\ the}
\DoxyCodeLine{03317\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ input\ image\textcolor{stringliteral}{'s\ height\ and\ width.}}
\DoxyCodeLine{03318\ \textcolor{stringliteral}{\ \ \ \ seed:\ random\ seed.}}
\DoxyCodeLine{03319\ \textcolor{stringliteral}{\ \ \ \ preprocess\_vars\_cache:\ PreprocessorCache\ object\ that\ records\ previously}}
\DoxyCodeLine{03320\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ performed\ augmentations.\ Updated\ }\textcolor{keywordflow}{in}-\/place.\ If\ this}
\DoxyCodeLine{03321\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ function\ \textcolor{keywordflow}{is}\ called\ multiple\ times\ \textcolor{keyword}{with}\ the\ same}
\DoxyCodeLine{03322\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ non-\/null\ cache,\ it\ will\ perform\ deterministically.}
\DoxyCodeLine{03323\ }
\DoxyCodeLine{03324\ \ \ Returns:}
\DoxyCodeLine{03325\ \ \ \ \ image:\ image\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ image.}
\DoxyCodeLine{03326\ \ \ \ \ boxes:\ boxes\ which\ \textcolor{keywordflow}{is}\ the\ same\ rank\ \textcolor{keyword}{as}\ input\ boxes.}
\DoxyCodeLine{03327\ \ \ \ \ \ \ \ \ \ \ \ Boxes\ are\ \textcolor{keywordflow}{in}\ normalized\ form.}
\DoxyCodeLine{03328\ \ \ \ \ labels:\ new\ labels.}
\DoxyCodeLine{03329\ }
\DoxyCodeLine{03330\ \ \ \ \ If\ multiclass\_scores,\ masks,\ \textcolor{keywordflow}{or}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None},\ the\ function\ also}
\DoxyCodeLine{03331\ \ \ \ \ returns:}
\DoxyCodeLine{03332\ }
\DoxyCodeLine{03333\ \ \ \ \ multiclass\_scores:\ rank\ 2\ \textcolor{keyword}{with}\ shape\ [num\_instances,\ num\_classes]}
\DoxyCodeLine{03334\ \ \ \ \ masks:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape\ [num\_instances,\ height,\ width]}
\DoxyCodeLine{03335\ \ \ \ \ \ \ \ \ \ \ \ containing\ instance\ masks.}
\DoxyCodeLine{03336\ \ \ \ \ keypoints:\ rank\ 3\ float32\ tensor\ \textcolor{keyword}{with}\ shape}
\DoxyCodeLine{03337\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [num\_instances,\ num\_keypoints,\ 2]}
\DoxyCodeLine{03338\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{03339\ \textcolor{stringliteral}{\ \ crop\_result\ =\ ssd\_random\_crop(}}
\DoxyCodeLine{03340\ \textcolor{stringliteral}{\ \ \ \ \ \ image,}}
\DoxyCodeLine{03341\ \textcolor{stringliteral}{\ \ \ \ \ \ boxes,}}
\DoxyCodeLine{03342\ \textcolor{stringliteral}{\ \ \ \ \ \ labels,}}
\DoxyCodeLine{03343\ \textcolor{stringliteral}{\ \ \ \ \ \ label\_weights=label\_weights,}}
\DoxyCodeLine{03344\ \textcolor{stringliteral}{\ \ \ \ \ \ label\_confidences=label\_confidences,}}
\DoxyCodeLine{03345\ \textcolor{stringliteral}{\ \ \ \ \ \ multiclass\_scores=multiclass\_scores,}}
\DoxyCodeLine{03346\ \textcolor{stringliteral}{\ \ \ \ \ \ masks=masks,}}
\DoxyCodeLine{03347\ \textcolor{stringliteral}{\ \ \ \ \ \ keypoints=keypoints,}}
\DoxyCodeLine{03348\ \textcolor{stringliteral}{\ \ \ \ \ \ min\_object\_covered=min\_object\_covered,}}
\DoxyCodeLine{03349\ \textcolor{stringliteral}{\ \ \ \ \ \ aspect\_ratio\_range=aspect\_ratio\_range,}}
\DoxyCodeLine{03350\ \textcolor{stringliteral}{\ \ \ \ \ \ area\_range=area\_range,}}
\DoxyCodeLine{03351\ \textcolor{stringliteral}{\ \ \ \ \ \ overlap\_thresh=overlap\_thresh,}}
\DoxyCodeLine{03352\ \textcolor{stringliteral}{\ \ \ \ \ \ clip\_boxes=clip\_boxes,}}
\DoxyCodeLine{03353\ \textcolor{stringliteral}{\ \ \ \ \ \ random\_coef=random\_coef,}}
\DoxyCodeLine{03354\ \textcolor{stringliteral}{\ \ \ \ \ \ seed=seed,}}
\DoxyCodeLine{03355\ \textcolor{stringliteral}{\ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache)}}
\DoxyCodeLine{03356\ \textcolor{stringliteral}{\ \ i\ =\ 3}}
\DoxyCodeLine{03357\ \textcolor{stringliteral}{\ \ new\_image,\ new\_boxes,\ new\_labels\ =\ crop\_result[:i]}}
\DoxyCodeLine{03358\ \textcolor{stringliteral}{\ \ new\_label\_weights\ =\ }\textcolor{keywordtype}{None}}
\DoxyCodeLine{03359\ \ \ new\_label\_confidences\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{03360\ \ \ new\_multiclass\_scores\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{03361\ \ \ new\_masks\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{03362\ \ \ new\_keypoints\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{03363\ \ \ \textcolor{keywordflow}{if}\ label\_weights\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{03364\ \ \ \ \ new\_label\_weights\ =\ crop\_result[i]}
\DoxyCodeLine{03365\ \ \ \ \ i\ +=\ 1}
\DoxyCodeLine{03366\ \ \ \textcolor{keywordflow}{if}\ label\_confidences\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{03367\ \ \ \ \ new\_label\_confidences\ =\ crop\_result[i]}
\DoxyCodeLine{03368\ \ \ \ \ i\ +=\ 1}
\DoxyCodeLine{03369\ \ \ \textcolor{keywordflow}{if}\ multiclass\_scores\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{03370\ \ \ \ \ new\_multiclass\_scores\ =\ crop\_result[i]}
\DoxyCodeLine{03371\ \ \ \ \ i\ +=\ 1}
\DoxyCodeLine{03372\ \ \ \textcolor{keywordflow}{if}\ masks\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{03373\ \ \ \ \ new\_masks\ =\ crop\_result[i]}
\DoxyCodeLine{03374\ \ \ \ \ i\ +=\ 1}
\DoxyCodeLine{03375\ \ \ \textcolor{keywordflow}{if}\ keypoints\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{03376\ \ \ \ \ new\_keypoints\ =\ crop\_result[i]}
\DoxyCodeLine{03377\ }
\DoxyCodeLine{03378\ \ \ result\ =\ random\_pad\_to\_aspect\_ratio(}
\DoxyCodeLine{03379\ \ \ \ \ \ \ new\_image,}
\DoxyCodeLine{03380\ \ \ \ \ \ \ new\_boxes,}
\DoxyCodeLine{03381\ \ \ \ \ \ \ masks=new\_masks,}
\DoxyCodeLine{03382\ \ \ \ \ \ \ keypoints=new\_keypoints,}
\DoxyCodeLine{03383\ \ \ \ \ \ \ aspect\_ratio=aspect\_ratio,}
\DoxyCodeLine{03384\ \ \ \ \ \ \ min\_padded\_size\_ratio=min\_padded\_size\_ratio,}
\DoxyCodeLine{03385\ \ \ \ \ \ \ max\_padded\_size\_ratio=max\_padded\_size\_ratio,}
\DoxyCodeLine{03386\ \ \ \ \ \ \ seed=seed,}
\DoxyCodeLine{03387\ \ \ \ \ \ \ preprocess\_vars\_cache=preprocess\_vars\_cache)}
\DoxyCodeLine{03388\ }
\DoxyCodeLine{03389\ \ \ result\ =\ list(result)}
\DoxyCodeLine{03390\ \ \ i\ =\ 3}
\DoxyCodeLine{03391\ \ \ result.insert(2,\ new\_labels)}
\DoxyCodeLine{03392\ \ \ \textcolor{keywordflow}{if}\ new\_label\_weights\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{03393\ \ \ \ \ result.insert(i,\ new\_label\_weights)}
\DoxyCodeLine{03394\ \ \ \ \ i\ +=\ 1}
\DoxyCodeLine{03395\ \ \ \textcolor{keywordflow}{if}\ new\_label\_confidences\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{03396\ \ \ \ \ result.insert(i,\ new\_label\_confidences)}
\DoxyCodeLine{03397\ \ \ \ \ i\ +=\ 1}
\DoxyCodeLine{03398\ \ \ \textcolor{keywordflow}{if}\ multiclass\_scores\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{03399\ \ \ \ \ result.insert(i,\ new\_multiclass\_scores)}
\DoxyCodeLine{03400\ \ \ result\ =\ tuple(result)}
\DoxyCodeLine{03401\ }
\DoxyCodeLine{03402\ \ \ \textcolor{keywordflow}{return}\ result}
\DoxyCodeLine{03403\ }
\DoxyCodeLine{03404\ }

\end{DoxyCode}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/da5/namespacedetection__utils_1_1core_1_1preprocessor_ac4cb1ebd49aea7a953dff66c0b64cc19_cgraph}
\end{center}
\end{figure}
\Hypertarget{namespacedetection__utils_1_1core_1_1preprocessor_a42ac33ac786175636312abd4941aa915}\label{namespacedetection__utils_1_1core_1_1preprocessor_a42ac33ac786175636312abd4941aa915} 
\index{detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}!subtract\_channel\_mean@{subtract\_channel\_mean}}
\index{subtract\_channel\_mean@{subtract\_channel\_mean}!detection\_utils.core.preprocessor@{detection\_utils.core.preprocessor}}
\doxysubsubsection{\texorpdfstring{subtract\_channel\_mean()}{subtract\_channel\_mean()}}
{\footnotesize\ttfamily detection\+\_\+utils.\+core.\+preprocessor.\+subtract\+\_\+channel\+\_\+mean (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{means = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Normalizes an image by subtracting a mean from each channel.

Args:
  image: A 3D tensor of shape [height, width, channels]
  means: float list containing a mean for each channel
Returns:
  normalized_images: a tensor of shape [height, width, channels]
Raises:
  ValueError: if images is not a 4D tensor or if the number of means is not
    equal to the number of channels.
\end{DoxyVerb}
 

Definition at line \mbox{\hyperlink{preprocessor_8py_source_l02692}{2692}} of file \mbox{\hyperlink{preprocessor_8py_source}{preprocessor.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{02692\ \textcolor{keyword}{def\ }subtract\_channel\_mean(image,\ means=None):}
\DoxyCodeLine{02693\ \ \ \textcolor{stringliteral}{"{}"{}"{}Normalizes\ an\ image\ by\ subtracting\ a\ mean\ from\ each\ channel.}}
\DoxyCodeLine{02694\ \textcolor{stringliteral}{}}
\DoxyCodeLine{02695\ \textcolor{stringliteral}{\ \ Args:}}
\DoxyCodeLine{02696\ \textcolor{stringliteral}{\ \ \ \ image:\ A\ 3D\ tensor\ of\ shape\ [height,\ width,\ channels]}}
\DoxyCodeLine{02697\ \textcolor{stringliteral}{\ \ \ \ means:\ float\ list\ containing\ a\ mean\ }\textcolor{keywordflow}{for}\ each\ channel}
\DoxyCodeLine{02698\ \ \ Returns:}
\DoxyCodeLine{02699\ \ \ \ \ normalized\_images:\ a\ tensor\ of\ shape\ [height,\ width,\ channels]}
\DoxyCodeLine{02700\ \ \ Raises:}
\DoxyCodeLine{02701\ \ \ \ \ ValueError:\ \textcolor{keywordflow}{if}\ images\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ a\ 4D\ tensor\ \textcolor{keywordflow}{or}\ \textcolor{keywordflow}{if}\ the\ number\ of\ means\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}}
\DoxyCodeLine{02702\ \ \ \ \ \ \ equal\ to\ the\ number\ of\ channels.}
\DoxyCodeLine{02703\ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{02704\ \textcolor{stringliteral}{\ \ }\textcolor{keyword}{with}\ tf.name\_scope(\textcolor{stringliteral}{'SubtractChannelMean'},\ values=[image,\ means]):}
\DoxyCodeLine{02705\ \ \ \ \ \textcolor{keywordflow}{if}\ len(image.get\_shape())\ !=\ 3:}
\DoxyCodeLine{02706\ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'Input\ must\ be\ of\ size\ [height,\ width,\ channels]'})}
\DoxyCodeLine{02707\ \ \ \ \ \textcolor{keywordflow}{if}\ len(means)\ !=\ image.get\_shape()[-\/1]:}
\DoxyCodeLine{02708\ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ ValueError(\textcolor{stringliteral}{'len(means)\ must\ match\ the\ number\ of\ channels'})}
\DoxyCodeLine{02709\ \ \ \ \ \textcolor{keywordflow}{return}\ image\ -\/\ [[means]]}
\DoxyCodeLine{02710\ }
\DoxyCodeLine{02711\ }

\end{DoxyCode}
